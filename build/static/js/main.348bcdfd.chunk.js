(this["webpackJsonpgame-blockprobe-web"]=this["webpackJsonpgame-blockprobe-web"]||[]).push([[0],{1053:function(e,t,a){},1054:function(e,t,a){e.exports=a.p+"static/media/logo.5d5d9eef.svg"},1055:function(e,t,a){},1123:function(e,t,a){},1139:function(e,t,a){},1286:function(e,t){},1288:function(e,t){},1299:function(e,t){},1301:function(e,t){},1326:function(e,t){},1328:function(e,t){},1329:function(e,t){},1335:function(e,t){},1337:function(e,t){},1355:function(e,t){},1358:function(e,t){},1374:function(e,t){},1377:function(e,t){},1411:function(e,t,a){},1426:function(e,t,a){},1427:function(e,t,a){},1428:function(e,t,a){},1433:function(e,t,a){},1434:function(e,t,a){},1436:function(e,t,a){},1460:function(e,t,a){},1461:function(e,t,a){},1462:function(e,t,a){},1463:function(e,t,a){},1507:function(e,t,a){},1508:function(e,t,a){},1509:function(e,t,a){},1513:function(e,t,a){},1514:function(e,t,a){},1515:function(e,t,a){},1619:function(e,t,a){},1620:function(e,t,a){},1621:function(e,t,a){},1622:function(e,t,a){},1623:function(e,t,a){},1625:function(e,t,a){},1657:function(e,t){},1677:function(e,t,a){},1678:function(e,t,a){},1679:function(e,t,a){},1680:function(e,t,a){},1681:function(e,t,a){},1682:function(e,t,a){},1683:function(e,t,a){},1684:function(e,t,a){},1685:function(e,t,a){},1686:function(e,t,a){},1687:function(e,t,a){},1688:function(e,t,a){},1700:function(e,t,a){},1701:function(e,t,a){"use strict";a.r(t);a(940),a(950);var i=a(0),n=a.n(i),s=a(50),l=a.n(s),r=(a(1053),a(26)),o=a(27),c=a(29),d=a(28),u=(a(1054),a(1055),a(1790)),h=a(1792),p=a(1793),m=a(1789),b=a(15),f=a.n(b),g=a(465),k=a(31),v=a(3),y=a(14),E=(a(128),a(1123),a(46)),S=a(49),O=a(39),B=a(95),T=a.n(B),w=(a(514),a(515),a(854)),N=a.n(w),x=(a(1139),a(855)),j=a.n(x),C=a(860),I=a.n(C),L=a(6),D=function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).state={summBlocks:[],summBlockIdx:0,isContentActive:!0},i.getTitle=i.getTitle.bind(Object(v.a)(i)),i.getSummary=i.getSummary.bind(Object(v.a)(i)),i.removeHashedIndex=i.removeHashedIndex.bind(Object(v.a)(i)),i.clickChevron=i.clickChevron.bind(Object(v.a)(i)),i.clickSummaryBlock=i.clickSummaryBlock.bind(Object(v.a)(i)),E.a.initialize("UA-143383035-1"),i}return Object(o.a)(a,[{key:"removeHashedIndex",value:function(e){var t=0;if((e=e.trim()).length>0&&"#"==e[0]){for(var a=1;a<e.length;a++)if(t=a," "==e.charAt(a))return e.substring(t).trim();return""}return e}},{key:"clickSummaryBlock",value:function(){this.props.summaryBlocks&&this.state.summBlockIdx<this.props.summaryBlocks.length&&this.state.summBlockIdx>=0&&(E.a.event({category:"select_summaryBlock",action:"Select "+JSON.stringify(this.props.summaryBlocks[this.state.summBlockIdx]),label:JSON.stringify(this.props.summaryBlocks[this.state.summBlockIdx])}),this.props.selectBlock(this.props.summaryBlocks[this.state.summBlockIdx]))}},{key:"componentDidMount",value:function(){var e=this;this.timeout=setInterval((function(){if(!Object(L.isNullOrUndefined)(e.props.summaryBlocks)){var t=e.state.summBlockIdx,a=Math.max(1,e.props.summaryBlocks.length);e.setState({isContentActive:!1});var i=e;e.timeout=setTimeout((function(){i.setState({summBlockIdx:(t+1)%a,isContentActive:!0})}),500)}}),11e3)}},{key:"getTitle",value:function(){return Object(L.isNullOrUndefined)(this.props.summaryBlocks)||0==this.props.summaryBlocks.length?"":this.removeHashedIndex(this.props.summaryBlocks[this.state.summBlockIdx].title)}},{key:"getSummary",value:function(){return Object(L.isNullOrUndefined)(this.props.summaryBlocks)||0==this.props.summaryBlocks.length?"":this.props.summaryBlocks[this.state.summBlockIdx].summary}},{key:"clickChevron",value:function(e){if(!Object(L.isNullOrUndefined)(this.props.summaryBlocks)){var t=this.state.summBlockIdx,a=Math.max(1,this.props.summaryBlocks.length);t=e?(t+1)%a:(t+a-1)%a,this.setState({summBlockIdx:t})}}},{key:"render",value:function(){var e=this;return n.a.createElement("div",{className:"summary-container"},n.a.createElement("div",{style:{width:"5%",cursor:"pointer",transition:"0.5s"}},n.a.createElement(j.a,{className:"summaryContent-nav",onClick:function(){e.clickChevron(!1)}})),n.a.createElement("div",{className:"color-gradient summaryView-container",onClick:function(){e.clickSummaryBlock()}},n.a.createElement(N.a,{transitionName:"summaryContent",transitionAppear:!0,transitionAppearTimeout:500,transitionEnter:!0,transitionEnterTimeout:500,transitionLeave:!0,transitionLeaveTimeout:500},this.state.isContentActive?n.a.createElement("div",null,n.a.createElement("div",{className:"summaryView-title"},this.getTitle()),n.a.createElement("p",{className:"summaryView-desc"},this.getSummary())):null)),n.a.createElement("div",{style:{width:"5%",cursor:"pointer",transition:"0.5s"}},n.a.createElement(I.a,{className:"summaryContent-nav",onClick:function(){e.clickChevron(!0)}})))}}]),a}(n.a.Component),U=a(97),A=a.n(U),G=a(341),P=a.n(G),M=(a(539),a(256),a(311),a(102)),F=a.n(M),V=a(208),R=a.n(V),W=a(61),J=a(286),H=a(239),z=a(287),_=a(349);W.i(z.a);var Y=function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).generateAmForceDirectedGraph=i.generateAmForceDirectedGraph.bind(Object(v.a)(i)),i.prepareData=i.prepareData.bind(Object(v.a)(i)),i.chart={},i.selectedLink=null,i.previousChart=JSON.parse(JSON.stringify(e.graph)),i}return Object(o.a)(a,[{key:"prepareData",value:function(e){for(var t=[],a=0;e&&a<e.length;a++){var i=JSON.parse(JSON.stringify(e[a]));i.image&&i.image.length>0?(i.imageDisabled=!1,i.circleDisabled=!0):(i.imageDisabled=!0,i.circleDisabled=!1),"ALL"==i.label?(i.isNotAll=!1,i.imageDisabled=!0,i.circleDisabled=!0):i.isNotAll=!0,t.push(i)}return t}},{key:"generateAmForceDirectedGraph",value:function(){var e=W.f("chartdiv",H.b),t=e.series.push(new H.a);t.data=this.prepareData(this.props.graph),t.dataFields.value="value",t.dataFields.name="label",t.dataFields.id="id",t.dataFields.children="children",t.dataFields.linkWith="link",t.nodes.template.label.text="{name}",t.nodes.template.tooltipText="{name}",t.nodes.template.label.valign="bottom",t.nodes.template.label.fill=W.e("#000"),t.nodes.template.label.dy=-30,t.fontSize=13,t.minRadius=10,t.maxRadius=10,t.nodes.template.label.propertyFields.hidden="circleDisabled",t.nodes.template.togglable=!1,t.nodes.template.circle.propertyFields.disabled="circleDisabled",t.nodes.template.outerCircle.propertyFields.disabled="circleDisabled";var a=t.nodes.template.createChild(_.a);a.image=new W.c,a.image.propertyFields.href="image",a.circle.radius=25,a.circle.strokeWidth=0,a.background.pointerLength=0,a.background.disabled=!0;var i=a.createChild(W.a);i.adapter.add("radius",(function(e,t){return t.parent.circle.radius+2})),i.propertyFields.disabled="imageDisabled";var n=t.nodes.template.createChild(W.d);n.width=35,n.height=15,n.depth=35,n.angle=45,n.strokeOpacity=1,n.strokeWidth=1.25,n.stroke=W.e("black"),n.fillOpacity=.85,n.fill=W.e("rgb(240,240,240)"),n.propertyFields.disabled="isNotAll",t.centerStrength=.55,t.manyBodyStrength=-38,t.links.template.strength=.5,t.links.template.strokeWidth=5;var s=this;t.links.template.interactionsEnabled=!0,t.links.template.clickable=!0,t.links.template.distance=8.5,t.links.template.events.on("hit",(function(e){var t=e.target;t.strokeWidth=9,s.selectedLink&&(s.selectedLink.strokeWidth=5),s.selectedLink=t,s.props.selectEdge(t.source.label.currentText,t.target.label.currentText)})),t.nodes.template.events.on("hit",(function(e){var t=e.target;s.selectedLink&&(s.selectedLink.strokeWidth=5),s.selectedLink=null,s.props.selectNode(t.label.currentText)})),this.chart=e}},{key:"componentDidMount",value:function(){this.generateAmForceDirectedGraph()}},{key:"componentDidUpdate",value:function(){JSON.stringify(this.previousChart)!=JSON.stringify(this.props.graph)&&(this.generateAmForceDirectedGraph(),this.previousChart=JSON.parse(JSON.stringify(this.props.graph)))}},{key:"render",value:function(){return n.a.createElement("div",{id:"chartdiv",style:{width:"100%",height:"100%"}})}}]),a}(n.a.Component),K=a(211),q=a.n(K),X=a(438),Q=a.n(X),$=a(437),Z=a.n($),ee=a(345),te=a.n(ee),ae=a(346),ie=a.n(ae),ne=a(282),se=a.n(ne),le=a(585),re=["Jan","Feb","March","April","May","June","July","Aug","Sep","Oct","Nov","Dec"],oe=function(e){var t=e,a=0,i=[],n=[];if(null!=t&&Object.keys(t).map((function(e,s){if(a&&a%100==0){var l={blocks:n};i.push(l),n=[]}var r=t[e];null!=r&&(r.previousKey&&(r.parent=r.previousKey),r.children||(r.children=[]),r.actionType&&(Object.keys(r).map((function(e){void 0==r[e]&&delete r[e]})),n.push(r),a++))})),n.length>0){var s={blocks:n};i.push(s),n=[]}return i},ce=function(e){var t=e,a=0,i=[],n=[];if(null!=t&&Object.keys(t).map((function(e,s){if(a&&a%200==0){var l={images:n};i.push(l),n=[]}var r={url:t[e],entity:e};null!=r&&(Object.keys(r).map((function(e){void 0==r[e]&&delete r[e]})),n.push(r),a++)})),n.length>0){var s={images:n};i.push(s),n=[]}return i},de=function(e){for(var t=[],a="",i=0;!Object(L.isNullOrUndefined)(e)&&i<e.length;i++)a+=e[i],i&&i%1e4==0&&(t.push(a),a="");return a.length>0&&t.push(a),t},ue=function(e){if(Object(L.isNullOrUndefined)(e))return null;var t=e.title;if(Object(L.isNullOrUndefined)(t))return null;var a=t.trim(),i=0,n=!1;if(a.length>0&&"#"===a.charAt(0)){for(var s="",l=1;l<a.length&&" "!=a[l];l++)isNaN(parseInt(a.charAt(l),10))&&"."!==a[l]?s.length>0&&(i=parseFloat(s),n=!0):s+=a.charAt(l);s.length>0&&(i=parseFloat(s),n=!0)}return n?i:null},he=function(e){var t="";if(null!=e.blockDate&&(Object(L.isNullOrUndefined)(e.blockDate.month)||(t=t+re[e.blockDate.month]+" "),Object(L.isNullOrUndefined)(e.blockDate.date)||(t=t+e.blockDate.date+", "),t=t+function(e,t,a){for(var i="",n=Math.max(0,a-e.length),s=0;s<n;s++)i+=String(t);return i+=e}(String(e.blockDate.year),"0",4)+"  ",null!=e.blockTime)){var a="";e.blockTime.hours<10&&(a="0"),t=t+(a+=e.blockTime.hours)+":",a="",e.blockTime.minutes<10&&(a="0"),t+=a+=e.blockTime.minutes}return t},pe=function(e){return!Object(L.isNullOrUndefined)(e)&&(e=e.trim()).length>0&&"#"==e[0]},me=function(e){if(!Object(L.isNullOrUndefined)(e)&&(e=e.trim()).length>2&&"$"==e[0]){for(var t=1;t<e.length&&" "==e[t];)t++;if("["==e[t]){for(;t<e.length&&"]"!=e[t];)t++;if(t<e.length&&"]"==e[t])return!0}}return!1},be=function(e){var t=0,a=[];if(Object(L.isNullOrUndefined)(e))return a;for(var i,n;t<e.length&&"["!=e[t];)t++;for(i=t+1;t<e.length&&"]"!=e[t];)t++;if((n=t)>=e.length)return a;a=e.substring(i,n).split(",");for(var s=0;s<a.length;s++)a[s]=a[s].trim();return a},fe=function(e){if(pe(e)){e=e.trim();for(var t=0;t<e.length&&" "!=e[t];){if("s"==e[t]||"S"==e[t])return!0;t++}}return!1},ge=function(e){if(pe(e)){e=e.trim();for(var t=0;t<e.length&&" "!=e[t];)t++;e=t<e.length?e.substring(t+1):""}return e},ke=function(e){var t="";if(!Object(L.isNullOrUndefined)(e))for(var a=0;a<e.length;a++){if(!Object(L.isNullOrUndefined)(e[a].title)&&e[a].title.trim().length>0)ge(e[a].title).length>0&&(t+="# "+ge(e[a].title)+"\n");if(!Object(L.isNullOrUndefined)(e[a].summary)&&e[a].summary.trim().length>0&&(t+=e[a].summary+"\n"),!Object(L.isNullOrUndefined)(e[a].entities)&&e[a].entities.length>0){for(var i="$[",n=0;n<e[a].entities.length;n++)0!=n&&(i+=","),i+=e[a].entities[n].title.toLowerCase();t+=i+="]\n"}t+="\n"}return t},ve=function(e){e.sort((function(e,t){if(t.blockDate.year!==e.blockDate.year)return t.blockDate.year-e.blockDate.year;if(null==t.blockDate.month)return 1;if(null==e.blockDate.month)return-1;if(t.blockDate.month!==e.blockDate.month)return t.blockDate.month-e.blockDate.month;if(null==t.blockDate.date)return 1;if(null==e.blockDate.date)return-1;if(t.blockDate.date!==e.blockDate.date)return t.blockDate.date-e.blockDate.date;if(null==e.blockTime&&null!=t.blockTime)return 1;if(null==t.blockTime&&null!=e.blockTime)return-1;if(null!=t.blockTime&&null!=e.blockTime){if(t.blockTime.hours!==e.blockTime.hours)return t.blockTime.hours-e.blockTime.hours;if(t.blockTime.minutes!==e.blockTime.minutes)return t.blockTime.minutes-e.blockTime.minutes}return function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;e=e.trim(),t=t.trim();var n=0,s=0,l=!1,r=!1;if(e.length>0&&"#"===e.charAt(0)){for(var o="",c=1;c<e.length;c++)isNaN(parseInt(e.charAt(c),10))&&"."!==e[c]?o.length>0&&(n=parseFloat(o),l=!0):o+=e.charAt(c);o.length>0&&(n=parseFloat(o),l=!0)}if(t.length>0&&"#"===t.charAt(0)){for(o="",c=1;c<t.length;c++)isNaN(parseInt(t.charAt(c),10))&&"."!==t[c]?o.length>0&&(s=parseFloat(o),r=!0):o+=t.charAt(c);o.length>0&&(s=parseFloat(o),r=!0)}return!l&&r?1:l&&!r?-1:l&&r?n>s?1:-1:a>i?1:i>a?-1:e>t?1:-1}(t.title,e.title,t.timestamp,e.timestamp)})),e.reverse()},ye=function(e){for(var t="",a=0;!Object(L.isNullOrUndefined)(e)&&a<e.length;a++)e[a]>="1"&&e[a]<="9"||e[a]>="a"&&e[a]<="z"||e[a]>="A"&&e[a]<="Z"||"0"==e[a]||"."==e[a]||"?"==e[a]||","==e[a]||'"'==e[a]||"'"==e[a]||" "==e[a]||"/"==e[a]||"\n"==e[a]?t+=e[a]:t+=" ";return t+="\n\n"},Ee=function(e){return e>="1"&&e<="9"||"0"==e||"."==e},Se=function(e){var t="";if(!Object(L.isNullOrUndefined)(e)){e.length&&(t+=e[0]);for(var a=1;a<e.length;a++)"."!=e[a-1]&&","!=e[a-1]||Ee(e[a])||"."==e[a]||" "==e[a]||(t+=" "),t+=e[a]}return t=t.trim()},Oe=function(e,t){for(var a=0;!Object(L.isNullOrUndefined)(e)&&a<e.length;a++)for(var i=0;!Object(L.isNullOrUndefined)(t)&&i<t.length;i++)if(e[a]==t[i])return!1;return!0},Be=function(e){for(var t={},a=0;!Object(L.isNullOrUndefined)(e)&&a<e.length;a++){var i=e[a].key,n=e[a].value;i in t||(t[i]=0),isNaN(Number(t[i]))||(t[i]+=Number(n))}var s=[];return Object.keys(t).forEach((function(e){s.push({key:e,value:t[e]})})),s},Te=function(e){for(var t=[],a=0;a<e.length;a++)if(!Object(L.isNullOrUndefined)(e[a].numbers))for(var i=0;i<e[a].numbers.length;i++)t.push(e[a].numbers[i]);return t=Be(t)},we=function(e){return Object(L.isNullOrUndefined)(e)?"":0==(e=e.trim()).length?e:e.toUpperCase().charAt(0)+e.substring(1).toLowerCase()},Ne=function(e,t,a){var i={change:e,ts:t};if(!(e in a))return i;var n=a[e];if(Object(L.isNullOrUndefined)(n))return i;for(var s=0,l=n.length-1;s<l;){var r=Math.floor(s+(l-s)/2);n[r].ts<t?s=r+1:l=r}for(;s<n.length&&n[s].ts<t;)s++;return s>=n.length?i:n[s]},xe=function(e){for(var t=[],a=0;!Object(L.isNullOrUndefined)(e)&&a<e.length;a++)0!=a&&e[a].title==e[a-1].title&&e[a].summary==e[a-1].summary||t.push(e[a]);return t},je=function(e,t,a){if(Object(L.isNullOrUndefined)(e)||Object(L.isNullOrUndefined)(t)||Object(L.isNullOrUndefined)(a))return t;for(var i=0;i<e.length;i++){var n={},s=t[e[i]];if(!Object(L.isNullOrUndefined)(s))for(var l=s.entities,r=0;!Object(L.isNullOrUndefined)(l)&&r<l.length;r++){var o=l[r];if(o.title in a){for(var c=o.title,d=s.timestamp,u=null;!Object(L.isNullOrUndefined)(c);){var h=Ne(c,d,a);if(c==(u=h.change))break;c=u,d=h.ts}Object(L.isNullOrUndefined)(u)||(n[u]="")}else n[o.title]=""}var p=[];for(var m in n)p.push({title:m,type:"None"});t[e[i]].entities=p}return t},Ce=function e(t,a,i,n){var s=t[a],l=a,r={};if(!(l in i))for(var o in Object(L.isNullOrUndefined)(s.edges)||(r=s.edges),i[l]={island:n,count:Object.keys(r).length},r)e(t,o,i,n)},Ie=function(e){if(Object(L.isNullOrUndefined)(e))return{};var t={},a=0;for(var i in e)i in t||(Ce(e,i,t,a),a++);var n={};for(var s in t){var l=t[s].island,r=t[s].count;l in n||(n[l]={count:-1,node:null}),r>n[l].count&&(n[l]={count:r,node:s})}return n},Le=function(e,t){if(Object(L.isNullOrUndefined)(e)&&(e="en"),Object(L.isNullOrUndefined)(t))return!1;var a=t.name,i=t.lang;if("en"==e){if(a.toLowerCase().includes("eng")||a.toLowerCase().includes("catherine"))return!0}else if("hi"==e&&(i.toLowerCase().includes("hi")||i.includes("\u0939\u093f\u0902\u0926\u0940")||a.includes("\u0939\u093f\u0902\u0926\u0940")||a.toLowerCase().includes("hindi")))return!0;return!1},De=function(e){var t=0;if(Object(L.isNullOrUndefined)(e))return t;for(var a in e)Object(L.isNullOrUndefined)(e[a].edges)||(t+=Object.keys(e[a].edges).length);return t/2},Ue=function(e,t){for(var a=0;!Object(L.isNullOrUndefined)(t)&&!Object(L.isNullOrUndefined)(e)&&a<t.length;a++)if(e==t[a])return!0;return!1},Ae=function(e,t){if(Object(L.isNullOrUndefined)(t)||Object(L.isNullOrUndefined)(e)||0==t.length||0==e.length)return!1;for(var a=0,i=-1;-1!=a;)if((0==(i=a=e.indexOf(t,i+1))||Ue(e[i-1]," ,."))&&(i+t.length==e.length||Ue(e[i+t.length]," ,.")))return!0;return!1},Ge={en:"Visualizations not found",hi:"\u0928\u0939\u0940\u0902 \u092e\u093f\u0932\u093e",ml:"\u0d15\u0d3e\u0d23\u0d4d\u0d2e\u0d3e\u0d28\u0d3f\u0d32\u0d4d\u0d32",mr:"\u0938\u093e\u092a\u0921\u0932\u0947 \u0928\u093e\u0939\u0940",bn:"\u09ad\u09bf\u099c\u09cd\u09af\u09c1\u09af\u09bc\u09be\u09b2\u09be\u0987\u099c\u09c7\u09b6\u09a8 \u09aa\u09be\u0993\u09af\u09bc\u09be \u09af\u09be\u09af\u09bc \u09a8\u09bf"},Pe={en:"Select any entity/topic",hi:"\u0915\u093f\u0938\u0940 \u092d\u0940 \u0907\u0915\u093e\u0908 / \u0935\u093f\u0937\u092f \u0915\u094b \u0926\u092c\u093e\u090f\u0902",ml:"\u0d0f\u0d24\u0d46\u0d19\u0d4d\u0d15\u0d3f\u0d32\u0d41\u0d02 \u0d0e\u0d28\u0d4d\u0d31\u0d3f\u0d31\u0d4d\u0d31\u0d3f / \u0d35\u0d3f\u0d37\u0d2f\u0d02 \u0d24\u0d3f\u0d30\u0d1e\u0d4d\u0d1e\u0d46\u0d1f\u0d41\u0d15\u0d4d\u0d15\u0d41\u0d15",mr:"\u0915\u094b\u0923\u0924\u0940\u0939\u0940 \u0918\u091f\u0915 / \u0935\u093f\u0937\u092f \u0928\u093f\u0935\u0921\u093e",bn:"\u09af\u09c7 \u0995\u09cb\u09a8\u0993 \u09b8\u09a4\u09cd\u09a4\u09be / \u09ac\u09bf\u09b7\u09af\u09bc \u09a8\u09bf\u09b0\u09cd\u09ac\u09be\u099a\u09a8 \u0995\u09b0\u09c1\u09a8"},Me={en:"Select two topics to connect",hi:"\u0926\u094b \u0935\u093f\u0937\u092f\u094b\u0902 \u0915\u093e \u091a\u092f\u0928 \u0915\u0930\u0947",ml:"\u0d30\u0d23\u0d4d\u0d1f\u0d4d \u0d35\u0d3f\u0d37\u0d2f\u0d19\u0d4d\u0d19\u0d7e \u0d24\u0d3f\u0d30\u0d1e\u0d4d\u0d1e\u0d46\u0d1f\u0d41\u0d15\u0d4d\u0d15\u0d41\u0d15",mr:"\u0926\u094b\u0928 \u0935\u093f\u0937\u092f \u0928\u093f\u0935\u0921\u093e",bn:"\u09a6\u09c1\u099f\u09bf \u09ac\u09bf\u09b7\u09af\u09bc \u09a8\u09bf\u09b0\u09cd\u09ac\u09be\u099a\u09a8 \u0995\u09b0\u09c1\u09a8"},Fe={en:"Selections",hi:"\u0935\u093f\u0937\u092f",ml:"\u0d24\u0d3f\u0d30\u0d1e\u0d4d\u0d1e\u0d46\u0d1f\u0d41\u0d15\u0d4d\u0d15\u0d32\u0d41\u0d15\u0d7e",mr:"\u0928\u093f\u0935\u0921\u0940",bn:"\u09a8\u09bf\u09b0\u09cd\u09ac\u09be\u099a\u09a8"},Ve={en:"Mindmap",hi:"\u092e\u0928 \u0928\u0915\u094d\u0936\u093e",ml:"\u0d2e\u0d48\u0d7b\u0d21\u0d4d\u0d2e\u0d3e\u0d2a\u0d4d\u0d2a\u0d4d",mr:"\u092e\u0928\u093e\u091a\u093e \u0928\u0915\u093e\u0936\u093e",bn:"\u09ae\u09be\u0987\u09a8\u09cd\u09a1 \u09ae\u09be\u09a8\u099a\u09bf\u09a4\u09cd\u09b0"},Re={title:{en:"Mindmap view",hi:"\u092e\u0928 \u0928\u0915\u094d\u0936\u093e",ml:"\u0d2e\u0d48\u0d7b\u0d21\u0d4d\u0d2e\u0d3e\u0d2a\u0d4d\u0d2a\u0d4d \u0d15\u0d3e\u0d34\u0d4d\u0d1a",mr:"\u092e\u0928\u093e\u091a\u093e \u0928\u0915\u093e\u0936\u093e",bn:"\u09ae\u09be\u0987\u09a8\u09cd\u09a1 \u09ae\u09be\u09a8\u099a\u09bf\u09a4\u09cd\u09b0"},desc:{en:"Visualise the story as a mindmap! Select any topic from the mindmap to read all about that topic.",hi:"\u0915\u0939\u093e\u0928\u0940 \u0915\u094b \u092e\u0928-\u0928\u0915\u094d\u0936\u093e \u0915\u0947 \u0930\u0942\u092a \u092e\u0947\u0902 \u0926\u0947\u0916\u0947\u0902! \u0909\u0938 \u0935\u093f\u0937\u092f \u0915\u0947 \u092c\u093e\u0930\u0947 \u092e\u0947\u0902 \u092a\u0922\u093c\u0928\u0947 \u0915\u0947 \u0932\u093f\u090f \u092e\u0928-\u0928\u0915\u094d\u0936\u093e \u0938\u0947 \u0915\u093f\u0938\u0940 \u092d\u0940 \u0935\u093f\u0937\u092f \u0915\u094b \u0926\u092c\u093e\u090f\u0902\u0964",ml:"\u0d38\u0d4d\u0d31\u0d4d\u0d31\u0d4b\u0d31\u0d3f \u0d12\u0d30\u0d41 \u0d2e\u0d48\u0d7b\u0d21\u0d4d \u0d2e\u0d3e\u0d2a\u0d4d\u0d2a\u0d3e\u0d2f\u0d3f \u0d26\u0d43\u0d36\u0d4d\u0d2f\u0d35\u0d7d\u0d15\u0d4d\u0d15\u0d30\u0d3f\u0d15\u0d4d\u0d15\u0d41\u0d15! \u0d06 \u0d35\u0d3f\u0d37\u0d2f\u0d24\u0d4d\u0d24\u0d46\u0d15\u0d4d\u0d15\u0d41\u0d31\u0d3f\u0d1a\u0d4d\u0d1a\u0d4d \u0d0e\u0d32\u0d4d\u0d32\u0d3e\u0d02 \u0d35\u0d3e\u0d2f\u0d3f\u0d15\u0d4d\u0d15\u0d3e\u0d7b \u0d2e\u0d48\u0d7b\u0d21\u0d4d\u0d2e\u0d3e\u0d2a\u0d4d\u0d2a\u0d3f\u0d7d \u0d28\u0d3f\u0d28\u0d4d\u0d28\u0d4d \u0d0f\u0d24\u0d46\u0d19\u0d4d\u0d15\u0d3f\u0d32\u0d41\u0d02 \u0d35\u0d3f\u0d37\u0d2f\u0d02 \u0d24\u0d3f\u0d30\u0d1e\u0d4d\u0d1e\u0d46\u0d1f\u0d41\u0d15\u0d4d\u0d15\u0d41\u0d15.",mr:"\u0915\u0932\u094d\u092a\u093f\u0924 \u092e\u0928\u093e\u0928\u0947 \u0915\u0932\u094d\u092a\u093f\u0924 \u0915\u0925\u093e \u092c\u0928\u0935\u093e! \u0924\u094d\u092f\u093e \u0935\u093f\u0937\u092f\u093e\u092c\u0926\u094d\u0926\u0932 \u0938\u0930\u094d\u0935 \u0935\u093e\u091a\u0923\u094d\u092f\u093e\u0938\u093e\u0920\u0940 \u092e\u093e\u0928\u0938\u093f\u0915\u0924\u093e\u092e\u0927\u0942\u0928 \u0915\u094b\u0923\u0924\u093e\u0939\u0940 \u0935\u093f\u0937\u092f \u0928\u093f\u0935\u0921\u093e",bn:"\u0995\u09be\u09b9\u09bf\u09a8\u09c0\u099f\u09bf\u0995\u09c7 \u09ae\u09a8 \u09ae\u09be\u09a8\u099a\u09bf\u09a4\u09cd\u09b0 \u09b9\u09bf\u09b8\u09be\u09ac\u09c7 \u09ad\u09bf\u099c\u09cd\u09af\u09c1\u09af\u09bc\u09be\u09b2\u09be\u0987\u099c \u0995\u09b0\u09c1\u09a8! \u09b8\u09c7\u0987 \u09ac\u09bf\u09b7\u09af\u09bc\u099f\u09bf \u09b8\u09ae\u09cd\u09aa\u09b0\u09cd\u0995\u09c7 \u09b8\u09ae\u09b8\u09cd\u09a4 \u0995\u09bf\u099b\u09c1 \u09aa\u09a1\u09bc\u09a4\u09c7 \u09ae\u09a8\u09ae\u09cd\u09af\u09be\u09aa \u09a5\u09c7\u0995\u09c7 \u09af\u09c7 \u0995\u09cb\u09a8\u0993 \u09ac\u09bf\u09b7\u09af\u09bc \u09a8\u09bf\u09b0\u09cd\u09ac\u09be\u099a\u09a8 \u0995\u09b0\u09c1\u09a8\u0964"}},We={title:{en:"Match the topics",hi:"\u092e\u0928 \u0928\u0915\u094d\u0936\u093e",ml:"\u0d2e\u0d48\u0d7b\u0d21\u0d4d\u0d2e\u0d3e\u0d2a\u0d4d\u0d2a\u0d4d \u0d15\u0d3e\u0d34\u0d4d\u0d1a",mr:"\u092e\u0928\u093e\u091a\u093e \u0928\u0915\u093e\u0936\u093e",bn:"\u09ae\u09be\u0987\u09a8\u09cd\u09a1 \u09ae\u09be\u09a8\u099a\u09bf\u09a4\u09cd\u09b0"},desc:{en:"Fill the connections in the mindmap! Select two nodes to try to connect them! Correct connection will increase your score.",hi:"\u092e\u0928 \u0928\u0915\u094d\u0936\u093e \u092e\u0947\u0902 \u0905\u0902\u0924\u0930\u093e\u0932 \u092d\u0930\u0947\u0902! \u0909\u0928\u094d\u0939\u0947\u0902 \u0915\u0928\u0947\u0915\u094d\u091f \u0915\u0930\u0928\u0947 \u0915\u093e \u092a\u094d\u0930\u092f\u093e\u0938 \u0915\u0930\u0928\u0947 \u0915\u0947 \u0932\u093f\u090f \u0926\u094b \u0928\u094b\u0921 \u0915\u093e \u091a\u092f\u0928 \u0915\u0930\u0947\u0902! \u0938\u0939\u0940 \u0915\u0928\u0947\u0915\u094d\u0936\u0928 \u0906\u092a\u0915\u0947 \u0938\u094d\u0915\u094b\u0930 \u0915\u094b \u092c\u0922\u093c\u093e\u090f\u0917\u093e\u0964",ml:"\u0d2e\u0d48\u0d7b\u0d21\u0d4d\u0d2e\u0d3e\u0d2a\u0d4d\u0d2a\u0d3f\u0d32\u0d46 \u0d35\u0d3f\u0d1f\u0d35\u0d41\u0d15\u0d7e \u0d2a\u0d42\u0d30\u0d3f\u0d2a\u0d4d\u0d2a\u0d3f\u0d15\u0d4d\u0d15\u0d41\u0d15! \u0d05\u0d35 \u0d2c\u0d28\u0d4d\u0d27\u0d3f\u0d2a\u0d4d\u0d2a\u0d3f\u0d15\u0d4d\u0d15\u0d3e\u0d7b \u0d36\u0d4d\u0d30\u0d2e\u0d3f\u0d15\u0d4d\u0d15\u0d41\u0d28\u0d4d\u0d28\u0d24\u0d3f\u0d28\u0d4d \u0d30\u0d23\u0d4d\u0d1f\u0d4d \u0d28\u0d4b\u0d21\u0d41\u0d15\u0d7e \u0d24\u0d3f\u0d30\u0d1e\u0d4d\u0d1e\u0d46\u0d1f\u0d41\u0d15\u0d4d\u0d15\u0d41\u0d15! \u0d36\u0d30\u0d3f\u0d2f\u0d3e\u0d2f \u0d15\u0d23\u0d15\u0d4d\u0d37\u0d7b \u0d28\u0d3f\u0d19\u0d4d\u0d19\u0d33\u0d41\u0d1f\u0d46 \u0d38\u0d4d\u0d15\u0d4b\u0d7c \u0d35\u0d7c\u0d26\u0d4d\u0d27\u0d3f\u0d2a\u0d4d\u0d2a\u0d3f\u0d15\u0d4d\u0d15\u0d41\u0d02.",mr:"\u092e\u0928\u093e\u0924\u0940\u0932 \u0928\u0915\u093e\u0936\u093e\u092e\u0927\u0940\u0932 \u0905\u0902\u0924\u0930 \u092d\u0930\u093e! \u0924\u094d\u092f\u093e\u0902\u0928\u093e \u091c\u094b\u0921\u0923\u094d\u092f\u093e\u091a\u093e \u092a\u094d\u0930\u092f\u0924\u094d\u0928 \u0915\u0930\u0923\u094d\u092f\u093e\u0938\u093e\u0920\u0940 \u0926\u094b\u0928 \u0928\u094b\u0921 \u0928\u093f\u0935\u0921\u093e! \u092f\u094b\u0917\u094d\u092f \u0915\u0928\u0947\u0915\u094d\u0936\u0928\u092e\u0941\u0933\u0947 \u0906\u092a\u0932\u0940 \u0927\u093e\u0935\u0938\u0902\u0916\u094d\u092f\u093e \u0935\u093e\u0922\u0947\u0932.",bn:"\u09b6\u09c2\u09a8\u09cd\u09af\u09b8\u09cd\u09a5\u09be\u09a8 \u09aa\u09c2\u09b0\u09a3 \u0995\u09b0\u09c1\u09a8 \u09ae\u09a8\u09ae\u09cd\u09af\u09be\u09aa\u09c7! \u09a6\u09c1\u099f\u09bf \u09b8\u0982\u09af\u09cb\u0997 \u09b8\u09cd\u09a5\u09be\u09aa\u09a8\u09c7\u09b0 \u099a\u09c7\u09b7\u09cd\u099f\u09be \u0995\u09b0\u09be\u09b0 \u099c\u09a8\u09cd\u09af \u09a6\u09c1\u099f\u09bf \u09a8\u09cb\u09a1 \u09a8\u09bf\u09b0\u09cd\u09ac\u09be\u099a\u09a8 \u0995\u09b0\u09c1\u09a8! \u09b8\u09a0\u09bf\u0995 \u09b8\u0982\u09af\u09cb\u0997 \u0986\u09aa\u09a8\u09be\u09b0 \u09b8\u09cd\u0995\u09cb\u09b0 \u09ac\u09be\u09a1\u09bc\u09bf\u09af\u09bc\u09c7 \u09a4\u09c1\u09b2\u09ac\u09c7\u0964"}},Je={title:{en:"Fill the dates",hi:"\u092e\u0928 \u0928\u0915\u094d\u0936\u093e",ml:"\u0d2e\u0d48\u0d7b\u0d21\u0d4d\u0d2e\u0d3e\u0d2a\u0d4d\u0d2a\u0d4d \u0d15\u0d3e\u0d34\u0d4d\u0d1a",mr:"\u092e\u0928\u093e\u091a\u093e \u0928\u0915\u093e\u0936\u093e",bn:"\u09ae\u09be\u0987\u09a8\u09cd\u09a1 \u09ae\u09be\u09a8\u099a\u09bf\u09a4\u09cd\u09b0"},desc:{en:"Fill the dates of the event in the cuecard! Select a date from the options! Correct selections will increase your score.",hi:"\u092e\u0928 \u0928\u0915\u094d\u0936\u093e \u092e\u0947\u0902 \u0905\u0902\u0924\u0930\u093e\u0932 \u092d\u0930\u0947\u0902! \u0909\u0928\u094d\u0939\u0947\u0902 \u0915\u0928\u0947\u0915\u094d\u091f \u0915\u0930\u0928\u0947 \u0915\u093e \u092a\u094d\u0930\u092f\u093e\u0938 \u0915\u0930\u0928\u0947 \u0915\u0947 \u0932\u093f\u090f \u0926\u094b \u0928\u094b\u0921 \u0915\u093e \u091a\u092f\u0928 \u0915\u0930\u0947\u0902! \u0938\u0939\u0940 \u0915\u0928\u0947\u0915\u094d\u0936\u0928 \u0906\u092a\u0915\u0947 \u0938\u094d\u0915\u094b\u0930 \u0915\u094b \u092c\u0922\u093c\u093e\u090f\u0917\u093e\u0964",ml:"\u0d2e\u0d48\u0d7b\u0d21\u0d4d\u0d2e\u0d3e\u0d2a\u0d4d\u0d2a\u0d3f\u0d32\u0d46 \u0d35\u0d3f\u0d1f\u0d35\u0d41\u0d15\u0d7e \u0d2a\u0d42\u0d30\u0d3f\u0d2a\u0d4d\u0d2a\u0d3f\u0d15\u0d4d\u0d15\u0d41\u0d15! \u0d05\u0d35 \u0d2c\u0d28\u0d4d\u0d27\u0d3f\u0d2a\u0d4d\u0d2a\u0d3f\u0d15\u0d4d\u0d15\u0d3e\u0d7b \u0d36\u0d4d\u0d30\u0d2e\u0d3f\u0d15\u0d4d\u0d15\u0d41\u0d28\u0d4d\u0d28\u0d24\u0d3f\u0d28\u0d4d \u0d30\u0d23\u0d4d\u0d1f\u0d4d \u0d28\u0d4b\u0d21\u0d41\u0d15\u0d7e \u0d24\u0d3f\u0d30\u0d1e\u0d4d\u0d1e\u0d46\u0d1f\u0d41\u0d15\u0d4d\u0d15\u0d41\u0d15! \u0d36\u0d30\u0d3f\u0d2f\u0d3e\u0d2f \u0d15\u0d23\u0d15\u0d4d\u0d37\u0d7b \u0d28\u0d3f\u0d19\u0d4d\u0d19\u0d33\u0d41\u0d1f\u0d46 \u0d38\u0d4d\u0d15\u0d4b\u0d7c \u0d35\u0d7c\u0d26\u0d4d\u0d27\u0d3f\u0d2a\u0d4d\u0d2a\u0d3f\u0d15\u0d4d\u0d15\u0d41\u0d02.",mr:"\u092e\u0928\u093e\u0924\u0940\u0932 \u0928\u0915\u093e\u0936\u093e\u092e\u0927\u0940\u0932 \u0905\u0902\u0924\u0930 \u092d\u0930\u093e! \u0924\u094d\u092f\u093e\u0902\u0928\u093e \u091c\u094b\u0921\u0923\u094d\u092f\u093e\u091a\u093e \u092a\u094d\u0930\u092f\u0924\u094d\u0928 \u0915\u0930\u0923\u094d\u092f\u093e\u0938\u093e\u0920\u0940 \u0926\u094b\u0928 \u0928\u094b\u0921 \u0928\u093f\u0935\u0921\u093e! \u092f\u094b\u0917\u094d\u092f \u0915\u0928\u0947\u0915\u094d\u0936\u0928\u092e\u0941\u0933\u0947 \u0906\u092a\u0932\u0940 \u0927\u093e\u0935\u0938\u0902\u0916\u094d\u092f\u093e \u0935\u093e\u0922\u0947\u0932.",bn:"\u09b6\u09c2\u09a8\u09cd\u09af\u09b8\u09cd\u09a5\u09be\u09a8 \u09aa\u09c2\u09b0\u09a3 \u0995\u09b0\u09c1\u09a8 \u09ae\u09a8\u09ae\u09cd\u09af\u09be\u09aa\u09c7! \u09a6\u09c1\u099f\u09bf \u09b8\u0982\u09af\u09cb\u0997 \u09b8\u09cd\u09a5\u09be\u09aa\u09a8\u09c7\u09b0 \u099a\u09c7\u09b7\u09cd\u099f\u09be \u0995\u09b0\u09be\u09b0 \u099c\u09a8\u09cd\u09af \u09a6\u09c1\u099f\u09bf \u09a8\u09cb\u09a1 \u09a8\u09bf\u09b0\u09cd\u09ac\u09be\u099a\u09a8 \u0995\u09b0\u09c1\u09a8! \u09b8\u09a0\u09bf\u0995 \u09b8\u0982\u09af\u09cb\u0997 \u0986\u09aa\u09a8\u09be\u09b0 \u09b8\u09cd\u0995\u09cb\u09b0 \u09ac\u09be\u09a1\u09bc\u09bf\u09af\u09bc\u09c7 \u09a4\u09c1\u09b2\u09ac\u09c7\u0964"}},He={en:"Timeline",hi:"\u0918\u091f\u0928\u093e\u0915\u094d\u0930\u092e",ml:"\u0d1f\u0d48\u0d02\u0d32\u0d48\u0d7b",mr:"\u091f\u093e\u0907\u092e\u0932\u093e\u0907\u0928",bn:"\u09b8\u09ae\u09af\u09bc\u09b0\u09c7\u0996\u09be"},ze={title:{en:"Timeline view",hi:"\u0918\u091f\u0928\u093e\u0915\u094d\u0930\u092e",ml:"\u0d1f\u0d48\u0d02\u0d32\u0d48\u0d7b \u0d15\u0d3e\u0d34\u0d4d\u0d1a",mr:"\u091f\u093e\u0907\u092e\u0932\u093e\u0907\u0928 \u0926\u0943\u0936\u094d\u092f",bn:"\u09b8\u09ae\u09af\u09bc\u09b0\u09c7\u0996\u09be"},desc:{en:"Visualise the story as a timeline!",hi:"\u090f\u0915 \u0918\u091f\u0928\u093e\u0915\u094d\u0930\u092e \u0915\u0947 \u0930\u0942\u092a \u092e\u0947\u0902 \u0915\u0939\u093e\u0928\u0940 \u0915\u0940 \u0915\u0932\u094d\u092a\u0928\u093e \u0915\u0930\u094b!",ml:"\u0d38\u0d4d\u0d31\u0d4d\u0d31\u0d4b\u0d31\u0d3f \u0d12\u0d30\u0d41 \u0d1f\u0d48\u0d02\u0d32\u0d48\u0d28\u0d3e\u0d2f\u0d3f \u0d26\u0d43\u0d36\u0d4d\u0d2f\u0d35\u0d7d\u0d15\u0d4d\u0d15\u0d30\u0d3f\u0d15\u0d4d\u0d15\u0d41\u0d15!",mr:"\u091f\u093e\u0907\u092e\u0932\u093e\u0907\u0928 \u092e\u094d\u0939\u0923\u0942\u0928 \u0915\u0925\u0947\u091a\u0947 \u0926\u0943\u0936\u094d\u092f \u0915\u0930\u093e!",bn:"\u098f\u0995\u099f\u09bf \u09b8\u09ae\u09af\u09bc\u09b0\u09c7\u0996\u09be \u09b9\u09bf\u09b8\u09be\u09ac\u09c7 \u0997\u09b2\u09cd\u09aa\u099f\u09bf \u09ad\u09bf\u099c\u09cd\u09af\u09c1\u09af\u09bc\u09be\u09b2\u09be\u0987\u099c \u0995\u09b0\u09c1\u09a8!"}},_e=!!window.chrome&&(!!window.chrome.webstore||!!window.chrome.runtime),Ye=!!document.documentMode,Ke=function(e){Object(c.a)(i,e);var t=Object(d.a)(i);function i(e){var a;return Object(r.a)(this,i),(a=t.call(this,e)).state={graph:{nodes:[],edges:[]},graphOptions:{layout:{hierarchical:!1},edges:{arrows:{to:{enabled:!1,scaleFactor:1,type:"arrow"},middle:{enabled:!1,scaleFactor:1,type:"arrow"},from:{enabled:!1,scaleFactor:1,type:"arrow"}},color:"#000000"}},graphEvents:{},multiSelectEntityList:[{value:!0,label:"All",id:0},{value:!1,label:"None",id:-1}],currentSelectedBlocks:[],selectedNodes:[],openSelectedBlocks:!1,wasAllOptionSelected:!0,wasNoneOptionSelected:!1,playStatus:"end",languageSupportedPlay:!0,copiedText:!1,testVar:-1},a.graphHelperMap={nodes:{},edges:{}},a.speech=null,a.handleAllAndNoneOptions=a.handleAllAndNoneOptions.bind(Object(v.a)(a)),a.initializeGraphEvents=a.initializeGraphEvents.bind(Object(v.a)(a)),a.generateGraph=a.generateGraph.bind(Object(v.a)(a)),a.onSelectGraph=a.onSelectGraph.bind(Object(v.a)(a)),a.addBlocksForNodeCharacteristic=a.addBlocksForNodeCharacteristic.bind(Object(v.a)(a)),a.addBlocksForEdge=a.addBlocksForEdge.bind(Object(v.a)(a)),a.isValidBlock=a.isValidBlock.bind(Object(v.a)(a)),a.clickBlockFromList=a.clickBlockFromList.bind(Object(v.a)(a)),a.sortBlocks=a.sortBlocks.bind(Object(v.a)(a)),a.removeHashedIndex=a.removeHashedIndex.bind(Object(v.a)(a)),a.AgregateNumberDisplay=a.AgregateNumberDisplay.bind(Object(v.a)(a)),a.generateAmGraph=a.generateAmGraph.bind(Object(v.a)(a)),a.selectEdge=a.selectEdge.bind(Object(v.a)(a)),a.selectNode=a.selectNode.bind(Object(v.a)(a)),a.toggleSelectedBlocksPane=a.toggleSelectedBlocksPane.bind(Object(v.a)(a)),a.resetScroll=a.resetScroll.bind(Object(v.a)(a)),a.initSpeech=a.initSpeech.bind(Object(v.a)(a)),a.playExistingSelection=a.playExistingSelection.bind(Object(v.a)(a)),a.pauseExistingSelection=a.pauseExistingSelection.bind(Object(v.a)(a)),a.resumeExistingSelection=a.resumeExistingSelection.bind(Object(v.a)(a)),a.stopExistingSelection=a.stopExistingSelection.bind(Object(v.a)(a)),a.timeoutFn=a.timeoutFn.bind(Object(v.a)(a)),a.timeInFn=a.timeInFn.bind(Object(v.a)(a)),a.graphRef=n.a.createRef(),E.a.initialize("UA-143383035-1"),a}return Object(o.a)(i,[{key:"resetScroll",value:function(){var e=null;this.graphRef&&(e=this.graphRef.current.offsetTop),this.props.setScrollToGraphList&&this.props.setScrollToGraphList(e),document.getElementById("graph-selected-block-list").scrollTop=0}},{key:"isValidBlock",value:function(e){return!Object(L.isNullOrUndefined)(e.title)}},{key:"selectEdge",value:function(e,t){var a=this;this.setState({openSelectedBlocks:!1});var i=[],n={to:t,from:e};this.addBlocksForEdge(n,i,{}),i.sort((function(e,t){return a.sortBlocks(e.title,t.title,e.timestamp,t.timestamp)})),this.setState({currentSelectedBlocks:i,openSelectedBlocks:!0,selectedNodes:[e,t],copiedText:!1}),E.a.event({category:"select_edge",action:"Select Edge from "+String(e)+" to "+String(t),label:String(e)+" to "+String(t)}),this.resetScroll()}},{key:"addBlocksForEdge",value:function(e,t,a){if(!Object(L.isNullOrUndefined)(this.props.investigationGraph[e.from])&&!Object(L.isNullOrUndefined)(this.props.investigationGraph[e.from]))for(var i=this.props.investigationGraph[e.from].edges[e.to],n=0;n<i.length;n++){var s=i[n];if(!(s in a)){var l=this.props.blockTree[s];this.isValidBlock(l)&&t.push(l),a[s]=!0}}}},{key:"selectNode",value:function(e){var t=this,a=[],i={};if(this.setState({openSelectedBlocks:!1}),this.addBlocksForNodeCharacteristic(e,a,i),this.props.investigationGraph[e]){var n=this.props.investigationGraph[e].edges,s=this;Object.keys(n).forEach((function(t){var n={to:e,from:t};s.addBlocksForEdge(n,a,i)}))}if("ALL"==e){var l={},r=this.props.investigationGraph;if(!Object(L.isNullOrUndefined)(r)){for(var o in r){for(var c=0;!Object(L.isNullOrUndefined)(r[o].char)&&c<r[o].char.length;c++)l[r[o].char[c]]=!0;for(var d in r[o].edges)for(var u=0;!Object(L.isNullOrUndefined)(r[o].edges[d])&&u<r[o].edges[d].length;u++)l[r[o].edges[d][u]]=!0}for(var h in l)Object(L.isNullOrUndefined)(this.props.blockTree)||Object(L.isNullOrUndefined)(this.props.blockTree[h])||a.push(this.props.blockTree[h])}}a.sort((function(e,a){return t.sortBlocks(e.title,a.title)})),this.setState({currentSelectedBlocks:a,openSelectedBlocks:!0,selectedNodes:[e],copiedText:!1}),E.a.event({category:"select_node",action:"Select Node "+String(e),label:String(e)}),this.resetScroll(),!Object(L.isNullOrUndefined)(this.props.isPublic)&&this.props.isPublic||!this.props.selectNode||"ALL"==e||this.props.selectNode(e)}},{key:"addBlocksForNodeCharacteristic",value:function(e,t,a){if(!Object(L.isNullOrUndefined)(this.props.investigationGraph[e]))for(var i=this.props.investigationGraph[e].char,n=0;n<i.length;n++){var s=i[n];if(!(s in a)){var l=this.props.blockTree[s];this.isValidBlock(l)&&t.push(l),a[s]=!0}}}},{key:"sortBlocks",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;e=e.trim(),t=t.trim();var n=0,s=0,l=!1,r=!1;if(e.length>0&&"#"===e.charAt(0)){for(var o="",c=1;c<e.length;c++)isNaN(parseInt(e.charAt(c),10))&&"."!==e[c]?o.length>0&&(n=parseFloat(o),l=!0):o+=e.charAt(c);o.length>0&&(n=parseFloat(o),l=!0)}if(t.length>0&&"#"===t.charAt(0)){for(o="",c=1;c<t.length;c++)isNaN(parseInt(t.charAt(c),10))&&"."!==t[c]?o.length>0&&(s=parseFloat(o),r=!0):o+=t.charAt(c);o.length>0&&(s=parseFloat(o),r=!0)}return!l&&r?1:l&&!r?-1:l&&r?n>s?1:-1:a>i?1:i>a?-1:e>t?1:-1}},{key:"onSelectGraph",value:function(e){var t=this;this.setState({openSelectedBlocks:!1});var a=e.nodes,i=e.edges,n=[],s={};if(!Object(L.isNullOrUndefined)(i))for(var l=0;l<i.length;l++){var r=i[l],o=this.graphHelperMap.edges[r];this.addBlocksForEdge(o,n,s)}if(!Object(L.isNullOrUndefined)(a))for(l=0;l<a.length;l++){var c=a[l],d=this.graphHelperMap.nodes[c];this.addBlocksForNodeCharacteristic(d,n,s)}n.sort((function(e,a){return t.sortBlocks(e.title,a.title,e.timestamp,a.timestamp)})),this.setState({currentSelectedBlocks:n,openSelectedBlocks:!0})}},{key:"initializeGraphEvents",value:function(){var e=this,t={select:function(t){e.onSelectGraph(t)}};this.setState({graphEvents:t})}},{key:"generateAmGraph",value:function(){var e=this.props.multiSelectEntityList[0].value,t=[],a={};if(!this.props.multiSelectEntityList[1].value){for(var i={},s=0,l=2;l<this.props.multiSelectEntityList.length;l++){var r=this.props.multiSelectEntityList[l];if(r.value||e){i[r.label]=s;var o=null;if(this.props.imageMapping&&r.label in this.props.imageMapping&&(o=this.props.imageMapping[r.label]),this.props.investigationGraph[r.label]){t.push({id:s,label:r.label,link:[],image:o}),a[s]=r.label;var c=r.label;if(!Object(L.isNullOrUndefined)(this.props.investigationGraph)&&!Object(L.isNullOrUndefined)(this.props.investigationGraph[c])){var d=this.props.investigationGraph[c].edges;Object.keys(d).forEach((function(e){e in i&&t[i[e]].link.push(s)}))}s++}}}var u=Ie(this.props.investigationGraph);if(Object.keys(u).length>0&&this.props.multiSelectEntityList[0].value){t.push({id:s,label:"ALL",link:[],image:null});for(var h={},p=0;p<t.length;p++)h[t[p].label]=t[p].id;for(var m in u){var b=h[u[m].node];Object(L.isNullOrUndefined)(b)||t[s].link.push(b)}s++}}return n.a.createElement("div",{className:"graph-main"},n.a.createElement(Y,{graph:t,selectEdge:this.selectEdge,selectNode:this.selectNode}))}},{key:"generateGraph",value:function(){var e=this.props.multiSelectEntityList[0].value,t={nodes:[],edges:[]},a={};if(!this.props.multiSelectEntityList[1].value)for(var i={},s=0,l=2;l<this.props.multiSelectEntityList.length;l++){var r=this.props.multiSelectEntityList[l];if(r.value||e){i[r.label]=s,t.nodes.push({id:s,label:r.label}),a[s]=r.label;var o=r.label;if(!Object(L.isNullOrUndefined)(this.props.investigationGraph)&&!Object(L.isNullOrUndefined)(this.props.investigationGraph[o])){var c=this.props.investigationGraph[o].edges;Object.keys(c).forEach((function(e){e in i&&t.edges.push({from:i[e],to:s,id:i[e]+"-"+s})}))}s++}}var d={nodes:a,edges:{}};for(l=0;l<t.edges.length;l++){var u=t.edges[l],h=a[u.to],p=a[u.from];d.edges[u.id]={from:p,to:h}}this.graphHelperMap=d;var m=this,b={select:function(e){m.onSelectGraph(e)}};return n.a.createElement("div",{className:"graph-main"},n.a.createElement(P.a,{graph:t,options:this.state.graphOptions,events:b}))}},{key:"removeHashedIndex",value:function(e){var t=0;if((e=e.trim()).length>0&&"#"==e[0]){for(var a=1;a<e.length;a++)if(t=a," "==e.charAt(a))return e.substring(t).trim();return""}return e}},{key:"BlockEntity",value:function(e){return n.a.createElement("span",{className:"graph-block-entity"},e.title)}},{key:"BlockEvidence",value:function(e,t){a(329);var i=[e.evidenceLink];return R()(e.evidenceLink)?n.a.createElement("div",{className:"graph-block-evidence"},n.a.createElement(F.a,{src:i,className:"graph-block-evidence-image"})):null}},{key:"AgregateNumberDisplay",value:function(e,t){var a="";return!Object(L.isNullOrUndefined)(e)&&e.length>0&&(a=e.map((function(e){return n.a.createElement("span",null,n.a.createElement("span",{className:"graph-content-number-key"},"Total ",e.key,": "),n.a.createElement("b",{className:"graph-content-number-value"},e.value)," ",n.a.createElement("br",null))}))),Object(L.isNullOrUndefined)(t)||(t=t.replace(":","")),""!=a?n.a.createElement("div",{className:"graph-block-para-div"},n.a.createElement("h4",{className:"graph-block-title"},"Statistics for ",t),n.a.createElement("div",{className:"graph-content-container"},n.a.createElement("p",{className:"graph-block-text"},a))):null}},{key:"SingleBlock",value:function(e){var t=this;null!=e.entities&&e.entities.length>0&&e.entities.map((function(e){return t.BlockEntity(e)}));var a="";null!=e.evidences&&e.evidences.length>0&&(a=e.evidences.map((function(e,a){return t.BlockEvidence(e,a)})));var i=null;!Object(L.isNullOrUndefined)(e.numbers)&&e.numbers.length>0&&(i=e.numbers.map((function(e){return n.a.createElement("span",null,n.a.createElement("span",{className:"graph-content-number-key"},e.key,": "),n.a.createElement("b",{className:"graph-content-number-value"},e.value)," ",n.a.createElement("br",null))})));return n.a.createElement("div",{className:"graph-block-para-div",onClick:function(){t.clickBlockFromList(e)}},n.a.createElement("h4",{className:"graph-block-title"},this.removeHashedIndex(e.title)),n.a.createElement("div",{className:"graph-content-container"},n.a.createElement("p",{className:"graph-block-text"},e.summary),n.a.createElement("p",{className:"graph-block-text"},i),n.a.createElement("div",{class:"graph-block-evidence-container"},a)))}},{key:"handleAllAndNoneOptions",value:function(){for(var e=this.state.wasAllOptionSelected,t=this.state.wasNoneOptionSelected,a=!1,i=!1,n=!1,s=this.props.multiSelectEntityList,l=0;l<s.length;l++)if(1==s[l].value)if(0==s[l].id)a=!0;else if(-1==s[l].id)i=!0;else{if(n=!0,a&&e||i&&t){a=!1,i=!1;break}(i||a)&&(s[l].value=!1)}a&&!e&&(i=!1),i&&!t&&(a=!1),a||i||n||(i=!0),s[0].value=a,s[1].value=i,this.setState({multiSelectEntityList:s,wasAllOptionSelected:a,wasNoneOptionSelected:i})}},{key:"entityClicked",value:function(e){this.setState({multiSelectEntityList:e}),this.handleAllAndNoneOptions()}},{key:"selectedBadgeClicked",value:function(e){this.setState({multiSelectEntityList:e}),this.handleAllAndNoneOptions()}},{key:"clickBlockFromList",value:function(e){this.props.selectBlock(e)}},{key:"initSpeech",value:function(){var e=Object(k.a)(f.a.mark((function e(){var t,a,i,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.speech=new se.a,this.speech.hasBrowserSupport(),e.next=5,this.speech.init();case 5:t=e.sent,a=t.voices,i=-1,n=0;case 9:if(Object(L.isNullOrUndefined)(a)||!(n<a.length)){e.next=17;break}if(a[n].name,!Le(this.props.lang,a[n])){e.next=14;break}return i=n,e.abrupt("break",17);case 14:n++,e.next=9;break;case 17:if(-1==i){e.next=23;break}return e.next=20,this.speech.setVoice(a[i].name);case 20:this.setState({languageSupportedPlay:!0}),e.next=24;break;case 23:this.setState({languageSupportedPlay:!1});case 24:e.next=28;break;case 26:e.prev=26,e.t0=e.catch(0);case 28:case"end":return e.stop()}}),e,this,[[0,26]])})));return function(){return e.apply(this,arguments)}}()},{key:"timeoutFn",value:function(){var e=Object(k.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("start"!=this.state.playStatus||Object(L.isNullOrUndefined)(this.speech)||!_e){e.next=5;break}return e.next=3,this.speech.pause();case 3:return e.next=5,this.speech.resume();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"timeInFn",value:function(){var e=this;this.timeout=setInterval((function(){e.timeoutFn()}),8500)}},{key:"componentDidMount",value:function(){var e=Object(k.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initializeGraphEvents(),e.next=3,this.initSpeech();case 3:_e&&this.timeInFn();case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toggleSelectedBlocksPane",value:function(){this.setState({openSelectedBlocks:!this.state.openSelectedBlocks})}},{key:"pauseExistingSelection",value:function(){var e=Object(k.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(L.isNullOrUndefined)(this.speech)||!this.speech.speaking()){e.next=4;break}return e.next=3,this.speech.pause();case 3:this.setState({playStatus:"paused"});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"resumeExistingSelection",value:function(){var e=Object(k.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(L.isNullOrUndefined)(this.speech)){e.next=4;break}return e.next=3,this.speech.resume();case 3:this.setState({playStatus:"start"});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stopExistingSelection",value:function(){var e=Object(k.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(L.isNullOrUndefined)(this.speech)){e.next=4;break}return e.next=3,this.speech.cancel();case 3:this.setState({playStatus:"end"});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"playExistingSelection",value:function(){var e=Object(k.a)(f.a.mark((function e(){var t,a,i,n,s,l=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(L.isNullOrUndefined)(this.speech)){e.next=16;break}if(!this.speech.speaking()){e.next=4;break}return e.next=4,this.speech.cancel();case 4:for(t=": ",a=0;!Object(L.isNullOrUndefined)(this.state.selectedNodes)&&a<this.state.selectedNodes.length;a++)t+=this.state.selectedNodes[a]+", ";for(t.length>0&&(t=t.substring(0,t.length-2)),E.a.event({category:"playSound",action:"PlaySound "+t,label:"PlaySound "+t}),i="",n=Te(this.state.currentSelectedBlocks),!Object(L.isNullOrUndefined)(n)&&n.length>0&&(i+="Statistics for "+t+". "),s=0;!Object(L.isNullOrUndefined)(n)&&s<n.length;s++)i+="Total "+n[s].key+": "+String(n[s].value)+". ";xe(this.state.currentSelectedBlocks).map((function(e){var t=l.removeHashedIndex(e.title),a=e.summary;!Object(L.isNullOrUndefined)(t)&&t.length>0&&(i+=Se(t)+". "),i+=Se(a),i+=". ";for(var n=0;!Object(L.isNullOrUndefined)(e.numbers)&&n<e.numbers.length;n++)i+=e.numbers[n].key+": "+String(e.numbers[n].value)+". "})),this.setState({playStatus:"start"}),this.speech.speak({text:i,queue:!1}).then((function(){l.setState({playStatus:"end"})})).catch((function(e){console.error("An error occurred :",e)}));case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){var e=Object(k.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(L.isNullOrUndefined)(this.speech)){e.next=3;break}return e.next=3,this.speech.cancel();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillReceiveProps",value:function(){var e=Object(k.a)(f.a.mark((function e(t){var a,i,n,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.lang==t.lang||Object(L.isNullOrUndefined)(this.speech)){e.next=22;break}return e.next=3,this.speech.init();case 3:a=e.sent,i=a.voices,n=-1,s=0;case 7:if(Object(L.isNullOrUndefined)(i)||!(s<i.length)){e.next=15;break}if(i[s].name,!Le(this.props.lang,i[s])){e.next=12;break}return n=s,e.abrupt("break",15);case 12:s++,e.next=7;break;case 15:if(-1==n){e.next=21;break}return e.next=18,this.speech.setVoice(i[n].name);case 18:this.setState({languageSupportedPlay:!0}),e.next=22;break;case 21:this.setState({languageSupportedPlay:!1});case 22:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.props.lang;Object(L.isNullOrUndefined)(t)&&(t="en");for(var a={color:"white",backgroundColor:"rgb(117, 106, 214)",borderRadius:"20px",fontSize:"0.6em",padding:"10px",maxWidth:"92%",wordWrap:"break-word"},i={backgroundColor:"darkcyan",color:"white"},s=xe(this.state.currentSelectedBlocks).map((function(t){return e.SingleBlock(t)})),l=(ke(this.state.currentSelectedBlocks),": "),r=0;r<this.state.selectedNodes.length;r++)l+=this.state.selectedNodes[r]+", ";l.length>0&&(l=l.substring(0,l.length-2));var o=Te(this.state.currentSelectedBlocks),c=this.AgregateNumberDisplay(o,l);return n.a.createElement("div",null,void 0!=this.props.isPublic&&this.props.isPublic?n.a.createElement("div",{className:"dropdown-container only-large-screen",style:{marginBottom:"1em",marginTop:"0"}},n.a.createElement(A.a,{options:this.props.multiSelectEntityList,optionClicked:this.entityClicked.bind(this),selectedBadgeClicked:this.selectedBadgeClicked.bind(this),selectedOptionsStyles:a,optionsListStyles:i,isTextWrap:!1})):n.a.createElement("div",{className:"filter-container"},n.a.createElement("div",{className:"dropdown-container only-large-screen"},n.a.createElement(A.a,{options:this.props.multiSelectEntityList,optionClicked:this.entityClicked.bind(this),selectedBadgeClicked:this.selectedBadgeClicked.bind(this),selectedOptionsStyles:a,optionsListStyles:i,isTextWrap:!1}))),this.state.copiedText?n.a.createElement("div",{className:"copiedTextContainer"},n.a.createElement("p",{className:"copiedTextValue"},"Text has been copied in the block format. Paste it in another story.")):null,this.state.currentSelectedBlocks.length>=0?n.a.createElement("div",{className:"graph-block-list",ref:this.graphRef},l.length>0&&!Ye&&!Object(L.isNullOrUndefined)(this.speech)&&this.state.languageSupportedPlay?n.a.createElement("div",{className:"graph-block-list-sound"},"end"==this.state.playStatus?n.a.createElement("a",{onClick:this.playExistingSelection,className:"soundIcon"},n.a.createElement(te.a,null)):null,"start"==this.state.playStatus||"paused"==this.state.playStatus?n.a.createElement("a",{onClick:this.stopExistingSelection,className:"soundIcon"},n.a.createElement(ie.a,null)):null):null,(void 0==this.props.isPublic||!this.props.isPublic)&&l.length>0?n.a.createElement(le.CopyToClipboard,{text:ke(this.state.currentSelectedBlocks),onCopy:function(){return e.setState({copiedText:!0})}},n.a.createElement("div",{className:"copyBlockText"},"Copy the text as draft")):null,n.a.createElement("div",{className:"graph-block-list-title",onClick:this.toggleSelectedBlocksPane},l.length>0?n.a.createElement("span",null,Fe[t]):n.a.createElement("span",null,Pe[t]),n.a.createElement("span",null,l),n.a.createElement("span",null,this.state.openSelectedBlocks?n.a.createElement(Z.a,{className:l.length>0?"graph-block-list-title-icon":"displayNone"}):n.a.createElement(Q.a,{className:l.length>0?"graph-block-list-title-icon":"displayNone"}))),n.a.createElement(q.a,{open:this.state.openSelectedBlocks,duration:400,transitions:["height","opacity","background"]},n.a.createElement("div",{className:"graph-block-list-container",id:"graph-selected-block-list"},c,s))):null,this.generateAmGraph())}}]),i}(n.a.Component),qe=function(e){Object(c.a)(i,e);var t=Object(d.a)(i);function i(e){var a;return Object(r.a)(this,i),(a=t.call(this,e)).state={amGraph:{},graph:{nodes:[],edges:[]},graphHelperMap:{nodes:{},edges:{}},graphOptions:{layout:{hierarchical:!1},edges:{arrows:{to:{enabled:!1,scaleFactor:1,type:"arrow"},middle:{enabled:!1,scaleFactor:1,type:"arrow"},from:{enabled:!1,scaleFactor:1,type:"arrow"}},color:"#000000"}},graphEvents:{},firstEntitySelectList:[{value:!0,label:"None",id:-1}],secondEntitySelectList:[{value:!0,label:"None",id:-1}],currentSelectedBlocks:[],selectedNodes:[],openSelectedBlocks:!1,wasAllOptionSelected:!0,wasNoneOptionSelected:!1,testVar:-1},a.initializeGraphEvents=a.initializeGraphEvents.bind(Object(v.a)(a)),a.generateEntityLists=a.generateEntityLists.bind(Object(v.a)(a)),a.generateGraph=a.generateGraph.bind(Object(v.a)(a)),a.getPathViaBfs=a.getPathViaBfs.bind(Object(v.a)(a)),a.findConnections=a.findConnections.bind(Object(v.a)(a)),a.onSelectGraph=a.onSelectGraph.bind(Object(v.a)(a)),a.addBlocksForNodeCharacteristic=a.addBlocksForNodeCharacteristic.bind(Object(v.a)(a)),a.addBlocksForEdge=a.addBlocksForEdge.bind(Object(v.a)(a)),a.isValidBlock=a.isValidBlock.bind(Object(v.a)(a)),a.clickBlockFromList=a.clickBlockFromList.bind(Object(v.a)(a)),a.sortBlocks=a.sortBlocks.bind(Object(v.a)(a)),a.removeHashedIndex=a.removeHashedIndex.bind(Object(v.a)(a)),a.generateAmGraph=a.generateAmGraph.bind(Object(v.a)(a)),a.selectEdge=a.selectEdge.bind(Object(v.a)(a)),a.selectNode=a.selectNode.bind(Object(v.a)(a)),a.toggleSelectedBlocksPane=a.toggleSelectedBlocksPane.bind(Object(v.a)(a)),a.resetScroll=a.resetScroll.bind(Object(v.a)(a)),a.findConnectionRef=n.a.createRef(),a}return Object(o.a)(i,[{key:"resetScroll",value:function(){var e=null;this.findConnectionRef&&(e=this.findConnectionRef.current.offsetTop),this.props.setScrollToGraphList&&this.props.setScrollToGraphList(e)}},{key:"isValidBlock",value:function(e){return!Object(L.isNullOrUndefined)(e.title)&&""!=e.title}},{key:"selectEdge",value:function(e,t){var a=this;this.setState({openSelectedBlocks:!1});var i=[],n={to:t,from:e};this.addBlocksForEdge(n,i,{}),i.sort((function(e,t){return a.sortBlocks(e.title,t.title,e.timestamp,t.timestamp)})),this.setState({currentSelectedBlocks:i,openSelectedBlocks:!0,selectedNodes:[e,t]}),this.resetScroll()}},{key:"addBlocksForEdge",value:function(e,t,a){for(var i=this.props.investigationGraph[e.from].edges[e.to],n=0;n<i.length;n++){var s=i[n];if(!(s in a)){var l=this.props.blockTree[s];this.isValidBlock(l)&&t.push(l),a[s]=!0}}}},{key:"selectNode",value:function(e){var t=this;this.setState({openSelectedBlocks:!1});var a=[],i={};this.addBlocksForNodeCharacteristic(e,a,i);var n=this.props.investigationGraph[e].edges,s=this;Object.keys(n).forEach((function(t){var n={to:e,from:t};s.addBlocksForEdge(n,a,i)})),a.sort((function(e,a){return t.sortBlocks(e.title,a.title,e.timestamp,a.timestamp)})),this.setState({currentSelectedBlocks:a,openSelectedBlocks:!0,selectedNodes:[e]}),this.resetScroll()}},{key:"addBlocksForNodeCharacteristic",value:function(e,t,a){for(var i=this.props.investigationGraph[e].char,n=0;n<i.length;n++){var s=i[n];if(!(s in a)){var l=this.props.blockTree[s];this.isValidBlock(l)&&t.push(l),a[s]=!0}}}},{key:"sortBlocks",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;e=e.trim(),t=t.trim();var n=0,s=0,l=!1,r=!1;if(e.length>0&&"#"===e.charAt(0)){for(var o="",c=1;c<e.length;c++)isNaN(parseInt(e.charAt(c),10))&&"."!==e[c]?o.length>0&&(n=parseFloat(o),l=!0):o+=e.charAt(c);o.length>0&&(n=parseFloat(o),l=!0)}if(t.length>0&&"#"===t.charAt(0)){for(o="",c=1;c<t.length;c++)isNaN(parseInt(t.charAt(c),10))&&"."!==t[c]?o.length>0&&(s=parseFloat(o),r=!0):o+=t.charAt(c);o.length>0&&(s=parseFloat(o),r=!0)}return!l&&r?1:l&&!r?-1:l&&r?n>s?1:-1:a>i?1:i>a?-1:e>t?1:-1}},{key:"onSelectGraph",value:function(e){this.setState({openSelectedBlocks:!1});var t=e.nodes,a=e.edges,i=[],n={};if(!Object(L.isNullOrUndefined)(a))for(var s=0;s<a.length;s++){var l=a[s],r=this.state.graphHelperMap.edges[l];this.addBlocksForEdge(r,i,n)}if(!Object(L.isNullOrUndefined)(t))for(s=0;s<t.length;s++){var o=t[s],c=this.state.graphHelperMap.nodes[o];this.addBlocksForNodeCharacteristic(c,i,n)}this.setState({currentSelectedBlocks:i,openSelectedBlocks:!0})}},{key:"initializeGraphEvents",value:function(){var e=this,t={select:function(t){e.onSelectGraph(t)}};this.setState({graphEvents:t})}},{key:"getPathViaBfs",value:function(e,t){var a=[],i={};i[e]={id:e,blockCount:0,hops:0,prevNode:""},a.push(e);for(var n=this.props.investigationGraph,s=0;!(s>=a.length||a[s]==t);){var l=a[s],r=i[l],o=r.hops,c=r.blockCount,d=n[l].edges;Object.keys(d).forEach((function(e){var t=!1;e in i?(i[e].hops>o+1||i[e].hops==o+1&&c+n[l].edges[e].length>i[e].blockCount)&&(t=!0):(t=!0,a.push(e)),t&&(i[e]={id:e,blockCount:c+n[l].edges[e].length,hops:o+1,prevNode:l})})),s++}for(var u={},h=t;h in i&&h!=e;)u[h]=!0,h=i[h].prevNode;var p=[];if(h==e){u[e]=!0;for(s=1;s<this.state.firstEntitySelectList.length;s++)if(this.state.firstEntitySelectList[s].label in u){var m={value:!0,label:this.state.firstEntitySelectList[s].label,id:this.state.firstEntitySelectList[s].id};p.push(m)}}return p}},{key:"findConnections",value:function(){for(var e={},t={},a=[],i=1;i<this.state.firstEntitySelectList.length;i++)this.state.firstEntitySelectList[i].value&&(e=this.state.firstEntitySelectList[i]);for(i=1;i<this.state.secondEntitySelectList.length;i++)this.state.secondEntitySelectList[i].value&&(t=this.state.secondEntitySelectList[i]);return 0==(a=this.getPathViaBfs(e.label,t.label)).length&&(a.push(e),a.push(t)),a}},{key:"generateAmGraph",value:function(){var e=Object(k.a)(f.a.mark((function e(){var t,a,i,n,s,l,r,o,c,d;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],a={},(i=this.findConnections()).length>=2)for(n={},s=0,l=0;l<i.length;l++)(r=i[l]).value&&(n[r.label]=s,o=null,this.props.imageMapping&&r.label in this.props.imageMapping&&(o=this.props.imageMapping[r.label]),t.push({id:s,label:r.label,link:[],image:o}),a[s]=r.label,c=r.label,Object(L.isNullOrUndefined)(this.props.investigationGraph)||Object(L.isNullOrUndefined)(this.props.investigationGraph[c])||(d=this.props.investigationGraph[c].edges,Object.keys(d).forEach((function(e){e in n&&t[n[e]].link.push(s)}))),s++);({nodes:a,edges:{}}),this.setState({amGraph:t});case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"generateGraph",value:function(){var e=Object(k.a)(f.a.mark((function e(){var t,a,i,n,s,l,r,o,c,d,u,h,p;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={nodes:[],edges:[]},a={},(i=this.findConnections()).length>=2)for(n={},s=0,l=0;l<i.length;l++)(r=i[l]).value&&(n[r.label]=s,t.nodes.push({id:s,label:r.label}),a[s]=r.label,o=r.label,c=this.props.investigationGraph[o].edges,Object.keys(c).forEach((function(e){e in n&&t.edges.push({from:n[e],to:s,id:n[e]+"-"+s})})),s++);for(d={nodes:a,edges:{}},l=0;l<t.edges.length;l++)u=t.edges[l],h=a[u.to],p=a[u.from],d.edges[u.id]={from:p,to:h};return e.next=8,this.setState({graph:t,graphHelperMap:d});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"generateEntityLists",value:function(){var e=1,t=this.state.firstEntitySelectList,a=this.state.secondEntitySelectList;Object.keys(this.props.investigationGraph).forEach((function(i){t.push({value:!1,label:i,id:e}),a.push({value:!1,label:i,id:e}),e++})),t.sort((function(e,t){return"none"==e.label.toLocaleLowerCase()?-1:"none"==t.label.toLocaleLowerCase()?1:e.label.toLocaleLowerCase()<t.label.toLocaleLowerCase()?-1:1})),a.sort((function(e,t){return"none"==e.label.toLocaleLowerCase()?-1:"none"==t.label.toLocaleLowerCase()?1:e.label.toLocaleLowerCase()<t.label.toLocaleLowerCase()?-1:1})),this.setState({firstEntitySelectList:t,secondEntitySelectList:a})}},{key:"removeHashedIndex",value:function(e){var t=0;if((e=e.trim()).length>0&&"#"==e[0]){for(var a=1;a<e.length;a++)if(t=a," "==e.charAt(a))return e.substring(t).trim();return""}return e}},{key:"BlockEntity",value:function(e){return n.a.createElement("span",{className:"graph-block-entity"},e.title)}},{key:"BlockEvidence",value:function(e,t){a(329);var i=[e.evidenceLink];return R()(e.evidenceLink)?n.a.createElement("div",{className:"graph-block-evidence"},n.a.createElement(F.a,{src:i,className:"graph-block-evidence-image"})):null}},{key:"SingleBlock",value:function(e){var t=this;null!=e.entities&&e.entities.length>0&&e.entities.map((function(e){return t.BlockEntity(e)}));var a="";return null!=e.evidences&&e.evidences.length>0&&(a=e.evidences.map((function(e,a){return t.BlockEvidence(e,a)}))),n.a.createElement("div",{className:"graph-block-para-div",onClick:function(){t.clickBlockFromList(e)}},n.a.createElement("h4",{className:"graph-block-title"},this.removeHashedIndex(e.title)),n.a.createElement("div",{className:"graph-content-container"},n.a.createElement("p",{className:"graph-block-text"},e.summary),n.a.createElement("div",{class:"graph-block-evidence-container"},a)))}},{key:"firstEntityClicked",value:function(e){this.setState({firstEntitySelectList:e})}},{key:"firstSelectedBadgeClicked",value:function(e){this.setState({firstEntitySelectList:e})}},{key:"secondEntityClicked",value:function(e){this.setState({secondEntitySelectList:e})}},{key:"secondSelectedBadgeClicked",value:function(e){this.setState({secondEntitySelectList:e})}},{key:"clickBlockFromList",value:function(e){this.props.selectBlock(e)}},{key:"componentDidMount",value:function(){this.initializeGraphEvents(),this.generateEntityLists(),this.generateGraph()}},{key:"toggleSelectedBlocksPane",value:function(){this.setState({openSelectedBlocks:!this.state.openSelectedBlocks})}},{key:"render",value:function(){for(var e=this,t={color:"white",backgroundColor:"rgb(117, 106, 214)",borderRadius:"20px",fontSize:"0.6em",padding:"10px",maxWidth:"92%",wordWrap:"break-word"},a={backgroundColor:"darkcyan",color:"white"},i=this.state.currentSelectedBlocks.map((function(t){return e.SingleBlock(t)})),s=": ",l=0;l<this.state.selectedNodes.length;l++)s+=this.state.selectedNodes[l]+", ";return s.length>0&&(s=s.substring(0,s.length-2)),n.a.createElement("div",null,n.a.createElement("div",{className:"filter-container"},n.a.createElement("div",{className:"find-connections-dropdown-container"},n.a.createElement(A.a,{options:this.state.firstEntitySelectList,optionClicked:this.firstEntityClicked.bind(this),selectedBadgeClicked:this.firstSelectedBadgeClicked.bind(this),selectedOptionsStyles:t,optionsListStyles:a,isSingleSelect:!0,isTextWrap:!1})),n.a.createElement("div",{className:"find-connections-dropdown-container"},n.a.createElement(A.a,{options:this.state.secondEntitySelectList,optionClicked:this.secondEntityClicked.bind(this),selectedBadgeClicked:this.secondSelectedBadgeClicked.bind(this),selectedOptionsStyles:t,optionsListStyles:a,isSingleSelect:!0,isTextWrap:!1})),n.a.createElement("button",{className:"filterButton",onClick:this.generateAmGraph},"Find Connection")),this.state.currentSelectedBlocks.length>=0?n.a.createElement("div",{className:"graph-block-list"},n.a.createElement("div",{className:"graph-block-list-title",onClick:this.toggleSelectedBlocksPane,ref:this.findConnectionRef},n.a.createElement("span",null,"Graph selections"),n.a.createElement("span",null,s)),n.a.createElement(q.a,{open:this.state.openSelectedBlocks,duration:1e3,transitions:["height","opacity","background"]},n.a.createElement("div",{className:"graph-block-list-container",id:"graph-selected-block-list"},i))):null,n.a.createElement("div",{className:"graph-main"},n.a.createElement(Y,{graph:this.state.amGraph,selectEdge:this.selectEdge,selectNode:this.selectNode})))}}]),i}(n.a.Component),Xe=(a(1411),a(468)),Qe=(a(1421),!!window.chrome&&(!!window.chrome.webstore||!!window.chrome.runtime)),$e=!!document.documentMode,Ze=function(e){Object(c.a)(i,e);var t=Object(d.a)(i);function i(e){var a;return Object(r.a)(this,i),(a=t.call(this,e)).state={playStatus:"end",isSpeechAvailable:!1},a.speech=null,a.selectTimelineBlock=a.selectTimelineBlock.bind(Object(v.a)(a)),a.removeHashedIndex=a.removeHashedIndex.bind(Object(v.a)(a)),a.initSpeech=a.initSpeech.bind(Object(v.a)(a)),a.playExistingSelection=a.playExistingSelection.bind(Object(v.a)(a)),a.stopExistingSelection=a.stopExistingSelection.bind(Object(v.a)(a)),a.timeoutFn=a.timeoutFn.bind(Object(v.a)(a)),a.timeInFn=a.timeInFn.bind(Object(v.a)(a)),E.a.initialize("UA-143383035-1"),a}return Object(o.a)(i,[{key:"timeoutFn",value:function(){var e=Object(k.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("start"!=this.state.playStatus||Object(L.isNullOrUndefined)(this.speech)||!Qe){e.next=5;break}return e.next=3,this.speech.pause();case 3:return e.next=5,this.speech.resume();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"timeInFn",value:function(){var e=this;this.timeout=setInterval((function(){e.timeoutFn()}),8500)}},{key:"initSpeech",value:function(){var e=Object(k.a)(f.a.mark((function e(){var t,a,i,n,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.speech=new se.a,this.speech.hasBrowserSupport(),e.next=5,this.speech.init();case 5:t=e.sent,Object(L.isNullOrUndefined)(t)||this.setState({isSpeechAvailable:!0}),a=t.voices,i=-1,n=0;case 10:if(Object(L.isNullOrUndefined)(a)||!(n<a.length)){e.next=19;break}if(-1==i&&(i=n),!(s=a[n].name).toLowerCase().includes("eng")&&!s.toLowerCase().includes("catherine")){e.next=16;break}return i=n,e.abrupt("break",19);case 16:n++,e.next=10;break;case 19:if(-1==i){e.next=22;break}return e.next=22,this.speech.setVoice(a[i].name);case 22:e.next=26;break;case 24:e.prev=24,e.t0=e.catch(0);case 26:case"end":return e.stop()}}),e,this,[[0,24]])})));return function(){return e.apply(this,arguments)}}()},{key:"stopExistingSelection",value:function(){var e=Object(k.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(L.isNullOrUndefined)(this.speech)){e.next=4;break}return e.next=3,this.speech.cancel();case 3:this.setState({playStatus:"end"});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"playExistingSelection",value:function(){var e=Object(k.a)(f.a.mark((function e(){var t,a=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(L.isNullOrUndefined)(this.speech)){e.next=10;break}if(!this.speech.speaking()){e.next=4;break}return e.next=4,this.speech.cancel();case 4:"timeline",E.a.event({category:"playSound",action:"PlaySound timeline",label:"PlaySound timeline"}),t="",this.props.timeline.map((function(e){var i=he(e),n=a.removeHashedIndex(e.title),s=e.summary;!Object(L.isNullOrUndefined)(e.blockDate)&&Object(L.isNullOrUndefined)(e.blockDate.month)&&(i="Year "+i),!Object(L.isNullOrUndefined)(i)&&i.length>0&&(t+=i+". "),!Object(L.isNullOrUndefined)(n)&&n.length>0&&(t+=Se(n)+". "),t+=Se(s),t+=". ";for(var l=0;!Object(L.isNullOrUndefined)(e.numbers)&&l<e.numbers.length;l++)t+=e.numbers[l].key+": "+String(e.numbers[l].value)+". "})),this.setState({playStatus:"start"}),this.speech.speak({text:t,queue:!1}).then((function(){a.setState({playStatus:"end"})})).catch((function(e){console.error("An error occurred :",e)}));case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){var e=Object(k.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initSpeech();case 2:Qe&&this.timeInFn();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){var e=Object(k.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(L.isNullOrUndefined)(this.speech)){e.next=3;break}return e.next=3,this.speech.cancel();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"BlockEvidence",value:function(e,t){a(329);var i=[e.evidenceLink];return n.a.createElement("div",null,n.a.createElement(F.a,{src:i,style:{width:"80%",marginLeft:"10%",marginRight:"10%"}}))}},{key:"BlockEntity",value:function(e){return n.a.createElement("span",{className:"timeline-block-entity"},e.title)}},{key:"removeHashedIndex",value:function(e){if(e){var t=0;if((e=e.trim()).length>0&&"#"==e[0]){for(var a=1;a<e.length;a++)if(t=a," "==e.charAt(a))return e.substring(t).trim();return""}return e}return""}},{key:"selectTimelineBlock",value:function(e){E.a.event({category:"select_timeline_block",action:"Select "+JSON.stringify(e),label:JSON.stringify(e)}),this.props.selectBlock(e)}},{key:"renderTimeline",value:function(e,t){var a=this;null!=e.entities&&e.entities.length>0&&e.entities.map((function(e){return a.BlockEntity(e)}));var i="";e.evidences&&e.evidences.length>0&&(i=e.evidences.map((function(e,t){return a.BlockEvidence(e,t)})));var s=he(e),l="rgb(33, 150, 243)";t%3===1?l="rgb(243, 33, 150)":t%3===2&&(l="rgb(243, 33, 25)");var r=null;!Object(L.isNullOrUndefined)(e.numbers)&&e.numbers.length>0&&(r=e.numbers.map((function(e){return n.a.createElement("span",null,n.a.createElement("span",{className:"graph-content-number-key"},e.key,": "),n.a.createElement("b",{className:"graph-content-number-value"},e.value)," ",n.a.createElement("br",null))})));return n.a.createElement(Xe.VerticalTimelineElement,{className:"vertical-timeline-element--work",date:s,iconStyle:{background:l,color:"#fff"}},n.a.createElement("div",{onClick:function(){a.selectTimelineBlock(e)},className:"timeline-block-container"},this.removeHashedIndex(e.title).length>0?n.a.createElement("h4",{className:"vertical-timeline-element-title timeline-block-title timeline-block-text"},this.removeHashedIndex(e.title)):null,n.a.createElement("p",{className:"timeline-block-text"},e.summary),n.a.createElement("p",{className:"timeline-block-text"},r),""!==i.length?n.a.createElement("div",null,i):null))}},{key:"render",value:function(){var e=this,t=this.props.timeline.map((function(t,a){return e.renderTimeline(t,a)}));return n.a.createElement("div",null,!$e&&this.state.isSpeechAvailable?n.a.createElement("div",{className:"timeline-block-list-sound timeline-view-container-width"},"end"==this.state.playStatus?n.a.createElement("a",{onClick:this.playExistingSelection,className:"soundIcon"},n.a.createElement(te.a,null)):null,"start"==this.state.playStatus||"paused"==this.state.playStatus?n.a.createElement("a",{onClick:this.stopExistingSelection,className:"soundIcon"},n.a.createElement(ie.a,null)):null):null,n.a.createElement("div",{style:{background:"lightblue"},className:"timeline-view-container timeline-view-container-width",id:"timeline-view-container-id"},n.a.createElement(Xe.VerticalTimeline,null,t,n.a.createElement(Xe.VerticalTimelineElement,{iconStyle:{background:"rgb(16, 204, 82)",color:"#fff"}}))),n.a.createElement("div",{className:"dummyTimelineView timeline-view-container-width"}))}}]),i}(n.a.Component),et=function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).state={key:"graph",adhocTooltip:{timeline:{flag:!1,text:[{title:ze.title[e.lang],target:".tooltipTimeline",content:ze.desc[e.lang],disableBeacon:!0}]},mindmap:{flag:!1,text:[{title:Re.title[e.lang],target:".tooltipMindmap",content:Re.desc[e.lang],disableBeacon:!0}]}}},i.isSummaryBlocksAvailable=i.isSummaryBlocksAvailable.bind(Object(v.a)(i)),i.isGraphAvailable=i.isGraphAvailable.bind(Object(v.a)(i)),i.isTimelineAvailable=i.isTimelineAvailable.bind(Object(v.a)(i)),i.showLocalTooltip=i.showLocalTooltip.bind(Object(v.a)(i)),i.hideLocalTooltip=i.hideLocalTooltip.bind(Object(v.a)(i)),i.handleAdhocTooltipJoyrideCallback=i.handleAdhocTooltipJoyrideCallback.bind(Object(v.a)(i)),i}return Object(o.a)(a,[{key:"showLocalTooltip",value:function(e){var t=this.state.adhocTooltip;"timeline"==e?t.timeline.flag=!0:"mindmap"==e&&(t.mindmap.flag=!0),this.setState({adhocTooltip:t})}},{key:"hideLocalTooltip",value:function(e){var t=this.state.adhocTooltip;"timeline"==e?t.timeline.flag=!1:"mindmap"==e&&(t.mindmap.flag=!1),this.setState({adhocTooltip:t})}},{key:"handleAdhocTooltipJoyrideCallback",value:function(e,t){e.action,e.index;var a=e.status;e.type;[O.a.FINISHED,O.a.SKIPPED].includes(a)&&this.hideLocalTooltip(t)}},{key:"isSummaryBlocksAvailable",value:function(){return!Object(L.isNullOrUndefined)(this.props.summaryBlocks)&&0!=this.props.summaryBlocks.length}},{key:"isGraphAvailable",value:function(){return!Object(L.isNullOrUndefined)(this.props.investigationGraph)&&0!=Object.keys(this.props.investigationGraph).length}},{key:"isTimelineAvailable",value:function(){return!!(this.props.timeline&&this.props.timeline.length>0)}},{key:"isBlockprobeEmpty",value:function(){return!(this.isTimelineAvailable()||this.isGraphAvailable()||this.isSummaryBlocksAvailable())}},{key:"render",value:function(){var e=this,t=this.props.lang;return Object(L.isNullOrUndefined)(t)&&(t="en"),n.a.createElement("div",{style:{paddingBottom:"15px"}},this.props.setNewVisualisation?n.a.createElement("div",{className:"shareTooltipTextContainer"},n.a.createElement("p",{className:"contributeOptionText"},"Click on the menu (top-left) and choose ",n.a.createElement("a",{className:"tooltip-selection",onClick:function(){return e.props.setNewVisualisation("contributions")}},"Contribute")," to resume working."),n.a.createElement("p",{className:"contributeOptionText"},"Click on the menu (top-left) and choose ",n.a.createElement("a",{className:"tooltip-selection",onClick:function(){return e.props.setNewVisualisation("publish_blockprobe")}},"Share")," to share.")):null,this.isSummaryBlocksAvailable()?n.a.createElement("div",null,n.a.createElement(D,{summaryBlocks:this.props.summaryBlocks,selectBlock:this.props.selectBlock})):null,this.isGraphAvailable()?n.a.createElement("div",null,n.a.createElement("div",{className:"dashboard-section-heading graph-heading"},Ve[t],n.a.createElement("a",{className:"tooltipMindmap tooltips-dashboard",onMouseEnter:function(){return e.showLocalTooltip("mindmap")},onClick:function(t){e.showLocalTooltip("mindmap")}},n.a.createElement(T.a,{style:{fontSize:"19px"}})),n.a.createElement(O.b,{styles:{options:{arrowColor:"#e3ffeb",beaconSize:"4em",primaryColor:"#05878B",backgroundColor:"#e3ffeb",overlayColor:"rgba(10,10,10, 0.4)",width:900,zIndex:1e3}},steps:this.state.adhocTooltip.mindmap.text,run:this.state.adhocTooltip.mindmap.flag,callback:function(t){e.handleAdhocTooltipJoyrideCallback(t,"mindmap")}})),n.a.createElement(Ke,{blockTree:this.props.blockTree,investigationGraph:this.props.investigationGraph,selectBlock:this.props.selectBlock,imageMapping:this.props.imageMapping,setScrollToGraphList:this.props.setScrollToGraphList,multiSelectEntityList:this.props.multiSelectEntityList,isPublic:this.props.isPublic,lang:this.props.lang})):null,this.isTimelineAvailable()?n.a.createElement("div",null,n.a.createElement("div",{className:"dashboard-section-heading timeline-heading",style:{marginBottom:"0 !important"}},He[t],n.a.createElement("a",{className:"tooltipTimeline tooltips-dashboard",onMouseEnter:function(){return e.showLocalTooltip("timeline")},onClick:function(t){e.showLocalTooltip("timeline")}},n.a.createElement(T.a,{style:{fontSize:"19px"}})),n.a.createElement(O.b,{styles:{options:{arrowColor:"#e3ffeb",beaconSize:"4em",primaryColor:"#05878B",backgroundColor:"#e3ffeb",overlayColor:"rgba(10,10,10, 0.4)",width:900,zIndex:1e3}},steps:this.state.adhocTooltip.timeline.text,run:this.state.adhocTooltip.timeline.flag,callback:function(t){e.handleAdhocTooltipJoyrideCallback(t,"timeline")}})),n.a.createElement(Ze,{timeline:this.props.timeline,selectBlock:this.props.selectBlock})):null,this.isBlockprobeEmpty()?n.a.createElement("div",{className:"dashboard-section-heading graph-heading",style:{textAlign:"center"}},Ge[t]):null)}}]),a}(n.a.Component),tt=function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).state={key:"graph",adhocTooltip:{timeline:{flag:!1,text:[{title:"Timeline view",target:".tooltipTimeline",content:"Visualise the story as a timeline!",disableBeacon:!0}]},mindmap:{flag:!1,text:[{title:"Mindmap view",target:".tooltipMindmap",content:"Visualise the story as a mindmap! Select any topic from the mindmap to read all about that topic.",disableBeacon:!0}]}}},i.isSummaryBlocksAvailable=i.isSummaryBlocksAvailable.bind(Object(v.a)(i)),i.isGraphAvailable=i.isGraphAvailable.bind(Object(v.a)(i)),i.isTimelineAvailable=i.isTimelineAvailable.bind(Object(v.a)(i)),i.showLocalTooltip=i.showLocalTooltip.bind(Object(v.a)(i)),i.hideLocalTooltip=i.hideLocalTooltip.bind(Object(v.a)(i)),i.handleAdhocTooltipJoyrideCallback=i.handleAdhocTooltipJoyrideCallback.bind(Object(v.a)(i)),i}return Object(o.a)(a,[{key:"showLocalTooltip",value:function(e){var t=this.state.adhocTooltip;"timeline"==e?t.timeline.flag=!0:"mindmap"==e&&(t.mindmap.flag=!0),this.setState({adhocTooltip:t})}},{key:"hideLocalTooltip",value:function(e){var t=this.state.adhocTooltip;"timeline"==e?t.timeline.flag=!1:"mindmap"==e&&(t.mindmap.flag=!1),this.setState({adhocTooltip:t})}},{key:"handleAdhocTooltipJoyrideCallback",value:function(e,t){e.action,e.index;var a=e.status;e.type;[O.a.FINISHED,O.a.SKIPPED].includes(a)&&this.hideLocalTooltip(t)}},{key:"isSummaryBlocksAvailable",value:function(){return!Object(L.isNullOrUndefined)(this.props.summaryBlocks)&&0!=this.props.summaryBlocks.length}},{key:"isGraphAvailable",value:function(){return!Object(L.isNullOrUndefined)(this.props.investigationGraph)&&0!=Object.keys(this.props.investigationGraph).length}},{key:"isTimelineAvailable",value:function(){return!!(this.props.timeline&&this.props.timeline.length>0)}},{key:"isBlockprobeEmpty",value:function(){return!(this.isTimelineAvailable()||this.isGraphAvailable()||this.isSummaryBlocksAvailable())}},{key:"render",value:function(){return n.a.createElement("div",{style:{paddingBottom:"15px"}},n.a.createElement(S.d,{style:{marginTop:"10px"}},n.a.createElement(S.b,null,this.isGraphAvailable()?n.a.createElement(S.a,null,"Mindmap"):null,this.isTimelineAvailable()?n.a.createElement(S.a,null,"Timeline"):null,this.isSummaryBlocksAvailable()?n.a.createElement(S.a,null,"Summary"):null),this.isGraphAvailable()?n.a.createElement(S.c,null,n.a.createElement("div",null,n.a.createElement(Ke,{blockTree:this.props.blockTree,investigationGraph:this.props.investigationGraph,selectBlock:this.props.selectBlock,imageMapping:this.props.imageMapping,setScrollToGraphList:this.props.setScrollToGraphList,multiSelectEntityList:this.props.multiSelectEntityList,isPublic:this.props.isPublic,lang:this.props.lang}))):null,this.isTimelineAvailable()?n.a.createElement(S.c,null,n.a.createElement("div",null,n.a.createElement(Ze,{timeline:this.props.timeline,selectBlock:this.props.selectBlock}))):null,this.isSummaryBlocksAvailable()?n.a.createElement(S.c,null,n.a.createElement("div",null,n.a.createElement(D,{summaryBlocks:this.props.summaryBlocks,selectBlock:this.props.selectBlock}))):null),this.isBlockprobeEmpty()?n.a.createElement("div",{className:"dashboard-section-heading graph-heading",style:{textAlign:"center"}},"Visualizations not found"):null)}}]),a}(n.a.Component),at=a(1762),it=a(863),nt=a.n(it),st=a(862),lt=a.n(st),rt=a(1761),ot=a(1786),ct=[{id:"en",label:"English"},{id:"hi",label:"Hindi"},{id:"ml",label:"Malayalam"},{id:"mr",label:"Marathi"},{id:"bn",label:"Bengali"}],dt=["#556efd","#e43c84","#ed4442","#46237a","#3ddc97"];W.i(z.a);var ut=function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).generateAmForceDirectedGraph=i.generateAmForceDirectedGraph.bind(Object(v.a)(i)),i.prepareData=i.prepareData.bind(Object(v.a)(i)),i.chart={},i.data=[],i.refData=[],i.edgeList=[],i.selectedEdges={},i.selectedLink=null,i.prevNode=null,i.prevLinksWith=null,i.currIndex=0,i.count=0,i.totalCnt=0,i.previousChart=JSON.parse(JSON.stringify(e.graph)),i.getDesiredLink=i.getDesiredLink.bind(Object(v.a)(i)),i.hasEdgeBeenSelected=i.hasEdgeBeenSelected.bind(Object(v.a)(i)),E.a.initialize("UA-143383035-1"),i}return Object(o.a)(a,[{key:"hideNode",value:function(e,t,a){e[t].nodeDisabled=a}},{key:"showOnlyNodes",value:function(e,t){for(var a=0;!Object(L.isNullOrUndefined)(e)&&a<e.length;a++)e[a].label in t?this.hideNode(e,a,!1):this.hideNode(e,a,!0)}},{key:"getNodesToBeDisplayed",value:function(){var e=this.edgeList,t={};if(e.length<=0)return t;for(var a=e.length,i=0,n=this.currIndex%a;n=(n+1)%a,this.hasEdgeBeenSelected(e[n].f,e[n].s)||(t[e[n].f]="",t[e[n].s]="",i++),26!=Object.keys(t).length&&n!=this.currIndex%a;);for(this.currIndex=n;Object.keys(t).length<6&&(n=(n+1)%a,this.hasEdgeBeenSelected(e[n].f,e[n].s)&&(t[e[n].f]="",t[e[n].s]=""),n!=this.currIndex%a););return this.count=0,this.totalCnt=i,t}},{key:"reshuffleGraphNodes",value:function(e){var t=this.getNodesToBeDisplayed();this.showOnlyNodes(e,t)}},{key:"getEdgeList",value:function(e){for(var t=[],a=0;e&&a<e.length;a++){var i=JSON.parse(JSON.stringify(e[a]));if("ALL"!=i.label&&i.link)for(var n=0;n<i.link.length;n++)t.push({f:i.label,s:e[i.link[n]].label,selected:!1})}return t}},{key:"prepareData",value:function(e,t){for(var a=[],i=0;e&&i<e.length;i++){var n=JSON.parse(JSON.stringify(e[i]));n.image&&n.image.length>0?(n.imageDisabled=!1,n.circleDisabled=!0):(n.imageDisabled=!0,n.circleDisabled=!1),n.color=W.e(dt[i%dt.length]),"ALL"==n.label?(n.isNotAll=!1,n.imageDisabled=!0,n.circleDisabled=!0):n.isNotAll=!0,t||delete n.link,"ALL"!=n.label&&a.push(n)}return a}},{key:"getDesiredLink",value:function(e,t,a){for(var i=0;!Object(L.isNullOrUndefined)(e)&&i<e.length;i++){var n=e[i];if(!Object(L.isNullOrUndefined)(n))for(var s in n){var l=n[s],r=l.source.label.currentText,o=l.target.label.currentText;if(r!=o&&(r==t&&o==a||r==a&&o==t))return l}}return null}},{key:"hasEdgeBeenSelected",value:function(e,t){if(!Object(L.isNullOrUndefined)(e)&&!Object(L.isNullOrUndefined)(t))return String(e+",_CCC_,"+t)in this.selectedEdges||String(t+",_CCC_,"+e)in this.selectedEdges}},{key:"addSelectedEdgeToMap",value:function(e,t){this.selectedEdges[String(e+",_CCC_,"+t)]=!0}},{key:"getCenterStrength",value:function(e){return.2772727+.022727*e}},{key:"getBodyStrength",value:function(e){return.170454*e-40.04545}},{key:"generateAmForceDirectedGraph",value:function(e){var t=W.f("chartdiv",H.b),a=t.series.push(new H.a),i=this.data.length;a.data=this.data,a.dataFields.value="value",a.dataFields.name="label",a.dataFields.id="id",a.dataFields.children="children",a.dataFields.linkWith="link",a.dataFields.color="color",a.nodes.template.label.text="{name}",a.nodes.template.tooltipText="{name}",a.nodes.template.id="{id}",a.nodes.template.label.valign="bottom",a.nodes.template.label.fill=W.e("#000"),a.nodes.template.label.dy=-30,a.fontSize=13,a.minRadius=10,a.maxRadius=10,a.propertyFields.fill="color",a.nodes.template.label.propertyFields.hidden="circleDisabled",a.nodes.template.togglable=!1,a.nodes.template.propertyFields.disabled="nodeDisabled",a.nodes.template.circle.propertyFields.disabled="circleDisabled",a.nodes.template.outerCircle.propertyFields.disabled="circleDisabled";var n=a.nodes.template.createChild(_.a);n.image=new W.c,n.image.propertyFields.href="image",n.circle.radius=25,n.circle.strokeWidth=0,n.background.pointerLength=0,n.background.disabled=!0,window.innerWidth>600&&(n.background.radius=35,n.circle.radius=35);var s=n.createChild(W.a);s.propertyFields.fill="color",s.adapter.add("radius",(function(e,t){return t.parent.circle.radius+2})),s.propertyFields.disabled="imageDisabled";var l=a.nodes.template.createChild(W.d);l.width=35,l.height=15,l.depth=35,l.angle=45,l.strokeOpacity=1,l.strokeWidth=1.25,l.stroke=W.e("black"),l.fillOpacity=.85,l.fill=W.e("rgb(240,240,240)"),l.propertyFields.disabled="isNotAll",a.centerStrength=this.getCenterStrength(i),a.manyBodyStrength=this.getBodyStrength(i),a.links.template.strength=.5,a.links.template.strokeWidth=5;var r=this;a.links.template.interactionsEnabled=!0,a.links.template.clickable=!0,a.links.template.distance=8.5,a.links.template.events.on("hit",(function(e){var t=e.target;r.hasEdgeBeenSelected(t.source.label.currentText,t.target.label.currentText)&&(t.strokeWidth=9,r.selectedLink&&(r.selectedLink.strokeWidth=5),r.selectedLink=t,r.props.selectEdge(t.source.label.currentText,t.target.label.currentText))})),a.nodes.template.events.on("hit",(function(e){if(!r.props.disabled){r.selectedLink&&(r.selectedLink.strokeWidth=5);var t=r.props.selectedNodes.f,a=r.props.selectedNodes.s,i=e.target;null!=a&&(r.props.setNodeVal("s",null),r.props.setNodeVal("f",null),t=null,a=null);var n=!1;if(Object(L.isNullOrUndefined)(t)||Object(L.isNullOrUndefined)(t.label)||(n=r.hasEdgeBeenSelected(i.label.currentText,t.label.currentText)),Object(L.isNullOrUndefined)(t)||n||t==i)n?(r.props.setGameMessage("alreadySelected"),r.props.setNodeVal("s",i)):(r.props.setNodeVal("f",i),r.props.playNodeSound(i.label.currentText)),Object(L.isNullOrUndefined)(i.linksWith)?r.prevLinksWith={}:r.prevLinksWith=i.linksWith._dictionary;else{var s=i.linksWith;s=Object(L.isNullOrUndefined)(s)?{}:s._dictionary;var l=r.getDesiredLink([s,r.prevLinksWith],i.label.currentText,t.label.currentText);Object(L.isNullOrUndefined)(l)?r.connectEdge(i.label.currentText,t.label.currentText):l.strokeWidth=5,r.props.setNodeVal("s",i),r.prevLinksWith=null}}})),this.chart=t}},{key:"componentDidMount",value:function(){this.data=this.prepareData(this.props.graph,!1),this.edgeList=this.getEdgeList(this.props.graph),this.refData=this.prepareData(this.props.graph,!0),Object.keys(this.data).length>26&&this.reshuffleGraphNodes(this.data),this.generateAmForceDirectedGraph()}},{key:"componentDidUpdate",value:function(){JSON.stringify(this.previousChart)!=JSON.stringify(this.props.graph)&&(this.generateAmForceDirectedGraph(),this.previousChart=JSON.parse(JSON.stringify(this.props.graph)))}},{key:"connectEdge",value:function(e,t){for(var a=this.chart.series.values[0].data,i=-1,n=-1,s=!1,l=0;l<a.length;l++)a[l].label==e?i=l:a[l].label==t&&(n=l);if(-1!=i&&-1!=n){for(var r=0;!Object(L.isNullOrUndefined)(this.refData)&&!Object(L.isNullOrUndefined)(this.refData[i].link)&&r<this.refData[i].link.length;r++)this.refData[i].link[r]==n&&(s=!0);for(var o=0;!Object(L.isNullOrUndefined)(this.refData)&&!Object(L.isNullOrUndefined)(this.refData[n].link)&&o<this.refData[n].link.length;o++)this.refData[n].link[o]==i&&(s=!0)}s?("link"in a[i]||(a[i].link=[]),a[i].link.push(n),Object.keys(this.data).length>26&&this.count>Math.floor(.4*this.totalCnt)&&this.reshuffleGraphNodes(a),this.data=a,this.chart.series.values[0].invalidateData(),Object(L.isNullOrUndefined)(e)||Object(L.isNullOrUndefined)(t)||(this.addSelectedEdgeToMap(e,t),this.props.selectEdge(e,t),this.props.setGameMessage("successLink"),this.count=this.count+1,E.a.event({category:"connect_edge",action:"Connect "+String(e)+", "+String(t),label:String(e)+", "+String(t)}))):(this.props.setGameMessage("failLink"),this.props.setEntityStats(e,!1),this.props.setEntityStats(t,!1))}},{key:"render",value:function(){return n.a.createElement("div",{id:"chartdiv",style:{width:"100%",height:"100%"}})}}]),a}(n.a.Component);W.i(z.a);var ht=function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).chart=null,i.hand=null,i.range0=null,i.range1=null,i.generateSpeedometer=i.generateSpeedometer.bind(Object(v.a)(i)),i.moveHand=i.moveHand.bind(Object(v.a)(i)),i}return Object(o.a)(a,[{key:"generateSpeedometer",value:function(){var e=W.f(this.props.id,J.b);e.hiddenState.properties.opacity=0,e.radius=W.h(100),e.innerRadius=W.h(87);var t=e.xAxes.push(new J.c);t.min=this.props.min,t.max=this.props.max,t.strictMinMax=!0,t.renderer.ticks.template.disabled=!0,t.renderer.grid.template.disabled=!0,t.renderer.labels.template.disabled=!0;new W.b;var a=t.axisRanges.create();a.value=this.props.min,a.endValue=this.props.val,a.axisFill.fillOpacity=1,a.axisFill.fill=W.e("#556efd"),Object(L.isNullOrUndefined)(this.props.color)||(a.axisFill.fill=W.e(this.props.color)),a.axisFill.zIndex=-1;var i=t.axisRanges.create();i.value=this.props.val,i.endValue=this.props.max,i.axisFill.fillOpacity=1,i.axisFill.fill=W.e("#999999"),i.axisFill.zIndex=-1;var n=e.hands.push(new J.a);n.pin.disabled=!1,n.strokeWidth=0,n.fill=W.e("#556efd"),Object(L.isNullOrUndefined)(this.props.color)||(n.fill=W.e(this.props.color)),n.showValue(Math.min(Math.max(this.props.val,this.props.min),this.props.max)),this.chart=e,this.hand=n,this.range0=a,this.range1=i}},{key:"moveHand",value:function(e){if(!(Object(L.isNullOrUndefined)(this.chart)||Object(L.isNullOrUndefined)(this.hand)||Object(L.isNullOrUndefined)(this.range0)||Object(L.isNullOrUndefined)(this.range1))){this.chart.setTimeout((function(){t.hand.showValue(Math.min(Math.max(e,t.props.min),t.props.max),1e3,W.g.cubicOut),t.range0.endValue=e,t.range1.value=e}),500);var t=this}}},{key:"componentWillReceiveProps",value:function(e){this.props.val!=e.val&&this.moveHand(e.val)}},{key:"componentDidMount",value:function(){this.generateSpeedometer()}},{key:"render",value:function(){return n.a.createElement("div",{id:this.props.id,style:{width:"100%",height:"100%"}})}}]),a}(n.a.Component),pt=ht,mt=a(439),bt=a.n(mt),ft=(a(1426),function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).uiConfig={signInFlow:"popup",signInOptions:[y.auth.GoogleAuthProvider.PROVIDER_ID,y.auth.EmailAuthProvider.PROVIDER_ID,y.auth.PhoneAuthProvider.PROVIDER_ID],callbacks:{signInSuccess:function(){return!1},signInSuccessWithAuthResult:function(e,t){}}},i}return Object(o.a)(a,[{key:"saveUserStats",value:function(){var e=Object(k.a)(f.a.mark((function e(t){var a,i,n,s,l,r,o,c;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r in a=this.props.type,i=JSON.parse(JSON.stringify(this.props.stats)),n=Date.now(),i.ts=n,i.bpId=this.props.bpId,i.userId=t,i.bpTitle=this.props.title,s=this.props.stats.entityStats,l={},s)l[r]={entity:r,mistakes:s[r]};return i.entityStats=l,o={bpId:this.props.bpId,ts:n,title:this.props.title},c=this.props.bpId+"_"+String(n),"timeline"==a&&(c+="_ts",i.bpId=i.bpId+"_ts"),e.next=16,y.firestore().collection("Users").doc(t).collection("gameScores").doc(c).set(i);case 16:return e.next=18,y.firestore().collection("Users").doc(t).collection("gameBlockprobes").doc(this.props.bpId).set(o);case 18:if(this.getItemWrapper("isUserSignedIn",!1)){e.next=21;break}return e.next=21,y.auth().signOut();case 21:this.props.finishSaving(t);case 22:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getItemWrapper",value:function(e,t){return Object(L.isNullOrUndefined)(localStorage.getItem(e))?t:localStorage.getItem(e)}},{key:"componentDidMount",value:function(){var e=this;this.unregisterAuthObserver=y.auth().onAuthStateChanged((function(t){var a=null,i=null;!Object(L.isNullOrUndefined)(y.auth().currentUser)&&!Object(L.isNullOrUndefined)(y.auth().currentUser.providerData)&&y.auth().currentUser.providerData.length>0&&(i=y.auth().currentUser.providerData[0].providerId),"phone"==i?a=y.auth().currentUser.phoneNumber:("google.com"==i||"password"==i)&&(a=y.auth().currentUser.email),t&&!Object(L.isNullOrUndefined)(y.auth().currentUser)&&(Object(L.isNullOrUndefined)(a)||e.saveUserStats(a))}))}},{key:"componentWillUnmount",value:function(){this.unregisterAuthObserver()}},{key:"render",value:function(){return n.a.createElement("div",null,n.a.createElement("div",{className:"StatsAuthTitle"},"Sign in to save"),n.a.createElement("div",{className:"StatsAuthLoginContainer"},n.a.createElement(bt.a,{uiConfig:this.uiConfig,firebaseAuth:y.auth()})))}}]),a}(n.a.Component)),gt=ft,kt=(a(1427),function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).state={saveAuth:!1,finishedSaving:!1,uId:null},i.renderSingleEntityMistakes=i.renderSingleEntityMistakes.bind(Object(v.a)(i)),i.saveResults=i.saveResults.bind(Object(v.a)(i)),i.finishSaving=i.finishSaving.bind(Object(v.a)(i)),E.a.initialize("UA-143383035-1"),i}return Object(o.a)(a,[{key:"renderSingleEntityMistakes",value:function(e,t){return n.a.createElement("div",{className:"statsEntityMistakesContainer"},n.a.createElement("span",{className:"statsEntityText"},e," : "),n.a.createElement("span",{className:"statsMistakes"},String(t)))}},{key:"saveResults",value:function(){E.a.event({category:"saveResult",action:this.props.id+" "+this.props.bpId,label:this.props.id+" "+this.props.bpId}),this.setState({saveAuth:!0,finishedSaving:!1,uId:null})}},{key:"finishSaving",value:function(e){this.setState({saveAuth:!1,finishedSaving:!0,uId:e})}},{key:"componentDidMount",value:function(){this.props.stats&&E.a.event({category:"finishedGame",action:this.props.id+" "+this.props.bpId,label:"Score:"+String(this.props.stats.score)})}},{key:"render",value:function(){var e=this,t=[];for(var a in this.props.stats.entityStats)t.push({entity:a,mistakes:this.props.stats.entityStats[a]});t.sort((function(e,t){return e.mistakes-t.mistakes}));var i=t.map((function(t){return e.renderSingleEntityMistakes(t.entity,t.mistakes)})),s="speedometer_rand";Object(L.isNullOrUndefined)(this.props.id)||(s=this.props.id);var l="graphGame",r="#556efd";return Object(L.isNullOrUndefined)(this.props.type)||"timeline"!=this.props.type||(l="timeline",r="#46237a"),n.a.createElement("div",{class:"statsContainer"},n.a.createElement("div",{className:"statsTitle"},"Game results"),n.a.createElement("div",{className:"statsAmchartContainer"},n.a.createElement(pt,{id:s,val:this.props.stats.score,min:0,max:this.props.stats.totalScore,color:r})),n.a.createElement("div",{className:"statsScoreText"},"Score: ",n.a.createElement("span",{className:"statsScoreVal "+("graphGame"==l?"color-graph ":"")+("timeline"==l?"color-timeline ":"")},this.props.stats.score),n.a.createElement("span",{className:"statsTotalScoreVal"},"/",this.props.stats.totalScore)),(Object(L.isNullOrUndefined)(this.props.type)||"graph"==this.props.type)&&t.length>0?n.a.createElement("div",{className:"statsMistakesContainer"},n.a.createElement("div",{className:"statsMistakesTitle"},"Mistakes"),n.a.createElement("div",{className:"statsMistakesContent"},i)):null,n.a.createElement("div",{className:"statsMistakesOptions"},this.props.canSave&&!this.state.finishedSaving?n.a.createElement(rt.a,{variant:"contained",className:"statsSaveButton",onClick:function(){e.saveResults()}},"Save results"):null),n.a.createElement("div",null,this.state.finishedSaving?n.a.createElement("p",{className:"statsSavedMessage"},"Your results have been saved to the account ",this.state.uId,"!"):null),this.state.saveAuth?n.a.createElement(gt,{stats:this.props.stats,finishSaving:this.finishSaving,bpId:this.props.bpId,title:this.props.title,type:l}):null)}}]),a}(n.a.Component)),vt=kt,yt=a(290),Et=a.n(yt),St=a(441),Ot=a.n(St),Bt=a(442),Tt=a.n(Bt),wt=!!window.chrome&&(!!window.chrome.webstore||!!window.chrome.runtime),Nt=(document.documentMode,new Et.a(Ot.a,{volume:.65,throttleMs:100})),xt=new Et.a(Tt.a,{volume:.65,throttleMs:100}),jt=function(e){Object(c.a)(i,e);var t=Object(d.a)(i);function i(e){var a;return Object(r.a)(this,i),(a=t.call(this,e)).state={graph:{nodes:[],edges:[]},stopGame:!1,stats:{score:0,entityStats:{},totalScore:0},graphOptions:{layout:{hierarchical:!1},edges:{arrows:{to:{enabled:!1,scaleFactor:1,type:"arrow"},middle:{enabled:!1,scaleFactor:1,type:"arrow"},from:{enabled:!1,scaleFactor:1,type:"arrow"}},color:"#000000"}},graphEvents:{},multiSelectEntityList:[{value:!0,label:"All",id:0},{value:!1,label:"None",id:-1}],currentSelectedBlocks:[],selectedNodes:[],openSelectedBlocks:!1,wasAllOptionSelected:!0,wasNoneOptionSelected:!1,playStatus:"end",languageSupportedPlay:!0,copiedText:!1,score:0,totalScore:De(e.investigationGraph),gameMessageFinished:"Congratulations! You did it!",testVar:-1,gameNodeSelections:{f:null,s:null},gameMessage:null},a.graphHelperMap={nodes:{},edges:{}},a.entityStatistics={},a.speech=null,a.prevNode=null,a.handleAllAndNoneOptions=a.handleAllAndNoneOptions.bind(Object(v.a)(a)),a.initializeGraphEvents=a.initializeGraphEvents.bind(Object(v.a)(a)),a.generateGraph=a.generateGraph.bind(Object(v.a)(a)),a.onSelectGraph=a.onSelectGraph.bind(Object(v.a)(a)),a.addBlocksForNodeCharacteristic=a.addBlocksForNodeCharacteristic.bind(Object(v.a)(a)),a.addBlocksForEdge=a.addBlocksForEdge.bind(Object(v.a)(a)),a.isValidBlock=a.isValidBlock.bind(Object(v.a)(a)),a.clickBlockFromList=a.clickBlockFromList.bind(Object(v.a)(a)),a.sortBlocks=a.sortBlocks.bind(Object(v.a)(a)),a.removeHashedIndex=a.removeHashedIndex.bind(Object(v.a)(a)),a.AgregateNumberDisplay=a.AgregateNumberDisplay.bind(Object(v.a)(a)),a.generateAmGraph=a.generateAmGraph.bind(Object(v.a)(a)),a.selectEdge=a.selectEdge.bind(Object(v.a)(a)),a.selectNode=a.selectNode.bind(Object(v.a)(a)),a.toggleSelectedBlocksPane=a.toggleSelectedBlocksPane.bind(Object(v.a)(a)),a.resetScroll=a.resetScroll.bind(Object(v.a)(a)),a.initSpeech=a.initSpeech.bind(Object(v.a)(a)),a.playNodeSound=a.playNodeSound.bind(Object(v.a)(a)),a.playExistingSelection=a.playExistingSelection.bind(Object(v.a)(a)),a.pauseExistingSelection=a.pauseExistingSelection.bind(Object(v.a)(a)),a.resumeExistingSelection=a.resumeExistingSelection.bind(Object(v.a)(a)),a.stopExistingSelection=a.stopExistingSelection.bind(Object(v.a)(a)),a.timeoutFn=a.timeoutFn.bind(Object(v.a)(a)),a.timeInFn=a.timeInFn.bind(Object(v.a)(a)),a.setNodeVal=a.setNodeVal.bind(Object(v.a)(a)),a.clearGamifiedEntity=a.clearGamifiedEntity.bind(Object(v.a)(a)),a.BlockEntity=a.BlockEntity.bind(Object(v.a)(a)),a.setGameMessage=a.setGameMessage.bind(Object(v.a)(a)),a.incrementScore=a.incrementScore.bind(Object(v.a)(a)),a.setEntityStats=a.setEntityStats.bind(Object(v.a)(a)),a.stopGame=a.stopGame.bind(Object(v.a)(a)),a.graphRef=n.a.createRef(),E.a.initialize("UA-143383035-1"),a}return Object(o.a)(i,[{key:"incrementScore",value:function(){this.setState({score:this.state.score+1})}},{key:"setEntityStats",value:function(e,t){t||(e in this.entityStatistics||(this.entityStatistics[e]=0),this.entityStatistics[e]=this.entityStatistics[e]+1)}},{key:"setGameMessage",value:function(e){var t=null;"alreadySelected"==e?(this.props.playSound&&xt.play(),t="This connection has already been made. Try another one!"):"successLink"==e?(this.props.playSound&&Nt.play(),t="Yes! You got it right!",this.incrementScore()):"failLink"==e&&(this.props.playSound&&xt.play(),t="No! You got it wrong! These topics are not connected"),this.setState({gameMessage:t})}},{key:"setNodeVal",value:function(e,t){var a=this.state.gameNodeSelections;a[e]=t,null==t&&null!=this.state.gameMessage&&this.setState({gameMessage:null}),this.setState({gameNodeSelections:a})}},{key:"clearGamifiedEntity",value:function(e){var t=this.state.gameNodeSelections;t[e]=null,"f"==e&&(t.f=t.s,t.s=null),this.setState({gameNodeSelections:t,gameMessage:null})}},{key:"resetScroll",value:function(){var e=null;this.graphRef&&(e=this.graphRef.current.offsetTop),this.props.setScrollToGraphList&&this.props.setScrollToGraphList(e),document.getElementById("graph-selected-block-list").scrollTop=0}},{key:"isValidBlock",value:function(e){return!Object(L.isNullOrUndefined)(e.title)}},{key:"selectEdge",value:function(e,t){var a=this;this.setState({openSelectedBlocks:!1});var i=[],n={to:t,from:e};this.addBlocksForEdge(n,i,{}),i.sort((function(e,t){return a.sortBlocks(e.title,t.title,e.timestamp,t.timestamp)})),this.setState({currentSelectedBlocks:i,openSelectedBlocks:!0,selectedNodes:[e,t],copiedText:!1}),this.resetScroll()}},{key:"addBlocksForEdge",value:function(e,t,a){if(!Object(L.isNullOrUndefined)(this.props.investigationGraph[e.from])&&!Object(L.isNullOrUndefined)(this.props.investigationGraph[e.from]))for(var i=this.props.investigationGraph[e.from].edges[e.to],n=0;n<i.length;n++){var s=i[n];if(!(s in a)){var l=this.props.blockTree[s];this.isValidBlock(l)&&t.push(l),a[s]=!0}}}},{key:"selectNode",value:function(e){var t=this,a=[],i={};if(this.setState({openSelectedBlocks:!1}),this.addBlocksForNodeCharacteristic(e,a,i),this.props.investigationGraph[e]){var n=this.props.investigationGraph[e].edges,s=this;Object.keys(n).forEach((function(t){var n={to:e,from:t};s.addBlocksForEdge(n,a,i)}))}if("ALL"==e){var l={},r=this.props.investigationGraph;if(!Object(L.isNullOrUndefined)(r)){for(var o in r){for(var c=0;!Object(L.isNullOrUndefined)(r[o].char)&&c<r[o].char.length;c++)l[r[o].char[c]]=!0;for(var d in r[o].edges)for(var u=0;!Object(L.isNullOrUndefined)(r[o].edges[d])&&u<r[o].edges[d].length;u++)l[r[o].edges[d][u]]=!0}for(var h in l)Object(L.isNullOrUndefined)(this.props.blockTree)||Object(L.isNullOrUndefined)(this.props.blockTree[h])||a.push(this.props.blockTree[h])}}a.sort((function(e,a){return t.sortBlocks(e.title,a.title)})),this.setState({currentSelectedBlocks:a,openSelectedBlocks:!0,selectedNodes:[e],copiedText:!1}),this.resetScroll(),!Object(L.isNullOrUndefined)(this.props.isPublic)&&this.props.isPublic||!this.props.selectNode||"ALL"==e||this.props.selectNode(e)}},{key:"addBlocksForNodeCharacteristic",value:function(e,t,a){if(!Object(L.isNullOrUndefined)(this.props.investigationGraph[e]))for(var i=this.props.investigationGraph[e].char,n=0;n<i.length;n++){var s=i[n];if(!(s in a)){var l=this.props.blockTree[s];this.isValidBlock(l)&&t.push(l),a[s]=!0}}}},{key:"sortBlocks",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;e=e.trim(),t=t.trim();var n=0,s=0,l=!1,r=!1;if(e.length>0&&"#"===e.charAt(0)){for(var o="",c=1;c<e.length;c++)isNaN(parseInt(e.charAt(c),10))&&"."!==e[c]?o.length>0&&(n=parseFloat(o),l=!0):o+=e.charAt(c);o.length>0&&(n=parseFloat(o),l=!0)}if(t.length>0&&"#"===t.charAt(0)){for(o="",c=1;c<t.length;c++)isNaN(parseInt(t.charAt(c),10))&&"."!==t[c]?o.length>0&&(s=parseFloat(o),r=!0):o+=t.charAt(c);o.length>0&&(s=parseFloat(o),r=!0)}return!l&&r?1:l&&!r?-1:l&&r?n>s?1:-1:a>i?1:i>a?-1:e>t?1:-1}},{key:"onSelectGraph",value:function(e){var t=this;this.setState({openSelectedBlocks:!1});var a=e.nodes,i=e.edges,n=[],s={};if(!Object(L.isNullOrUndefined)(i))for(var l=0;l<i.length;l++){var r=i[l],o=this.graphHelperMap.edges[r];this.addBlocksForEdge(o,n,s)}if(!Object(L.isNullOrUndefined)(a))for(l=0;l<a.length;l++){var c=a[l],d=this.graphHelperMap.nodes[c];this.addBlocksForNodeCharacteristic(d,n,s)}n.sort((function(e,a){return t.sortBlocks(e.title,a.title,e.timestamp,a.timestamp)})),this.setState({currentSelectedBlocks:n,openSelectedBlocks:!0})}},{key:"initializeGraphEvents",value:function(){var e=this,t={select:function(t){e.onSelectGraph(t)}};this.setState({graphEvents:t})}},{key:"generateAmGraph",value:function(){var e=this.props.multiSelectEntityList[0].value,t=[],a={};if(!this.props.multiSelectEntityList[1].value){for(var i={},s=0,l=2;l<this.props.multiSelectEntityList.length;l++){var r=this.props.multiSelectEntityList[l];if(r.value||e){i[r.label]=s;var o=null;if(this.props.imageMapping&&r.label in this.props.imageMapping&&(o=this.props.imageMapping[r.label]),this.props.investigationGraph[r.label]){t.push({id:s,label:r.label,link:[],image:o}),a[s]=r.label;var c=r.label;if(!Object(L.isNullOrUndefined)(this.props.investigationGraph)&&!Object(L.isNullOrUndefined)(this.props.investigationGraph[c])){var d=this.props.investigationGraph[c].edges;Object.keys(d).forEach((function(e){e in i&&t[i[e]].link.push(s)}))}s++}}}var u=Ie(this.props.investigationGraph);if(Object.keys(u).length>0&&this.props.multiSelectEntityList[0].value){t.push({id:s,label:"ALL",link:[],image:null});for(var h={},p=0;p<t.length;p++)h[t[p].label]=t[p].id;for(var m in u){var b=h[u[m].node];Object(L.isNullOrUndefined)(b)||t[s].link.push(b)}s++}}return n.a.createElement("div",{className:"graph-main"},n.a.createElement(ut,{graph:t,selectEdge:this.selectEdge,selectNode:this.selectNode,selectedNodes:this.state.gameNodeSelections,setNodeVal:this.setNodeVal,setGameMessage:this.setGameMessage,setEntityStats:this.setEntityStats,playNodeSound:this.playNodeSound,disabled:this.state.stopGame}))}},{key:"generateGraph",value:function(){var e=this.props.multiSelectEntityList[0].value,t={nodes:[],edges:[]},a={};if(!this.props.multiSelectEntityList[1].value)for(var i={},s=0,l=2;l<this.props.multiSelectEntityList.length;l++){var r=this.props.multiSelectEntityList[l];if(r.value||e){i[r.label]=s,t.nodes.push({id:s,label:r.label}),a[s]=r.label;var o=r.label;if(!Object(L.isNullOrUndefined)(this.props.investigationGraph)&&!Object(L.isNullOrUndefined)(this.props.investigationGraph[o])){var c=this.props.investigationGraph[o].edges;Object.keys(c).forEach((function(e){e in i&&t.edges.push({from:i[e],to:s,id:i[e]+"-"+s})}))}s++}}var d={nodes:a,edges:{}};for(l=0;l<t.edges.length;l++){var u=t.edges[l],h=a[u.to],p=a[u.from];d.edges[u.id]={from:p,to:h}}this.graphHelperMap=d;var m=this,b={select:function(e){m.onSelectGraph(e)}};return n.a.createElement("div",{className:"graph-main"},n.a.createElement(P.a,{graph:t,options:this.state.graphOptions,events:b}))}},{key:"removeHashedIndex",value:function(e){var t=0;if((e=e.trim()).length>0&&"#"==e[0]){for(var a=1;a<e.length;a++)if(t=a," "==e.charAt(a))return e.substring(t).trim();return""}return e}},{key:"BlockEntity",value:function(e){return n.a.createElement("span",{className:"graph-block-entity"},e.title)}},{key:"BlockEvidence",value:function(e,t){a(329);var i=[e.evidenceLink];return R()(e.evidenceLink)?n.a.createElement("div",{className:"graph-block-evidence"},n.a.createElement(F.a,{src:i,className:"graph-block-evidence-image"})):null}},{key:"AgregateNumberDisplay",value:function(e,t){var a="";return!Object(L.isNullOrUndefined)(e)&&e.length>0&&(a=e.map((function(e){return n.a.createElement("span",null,n.a.createElement("span",{className:"graph-content-number-key"},"Total ",e.key,": "),n.a.createElement("b",{className:"graph-content-number-value"},e.value)," ",n.a.createElement("br",null))}))),Object(L.isNullOrUndefined)(t)||(t=t.replace(":","")),""!=a?n.a.createElement("div",{className:"graph-block-para-div"},n.a.createElement("h4",{className:"graph-block-title"},"Statistics for ",t),n.a.createElement("div",{className:"graph-content-container"},n.a.createElement("p",{className:"graph-block-text"},a))):null}},{key:"SingleBlock",value:function(e){var t=this;null!=e.entities&&e.entities.length>0&&e.entities.map((function(e){return t.BlockEntity(e)}));var a="";null!=e.evidences&&e.evidences.length>0&&(a=e.evidences.map((function(e,a){return t.BlockEvidence(e,a)})));var i=null;!Object(L.isNullOrUndefined)(e.numbers)&&e.numbers.length>0&&(i=e.numbers.map((function(e){return n.a.createElement("span",null,n.a.createElement("span",{className:"graph-content-number-key"},e.key,": "),n.a.createElement("b",{className:"graph-content-number-value"},e.value)," ",n.a.createElement("br",null))})));return n.a.createElement("div",{className:"graph-block-para-div",onClick:function(){t.clickBlockFromList(e)}},n.a.createElement("h4",{className:"graph-block-title"},this.removeHashedIndex(e.title)),n.a.createElement("div",{className:"graph-content-container"},n.a.createElement("p",{className:"graph-block-text"},e.summary),n.a.createElement("p",{className:"graph-block-text"},i),n.a.createElement("div",{class:"graph-block-evidence-container"},a)))}},{key:"handleAllAndNoneOptions",value:function(){for(var e=this.state.wasAllOptionSelected,t=this.state.wasNoneOptionSelected,a=!1,i=!1,n=!1,s=this.props.multiSelectEntityList,l=0;l<s.length;l++)if(1==s[l].value)if(0==s[l].id)a=!0;else if(-1==s[l].id)i=!0;else{if(n=!0,a&&e||i&&t){a=!1,i=!1;break}(i||a)&&(s[l].value=!1)}a&&!e&&(i=!1),i&&!t&&(a=!1),a||i||n||(i=!0),s[0].value=a,s[1].value=i,this.setState({multiSelectEntityList:s,wasAllOptionSelected:a,wasNoneOptionSelected:i})}},{key:"entityClicked",value:function(e){this.setState({multiSelectEntityList:e}),this.handleAllAndNoneOptions()}},{key:"selectedBadgeClicked",value:function(e){this.setState({multiSelectEntityList:e}),this.handleAllAndNoneOptions()}},{key:"clickBlockFromList",value:function(e){}},{key:"initSpeech",value:function(){var e=Object(k.a)(f.a.mark((function e(){var t,a,i,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.speech=new se.a,this.speech.hasBrowserSupport(),e.next=5,this.speech.init();case 5:t=e.sent,a=t.voices,i=-1,n=0;case 9:if(Object(L.isNullOrUndefined)(a)||!(n<a.length)){e.next=17;break}if(a[n].name,!Le(this.props.lang,a[n])){e.next=14;break}return i=n,e.abrupt("break",17);case 14:n++,e.next=9;break;case 17:if(-1==i){e.next=23;break}return e.next=20,this.speech.setVoice(a[i].name);case 20:this.setState({languageSupportedPlay:!0}),e.next=24;break;case 23:this.setState({languageSupportedPlay:!1});case 24:e.next=28;break;case 26:e.prev=26,e.t0=e.catch(0);case 28:case"end":return e.stop()}}),e,this,[[0,26]])})));return function(){return e.apply(this,arguments)}}()},{key:"timeoutFn",value:function(){var e=Object(k.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("start"!=this.state.playStatus||Object(L.isNullOrUndefined)(this.speech)||!wt){e.next=5;break}return e.next=3,this.speech.pause();case 3:return e.next=5,this.speech.resume();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"timeInFn",value:function(){var e=this;this.timeout=setInterval((function(){e.timeoutFn()}),8500)}},{key:"componentDidMount",value:function(){var e=Object(k.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initializeGraphEvents(),e.next=3,this.initSpeech();case 3:wt&&this.timeInFn();case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toggleSelectedBlocksPane",value:function(){this.setState({openSelectedBlocks:!this.state.openSelectedBlocks})}},{key:"pauseExistingSelection",value:function(){var e=Object(k.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(L.isNullOrUndefined)(this.speech)||!this.speech.speaking()){e.next=4;break}return e.next=3,this.speech.pause();case 3:this.setState({playStatus:"paused"});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"resumeExistingSelection",value:function(){var e=Object(k.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(L.isNullOrUndefined)(this.speech)){e.next=4;break}return e.next=3,this.speech.resume();case 3:this.setState({playStatus:"start"});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stopExistingSelection",value:function(){var e=Object(k.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(L.isNullOrUndefined)(this.speech)){e.next=4;break}return e.next=3,this.speech.cancel();case 3:this.setState({playStatus:"end"});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"playNodeSound",value:function(){var e=Object(k.a)(f.a.mark((function e(t){var a,i,n,s=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(L.isNullOrUndefined)(this.speech)||!this.props.playSound){e.next=10;break}if(!this.speech.speaking()){e.next=4;break}return e.next=4,this.speech.cancel();case 4:for(a=t,i=0;!Object(L.isNullOrUndefined)(this.state.selectedNodes)&&i<this.state.selectedNodes.length;i++)a+=this.state.selectedNodes[i]+", ";a.length>0&&(a=a.substring(0,a.length-2)),n=t,this.setState({playStatus:"start"}),this.speech.speak({text:n,queue:!1}).then((function(){s.setState({playStatus:"end"})})).catch((function(e){console.error("An error occurred :",e)}));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"playExistingSelection",value:function(){var e=Object(k.a)(f.a.mark((function e(){var t,a,i,n,s,l=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(L.isNullOrUndefined)(this.speech)){e.next=14;break}if(!this.speech.speaking()){e.next=4;break}return e.next=4,this.speech.cancel();case 4:for(t=": ",a=0;!Object(L.isNullOrUndefined)(this.state.selectedNodes)&&a<this.state.selectedNodes.length;a++)t+=this.state.selectedNodes[a]+", ";for(t.length>0&&(t=t.substring(0,t.length-2)),i="",n=Te(this.state.currentSelectedBlocks),!Object(L.isNullOrUndefined)(n)&&n.length>0&&(i+="Statistics for "+t+". "),s=0;!Object(L.isNullOrUndefined)(n)&&s<n.length;s++)i+="Total "+n[s].key+": "+String(n[s].value)+". ";this.state.currentSelectedBlocks.map((function(e){var t=l.removeHashedIndex(e.title),a=e.summary;!Object(L.isNullOrUndefined)(t)&&t.length>0&&(i+=Se(t)+". "),i+=Se(a),i+=". ";for(var n=0;!Object(L.isNullOrUndefined)(e.numbers)&&n<e.numbers.length;n++)i+=e.numbers[n].key+": "+String(e.numbers[n].value)+". "})),this.setState({playStatus:"start"}),this.speech.speak({text:i,queue:!1}).then((function(){l.setState({playStatus:"end"})})).catch((function(e){console.error("An error occurred :",e)}));case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){var e=Object(k.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(L.isNullOrUndefined)(this.speech)){e.next=3;break}return e.next=3,this.speech.cancel();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillReceiveProps",value:function(){var e=Object(k.a)(f.a.mark((function e(t){var a,i,n,s,l;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.lang==t.lang||Object(L.isNullOrUndefined)(this.speech)){e.next=22;break}return e.next=3,this.speech.init();case 3:a=e.sent,i=a.voices,n=-1,s=0;case 7:if(Object(L.isNullOrUndefined)(i)||!(s<i.length)){e.next=15;break}if(i[s].name,!Le(this.props.lang,i[s])){e.next=12;break}return n=s,e.abrupt("break",15);case 12:s++,e.next=7;break;case 15:if(-1==n){e.next=21;break}return e.next=18,this.speech.setVoice(i[n].name);case 18:this.setState({languageSupportedPlay:!0}),e.next=22;break;case 21:this.setState({languageSupportedPlay:!1});case 22:(Object(L.isNullOrUndefined)(this.props.investigationGraph)||JSON.parse(JSON.stringify(this.props.investigationGraph))!=JSON.parse(JSON.stringify(t.investigationGraph)))&&(l=De(t.investigationGraph),this.setState({totalScore:l}));case 23:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"stopGame",value:function(e){if(e){var t=this.state.stats;t.score=this.state.score,t.totalScore=this.state.totalScore,t.entityStats=this.entityStatistics,this.setState({stats:t})}this.setState({stopGame:e})}},{key:"BlockEntity",value:function(e,t){var a=this;return n.a.createElement("span",{className:"gamified-block-entity"},e,n.a.createElement("a",{style:{marginLeft:"5px",color:"black",cursor:"pointer"},onClick:function(){a.clearGamifiedEntity(t)}},"X"))}},{key:"render",value:function(){var e=this,t=this.props.lang;Object(L.isNullOrUndefined)(t)&&(t="en");for(var a=this.state.currentSelectedBlocks.map((function(t){return e.SingleBlock(t)})),i=(ke(this.state.currentSelectedBlocks),": "),s=0;s<this.state.selectedNodes.length;s++)i+=this.state.selectedNodes[s]+", ";i.length>0&&(i=i.substring(0,i.length-2));var l=Te(this.state.currentSelectedBlocks),r=this.AgregateNumberDisplay(l,i),o=this.state.gameNodeSelections.f;Object(L.isNullOrUndefined)(o)||Object(L.isNullOrUndefined)(o.label)||(o=o.label.currentText);var c=this.state.gameNodeSelections.s;return Object(L.isNullOrUndefined)(c)||Object(L.isNullOrUndefined)(c.label)||(c=c.label.currentText),n.a.createElement("div",null,n.a.createElement("div",{ref:this.graphRef}),n.a.createElement("div",{className:"specialViewMargin"},n.a.createElement("div",{className:"gameButtonContainer"},this.state.score>0&&!this.state.stopGame?n.a.createElement(rt.a,{variant:"contained",className:"stopGamebutton",onClick:function(){e.stopGame(!0)}}," Stop Game"):null)),Object(L.isNullOrUndefined)(o)||this.state.stopGame?null:n.a.createElement("div",{className:"specialViewMargin"},n.a.createElement("div",{className:"gamifiedNodeDisplay"},n.a.createElement("div",{className:"gamifiedNodeSelectionsTitle"},"Selections: "),n.a.createElement("div",null,this.BlockEntity(o,"f")),Object(L.isNullOrUndefined)(c)?null:n.a.createElement("div",null,this.BlockEntity(c,"s")))),this.state.stopGame?n.a.createElement("div",null,n.a.createElement(vt,{stats:this.state.stats,bpId:this.props.bpId,title:this.props.title,canSave:!0,id:"mindmap_result"})):n.a.createElement("div",{className:"specialViewMargin"},n.a.createElement("div",{className:"scoreAmchartContainer"},n.a.createElement(pt,{id:"speedometer_mindmap_ingame",val:this.state.score,min:0,max:this.state.totalScore})),n.a.createElement("div",{className:"scoreText"},"Score: ",n.a.createElement("span",{className:"scoreVal"},this.state.score),n.a.createElement("span",{className:"totalScoreVal"},"/",this.state.totalScore)),this.state.score==this.state.totalScore?n.a.createElement(ot.a,{severity:"success",className:"gameMessage"},this.state.gameMessageFinished):n.a.createElement("div",null,"No! You got it wrong! These topics are not connected"==this.state.gameMessage?n.a.createElement(ot.a,{severity:"error",className:"gameMessage"},this.state.gameMessage):null,"Yes! You got it right!"==this.state.gameMessage?n.a.createElement(ot.a,{severity:"success",className:"gameMessage"},this.state.gameMessage):null,"This connection has already been made. Try another one!"==this.state.gameMessage?n.a.createElement(ot.a,{severity:"info",className:"gameMessage"},this.state.gameMessage):null)),this.state.currentSelectedBlocks.length>=0&&!this.state.stopGame?n.a.createElement("div",null,n.a.createElement("div",{className:"graph-block-list"},n.a.createElement("div",{className:"gamified-graph-block-list-title",onClick:this.toggleSelectedBlocksPane},i.length>0?n.a.createElement("span",null,Fe[t]):n.a.createElement("span",null,Me[t]),n.a.createElement("span",null,i),n.a.createElement("span",null,this.state.openSelectedBlocks?n.a.createElement(Z.a,{className:i.length>0?"graph-block-list-title-icon":"displayNone"}):n.a.createElement(Q.a,{className:i.length>0?"graph-block-list-title-icon":"displayNone"}))),n.a.createElement(q.a,{open:this.state.openSelectedBlocks,duration:400,transitions:["height","opacity","background"]},n.a.createElement("div",{className:"graph-block-list-container",id:"graph-selected-block-list"},r,a))),this.generateAmGraph()):null)}}]),i}(n.a.Component),Ct=jt,It=a(1764),Lt=a(1763),Dt=a(1765),Ut=a(1766),At=a(861),Gt=a.n(At),Pt=a(296),Mt=(a(1428),a(894)),Ft=new Et.a(Ot.a,{volume:.65,throttleMs:100}),Vt=new Et.a(Tt.a,{volume:.65,throttleMs:100}),Rt=function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).state={currentTimelineIndex:0,message:null,gameMessageFinished:"Congratulations! You did it!",score:0,totalScore:0,finishedBlocks:{},stopGame:!1,slideCard:!0,stats:{score:0,entityStats:{},totalScore:0}},e.timeline&&(i.state.currentTimelineIndex=Math.floor(Math.random()*(e.timeline.length-1)),i.state.totalScore=i.props.timeline.length),i.incrementTimelineIndex=i.incrementTimelineIndex.bind(Object(v.a)(i)),i.clickChevron=i.clickChevron.bind(Object(v.a)(i)),i.removeHashedIndex=i.removeHashedIndex.bind(Object(v.a)(i)),i.selectTime=i.selectTime.bind(Object(v.a)(i)),i.incrementScore=i.incrementScore.bind(Object(v.a)(i)),i.stopGame=i.stopGame.bind(Object(v.a)(i)),i}return Object(o.a)(a,[{key:"clickChevron",value:function(e){this.incrementTimelineIndex()}},{key:"seperateTimeline",value:function(e){for(var t=[],a=0;a<e.length;a++){var i={date:e[a].blockDate,time:e[a].blockTime,timeStr:he(e[a])};0!=t.length&&t[t.length-1].timeStr==i.timeStr||t.push(i)}return t}},{key:"incrementScore",value:function(e){var t=this.state.finishedBlocks;t[e]=!0;this.state.stopGame;this.state.score+1>=this.state.totalScore||this.setSlideAnimation(!1),this.setState({score:this.state.score+1,finishedBlocks:t})}},{key:"selectTime",value:function(e,t){var a=this.props.timeline[this.state.currentTimelineIndex];JSON.stringify(a.blockDate)!=JSON.stringify(e.date)||JSON.stringify(a.blockTime)!=JSON.stringify(e.time)?(this.setState({message:"Please try again!"}),this.props.playSound&&Vt.play()):(this.setState({message:"Well done"}),this.incrementScore(this.state.currentTimelineIndex),this.props.playSound&&Ft.play())}},{key:"singleTimelineCard",value:function(e,t){var a=this;return n.a.createElement(Mt.a,{className:"singleTimeOption",elevation:8,onClick:function(){return a.selectTime(e,t)}},n.a.createElement("div",{style:{margin:"auto",width:"50%"}},e.timeStr))}},{key:"removeHashedIndex",value:function(e){if(e){var t=0;if((e=e.trim()).length>0&&"#"==e[0]){for(var a=1;a<e.length;a++)if(t=a," "==e.charAt(a))return e.substring(t).trim();return""}return e}return""}},{key:"setSlideAnimation",value:function(e){this.setState({slideCard:e})}},{key:"singleBlockCard",value:function(e){var t=this;return n.a.createElement("div",{className:"gamifiedTimelineBlockContainer"},n.a.createElement(Lt.a,{container:!0,direction:"row-reverse",justify:"center",alignItems:"center"},n.a.createElement(Lt.a,{item:!0,xs:10,md:7,lg:5},!Object(L.isNullOrUndefined)(this.props.timeline)&&this.props.timeline.length>1?n.a.createElement("div",{className:"horizontallyCentered width-40"},n.a.createElement(Gt.a,{className:"gamifiedTimelineBlockNav",onClick:function(){t.clickChevron(!0)}})):null,n.a.createElement(It.a,{direction:"up",in:this.state.slideCard,mountOnEnter:!0,unmountOnExit:!0,onExited:function(){t.setSlideAnimation(!0)},onEnter:function(){t.state.stopGame||t.incrementTimelineIndex()}},n.a.createElement(Dt.a,{elevation:6},n.a.createElement(Ut.a,null,Object(L.isNullOrUndefined)(e.title)?null:n.a.createElement(Pt.a,{variant:"h5",component:"h2"},this.removeHashedIndex(e.title)),n.a.createElement(Pt.a,{variant:"body2",component:"p",gutterBottom:!0},e.summary),n.a.createElement(Pt.a,{color:"textSecondary"},"Select the correct date")))))),n.a.createElement("div",{className:"gamifiedTimelineBlock horizontallyCentered"}))}},{key:"incrementTimelineIndex",value:function(){if(!Object(L.isNullOrUndefined)(this.props.timeline)&&this.props.timeline.length>1){var e=Math.floor(Math.random()*(this.props.timeline.length-1));0==e&&e++;var t=this.state.currentTimelineIndex;t=(t+e)%this.props.timeline.length;for(var a=this.state.finishedBlocks;t in a;)t=(t+1)%this.props.timeline.length;this.setState({currentTimelineIndex:t})}}},{key:"componentWillReceiveProps",value:function(e){if(this.props.timeline!=e.timeline){var t=Math.floor(Math.random()*(e.timeline.length-1));this.setState({currentTimelineIndex:t,totalScore:this.props.timeline.length})}}},{key:"stopGame",value:function(e){if(e){var t=this.state.stats;t.score=this.state.score,t.totalScore=this.state.totalScore,this.setState({stats:t})}this.setState({stopGame:e})}},{key:"render",value:function(){var e=this,t=this.seperateTimeline(this.props.timeline).map((function(t,a){return e.singleTimelineCard(t,a)}));return n.a.createElement("div",null,this.state.stopGame?n.a.createElement("div",null,n.a.createElement(vt,{stats:this.state.stats,bpId:this.props.bpId,title:this.props.title,canSave:!0,type:"timeline",id:"timeline_result"})):null,n.a.createElement("div",{className:"specialViewMargin"},this.state.stopGame?null:n.a.createElement("div",null,n.a.createElement("div",{className:"gameButtonContainer"},this.state.score>0&&!this.state.stopGame?n.a.createElement(rt.a,{variant:"contained",className:"stopGamebutton",onClick:function(){e.stopGame(!0)}}," Stop Game"):null),n.a.createElement("div",{className:"scoreAmchartContainer"},n.a.createElement(pt,{id:"speedometer_timeline_ingame",val:this.state.score,min:0,max:this.state.totalScore,color:"#46237a"})),n.a.createElement("div",{className:"scoreText"},"Score: ",n.a.createElement("span",{className:"timelineScoreVal"},this.state.score),n.a.createElement("span",{className:"totalScoreVal"},"/",this.state.totalScore)),this.state.score==this.state.totalScore?n.a.createElement(ot.a,{severity:"success",className:"gameTimelineMessage"},this.state.gameMessageFinished):n.a.createElement("div",null,"Well done"==this.state.message?n.a.createElement(ot.a,{severity:"success",className:"gameTimelineMessage"},this.state.message):null,"Please try again!"==this.state.message?n.a.createElement(ot.a,{severity:"error",className:"gameTimelineMessage"},this.state.message):null)),this.props.timeline.length>this.state.score&&!this.state.stopGame?n.a.createElement(Lt.a,{container:!0,direction:"row",style:{border:"1px black solid"}},n.a.createElement(Lt.a,{xs:12,sm:6,item:!0},this.singleBlockCard(this.props.timeline[this.state.currentTimelineIndex])),n.a.createElement(Lt.a,{xs:12,sm:6,item:!0},n.a.createElement("div",{className:"timelineTimesContainer"},n.a.createElement(Lt.a,{xs:12,className:"timesViewGrid",id:"gamifiedTimesViewGrid"},t)))):null))}}]),a}(n.a.Component),Wt=Rt,Jt=function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).state={key:"graph",adhocTooltip:{mindmap:{flag:!1,text:[{title:We.title[e.lang],target:".tooltipMindmap",content:We.desc[e.lang],disableBeacon:!0}]},timeline:{flag:!1,text:[{title:Je.title[e.lang],target:".tooltipTimeline",content:Je.desc[e.lang],disableBeacon:!0}]}},playSound:!0},i.isSummaryBlocksAvailable=i.isSummaryBlocksAvailable.bind(Object(v.a)(i)),i.isGraphAvailable=i.isGraphAvailable.bind(Object(v.a)(i)),i.isTimelineAvailable=i.isTimelineAvailable.bind(Object(v.a)(i)),i.showLocalTooltip=i.showLocalTooltip.bind(Object(v.a)(i)),i.hideLocalTooltip=i.hideLocalTooltip.bind(Object(v.a)(i)),i.handleAdhocTooltipJoyrideCallback=i.handleAdhocTooltipJoyrideCallback.bind(Object(v.a)(i)),i}return Object(o.a)(a,[{key:"showLocalTooltip",value:function(e){var t=this.state.adhocTooltip;"mindmap"==e?t.mindmap.flag=!0:"timeline"==e&&(t.timeline.flag=!0),this.setState({adhocTooltip:t})}},{key:"hideLocalTooltip",value:function(e){var t=this.state.adhocTooltip;"mindmap"==e?t.mindmap.flag=!1:"timeline"==e&&(t.timeline.flag=!1),this.setState({adhocTooltip:t})}},{key:"handleAdhocTooltipJoyrideCallback",value:function(e,t){e.action,e.index;var a=e.status;e.type;[O.a.FINISHED,O.a.SKIPPED].includes(a)&&this.hideLocalTooltip(t)}},{key:"isSummaryBlocksAvailable",value:function(){return!Object(L.isNullOrUndefined)(this.props.summaryBlocks)&&0!=this.props.summaryBlocks.length}},{key:"isGraphAvailable",value:function(){return!Object(L.isNullOrUndefined)(this.props.investigationGraph)&&0!=Object.keys(this.props.investigationGraph).length}},{key:"isTimelineAvailable",value:function(){return!!(this.props.timeline&&this.props.timeline.length>0)}},{key:"isBlockprobeEmpty",value:function(){return!(this.isTimelineAvailable()||this.isGraphAvailable()||this.isSummaryBlocksAvailable())}},{key:"render",value:function(){var e=this,t=this.props.lang;return Object(L.isNullOrUndefined)(t)&&(t="en"),n.a.createElement("div",{style:{paddingBottom:"15px"}},n.a.createElement("div",{className:"gamifiedDashboardOptionsContainer uniformMarginLeft"},this.state.playSound?n.a.createElement(at.a,{variant:"contained",className:"soundSettingsbutton",onClick:function(){e.setState({playSound:!1})}},n.a.createElement(lt.a,null)):n.a.createElement(at.a,{variant:"contained",className:"soundSettingsbutton",onClick:function(){e.setState({playSound:!0})}},n.a.createElement(nt.a,null))),this.isGraphAvailable()?n.a.createElement("div",{style:{marginBottom:"50px"}},n.a.createElement("div",{className:"dashboard-section-heading graph-heading"},We.title[t],n.a.createElement("a",{className:"tooltipMindmap tooltips-dashboard",onMouseEnter:function(){return e.showLocalTooltip("mindmap")},onClick:function(t){e.showLocalTooltip("mindmap")}},n.a.createElement(T.a,{style:{fontSize:"19px"}})),n.a.createElement(O.b,{styles:{options:{arrowColor:"#e3ffeb",beaconSize:"4em",primaryColor:"#05878B",backgroundColor:"#e3ffeb",overlayColor:"rgba(10,10,10, 0.4)",width:900,zIndex:1e3}},steps:this.state.adhocTooltip.mindmap.text,run:this.state.adhocTooltip.mindmap.flag,callback:function(t){e.handleAdhocTooltipJoyrideCallback(t,"mindmap")}})),n.a.createElement(Ct,{bpId:this.props.bpId,title:this.props.title,blockTree:this.props.blockTree,investigationGraph:this.props.investigationGraph,selectBlock:this.props.selectBlock,imageMapping:this.props.imageMapping,setScrollToGraphList:this.props.setScrollToGraphList,multiSelectEntityList:this.props.multiSelectEntityList,isPublic:this.props.isPublic,playSound:this.state.playSound,lang:this.props.lang})):null,this.isTimelineAvailable()?n.a.createElement("div",null,n.a.createElement("div",{className:"dashboard-section-heading graph-heading"},Je.title[t],n.a.createElement("a",{className:"tooltipTimeline tooltips-dashboard",onMouseEnter:function(){return e.showLocalTooltip("timeline")},onClick:function(t){e.showLocalTooltip("timeline")}},n.a.createElement(T.a,{style:{fontSize:"19px"}})),n.a.createElement(O.b,{styles:{options:{arrowColor:"#e3ffeb",beaconSize:"4em",primaryColor:"#05878B",backgroundColor:"#e3ffeb",overlayColor:"rgba(10,10,10, 0.4)",width:900,zIndex:1e3}},steps:this.state.adhocTooltip.timeline.text,run:this.state.adhocTooltip.timeline.flag,callback:function(t){e.handleAdhocTooltipJoyrideCallback(t,"timeline")}})),n.a.createElement("div",null,n.a.createElement(Wt,{timeline:this.props.timeline,playSound:this.state.playSound,bpId:this.props.bpId,title:this.props.title,isPublic:this.props.isPublic,lang:this.props.lang}))):null,this.isBlockprobeEmpty()?n.a.createElement("div",{className:"dashboard-section-heading graph-heading",style:{textAlign:"center"}},Ge[t]):null)}}]),a}(n.a.Component),Ht=Jt,zt=a(864),_t=a(605),Yt=(a(1433),{0:"You",1:"Submitter",2:"Reviewer"}),Kt=function(e){return n.a.createElement("div",null,n.a.createElement("p",null,"".concat(e.message.senderName," ").concat(e.message.id?"says":"said",": ").concat(e.message.message)))},qt=function(e){Object(c.a)(i,e);var t=Object(d.a)(i);function i(e){var n;Object(r.a)(this,i),(n=t.call(this,e)).state={messages:[],useCustomBubble:!1,curr_user:0,shajs:"",uIdHash:""},n.prevBlockId="",n.prevBlockState="",n.currRef=null;var s=a(149);return n.state.uIdHash=s("sha256").update(n.props.uId).digest("hex"),n.state.shajs=s,n.getChatFeedFromDb=n.getChatFeedFromDb.bind(Object(v.a)(n)),n}return Object(o.a)(i,[{key:"onPress",value:function(e){this.setState({curr_user:e})}},{key:"onMessageSubmit",value:function(e){var t=this.message;return e.preventDefault(),!!t.value&&(this.pushMessage(this.state.curr_user,t.value),t.value="",!0)}},{key:"pushMessage",value:function(e,t){var a=null;"UNDER REVIEW"==this.props.selectedBlock.blockState?a=!0:"TO REVIEW"==this.props.selectedBlock.blockState&&(a=!1),null!=this.currRef&&this.currRef.push({author:this.state.uIdHash,blockSubmitter:a,message:t})}},{key:"componentDidUpdate",value:function(){var e=Object(k.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.prevBlockId==this.props.selectedBlock.key&&(this.prevBlockId!=this.props.selectedBlock.key||this.prevBlockState==this.props.selectedBlock.blockState)){e.next=5;break}return this.prevBlockId=this.props.selectedBlock.key,this.prevBlockState=this.props.selectedBlock.blockState,e.next=5,this.setState({messages:[]},(function(){this.getChatFeedFromDb()}));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){this.getChatFeedFromDb()}},{key:"getChatFeedFromDb",value:function(){var e=this;if(!Object(L.isNullOrUndefined)(this.props.selectedBlock))return this.prevBlockId=this.props.selectedBlock.key,this.prevBlockState=this.props.selectedBlock.blockState,null!=this.currRef&&this.currRef.off(),this.currRef=y.database().ref("Blockprobes/"+this.props.bpId+"/chts/"+this.props.selectedBlock.key),this.currRef.on("child_added",(function(t){var a=e.state.messages,i=t.val(),n=0;n=e.state.uIdHash==i.author?"TO REVIEW"==e.props.selectedBlock.blockState&&i.blockSubmitter?1:"UNDER REVIEW"!=e.props.selectedBlock.blockState||i.blockSubmitter?0:2:i.blockSubmitter?1:2,a.push(new _t.Message({id:n,message:i.message,senderName:Yt[n]})),e.setState({messages:a})})),null}},{key:"render",value:function(){var e=this;return n.a.createElement("div",{className:"chat-box-container"},n.a.createElement(_t.ChatFeed,{chatBubble:this.state.useCustomBubble&&Kt,maxHeight:250,messages:this.state.messages,showSenderName:!0}),n.a.createElement("form",{onSubmit:function(t){return e.onMessageSubmit(t)}},n.a.createElement("input",{ref:function(t){e.message=t},placeholder:"Type a message...",className:"message-input",style:{width:"99%",height:"30px"}})))}}]),i}(n.a.Component),Xt=qt,Qt=a(1767),$t=a(1768),Zt=a(1769),ea=a(1794),ta=a(867),aa=a.n(ta),ia=a(866),na=a.n(ia),sa=a(444),la=a.n(sa),ra=a(338),oa=a.n(ra),ca=a(269),da=a.n(ca),ua=a(865),ha=a.n(ua),pa=(a(802),function(e){Object(c.a)(i,e);var t=Object(d.a)(i);function i(e){var n;Object(r.a)(this,i),(n=t.call(this,e)).state={shajs:"",uIdHash:"",tooltipText:{addToStory:[{title:"Add your first block to the story!",target:".commitBlock",content:"Click on 'Commit block to story' from the options!",disableBeacon:!0,placement:"center",event:"hover"}]},showTooltip:{addToStory:!1}},e.commitToStoryTooltip&&(n.state.showTooltip={addToStory:!0});var s=a(149);return n.state.uIdHash=s("sha256").update(n.props.uId).digest("hex"),n.state.shajs=s,n.selectOption=n.selectOption.bind(Object(v.a)(n)),n.renderReviewOptionList=n.renderReviewOptionList.bind(Object(v.a)(n)),n.renderSubmitterOptionList=n.renderSubmitterOptionList.bind(Object(v.a)(n)),n.getRandomReviewer=n.getRandomReviewer.bind(Object(v.a)(n)),n.giveBlockToNextReviewer=n.giveBlockToNextReviewer.bind(Object(v.a)(n)),n.renderSuccessfulOptionList=n.renderSuccessfulOptionList.bind(Object(v.a)(n)),n.handleCommitJoyrideCallback=n.handleCommitJoyrideCallback.bind(Object(v.a)(n)),n}return Object(o.a)(i,[{key:"selectOption",value:function(e){if("revert"==e){var t=JSON.stringify(this.props.selectedBlock);(i=JSON.parse(t)).blockState="DRAFT",y.firestore().collection("Blockprobes").doc(i.bpID).collection("users").doc(this.state.uIdHash).collection("userBlocks").doc(i.key).set(i),y.database().ref("Blockprobes/"+i.bpID+"/reviewBlocks/"+i.key).remove()}else if("upvote"==e){var a=JSON.stringify(this.props.selectedBlock),i=JSON.parse(a);this.giveBlockToNextReviewer(i),y.database().ref("Blockprobes/"+this.props.selectedBlock.bpID+"/reviewBlocks/"+this.props.selectedBlock.key+"/reviewers/"+this.state.uIdHash).set("1"),y.firestore().collection("Blockprobes").doc(this.props.selectedBlock.bpID).collection("users").doc(this.state.uIdHash).collection("userBlocks").doc(this.props.selectedBlock.key+"_r").delete()}else if("reassign_reviewer"==e){var n=JSON.stringify(this.props.selectedBlock);i=JSON.parse(n);this.giveBlockToNextReviewer(i)}else if("can_commit"==e){var s=this.props.selectedBlock.key,l=JSON.stringify(this.props.selectedBlock),r=(i=JSON.parse(l),this.state.shajs("sha256").update(this.state.uIdHash+String(i.timestamp)).digest("hex"));i.timestamp=Date.now(),i.verificationHash=r,i.previousKey=this.props.latestBlock.key,"ADD"==i.actionType&&(i.referenceBlock=null),i.key=this.state.shajs("sha256").update(r+i.previousKey).digest("hex"),Object(L.isNullOrUndefined)(i.blockDate)&&(i.blockDate=null),Object(L.isNullOrUndefined)(i.blockTime)&&(i.blockTime=null),i.blockState="SUCCESSFUL",delete(o=JSON.parse(JSON.stringify(i))).blockState,delete o.bpID,y.database().ref("Blockprobes/"+i.bpID+"/reviewBlocks/"+s).remove(),y.firestore().collection("Blockprobes").doc(i.bpID).collection("users").doc(this.state.uIdHash).collection("userBlocks").doc(s).delete(),y.firestore().collection("Blockprobes").doc(i.bpID).collection("users").doc(this.state.uIdHash).collection("userBlocks").doc(i.key).set(i),y.firestore().collection("Blockprobes").doc(i.bpID).collection("fullBlocks").doc(o.key).set(o)}else if("remove"==e){var o,c=Date.now(),d="CHALLENGE TO {"+this.props.selectedBlock.title+"}",u=this.props.selectedBlock.key;null!=this.props.selectedBlock.referenceBlock&&void 0!=this.props.selectedBlock.referenceBlock&&(u=this.props.selectedBlock.referenceBlock),(o={key:"",title:d,summary:this.props.selectedBlock.summary||"",entities:this.props.selectedBlock.entities||[],blockDate:this.props.selectedBlock.blockDate||{},blockTime:this.props.selectedBlock.blockTime||{},evidences:[],actionType:"REMOVE",previousKey:this.props.selectedBlock.key,referenceBlock:u,timestamp:c,verificationHash:""}).actionType="REMOVE",(p=JSON.parse(JSON.stringify(this.props.selectedBlock))).actionType="REMOVE",p.referenceBlock=this.props.selectedBlock.key,p.previousKey=this.props.selectedBlock.key,p.title=d,p.timestamp=c;r=this.state.shajs("sha256").update(this.state.uIdHash+String(c)).digest("hex");o.verificationHash=r,p.verificationHash=r;var h=this.state.shajs("sha256").update(r+o.previousKey).digest("hex");o.key=h,p.key=h,p.bpID=this.props.bpId,delete p.children,delete o.children,y.firestore().collection("Blockprobes").doc(p.bpID).collection("users").doc(this.state.uIdHash).collection("userBlocks").doc(p.key).set(p),y.firestore().collection("Blockprobes").doc(p.bpID).collection("fullBlocks").doc(o.key).set(o),e="can_commit"}else if("modify"==e){var p;c=Date.now();(p=JSON.parse(JSON.stringify(this.props.selectedBlock))).actionType="MODIFY",p.referenceBlock=this.props.selectedBlock.key,void 0!=this.props.selectedBlock.referenceBlock&&null!=this.props.selectedBlock.referenceBlock&&(p.referenceBlock=this.props.selectedBlock.referenceBlock),p.previousKey=this.props.selectedBlock.key,p.timestamp=c,p.blockState="DRAFT",p.bpID=this.props.bpId;r=this.state.shajs("sha256").update(this.state.uIdHash+String(c)).digest("hex");p.verificationHash=r;h=this.state.shajs("sha256").update(r+p.previousKey).digest("hex");p.key=h,delete p.children,y.firestore().collection("Blockprobes").doc(p.bpID).collection("users").doc(this.state.uIdHash).collection("userBlocks").doc(p.key).set(p)}this.props.selectOption(e)}},{key:"getRandomReviewer",value:function(e,t){if(!Object(L.isNullOrUndefined)(e))for(var a=Date.now()%e.length,i=0;i<e.length;i++){var n=(a+i)%e.length;if(!(e[n].id in t))return e[n]}return null}},{key:"giveBlockToNextReviewer",value:function(e){var t=JSON.stringify(this.props.bpDetails.reviewers),a=JSON.parse(t),i=this.getRandomReviewer(a,this.props.reviewersMap);null!=i&&(e.blockState="TO REVIEW",y.firestore().collection("Blockprobes").doc(e.bpID).collection("users").doc(i.id).collection("userBlocks").doc(e.key+"_r").set(e),y.database().ref("Blockprobes/"+e.bpID+"/reviewBlocks/"+e.key+"/reviewers/"+i.id).set("-"))}},{key:"renderReviewOptionList",value:function(){var e=this;return n.a.createElement("div",null,n.a.createElement("h3",{style:{textAlign:"center"}},"OPTIONS"),n.a.createElement(Qt.a,{className:"view-block-option-list"},n.a.createElement($t.a,{button:!0,onClick:function(){e.selectOption("upvote")}},n.a.createElement(ea.a,null,n.a.createElement(la.a,null)),n.a.createElement(Zt.a,{primary:"Upvote and Pass On"}))))}},{key:"renderSuccessfulOptionList",value:function(){var e=this;return n.a.createElement("div",null,n.a.createElement("h3",{style:{textAlign:"center"}},"OPTIONS"),n.a.createElement(Qt.a,{className:"view-block-option-list"},n.a.createElement($t.a,{button:!0,onClick:function(){e.selectOption("remove")}},n.a.createElement(ea.a,null,n.a.createElement(da.a,null)),n.a.createElement(Zt.a,{primary:"Remove Block"})),n.a.createElement($t.a,{button:!0,onClick:function(){e.selectOption("modify")}},n.a.createElement(ea.a,null,n.a.createElement(ha.a,null)),n.a.createElement(Zt.a,{primary:"Modify Block"}))))}},{key:"renderSubmitterOptionList",value:function(){var e=this;return n.a.createElement("div",null,n.a.createElement("h3",{style:{textAlign:"center"}},"OPTIONS"),n.a.createElement(Qt.a,{className:"view-block-option-list"},this.props.canCommit?n.a.createElement("div",null,n.a.createElement(O.b,{styles:{options:{arrowColor:"#e3ffeb",beaconSize:"4em",primaryColor:"#05878B",backgroundColor:"#e3ffeb",overlayColor:"rgba(10,10,10, 0.4)",width:900,zIndex:1e3}},callback:this.handleCommitJoyrideCallback,steps:this.state.tooltipText.addToStory,run:this.props.commitToStoryTooltip}),n.a.createElement("div",{className:"commitBlock"},n.a.createElement($t.a,{button:!0,onClick:function(){e.selectOption("can_commit")}},n.a.createElement(ea.a,null,n.a.createElement(oa.a,null)),n.a.createElement(Zt.a,{primary:"Commit block to story"})))):null,n.a.createElement($t.a,{button:!0,onClick:function(){e.selectOption("revert")}},n.a.createElement(ea.a,null,n.a.createElement(na.a,null)),n.a.createElement(Zt.a,{primary:"Revert to Draft"})),n.a.createElement($t.a,{button:!0,onClick:function(){e.selectOption("reassign_reviewer")}},n.a.createElement(ea.a,null,n.a.createElement(aa.a,null)),n.a.createElement(Zt.a,{primary:"Reassign Reviewer"}))))}},{key:"componentWillReceiveProps",value:function(e){if(e.commitToStoryTooltip){var t=this.state.showTooltip;t.addToStory=!0,this.setState({showTooltip:t})}}},{key:"handleCommitJoyrideCallback",value:function(e){e.action,e.index;var t=e.status;e.type;if([O.a.FINISHED,O.a.SKIPPED].includes(t)){var a=this.state.showTooltip;a.addToStory=!1,this.setState({showTooltip:a})}}},{key:"render",value:function(){return n.a.createElement("div",null,"TO REVIEW"==this.props.blockState?this.renderReviewOptionList():null,"UNDER REVIEW"==this.props.blockState?this.renderSubmitterOptionList():null,"SUCCESSFUL"!=this.props.blockState||"ADD"!=this.props.selectedBlock.actionType&&"MODIFY"!=this.props.selectedBlock.actionType?null:this.renderSuccessfulOptionList())}}]),i}(n.a.Component)),ma=pa,ba=(a(1434),function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){return Object(r.a)(this,a),t.call(this,e)}return Object(o.a)(a,[{key:"render",value:function(){var e=this.props.bpDetails.criterion;return n.a.createElement("div",{className:"upvote-span"},n.a.createElement(la.a,{className:"upvoteIcon"}),this.props.upVotes," (",e-this.props.upVotes>0?e-this.props.upVotes:0," needed)")}}]),a}(n.a.Component)),fa=ba,ga=(a(1435),function(e){Object(c.a)(i,e);var t=Object(d.a)(i);function i(e){var a;return Object(r.a)(this,i),(a=t.call(this,e)).state={chatList:[],reviewersMap:{},upVotes:0,canCommit:!1},a.prevBlockId=null,a.prevBlockState=null,a.reviewerRef=null,a.renderChat=a.renderChat.bind(Object(v.a)(a)),a.renderOptions=a.renderOptions.bind(Object(v.a)(a)),a.renderUpvoteStatus=a.renderUpvoteStatus.bind(Object(v.a)(a)),a.selectOption=a.selectOption.bind(Object(v.a)(a)),a.renderNumber=a.renderNumber.bind(Object(v.a)(a)),a.getReviewersStatusForBlock=a.getReviewersStatusForBlock.bind(Object(v.a)(a)),a.modifyReviewerMap=a.modifyReviewerMap.bind(Object(v.a)(a)),a.removeHashedIndex=a.removeHashedIndex.bind(Object(v.a)(a)),a}return Object(o.a)(i,[{key:"removeHashedIndex",value:function(e){if(e){var t=0;if((e=e.trim()).length>0&&"#"==e[0]){for(var a=1;a<e.length;a++)if(t=a," "==e.charAt(a))return e.substring(t).trim();return""}return e}return""}},{key:"BlockEntity",value:function(e){return n.a.createElement("span",{className:"block-entity"},e.title)}},{key:"BlockEvidence",value:function(e,t){a(329);var i=[e.evidenceLink],s=R()(e.evidenceLink),l=e.evidenceLink;return n.a.createElement("div",{className:"block-evidence"},n.a.createElement("span",{className:"block-evidence-title"},"Evidence ",t+1),n.a.createElement("div",{className:"block-evidence-subtitle"},e.supportingDetails),s?n.a.createElement("a",{href:l,target:"_blank"},n.a.createElement(F.a,{src:i,style:{width:"100%"}})):n.a.createElement("a",{href:l,target:"_blank",className:"block-evidence-title"},l))}},{key:"renderDateTime",value:function(e){return""!=e?n.a.createElement("div",{class:"block-datetime","data-tip":!0,"data-for":"dateTime"},e):null}},{key:"renderNumber",value:function(e){var t=e.key+": "+e.value;return n.a.createElement("div",{class:"block-number"},t)}},{key:"renderChat",value:function(e){if(!Object(L.isNullOrUndefined)(this.props.selectedBlock.blockState)&&("TO REVIEW"==this.props.selectedBlock.blockState||"UNDER REVIEW"==this.props.selectedBlock.blockState)){return"UNDER REVIEW"==this.props.selectedBlock.blockState&&!1,n.a.createElement("div",{style:{marginBottom:"10px"}},n.a.createElement("h3",{style:{marginBottom:"5px",textAlign:"center"}},"CHAT"),n.a.createElement(Xt,{selectedBlock:this.props.selectedBlock,uId:this.props.uId,bpId:this.props.bpId,blId:e}))}return null}},{key:"modifyReviewerMap",value:function(e){var t=this.state.reviewersMap;t[e.key]=e.val();var a=0,i=this.props.bpDetails.criterion,n=!1;Object.keys(t).map((function(e){"1"==t[e]&&a++})),i-a<=0&&(n=!0),this.setState({reviewersMap:t,upVotes:a,canCommit:n})}},{key:"getReviewersStatusForBlock",value:function(){var e=this;this.reviewerRef=y.database().ref("Blockprobes/"+this.props.selectedBlock.bpID+"/reviewBlocks/"+this.props.selectedBlock.key+"/reviewers"),this.reviewerRef.on("child_added",(function(t){e.modifyReviewerMap(t)})),this.reviewerRef.on("child_changed",(function(t){e.modifyReviewerMap(t)})),this.prevBlockId=this.props.selectedBlock.key,this.prevBlockState=this.props.selectedBlock.blockState}},{key:"componentDidUpdate",value:function(){this.prevBlockId!=this.props.selectedBlock.key&&(this.setState({reviewersMap:{}}),this.getReviewersStatusForBlock())}},{key:"componentDidMount",value:function(){this.getReviewersStatusForBlock()}},{key:"selectOption",value:function(e){"revert"!=e&&"upvote"!=e&&"can_commit"!=e&&"modify"!=e||("can_commit"==e&&(this.props.commitToStoryTooltip&&this.props.finishAddingBlockToStoryTooltip(),this.props.refreshBlockprobe()),this.props.closeSideBar())}},{key:"renderOptions",value:function(){var e=this.props.selectedBlock.blockState;return Object(L.isNullOrUndefined)(this.props.selectedBlock.blockState)&&(e="SUCCESSFUL"),n.a.createElement(ma,{blockState:e,canCommit:this.state.canCommit,selectOption:this.selectOption,uId:this.props.uId,bpId:this.props.bpId,selectedBlock:this.props.selectedBlock,bpDetails:this.props.bpDetails,reviewersMap:this.state.reviewersMap,latestBlock:this.props.latestBlock,commitToStoryTooltip:this.props.commitToStoryTooltip})}},{key:"renderUpvoteStatus",value:function(){return Object(L.isNullOrUndefined)(this.props.selectedBlock.blockState)||"UNDER REVIEW"!=this.props.selectedBlock.blockState?null:n.a.createElement(fa,{upVotes:this.state.upVotes,bpDetails:this.props.bpDetails})}},{key:"render",value:function(){var e=this,t="",a="",i="",s="";return null!=this.props.selectedBlock.entities&&this.props.selectedBlock.entities.length>0&&(t=this.props.selectedBlock.entities.map((function(t){return e.BlockEntity(t)}))),null!=this.props.selectedBlock.evidences&&this.props.selectedBlock.evidences.length>0&&(a=this.props.selectedBlock.evidences.map((function(t,a){return e.BlockEvidence(t,a)}))),!Object(L.isNullOrUndefined)(this.props.selectedBlock.numbers)&&this.props.selectedBlock.numbers.length>0&&(i=this.props.selectedBlock.numbers.map((function(t){return e.renderNumber(t)}))),null!=this.props.selectedBlock.blockDate&&(s=he(this.props.selectedBlock)),n.a.createElement("div",{class:"block-div"},n.a.createElement("div",{class:"block-text"},n.a.createElement("h2",{class:"block-title"},this.removeHashedIndex(this.props.selectedBlock.title)),n.a.createElement("p",{class:"block-summary"},this.props.selectedBlock.summary)),this.renderDateTime(s),n.a.createElement("div",null,i),n.a.createElement("div",null,t),n.a.createElement("div",{className:"block-evidence-list"},a),this.props.isPublicView?null:n.a.createElement("div",null,this.renderUpvoteStatus(),this.renderOptions(),this.renderChat(this.props.selectedBlock.key)),n.a.createElement(zt.a,{id:"dateTime",type:"error",place:"left",className:"hover-template"},n.a.createElement("span",null,"Date and Time associated with the event described by this block.")))}}]),i}(n.a.Component)),ka=ga,va=a(292),ya=a(238),Ea=a.n(ya),Sa=a(870),Oa=a.n(Sa),Ba=a(868),Ta=a.n(Ba),wa=a(871),Na=a.n(wa),xa=a(869),ja=a.n(xa),Ca=(a(1436),function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).state={shouldEnableMultipleContributors:!0,tooltipText:{dashboard:[{title:"Click on 'Dashboard' from the menu and visualise your work!",target:".dashboard-menu",content:"",disableBeacon:!0,placement:"center"}],shareStory:[{title:"Click on 'Share my story' and use the public link to share the dashboard.",target:".shareOption",content:"",disableBeacon:!0,placement:"center"}]},showTooltip:{dashboard:JSON.parse(JSON.stringify(e.dashboardTooltip)),shareStory:JSON.parse(JSON.stringify(e.shareStoryTooltip))}},i.renderOptions=i.renderOptions.bind(Object(v.a)(i)),i}return Object(o.a)(a,[{key:"selectNewVisualisation",value:function(e){this.props.selectVisualisation(e)}},{key:"renderOptions",value:function(){var e=this;return n.a.createElement("div",null,n.a.createElement(O.b,{styles:{options:{arrowColor:"#e3ffeb",beaconSize:"3em",primaryColor:"#05878B",backgroundColor:"#e3ffeb",overlayColor:"rgba(10,10,10, 0.4)",width:900,zIndex:1e3}},steps:this.state.tooltipText.shareStory,run:this.state.showTooltip.shareStory}),n.a.createElement("h3",{style:{textAlign:"center"}},"OPTIONS"),n.a.createElement(Qt.a,{className:""},n.a.createElement($t.a,{button:!0,selected:"contributions"==this.props.selectedVisualisation,onClick:function(){e.selectNewVisualisation("contributions")}},n.a.createElement(ea.a,null,n.a.createElement(Ta.a,null)),n.a.createElement(Zt.a,{primary:"Contribute"})),"CREATOR"==this.props.permit?n.a.createElement("div",{className:"shareOption"},n.a.createElement($t.a,{button:!0,selected:"publish_blockprobe"==this.props.selectedVisualisation,onClick:function(){e.selectNewVisualisation("publish_blockprobe")}},n.a.createElement(ea.a,null,n.a.createElement(ja.a,null)),n.a.createElement(Zt.a,{primary:"Share"}))):null,this.state.shouldEnableMultipleContributors?n.a.createElement($t.a,{button:!0,selected:"manage_blockprobe"==this.props.selectedVisualisation,onClick:function(){e.selectNewVisualisation("manage_blockprobe")}},n.a.createElement(ea.a,null,n.a.createElement(Oa.a,null)),n.a.createElement(Zt.a,{primary:"Settings"})):null))}},{key:"componentWillReceiveProps",value:function(e){var t=this.state.showTooltip;e.dashboardTooltip!==this.state.showTooltip.dashboard&&(t.dashboard=JSON.parse(JSON.stringify(e.dashboardTooltip))),e.shareStoryTooltip!==this.state.showTooltip.shareStory&&(t.shareStory=JSON.parse(JSON.stringify(e.shareStoryTooltip))),this.setState({showTooltip:t})}},{key:"render",value:function(){var e=this;return n.a.createElement("div",null,n.a.createElement(O.b,{styles:{options:{arrowColor:"#e3ffeb",beaconSize:"3em",primaryColor:"#05878B",backgroundColor:"#e3ffeb",overlayColor:"rgba(10,10,10, 0.4)",width:900,zIndex:1e3}},steps:this.state.tooltipText.dashboard,run:this.state.showTooltip.dashboard}),n.a.createElement("h3",{style:{textAlign:"center"}},"VISUALISE"),n.a.createElement(Qt.a,{className:""},n.a.createElement("div",{className:"dashboard-menu"},n.a.createElement($t.a,{button:!0,selected:"dashboard"==this.props.selectedVisualisation,onClick:function(){e.selectNewVisualisation("dashboard")}},n.a.createElement(ea.a,null,n.a.createElement(Na.a,null)),n.a.createElement(Zt.a,{primary:"Dashboard"})))),this.props.isViewOnly||"VIEWER"==this.props.permit?null:this.renderOptions())}}]),a}(n.a.Component)),Ia=Ca,La=a(55),Da=a.n(La),Ua=(a(1458),function(e,t,a,i){var n=function(e){var t=0,a=[],i=[];if(null!=e)for(var n=0;n<e.length;n++){if(t&&t%100==0){var s={posts:i};a.push(s),i=[]}var l=e[n];Object(L.isNullOrUndefined)(l)||(i.push(l),t++)}if(i.length>0){var r={posts:i};a.push(r),i=[]}return a}(e);n&&y.firestore().collection("publicWall").doc(t).collection("userPosts").get().then((function(e){e.forEach((function(e){y.firestore().collection("publicWall").doc(t).collection("userPosts").doc(e.id).delete()}));for(var i=0;i<n.length;i++)y.firestore().collection("publicWall").doc(t).collection("userPosts").doc(String(i)).set(n[i]);a&&a()}),(function(e){i&&i()}))}),Aa=function(e,t){if(!Object(L.isNullOrUndefined)(e)&&!Object(L.isNullOrUndefined)(t)&&"id"in e){var a=e.id;return y.firestore().collection("Users").doc(t).collection("notifications").doc(a).delete()}return null},Ga=function(e,t,a){if(!Object(L.isNullOrUndefined)(e)&&!Object(L.isNullOrUndefined)(t)&&"permit"in e&&"id"in e){var i=e.id;y.database().ref("Blockprobes/"+i+"/users/"+a).remove()}},Pa=function(e,t,a){var i=[];if(!Object(L.isNullOrUndefined)(e)&&!Object(L.isNullOrUndefined)(t)&&"permit"in e&&"id"in e){var n={id:t,role:e.permit},s=e.id;y.database().ref("Blockprobes/"+s+"/users/"+a).set(n);var l=e;l.timestamp=Date.now();var r=y.firestore().collection("Users").doc(t).collection("blockprobes").doc(s).set(l);i.push(r)}return i},Ma=function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).changeSelectedBlock=function(e){i.setState({selectedBlock:e}),i.onSetSelectedBlockSidebarOpen(!0)},i.state={genesisBlockId:"",blockprobeTitle:"",bpDetailsLastTs:0,blockprobeSummary:"",lang:"en",selectedBlock:"",blockTree:{},modifyRef:{},blockStatus:{},investigationGraph:{},imageMapping:{},entityChanges:{},timeline:[],summaryList:[],selectedBlockSidebarOpen:!1,menuBarOpen:!1,selectedVisualisation:"dashboard",multiSelectEntityList:[{value:!0,label:"All",id:0},{value:!1,label:"None",id:-1}],testList:[],isPageLoading:!0},E.a.initialize("UA-143383035-1"),"graph"==i.props.visulationType?(i.state.selectedVisualisation="graph",E.a.pageview("/viewBlockprobePublic")):"tabs_all"==i.props.visulationType?i.state.selectedVisualisation="tabs_all":"game"==i.props.visulationType&&(i.state.selectedVisualisation="game",E.a.pageview("/openedGame")),i.changeSelectedBlock=i.changeSelectedBlock.bind(Object(v.a)(i)),i.onSetSelectedBlockSidebarOpen=i.onSetSelectedBlockSidebarOpen.bind(Object(v.a)(i)),i.onSetMenuBlockSidebarOpen=i.onSetMenuBlockSidebarOpen.bind(Object(v.a)(i)),i.renderVisualisation=i.renderVisualisation.bind(Object(v.a)(i)),i.setNewVisualisation=i.setNewVisualisation.bind(Object(v.a)(i)),i.addEdge=i.addEdge.bind(Object(v.a)(i)),i.createInvestigationGraph=i.createInvestigationGraph.bind(Object(v.a)(i)),i.sortBlocks=i.sortBlocks.bind(Object(v.a)(i)),i.isSummaryBlock=i.isSummaryBlock.bind(Object(v.a)(i)),i.createSummaryList=i.createSummaryList.bind(Object(v.a)(i)),i.generateMultiSelectEntityList=i.generateMultiSelectEntityList.bind(Object(v.a)(i)),i.setScrollToGraphList=i.setScrollToGraphList.bind(Object(v.a)(i)),i.getDataWrapper=i.getDataWrapper.bind(Object(v.a)(i)),i}return Object(o.a)(a,[{key:"setNewVisualisation",value:function(e){this.state.visualisation!=e&&this.setState({selectedVisualisation:e,menuBarOpen:!1})}},{key:"onSetSelectedBlockSidebarOpen",value:function(e){this.setState({selectedBlockSidebarOpen:e})}},{key:"onSetMenuBlockSidebarOpen",value:function(e){this.setState({menuBarOpen:e})}},{key:"addBlocksToProbe",value:function(e){var t=this;e.data().blocks.forEach((function(e){var a=t.state.blockTree;a[e.key]=e,t.setState({blockTree:a}),"genesis"==e.actionType&&(document.title=e.title,t.setState({genesisBlockId:e.key,blockprobeTitle:e.title,bpDetailsLastTs:0,blockprobeSummary:e.summary}))}))}},{key:"traverseBlockTree",value:function(e,t,a,i,n,s,l){var r=this,o=this.state.blockTree[e];if(!Object(L.isNullOrUndefined)(o)){try{if("entityChange"==o.actionType&&!Object(L.isNullOrUndefined)(o.entityMap)){var c=o.entityMap.curr,d=o.entityMap.new,u=o.timestamp;c in l||(l[c]=[]),l[c].push({ts:u,change:d})}if("BpDetails"==o.actionType){var h=o.timestamp,p=this.state.bpDetailsLastTs;!Object(L.isNullOrUndefined)(h)&&h>p&&this.setState({blockprobeTitle:o.title,blockprobeSummary:o.summary,bpDetailsLastTs:h})}if("REMOVE"!=o.actionType?(i.push(o.key),n[o.key]=!0):(n[o.referenceBlock]=!1,null!=s[o.referenceBlock]&&void 0!=s[o.referenceBlock]&&(n[s[o.referenceBlock]]=!1)),null==o.blockDate&&null==o.blockTime||("REMOVE"!=o.actionType?(t.push(o.key),a[o.key]=!0):a[o.referenceBlock]=!1),"MODIFY"==o.actionType){var m=s[o.referenceBlock],b=o.key,f=this.state.blockTree[s[o.referenceBlock]].timestamp,g=o.timestamp;n[m]?g>f?(n[m]=!1,a[m]=!1,s[m]=o.referenceBlock,s[o.referenceBlock]=b,s[b]=b):(n[b]=!1,a[b]=!1,s[b]=o.referenceBlock,s[o.referenceBlock]=m):(n[o.key]=!1,a[o.key]=!1,s[b]=o.referenceBlock)}else s[o.key]=o.key;this.setState({timeline:t})}catch(v){}var k={};Object(L.isNullOrUndefined)(o.children)||o.children.forEach((function(o){if(r.state.blockTree[o].previousKey==e&&!(o in k))try{r.traverseBlockTree(o,t,a,i,n,s,l)}catch(c){}k[o]=!0}))}}},{key:"addEdge",value:function(e,t,a,i){i in e[a].edges||(e[a].edges[i]=[]),e[a].edges[i].push(t.key)}},{key:"sortBlocks",value:function(e,t){e=e.trim(),t=t.trim();var a=0,i=0,n=!1,s=!1;if(e.length>0&&"#"===e.charAt(0))for(var l="",r=1;r<e.length;r++)isNaN(parseInt(e.charAt(r),10))&&"."!==e[r]?l.length>0&&(a=parseFloat(l),n=!0):l+=e.charAt(r);if(t.length>0&&"#"===t.charAt(0))for(l="",r=1;r<t.length;r++)isNaN(parseInt(t.charAt(r),10))&&"."!==t[r]?l.length>0&&(i=parseFloat(l),s=!0):l+=t.charAt(r);return!n&&s?1:n&&!s?-1:n&&s?a>i?1:-1:e>t?1:-1}},{key:"isSummaryBlock",value:function(e){var t=e.title;if((t=t.trim()).length>0&&"#"===t.charAt(0))for(var a=1;a<t.length;a++){if(" "==t.charAt(a))return!1;if("s"==t.charAt(a)||"S"==t.charAt(a))return!0}return!1}},{key:"createSummaryList",value:function(e){var t=this,a=[];e.forEach((function(e){var i=t.state.blockTree[e];t.isSummaryBlock(i)&&a.push(i)})),a.sort((function(e,a){return t.sortBlocks(e.title,a.title)})),this.setState({summaryList:a})}},{key:"createInvestigationGraph",value:function(e){var t=this,a={};e.forEach((function(e){var i=t.state.blockTree[e];if(null!=i.entities){for(var n=0;n<i.entities.length;n++){(s=i.entities[n].title)in a||(a[s]={char:[],edges:{}})}if(1==i.entities.length){var s=i.entities[0].title;a[s].char.push(i.key)}else if(i.entities.length>1)for(n=0;n<i.entities.length;n++)for(var l=n+1;l<i.entities.length;l++)t.addEdge(a,i,i.entities[n].title,i.entities[l].title),t.addEdge(a,i,i.entities[l].title,i.entities[n].title)}})),this.setState({investigationGraph:a}),this.generateMultiSelectEntityList()}},{key:"generateMultiSelectEntityList",value:function(){for(var e=1,t=this.state.multiSelectEntityList,a={},i=2;i<t.length;i++)a[t[i].label]=!0,t[i].id>=e&&(e=t[i].id+1);Object.keys(this.state.investigationGraph).forEach((function(i){i in a||(t.push({value:!1,label:i,id:e}),e++)})),t.sort((function(e,t){return"all"==e.label.toLocaleLowerCase()?-1:"all"==t.label.toLocaleLowerCase()?1:"none"==e.label.toLocaleLowerCase()?-1:"none"==t.label.toLocaleLowerCase()?1:e.label.toLocaleLowerCase()<t.label.toLocaleLowerCase()?-1:1})),this.setState({multiSelectEntityList:t})}},{key:"getImages",value:function(e){var t=this.state.imageMapping;e.forEach((function(e){e.data().images.forEach((function(e){t[e.entity]=e.url}))})),this.setState({imageMapping:t})}},{key:"createBlockprobe",value:function(e){var t=this;e.forEach((function(e){return t.addBlocksToProbe(e)}));var a=[],i={},n=[],s={},l={},r={};try{this.traverseBlockTree(this.state.genesisBlockId,a,i,n,s,l,r)}catch(u){}for(var o in r)r[o].sort((function(e,t){return e.ts-t.ts}));je(n,this.state.blockTree,r);var c=[];a.forEach((function(e){i[e]&&s[e]&&c.push(t.state.blockTree[e])})),ve(c),this.setState({timeline:[].concat(c),modifyRef:l,blockStatus:s,entityChanges:r});var d=[];n.forEach((function(e){s[e]&&d.push(e)})),this.createInvestigationGraph(d),this.createSummaryList(d),"game"==this.props.visulationType?E.a.event({category:"game",action:"Play game",label:this.props.bId}):E.a.event({category:"public_view",action:"View blockprobe publicly",label:this.props.bId})}},{key:"getDataWrapper",value:function(){var e=Object(k.a)(f.a.mark((function e(){var t,a,i,n=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=y.firestore().collection("public").doc(this.props.bId).collection("aggBlocks").get(),a=y.firestore().collection("public").doc(this.props.bId).collection("images").get(),s=this.props.bId,i=y.firestore().collection("blprobeLang").doc(s).get(),e.abrupt("return",Promise.all([t,a,i]).then((function(e){var t=Object(g.a)(e,3),a=t[0],i=t[1],s=t[2];n.createBlockprobe(a),i&&!i.empty&&n.getImages(i);var l,r=(l=s).exists?l.data().lang:"en";return n.setState({lang:r,isPageLoading:!1}),null})));case 4:case"end":return e.stop()}var s}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){this.getDataWrapper()}},{key:"renderVisualisation",value:function(){return"timeline"==this.state.selectedVisualisation?n.a.createElement("div",{className:"blockprobe-body"},n.a.createElement(Ze,{timeline:this.state.timeline,selectBlock:this.changeSelectedBlock})):"graph"==this.state.selectedVisualisation?n.a.createElement("div",null,n.a.createElement(Ke,{blockTree:this.state.blockTree,investigationGraph:this.state.investigationGraph,selectBlock:this.changeSelectedBlock,multiSelectEntityList:this.state.multiSelectEntityList,isPublic:!0,setScrollToGraphList:this.setScrollToGraphList,lang:this.state.lang,imageMapping:this.state.imageMapping})):"find_connections"==this.state.selectedVisualisation?n.a.createElement("div",null,n.a.createElement(qe,{blockTree:this.state.blockTree,investigationGraph:this.state.investigationGraph,selectBlock:this.changeSelectedBlock,setScrollToGraphList:this.setScrollToGraphList,imageMapping:this.state.imageMapping})):"tabs_all"==this.state.selectedVisualisation?n.a.createElement("div",null,n.a.createElement(tt,{summaryBlocks:this.state.summaryList,blockTree:this.state.blockTree,investigationGraph:this.state.investigationGraph,selectBlock:this.changeSelectedBlock,multiSelectEntityList:this.state.multiSelectEntityList,timeline:this.state.timeline,imageMapping:this.state.imageMapping,setScrollToGraphList:this.setScrollToGraphList,isPublic:!0,lang:this.state.lang})):"game"==this.state.selectedVisualisation?n.a.createElement("div",null,n.a.createElement("div",{className:"blockprobe-header"},n.a.createElement(Ea.a,{fonts:[{font:"Lora",weights:[400]}],subsets:["cyrillic-ext","greek"]}),n.a.createElement("h2",{style:{fontFamily:"Lora, bold-italic",textAlign:"center",fontSize:"26px",fontWeight:"bold"}},this.state.blockprobeTitle),n.a.createElement("h4",null,this.state.blockprobeSummary)),n.a.createElement(Ht,{summaryBlocks:this.state.summaryList,title:this.state.blockprobeTitle,blockTree:this.state.blockTree,bpId:this.props.bId,investigationGraph:this.state.investigationGraph,selectBlock:this.changeSelectedBlock,multiSelectEntityList:this.state.multiSelectEntityList,timeline:this.state.timeline,imageMapping:this.state.imageMapping,lang:this.state.lang,setScrollToGraphList:this.setScrollToGraphList,isPublic:!0})):n.a.createElement("div",{style:{textAlign:"center"}},"FEATURE TO BE IMPLEMENTED")}},{key:"renderSingularPage",value:function(){return n.a.createElement("div",null,this.state.isPageLoading?n.a.createElement("div",{style:{width:"50px",margin:"auto"}},n.a.createElement(Da.a,{type:"TailSpin",color:"#00BFFF",height:"50",width:"50"})):n.a.createElement("div",null,n.a.createElement(va.a,{sidebar:n.a.createElement("div",{className:"right-sidebar"},n.a.createElement(ka,{selectedBlock:this.state.selectedBlock,isPublicView:!0})),open:this.state.selectedBlockSidebarOpen,onSetOpen:this.onSetSelectedBlockSidebarOpen,pullRight:!0,defaultSidebarWidth:"200px",styles:{sidebar:{background:"#fefefe",position:"fixed"}}},n.a.createElement("div",{id:"main_body"},this.renderVisualisation()))))}},{key:"setScrollToGraphList",value:function(e){document.getElementById("main_body").parentElement.scrollTop=e||200}},{key:"renderFullDashboard",value:function(){return n.a.createElement("div",null,this.state.isPageLoading?n.a.createElement("div",{style:{width:"50px",margin:"auto"}},n.a.createElement(Da.a,{type:"TailSpin",color:"#00BFFF",height:"50",width:"50"})):n.a.createElement("div",null,n.a.createElement(va.a,{sidebar:n.a.createElement("div",{className:"right-sidebar"},n.a.createElement(ka,{selectedBlock:this.state.selectedBlock,isPublicView:!0})),open:this.state.selectedBlockSidebarOpen,onSetOpen:this.onSetSelectedBlockSidebarOpen,pullRight:!0,defaultSidebarWidth:"200px",styles:{sidebar:{background:"#fefefe",position:"fixed"}}},n.a.createElement("div",{id:"main_body"},n.a.createElement("div",{className:"blockprobe-header"},n.a.createElement(Ea.a,{fonts:[{font:"Lora",weights:[400]}],subsets:["cyrillic-ext","greek"]}),n.a.createElement("h2",{style:{fontFamily:"Lora, bold-italic",textAlign:"center",fontSize:"26px",fontWeight:"bold"}},this.state.blockprobeTitle),n.a.createElement("h4",null,this.state.blockprobeSummary)),n.a.createElement(et,{summaryBlocks:this.state.summaryList,blockTree:this.state.blockTree,investigationGraph:this.state.investigationGraph,selectBlock:this.changeSelectedBlock,multiSelectEntityList:this.state.multiSelectEntityList,timeline:this.state.timeline,imageMapping:this.state.imageMapping,lang:this.state.lang,setScrollToGraphList:this.setScrollToGraphList,isPublic:!0})))))}},{key:"render",value:function(){return n.a.createElement("div",null,"dashboard"==this.state.selectedVisualisation?this.renderFullDashboard():this.renderSingularPage())}}]),a}(n.a.Component),Fa=function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),i=t.call(this,e),E.a.initialize("UA-143383035-1"),i}return Object(o.a)(a,[{key:"componentDidCatch",value:function(e,t){var a=e.toString(),i=a+": "+JSON.stringify(t);E.a.exception({description:i,fatal:!0}),E.a.event({category:"error",action:i,label:a})}},{key:"render",value:function(){return this.props.children}}]),a}(n.a.Component),Va=function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).state={selectedVisualisation:null},e.match.params.viewType&&"view"==e.match.params.viewType?i.state.selectedVisualisation="dashboard":e.match.params.viewType&&"graph"==e.match.params.viewType?i.state.selectedVisualisation="graph":e.match.params.viewType&&"tabs"==e.match.params.viewType?i.state.selectedVisualisation="tabs_all":e.match.params.viewType&&"game"==e.match.params.viewType&&(i.state.selectedVisualisation="game"),i}return Object(o.a)(a,[{key:"render",value:function(){return n.a.createElement(Fa,null,Object(L.isNullOrUndefined)(this.state.selectedVisualisation)?n.a.createElement(m.a,{to:"/"}):n.a.createElement(Ma,{visulationType:this.state.selectedVisualisation,bId:this.props.match.params.bId}))}}]),a}(n.a.Component),Ra=(a(1460),a(1784)),Wa=(a(1461),function(e){Object(c.a)(i,e);var t=Object(d.a)(i);function i(e){var n;Object(r.a)(this,i),(n=t.call(this,e)).maxBlockprobeTitleChar=160,n.state={uIdHash:"",shajs:null,addBlockprobe:!1,draftBlockprobe:{title:"",summary:""},toolTipSteps:{createStoryStep:[{title:"Click on 'Create new story' to get started!",target:".addBlockprobeButton",content:"",placement:"center",disableBeacon:!0}],clickOnStoryStep:[{title:"Great! Now click on your new story!",target:".blockprobeListTooltip",content:"Let's go right to it!",disableBeacon:!0}]},showToolTips:{createStory:JSON.parse(JSON.stringify(e.buildStorytooltip)),addTitleAndSummary:!1,clickOnStory:!1,clickOnStoryEnabler:!1,buildStory:JSON.parse(JSON.stringify(e.buildStorytooltip))},isBlockprobeBeingCreated:!1};var s=a(149);return n.state.uIdHash=s("sha256").update(n.props.uId).digest("hex"),n.state.shajs=s,E.a.initialize("UA-143383035-1"),E.a.pageview("/userBlockProbes"),n.isValidBlockprobe=n.isValidBlockprobe.bind(Object(v.a)(n)),n.renderSingleBlockprobeItem=n.renderSingleBlockprobeItem.bind(Object(v.a)(n)),n.addCancelBlockprobe=n.addCancelBlockprobe.bind(Object(v.a)(n)),n.renderDraftBlockprobe=n.renderDraftBlockprobe.bind(Object(v.a)(n)),n.handleChange=n.handleChange.bind(Object(v.a)(n)),n.startTooltipTour=n.startTooltipTour.bind(Object(v.a)(n)),n.createBlockprobe=n.createBlockprobe.bind(Object(v.a)(n)),n.handleCreateStoryJoyrideCallback=n.handleCreateStoryJoyrideCallback.bind(Object(v.a)(n)),n.handleClickOnStoryJoyrideCallback=n.handleClickOnStoryJoyrideCallback.bind(Object(v.a)(n)),n.convertBlockprobeMapToList=n.convertBlockprobeMapToList.bind(Object(v.a)(n)),n}return Object(o.a)(i,[{key:"selectBlockprobe",value:function(e){E.a.event({category:"blockprobe_opened",action:"Blockprobe Opened",label:String(e)}),this.props.selectBlockprobe(e,this.state.showToolTips.buildStory)}},{key:"handleClickOnStoryJoyrideCallback",value:function(e){e.action,e.index;var t=e.status;e.type;if([O.a.FINISHED,O.a.SKIPPED].includes(t)){var a=this.state.showToolTips;a.createStory=!1,a.addTitleAndSummary=!1,a.clickOnStory=!0,a.clickOnStoryEnabler=!1,this.setState({showToolTips:a}),E.a.event({category:"read_clickOnStory_tooltip",action:"Closed clickOnStory tooltip",label:"close clickOnStory tooltip"})}}},{key:"handleCreateStoryJoyrideCallback",value:function(e){e.action,e.index;var t=e.status;e.type;if([O.a.FINISHED,O.a.SKIPPED].includes(t)){var a=this.state.showToolTips;a.createStory=!1,a.addTitleAndSummary=!0,a.clickOnStory=!1,this.setState({showToolTips:a}),E.a.event({category:"read_initial_tooltip",action:"Closed initial tooltip",label:"close initial tooltip"})}}},{key:"renderSingleBlockprobeItem",value:function(e,t){return n.a.createElement($t.a,{button:!0,selected:t.props.selectedBlockprobe==e.id,onClick:function(){t.selectBlockprobe(e.id)},style:{width:"100%"}},n.a.createElement(Zt.a,{primary:e.title,secondary:e.summary}))}},{key:"createBlockprobe",value:function(){var e=Object(k.a)(f.a.mark((function e(){var t,a,i,n,s,l,r,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({isBlockprobeBeingCreated:!0}),t=Date.now(),a={key:"",title:this.state.draftBlockprobe.title,summary:this.state.draftBlockprobe.summary,entities:[],evidences:[],actionType:"genesis",previousKey:"0",referenceBlock:"",timestamp:t,verificationHash:""},i=this.state.shajs("sha256").update(this.state.uIdHash+String(t)).digest("hex"),a.verificationHash=i,a.key=this.state.shajs("sha256").update(i+a.previousKey).digest("hex"),n=a.key,s={active:!0,criterion:0,isActive:!0,reviewers:[{id:this.state.uIdHash,nick:"creator"}],summary:this.state.draftBlockprobe.summary,title:this.state.draftBlockprobe.title},l={active:!0,id:n,isActive:!0,permit:"CREATOR",summary:this.state.draftBlockprobe.summary,title:this.state.draftBlockprobe.title,timestamp:t},(r={}).creator=this.props.uId,o={id:this.props.uId,role:"CREATOR"},e.next=14,y.database().ref("Blockprobes/"+n+"/users/"+this.state.uIdHash).set(o);case 14:return e.next=16,y.firestore().collection("Blockprobes").doc(n).collection("fullBlocks").doc(n).set(a);case 16:return e.next=18,y.firestore().collection("Users").doc(this.props.uId).collection("blockprobes").doc(n).set(l);case 18:return e.next=20,y.firestore().collection("Blockprobes").doc(n).set(s);case 20:return e.next=22,y.firestore().collection("Users").doc(this.props.uId).collection("blockprobes").doc(n).collection("privelegedInfo").doc("nickPhoneHash").set(r);case 22:this.addCancelBlockprobe(!0),E.a.event({category:"blockprobe",action:"Create blockprobe",label:n}),this.setState({isBlockprobeBeingCreated:!1}),this.selectBlockprobe(n);case 26:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isValidBlockprobe",value:function(){return""!=this.state.draftBlockprobe.title.trim()}},{key:"renderDraftBlockprobe",value:function(){var e=this;return this.state.addBlockprobe?n.a.createElement("div",{style:{}},n.a.createElement(O.b,{styles:{options:{arrowColor:"#e3ffeb",beaconSize:"3em",primaryColor:"#05878B",backgroundColor:"#e3ffeb",overlayColor:"rgba(10,10,10, 0.4)",width:900,zIndex:1e3}},steps:[],run:this.state.showToolTips.addTitleAndSummary}),n.a.createElement("form",{className:"newBlockprobeForm"},n.a.createElement("label",null,n.a.createElement(Ra.a,{type:"text",placeholder:"Enter title of your story.",variant:"outlined",value:this.state.draftBlockprobe.title,onChange:function(t){e.handleChange(t,"title")},multiline:!0,rowsMax:"2",rows:"1",style:{background:"white",marginTop:"6px",marginBottom:"6px",textColor:"black",fontWeight:"600",marginLeft:"1em",width:"95%"}}))),this.isValidBlockprobe()?n.a.createElement(rt.a,{className:"submitBlockprobeButton",color:"primary",variant:"contained",onClick:this.createBlockprobe},"Confirm"):null):null}},{key:"handleChange",value:function(e,t){var a=!0,i=e.target.value;if(Oe(i,"\n\t")||(a=!1),a){var n=this.state.draftBlockprobe;"title"==t?(n.title=e.target.value,n.title=n.title.substring(0,this.maxBlockprobeTitleChar-1),this.setState({draftBlockprobe:n})):"summary"==t&&(n.summary=e.target.value,this.setState({draftBlockprobe:n}))}}},{key:"addCancelBlockprobe",value:function(e){var t=this.state.addBlockprobe,a=this.state.draftBlockprobe,i=this.state.showToolTips;t?(a={title:"",summary:""},i.addTitleAndSummary&&e&&(i.createStory=!1,i.addTitleAndSummary=!1,i.clickOnStory=!0,i.clickOnStoryEnabler=!0)):(i.createStory&&(i.createStory=!1,i.addTitleAndSummary=!0,i.clickOnStory=!1,i.clickOnStoryEnabler=!1),E.a.event({category:"clicked_on_create_story",action:"Clicked on create story",label:"Clicked on create story"})),this.setState({addBlockprobe:!t,draftBlockprobe:a,showToolTips:i})}},{key:"startTooltipTour",value:function(){var e=this.state.showToolTips;e.createStory||e.clickOnStory?e.clickOnStory&&(e.clickOnStoryEnabler=!0,this.setState({showToolTips:e})):(e.createStory=!0,e.addTitleAndSummary=!1,e.clickOnStory=!1,e.buildStory=!0,this.setState({showToolTips:e}))}},{key:"componentWillReceiveProps",value:function(e){if(e.buildStorytooltip!=this.props.buildStorytooltip){var t=this.state.showToolTips;t.createStory=JSON.parse(JSON.stringify(e.buildStorytooltip)),this.setState({showToolTips:t})}}},{key:"componentDidMount",value:function(){var e=document.createElement("script"),t=document.createTextNode("gtag('event', 'conversion', {'send_to': 'AW-734513637/5XMVCJjI2qUBEOWTn94C'});");e.appendChild(t),document.head.appendChild(e);var a=document.createElement("script"),i=document.createTextNode("fbq('track', 'ViewContent', {value: 1, content_type: 'login', currency: 'INR', content_id:'1', product:'none'});");a.appendChild(i),document.head.appendChild(a)}},{key:"convertBlockprobeMapToList",value:function(e){var t=[];for(var a in e)a in e&&t.push(e[a]);return t.sort((function(e,t){return e.title.toLowerCase()>t.title.toLowerCase()?1:-1})),t}},{key:"render",value:function(){var e=this,t=this,a=this.convertBlockprobeMapToList(t.props.blockprobes).map((function(e){return t.renderSingleBlockprobeItem(e,t)}));return n.a.createElement("div",null,n.a.createElement(O.b,{styles:{options:{arrowColor:"#e3ffeb",beaconSize:"3em",primaryColor:"#05878B",backgroundColor:"#e3ffeb",overlayColor:"rgba(10,10,10, 0.4)",width:900,zIndex:1e3}},steps:this.state.toolTipSteps.createStoryStep,run:this.state.showToolTips.createStory,callback:this.handleCreateStoryJoyrideCallback}),n.a.createElement("h2",{style:{textAlign:"center"}},"My stories"),this.state.isBlockprobeBeingCreated?n.a.createElement("div",{style:{margin:"auto",width:"50px"}},n.a.createElement(Da.a,{type:"TailSpin",color:"#00BFFF",height:"50",width:"50"})):n.a.createElement("div",null,n.a.createElement("div",null,n.a.createElement("div",{style:{flexWrap:"wrap",display:"flex"}},n.a.createElement("div",null,n.a.createElement(rt.a,{className:"addBlockprobeButton",color:"primary",variant:"contained",onClick:function(){return e.addCancelBlockprobe(!1)}},this.state.addBlockprobe?n.a.createElement("div",null,"Cancel"):n.a.createElement("div",null,"Create new story"))),n.a.createElement("div",{style:{display:"none"}},n.a.createElement(rt.a,{className:"startTooltipsButton",color:"primary",variant:"contained",onClick:function(){return e.startTooltipTour()}},"Guided tutorial"))),this.state.addBlockprobe?this.renderDraftBlockprobe():null),0==Object.keys(this.props.blockprobes).length?n.a.createElement("div",null,n.a.createElement("div",{style:{padding:"15px"}},n.a.createElement("p",{className:"emptyListText"},"Click on ",n.a.createElement("span",{className:"emptyListTextEmphasisStory"},"Create new story")," and get started.",n.a.createElement("br",null),n.a.createElement("br",null),"Your work will be saved as ",n.a.createElement("span",{className:"emptyListTextEmphasisStory"},"stories"),".",n.a.createElement("br",null),"If you are a ",n.a.createElement("span",{className:"emptyListTextEmphasisPersona"},"police officer"),", the ",n.a.createElement("span",{className:"emptyListTextEmphasisStory"},"story")," could be the ",n.a.createElement("span",{className:"emptyListTextEmphasisStoryType"},"case that you are investigating"),".",n.a.createElement("br",null),"If you are a ",n.a.createElement("span",{className:"emptyListTextEmphasisPersona"},"politician"),", the ",n.a.createElement("span",{className:"emptyListTextEmphasisStory"},"story")," could be your ",n.a.createElement("span",{className:"emptyListTextEmphasisStoryType"},"policy proposal"),".",n.a.createElement("br",null),"If you are a ",n.a.createElement("span",{className:"emptyListTextEmphasisPersona"},"journalist"),", the ",n.a.createElement("span",{className:"emptyListTextEmphasisStory"},"story")," could be your ",n.a.createElement("span",{className:"emptyListTextEmphasisStoryType"},"article or investigation"),".",n.a.createElement("br",null)))):n.a.createElement(Qt.a,{className:"blockprobeListTooltip"},n.a.createElement(O.b,{styles:{options:{arrowColor:"#e3ffeb",beaconSize:"3em",primaryColor:"#05878B",backgroundColor:"#e3ffeb",overlayColor:"rgba(10, 10, 10, 0.4)",width:900,zIndex:1e3}},steps:this.state.toolTipSteps.clickOnStoryStep,run:!1,callback:this.handleClickOnStoryJoyrideCallback}),a)))}}]),i}(n.a.Component)),Ja=a(893),Ha=(a(1462),a(1463),a(1771)),za=a(1773),_a=a(1772),Ya=a(1774),Ka=function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).state={urlPrefix:"https://blprobe.com/view/",gameUrlPrefix:"https://blprobe.com/game/",blocksUploaded:!0,imageUploaded:!0,didPublishBlocksInSession:!1,didPublishImagesInSession:!1,unpublishingBlocks:!1,unpublishingImages:!1,isBlockprobeAlreadyPublished:!1,adhocTooltip:{publicLink:{flag:!1,text:[{title:"Link to share with public",target:".share-url",content:"Share your dashboard with the general public using this link so that they can also engage with your story.",disableBeacon:!0}]},socialMedia:{flag:!1,text:[{title:"Share link on social media",target:".shareContainer",content:"You can directly open social media (Facebook and Whatsapp) and share your dashboard's public link.",disableBeacon:!0}]}}},i.renderShareScreen=i.renderShareScreen.bind(Object(v.a)(i)),i.showLocalTooltip=i.showLocalTooltip.bind(Object(v.a)(i)),i.unpublishStory=i.unpublishStory.bind(Object(v.a)(i)),i.publishStory=i.publishStory.bind(Object(v.a)(i)),i.addStoryToWall=i.addStoryToWall.bind(Object(v.a)(i)),i.removeStoryFromWall=i.removeStoryFromWall.bind(Object(v.a)(i)),i.isAnyOptionClicked=i.isAnyOptionClicked.bind(Object(v.a)(i)),i.isStoryAlreadyAdded=i.isStoryAlreadyAdded.bind(Object(v.a)(i)),i.handleAdhocTooltipJoyrideCallback=i.handleAdhocTooltipJoyrideCallback.bind(Object(v.a)(i)),i}return Object(o.a)(a,[{key:"isStoryAlreadyAdded",value:function(){for(var e=this.props.posts,t=0;e&&t<e.length;t++)if(e[t].bp==this.props.bpId)return!0;return!1}},{key:"showLocalTooltip",value:function(e){var t=this.state.adhocTooltip;"publicLink"==e?t.publicLink.flag=!0:"socialMedia"==e&&(t.socialMedia.flag=!0),this.setState({adhocTooltip:t})}},{key:"handleAdhocTooltipJoyrideCallback",value:function(e,t){e.action,e.index;var a=e.status;e.type;if([O.a.FINISHED,O.a.SKIPPED].includes(a)){var i=this.state.adhocTooltip;"publicLink"==t?i.publicLink.flag=!1:"socialMedia"==t&&(i.socialMedia.flag=!1),this.setState({adhocTooltip:i})}}},{key:"addStoryToWall",value:function(){var e=Object(k.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.props.posts,this.isStoryAlreadyAdded()||(t.push({title:this.props.title,bp:this.props.bpId}),this.props.updatePosts(t));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"removeStoryFromWall",value:function(){var e=Object(k.a)(f.a.mark((function e(){var t,a,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props.posts,this.isStoryAlreadyAdded()){for(a=[],i=0;i<t.length;i++)t[i].bp!=this.props.bpId&&a.push(t[i]);this.props.updatePosts(a)}case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"renderShareScreen",value:function(){var e=this,t=this.state.urlPrefix+this.props.bpId,a=this.state.gameUrlPrefix+this.props.bpId;return n.a.createElement("div",null,this.state.didPublishBlocksInSession&&this.state.didPublishImagesInSession?n.a.createElement("div",{className:"shareTooltipTextContainer"},n.a.createElement("p",{className:"contributeOptionText"},"Click on the menu (top-left) and choose ",n.a.createElement("a",{className:"tooltip-selection",onClick:function(){return e.props.setNewVisualisation("contributions")}},"Contribute")," to resume working.")):null,this.isAnyOptionClicked()?n.a.createElement("div",{style:{width:"50px",margin:"auto"}},n.a.createElement(Da.a,{type:"TailSpin",color:"#00BFFF",height:"50",width:"50"})):n.a.createElement("div",{style:{display:"flex",flexWrap:"wrap"}},n.a.createElement("div",{style:{marginBottom:"10px"}},n.a.createElement(rt.a,{variant:"contained",className:"publishBlockprobeButton",onClick:this.publishStory},n.a.createElement("div",null,"Publish latest story"))),this.state.isBlockprobeAlreadyPublished?n.a.createElement("div",{style:{marginBottom:"10px"}},n.a.createElement(rt.a,{variant:"contained",className:"unpublishBlockprobeButton",onClick:this.unpublishStory},n.a.createElement("div",null,"Unpublish story"))):null,this.state.isBlockprobeAlreadyPublished&&!this.isStoryAlreadyAdded()?n.a.createElement("div",{style:{marginBottom:"10px"}},n.a.createElement(rt.a,{variant:"contained",className:"addToWallButton",onClick:this.addStoryToWall},n.a.createElement("div",null,"Add story to my wall"))):null,this.state.isBlockprobeAlreadyPublished&&this.isStoryAlreadyAdded()?n.a.createElement("div",{style:{marginBottom:"10px"}},n.a.createElement(rt.a,{variant:"contained",className:"addToWallButton",onClick:this.removeStoryFromWall},n.a.createElement("div",null,"Remove story from my wall"))):null),this.state.isBlockprobeAlreadyPublished?n.a.createElement("div",null,this.state.didPublishBlocksInSession&&this.state.didPublishImagesInSession?n.a.createElement("div",null,n.a.createElement("p",{className:"publish-story-message"},"Your latest story has been succesfully published!")):null,n.a.createElement("div",{className:"share-section-heading"},"Public link to visualize",n.a.createElement("a",{className:"share-tooltips",onClick:function(t){e.showLocalTooltip("publicLink")}},n.a.createElement(T.a,{style:{fontSize:"19px"}})),n.a.createElement(O.b,{styles:{options:{arrowColor:"#e3ffeb",beaconSize:"4em",primaryColor:"#05878B",backgroundColor:"#e3ffeb",overlayColor:"rgba(10,10,10, 0.4)",width:400,zIndex:1e3}},steps:this.state.adhocTooltip.publicLink.text,run:this.state.adhocTooltip.publicLink.flag,callback:function(t){e.handleAdhocTooltipJoyrideCallback(t,"publicLink")}})),n.a.createElement("div",{className:"share-url-div"},n.a.createElement("a",{href:t,target:"_blank",className:"share-url"},t)),n.a.createElement("div",{className:"share-section-heading"},"Public link to play game"),n.a.createElement("div",{className:"share-url-div"},n.a.createElement("a",{href:a,target:"_blank",className:"share-url"},a)),n.a.createElement("div",{className:"share-section-heading"},"Share Link on Social Media",n.a.createElement("a",{className:"share-tooltips tooltipSocialMedia",onClick:function(t){e.showLocalTooltip("socialMedia")}},n.a.createElement(T.a,{style:{fontSize:"19px"}}),n.a.createElement(O.b,{styles:{options:{arrowColor:"#e3ffeb",beaconSize:"4em",primaryColor:"#05878B",backgroundColor:"#e3ffeb",overlayColor:"rgba(10,10,10, 0.4)",width:400,zIndex:1e3}},steps:this.state.adhocTooltip.socialMedia.text,run:this.state.adhocTooltip.socialMedia.flag,callback:function(t){e.handleAdhocTooltipJoyrideCallback(t,"socialMedia")}}))),n.a.createElement("div",{className:"shareContainer"},n.a.createElement("div",{className:"shareIcons"},n.a.createElement(Ha.a,{children:n.a.createElement(_a.a,{round:!0}),url:t,hashtag:"#blockprobe"})),n.a.createElement("div",{className:"shareIcons"},n.a.createElement(za.a,{children:n.a.createElement(Ya.a,{round:!0}),url:t})))):null)}},{key:"componentDidMount",value:function(){var e=this;y.firestore().collection("public").doc(this.props.bpId).collection("aggBlocks").get().then((function(t){0==Object.keys(t.docs).length?e.setState({isBlockprobeAlreadyPublished:!1}):e.setState({isBlockprobeAlreadyPublished:!0})}))}},{key:"publishStory",value:function(){var e=this,t=this.props.blockTree,a=oe(t);a.length>0?y.firestore().collection("public").doc(this.props.bpId).collection("aggBlocks").get().then((function(t){t.forEach((function(t){y.firestore().collection("public").doc(e.props.bpId).collection("aggBlocks").doc(t.id).delete()}));for(var i=0;i<a.length;i++)y.firestore().collection("public").doc(e.props.bpId).collection("aggBlocks").doc(String(i)).set(a[i])})).then(this.setState({blocksUploaded:!0,didPublishBlocksInSession:!0})):this.setState({blocksUploaded:!0,didPublishBlocksInSession:!0});var i=this.props.imageMapping,n=ce(i);n.length>0?y.firestore().collection("public").doc(this.props.bpId).collection("images").get().then((function(t){t.forEach((function(t){y.firestore().collection("public").doc(e.props.bpId).collection("images").doc(t.id).delete()}));for(var a=0;a<n.length;a++)y.firestore().collection("public").doc(e.props.bpId).collection("images").doc(String(a)).set(n[a])})).then(this.setState({imageUploaded:!0,didPublishImagesInSession:!0})):this.setState({imageUploaded:!0,didPublishImagesInSession:!0}),this.setState({isBlockprobeAlreadyPublished:!0})}},{key:"unpublishStory",value:function(){var e=this;this.setState({unpublishingBlocks:!0,unpublishingImages:!0});y.firestore().collection("public").doc(this.props.bpId).collection("aggBlocks").get().then((function(t){t.forEach((function(t){y.firestore().collection("public").doc(e.props.bpId).collection("aggBlocks").doc(t.id).delete()}))})).then(this.setState({unpublishingBlocks:!1,didPublishBlocksInSession:!1})),y.firestore().collection("public").doc(this.props.bpId).collection("images").get().then((function(t){t.forEach((function(t){y.firestore().collection("public").doc(e.props.bpId).collection("images").doc(t.id).delete()}))})).then(this.setState({unpublishingImages:!1,didPublishImagesInSession:!1})),this.setState({isBlockprobeAlreadyPublished:!1})}},{key:"isAnyOptionClicked",value:function(){return!(!this.state.unpublishingBlocks&&!this.state.unpublishingImages)}},{key:"render",value:function(){return n.a.createElement("div",null,this.state.blocksUploaded&&this.state.imageUploaded?this.renderShareScreen():n.a.createElement("div",{style:{width:"50px",margin:"auto"}},n.a.createElement(Da.a,{type:"TailSpin",color:"#00BFFF",height:"50",width:"50"})))}}]),a}(n.a.Component),qa=a(1795),Xa=a(1791),Qa=a(1778),$a=a(1776),Za=a(1777),ei=a(1775),ti=(a(1507),function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).state={firstLangSelectList:[],selectedLang:String(i.props.lang),currentLangLabel:null},i.generateLangLists=i.generateLangLists.bind(Object(v.a)(i)),i.canSubmit=i.canSubmit.bind(Object(v.a)(i)),i.submitLanguage=i.submitLanguage.bind(Object(v.a)(i)),i}return Object(o.a)(a,[{key:"firstLangClicked",value:function(e){for(var t=null,a=0;a<e.length;a++)e[a].value&&(t=e[a].id);this.setState({firstLangSelectList:e,selectedLang:t})}},{key:"firstSelectedBadgeClicked",value:function(e){for(var t=null,a=0;a<e.length;a++)e[a].value&&(t=e[a].id);this.setState({firstLangSelectList:e,selectedLang:t})}},{key:"generateLangLists",value:function(){for(var e=this.state.firstLangSelectList,t=this.state.selectedLangLabel,a=0;a<ct.length;a++){var i=!1;this.state.selectedLang==ct[a].id&&(i=!0,t=ct[a].label),e.push({value:i,label:ct[a].label,id:ct[a].id})}this.setState({firstLangSelectList:e,currentLangLabel:t})}},{key:"componentDidMount",value:function(){this.generateLangLists()}},{key:"canSubmit",value:function(){return this.state.selectedLang!=this.props.lang&&!Object(L.isNullOrUndefined)(this.state.selectedLang)}},{key:"submitLanguage",value:function(){for(var e,t,a=this.state.firstLangSelectList,i=0;i<a.length;i++)if(this.state.selectedLang==a[i].id){this.setState({currentLangLabel:a[i].label});break}e=this.props.bpId,t=this.state.selectedLang,y.firestore().collection("blprobeLang").doc(e).set({lang:t})}},{key:"render",value:function(){return n.a.createElement("div",null,n.a.createElement("div",{style:{marginLeft:"10px",marginTop:"1em"}},n.a.createElement("h3",null,"Language settings"),Object(L.isNullOrUndefined)(this.state.currentLangLabel)?null:n.a.createElement("p",null,"Current language: ",this.state.currentLangLabel),n.a.createElement("div",{className:"langpane-filter-container"},n.a.createElement("div",{className:"langpane-dropdown-container"},n.a.createElement(A.a,{options:this.state.firstLangSelectList,optionClicked:this.firstLangClicked.bind(this),selectedBadgeClicked:this.firstSelectedBadgeClicked.bind(this),selectedOptionsStyles:{color:"white",backgroundColor:"rgb(117, 106, 214)",borderRadius:"20px",fontSize:"0.6em",padding:"10px",maxWidth:"92%",wordWrap:"break-word"},optionsListStyles:{backgroundColor:"darkcyan",color:"white"},isSingleSelect:!0,isTextWrap:!1})),this.canSubmit()?n.a.createElement(rt.a,{variant:"contained",color:"primary",className:"langPaneButton",onClick:this.submitLanguage},"Save"):null)))}}]),a}(n.a.Component)),ai=(a(1508),n.a.forwardRef((function(e,t){return n.a.createElement(It.a,Object.assign({direction:"up",ref:t},e))}))),ii=function(e){Object(c.a)(i,e);var t=Object(d.a)(i);function i(e){var n;Object(r.a)(this,i),(n=t.call(this,e)).changeCriterion=function(e,t){n.setState({newCriterion:t})},n.state={uIdHash:"",shajs:null,newCriterion:JSON.parse(JSON.stringify(e.details.criterion)),step:1,min:0,viewerId:"",contributorId:"",creatorId:"",prevCreatorId:"",selectedUser:null,creatorMessageId:null,addingUser:!1,dialogType:null,dialog:!1,userDialog:!1,dialogText:{selected:{title:null,desc:null}}};var s=a(149);return n.state.uIdHash=s("sha256").update(n.props.uId).digest("hex"),n.state.shajs=s,n.changeCriterion=n.changeCriterion.bind(Object(v.a)(n)),n.renderBlockprobeSettings=n.renderBlockprobeSettings.bind(Object(v.a)(n)),n.modifyBlockProbeSettings=n.modifyBlockProbeSettings.bind(Object(v.a)(n)),n.renderAddViewers=n.renderAddViewers.bind(Object(v.a)(n)),n.renderAddContributors=n.renderAddContributors.bind(Object(v.a)(n)),n.renderAddCreators=n.renderAddCreators.bind(Object(v.a)(n)),n.renderAccountSettings=n.renderAccountSettings.bind(Object(v.a)(n)),n.renderUserList=n.renderUserList.bind(Object(v.a)(n)),n.renderUser=n.renderUser.bind(Object(v.a)(n)),n.renderUserDialog=n.renderUserDialog.bind(Object(v.a)(n)),n.clickUser=n.clickUser.bind(Object(v.a)(n)),n.removeUser=n.removeUser.bind(Object(v.a)(n)),n.getMessage=n.getMessage.bind(Object(v.a)(n)),n.handleChange=n.handleChange.bind(Object(v.a)(n)),n.toggleDialog=n.toggleDialog.bind(Object(v.a)(n)),n.performAction=n.performAction.bind(Object(v.a)(n)),n}return Object(o.a)(i,[{key:"toggleDialog",value:function(e,t){var a=this.state.dialogText;if("exitBlockprobe"==t)a.selected.title='Exit story "'.concat(this.props.details.title,'"'),a.selected.desc="You will no longer be able to contribute or participate in building this story. Do you want to exit?";else if("user"==t){var i=this.state.selectedUser,n=null;return Object(L.isNullOrUndefined)(i)||(n=i.id,i.role),a.selected.title="".concat(n),a.selected.desc=null,void this.setState({userDialog:e,dialog:!1,dialogText:a})}this.setState({dialog:e,dialogType:t,dialogText:a})}},{key:"performAction",value:function(){var e=Object(k.a)(f.a.mark((function e(t){var a,i,n,s,l,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("exitBlockprobe"!=this.state.dialogType||!t){e.next=11;break}return a=this.props.bpId,i=this.props.uId,n=this.state.uIdHash,s=Date.now(),l={active:!0,id:this.props.bpId,isActive:!0,permit:"EXIT",summary:this.props.details.summary,title:this.props.details.title,timestamp:s},!Object(L.isNullOrUndefined)(this.props.coUsers)&&Object.keys(this.props.coUsers).length<=1&&(r={id:a,timestamp:s},y.firestore().collection("defunctBlockprobes").doc(a).set(r)),y.database().ref("Blockprobes/"+a+"/users/"+n).remove(),e.next=11,y.firestore().collection("Users").doc(i).collection("blockprobes").doc(a).set(l);case 11:this.setState({dialog:!1});case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getMessage",value:function(e){var t=this.state.prevCreatorId;if(!Object(L.isNullOrUndefined)(e)){if("alreadyPresent"==e)return n.a.createElement("p",{className:"messageUserTextGeneral"},"User ",n.a.createElement("span",{className:"messageUserTextUid"},t)," is already contributing to the story.");if("notExist"==e)return n.a.createElement("p",{className:"messageUserTextGeneral"},"User ",n.a.createElement("span",{className:"messageUserTextUid"},t)," does not exist.");if("alreadySent"==e)return n.a.createElement("p",{className:"messageUserTextGeneral"},"User ",n.a.createElement("span",{className:"messageUserTextUid"},t)," has already been invited.");if("sent"==e)return n.a.createElement("p",{className:"messageUserTextGeneral"},"Invitation sent to ",n.a.createElement("span",{className:"messageUserTextUid"},t),".");if("maxUserLimitReached"==e)return n.a.createElement("p",{className:"messageUserTextGeneral"},"Cannot add ",n.a.createElement("span",{className:"messageUserTextUid"},t)," because each story has ",25," contributors!")}return null}},{key:"modifyBlockProbeSettings",value:function(e,t){var a="";if(t){var i="";if("viewer"==e?(a=this.state.viewerId,i="VIEWER"):"contributor"==e?(a=this.state.contributorId,i="CONTRIBUTOR"):"reviewer"==e?i="REVIEWER":"creator"==e&&(a=this.state.creatorId.trim(),i="CREATOR",this.setState({prevCreatorId:a,addingUser:!0})),"criterion"!=e){var n={active:!0,id:this.props.bpId,isActive:!0,permit:i,summary:this.props.details.summary,title:this.props.details.title,timestamp:0},s=this,l=this.props.coUsers,r=1;Object(L.isNullOrUndefined)(l)||(r=Math.max(Object.keys(l).length,1)),r<25?y.firestore().collection("Users").doc(a).get().then((function(e){e.exists?y.firestore().collection("Users").doc(a).collection("blockprobes").doc(s.props.bpId).get().then((function(e){e.exists&&"EXIT"!=e.data().permit?s.setState({creatorMessageId:"alreadyPresent",addingUser:!1}):y.firestore().collection("Users").doc(a).collection("notifications").doc(s.props.bpId).get().then((function(e){if(e.exists)s.setState({creatorMessageId:"alreadySent",addingUser:!1});else{y.firestore().collection("Users").doc(a).collection("notifications").doc(s.props.bpId).set(n);var t={id:a,role:"INVITED"},i=s.state.shajs("sha256").update(a).digest("hex");y.database().ref("Blockprobes/"+s.props.bpId+"/users/"+i).set(t),s.setState({creatorMessageId:"sent",addingUser:!1})}}))})):s.setState({creatorMessageId:"notExist",addingUser:!1})})):s.setState({creatorMessageId:"maxUserLimitReached",addingUser:!1})}else if("criterion"==e){var o=JSON.parse(JSON.stringify(this.props.details));o.criterion=this.state.newCriterion,y.firestore().collection("Blockprobes").doc(this.props.bpId).set(o)}}"viewer"==e?this.setState({viewerId:""}):"contributor"==e?this.setState({contributorId:""}):"creator"==e?this.setState({creatorId:""}):"criterion"==e&&(a=t?this.state.newCriterion:this.props.details.criterion,this.setState({newCriterion:a}))}},{key:"renderBlockprobeSettings",value:function(){var e=this;this.props.classes;return"CREATOR"==this.props.permit?n.a.createElement("div",{style:{marginLeft:"10px",marginBottom:"5em"}},n.a.createElement("h3",null,"Upvote Criteria"),n.a.createElement("h5",null,"Number of reviewer upvotes for any block to accepted. (",this.state.newCriterion,")"),n.a.createElement("div",{style:{width:"30%",marginLeft:"15px"}},n.a.createElement(qa.a,{value:this.state.newCriterion,min:0,max:this.props.details.reviewers.length,onChange:this.changeCriterion,step:this.state.step})),this.state.newCriterion!=this.props.details.criterion?n.a.createElement("div",{className:"blockprobe-settings-criterion-options-container"},n.a.createElement(rt.a,{variant:"contained",className:"saveBlockProbeSettingsButton",onClick:function(t){return e.modifyBlockProbeSettings("criterion",!0)}},n.a.createElement("div",null,"Confirm settings")),n.a.createElement(rt.a,{variant:"contained",className:"cancelBlockProbeSettingsButton",onClick:function(t){return e.modifyBlockProbeSettings("criterion",!1)}},n.a.createElement("div",null,"Cancel"))):null):null}},{key:"handleChange",value:function(e,t){var a=!1,i=e.target.value;if("creator"==t&&Oe(i,["\n","\t"])&&(a=!0),a)if("viewer"==t){var n=e.target.value;this.setState({viewerId:n})}else if("contributor"==t){n=e.target.value;this.setState({contributorId:n})}else if("creator"==t){var s=e.target.value;this.setState({creatorId:s,creatorMessageId:null})}}},{key:"renderAddContributors",value:function(){var e=this;return"PRIVILEGED"==this.props.permit||"CREATOR"==this.props.permit?n.a.createElement("div",{style:{marginLeft:"10px",marginTop:"1em"}},n.a.createElement("h3",null,"Add Contributors"),n.a.createElement("form",null,n.a.createElement("label",null,n.a.createElement(Ra.a,{type:"text",variant:"outlined",multiline:!0,placeholder:"Phone number",value:this.state.contributorId,onChange:function(t){e.handleChange(t,"contributor")},rowsMax:"1",rows:"1",style:{background:"white",marginTop:"6px",marginBottom:"6px",width:"30%"}}))),""!=this.state.contributorId?n.a.createElement("div",{className:"blockprobe-settings-criterion-options-container"},n.a.createElement(rt.a,{variant:"contained",className:"saveBlockProbeSettingsButton",style:{marginTop:"1em"},onClick:function(t){return e.modifyBlockProbeSettings("contributor",!0)}},n.a.createElement("div",null,"Confirm contributor")),n.a.createElement(rt.a,{variant:"contained",className:"cancelBlockProbeSettingsButton",style:{marginTop:"1em"},onClick:function(t){return e.modifyBlockProbeSettings("contributor",!1)}},n.a.createElement("div",null,"Cancel"))):null):null}},{key:"renderAddViewers",value:function(){var e=this;return n.a.createElement("div",{style:{marginLeft:"10px",marginTop:"1em"}},n.a.createElement("h3",null,"Add Viewers"),n.a.createElement("form",null,n.a.createElement("label",null,n.a.createElement(Ra.a,{type:"text",variant:"outlined",multiline:!0,placeholder:"Phone number",value:this.state.viewerId,onChange:function(t){e.handleChange(t,"viewer")},rowsMax:"1",rows:"1",style:{background:"white",marginTop:"6px",marginBottom:"6px",width:"30%"}}))),""!=this.state.viewerId?n.a.createElement("div",{className:"blockprobe-settings-criterion-options-container"},n.a.createElement(rt.a,{variant:"contained",className:"saveBlockProbeSettingsButton",style:{marginTop:"1em"},onClick:function(t){return e.modifyBlockProbeSettings("viewer",!0)}},n.a.createElement("div",null,"Confirm viewer")),n.a.createElement(rt.a,{variant:"contained",className:"cancelBlockProbeSettingsButton",style:{marginTop:"1em"},onClick:function(t){return e.modifyBlockProbeSettings("viewer",!1)}},n.a.createElement("div",null,"Cancel"))):null)}},{key:"renderAddCreators",value:function(){var e=this;return n.a.createElement("div",null,n.a.createElement("div",{style:{marginLeft:"10px",marginTop:"1em"}},n.a.createElement("h3",null,"Add Users"),n.a.createElement("form",null,n.a.createElement("label",null,n.a.createElement("div",{className:"settings-textfield-container"},n.a.createElement(Ra.a,{type:"text",variant:"outlined",multiline:!0,placeholder:"Email or phonenumber",value:this.state.creatorId,onChange:function(t){e.handleChange(t,"creator")},rowsMax:"1",rows:"1",style:{background:"white",marginTop:"6px",marginBottom:"6px",width:"100%"}})))),this.getMessage(this.state.creatorMessageId),""==this.state.creatorId.trim()||this.state.addingUser?null:n.a.createElement("div",{className:"blockprobe-settings-criterion-options-container"},n.a.createElement(rt.a,{variant:"contained",className:"saveBlockProbeSettingsButton",style:{marginTop:"1em"},onClick:function(t){return e.modifyBlockProbeSettings("creator",!0)}},n.a.createElement("div",null,"Confirm")),n.a.createElement(rt.a,{variant:"contained",className:"cancelBlockProbeSettingsButton",style:{marginTop:"1em"},onClick:function(t){return e.modifyBlockProbeSettings("creator",!1)}},n.a.createElement("div",null,"Cancel"))),this.state.addingUser?n.a.createElement("div",{style:{width:"50px"}},n.a.createElement(Da.a,{type:"TailSpin",color:"#00BFFF",height:"50",width:"50"})):null))}},{key:"removeUser",value:function(){var e=Object(k.a)(f.a.mark((function e(){var t,a,i,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.state.selectedUser,Object(L.isNullOrUndefined)(t.role)||"INVITED"!=t.role){e.next=10;break}return a={id:this.props.bpId,permit:"INVITED"},i=t.id,n=this.state.shajs("sha256").update(i).digest("hex"),e.next=7,Ga(a,i,n);case 7:return e.next=9,Aa(a,i);case 9:this.setState({userDialog:!1});case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"clickUser",value:function(){var e=Object(k.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setState({selectedUser:t});case 2:this.toggleDialog(!0,"user");case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"renderUser",value:function(e){var t=this;return n.a.createElement($t.a,{button:!0,onClick:function(){return t.clickUser(e)}},n.a.createElement(Zt.a,{primary:e.id,secondary:e.role}))}},{key:"renderUserList",value:function(e){var t=this,a=null;return Object(L.isNullOrUndefined)(e)||(a=Object.keys(e).map((function(a){var i=e[a];return t.renderUser(i)}))),n.a.createElement("div",{style:{marginLeft:"10px",marginTop:"1em"}},n.a.createElement("h3",null,"User list"),n.a.createElement("div",{className:"userListContainer"},n.a.createElement(Qt.a,null,a)))}},{key:"renderAccountSettings",value:function(){var e=this;return n.a.createElement("div",null,n.a.createElement("div",{style:{marginLeft:"10px",marginTop:"1em"}},n.a.createElement("h3",{style:{marginBotton:"0.5em !important"}},"Account settings"),n.a.createElement("div",{className:"blockprobe-settings-criterion-options-container"},n.a.createElement(rt.a,{variant:"contained",className:"saveBlockProbeSettingsButton",onClick:function(t){return e.toggleDialog(!0,"exitBlockprobe")}},n.a.createElement("div",null,"Exit story")))))}},{key:"renderUserDialog",value:function(){var e=this,t=this.state.selectedUser;return n.a.createElement(Xa.a,{open:this.state.userDialog,TransitionComponent:ai,keepMounted:!0,onClose:function(){return e.toggleDialog(!1,"user")},"aria-labelledby":"alert-dialog-slide-title","aria-describedby":"alert-dialog-slide-description"},n.a.createElement(ei.a,{id:"alert-dialog-slide-title"},this.state.dialogText.selected.title),n.a.createElement($a.a,null,n.a.createElement(Za.a,{id:"alert-dialog-slide-description"},this.state.dialogText.selected.desc)),n.a.createElement(Qa.a,null,Object(L.isNullOrUndefined)(t)||"INVITED"!=t.role?null:n.a.createElement(rt.a,{onClick:function(){return e.removeUser()},color:"primary"},"Delete"),n.a.createElement(rt.a,{onClick:function(){return e.toggleDialog(!1,"user")},color:"primary"},"Cancel")))}},{key:"render",value:function(){var e=this;return n.a.createElement("div",null,this.renderUserList(this.props.coUsers),n.a.createElement(ti,{lang:this.props.lang,bpId:this.props.bpId}),this.renderAddCreators(),this.renderAccountSettings(),this.renderUserDialog(),n.a.createElement(Xa.a,{open:this.state.dialog,TransitionComponent:ai,keepMounted:!0,onClose:function(){return e.toggleDialog(!1,"all")},"aria-labelledby":"alert-dialog-slide-title","aria-describedby":"alert-dialog-slide-description"},n.a.createElement(ei.a,{id:"alert-dialog-slide-title"},this.state.dialogText.selected.title),n.a.createElement($a.a,null,n.a.createElement(Za.a,{id:"alert-dialog-slide-description"},this.state.dialogText.selected.desc)),n.a.createElement(Qa.a,null,n.a.createElement(rt.a,{onClick:function(){return e.performAction(!0)},color:"primary"},"Yes"),n.a.createElement(rt.a,{onClick:function(){return e.performAction(!1)},color:"primary"},"No"),n.a.createElement(rt.a,{onClick:function(){return e.toggleDialog(!1,"all")},color:"primary"},"Cancel"))))}}]),i}(n.a.Component),ni=a(600),si=a.n(ni),li=a(881),ri=a.n(li),oi=(a(1509),a(815),a(75)),ci=a(279),di=a.n(ci),ui=a(235),hi=(a(1513),function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).state={isClicked:JSON.parse(JSON.stringify(i.props.isClicked)),newEvidence:JSON.parse(JSON.stringify(i.props.evidence)),isImage:!1,isImageUploading:!1,image:null},i.getEvidenceViewOnly=i.getEvidenceViewOnly.bind(Object(v.a)(i)),i.clickEvidenceNotInDraft=i.clickEvidenceNotInDraft.bind(Object(v.a)(i)),i.getEvidenceDraft=i.getEvidenceDraft.bind(Object(v.a)(i)),i.handleChange=i.handleChange.bind(Object(v.a)(i)),i.removeEvidence=i.removeEvidence.bind(Object(v.a)(i)),i.updateEvidence=i.updateEvidence.bind(Object(v.a)(i)),i.cancelEvidenceAction=i.cancelEvidenceAction.bind(Object(v.a)(i)),i.onDrop=i.onDrop.bind(Object(v.a)(i)),i.uploadEvidenceImageToDb=i.uploadEvidenceImageToDb.bind(Object(v.a)(i)),i.deleteEvidenceImageFromDb=i.deleteEvidenceImageFromDb.bind(Object(v.a)(i)),i}return Object(o.a)(a,[{key:"clickEvidenceNotInDraft",value:function(){this.setState({isClicked:!0,newEvidence:JSON.parse(JSON.stringify(this.props.evidence))})}},{key:"cancelEvidenceAction",value:function(){this.setState({isClicked:!1})}},{key:"removeEvidence",value:function(){var e=Object(k.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.props.updateEvidence(this.props.evidence,null,!1,!0,this.props.index),this.setState({isClicked:!1});case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateEvidence",value:function(){var e=Object(k.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.props.updateEvidence(this.props.evidence,this.state.newEvidence,!0,!1,this.props.index),this.setState({isClicked:!1,image:null});case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleChange",value:function(e,t){var a=!0,i=e.target.value[e.target.value.length-1];if("\n"!=i&&"\t"!=i||(a=!1),a){var n=this.state.newEvidence;"details"==t?(n.supportingDetails=e.target.value,this.setState({newEvidence:n})):"link"==t&&(n.evidenceLink=e.target.value,this.setState({newEvidence:n}))}}},{key:"onDrop",value:function(){var e=Object(k.a)(f.a.mark((function e(t){var a,i,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.length>0)){e.next=12;break}return a=t[t.length-1],i={maxSizeMB:.06,maxWidthOrHeight:900,useWebWorker:!0},e.prev=3,e.next=6,Object(ui.a)(a,i);case 6:n=e.sent,this.setState({image:n}),e.next=12;break;case 10:e.prev=10,e.t0=e.catch(3);case 12:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteEvidenceImageFromDb",value:function(){var e=Object(k.a)(f.a.mark((function e(t){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.setState({isImageUploading:!0}),console.log(t),a=y.storage().ref(t),e.next=6,a.delete();case 6:this.setState({isImageUploading:!1}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),this.setState({isImageUploading:!1});case 12:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(t){return e.apply(this,arguments)}}()},{key:"uploadEvidenceImageToDb",value:function(){var e=Object(k.a)(f.a.mark((function e(){var t,a,i,n,s,l;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this,a=this.state.image,i=this.state.newEvidence,Object(L.isNullOrUndefined)(a)){e.next=24;break}return n=this.props.bId+"/evidences/"+this.props.uIdHash+"_"+String(Date.now()),s=y.storage().ref(n),this.setState({isImageUploading:!0}),e.prev=7,e.next=10,s.put(a);case 10:return e.next=12,s.getDownloadURL();case 12:l=e.sent,i.evidenceLink=l,i.isImage=!0,i.imgPath=n,t.setState({isImageUploading:!1,newEvidence:i}),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(7),t.setState({isImageUploading:!1});case 22:e.next=25;break;case 24:i&&(delete i.isImage,delete i.imgPath);case 25:case"end":return e.stop()}}),e,this,[[7,19]])})));return function(){return e.apply(this,arguments)}}()},{key:"getEvidenceDraft",value:function(){var e=this;return n.a.createElement("div",null,n.a.createElement(S.d,{style:{marginTop:"10px",fontSize:"15px"}},n.a.createElement(S.b,null,n.a.createElement(S.a,null,"Url")),n.a.createElement(S.c,null,n.a.createElement("form",null,n.a.createElement("label",null,n.a.createElement(oi.a,{type:"text",placeholder:"Paste link to evidence here.",value:this.state.newEvidence.evidenceLink,onChange:function(t){e.handleChange(t,"link")},maxRows:"3",minRows:"2",style:{background:"white",borderWidth:"2px",borderStyle:"solid",borderColor:"darkgrey",paddingTop:"6px",paddingBottom:"6px",width:"60%"}}))))),n.a.createElement("form",null,n.a.createElement("label",null,n.a.createElement(oi.a,{type:"text",placeholder:"Enter relevant details about evidence here.",value:this.state.newEvidence.supportingDetails,onChange:function(t){e.handleChange(t,"details")},maxRows:"5",minRows:"3",style:{background:"white",borderWidth:"2px",borderStyle:"solid",borderColor:"darkgrey",paddingTop:"6px",paddingBottom:"6px",width:"60%"}}))),n.a.createElement("div",{className:"draft-evidence-button-container"},n.a.createElement("button",{className:"updateEvidenceButton",onClick:this.updateEvidence},n.a.createElement("div",null,"Confirm evidence")),n.a.createElement("button",{className:"removeEvidenceButton",onClick:this.removeEvidence},n.a.createElement("div",null,"Remove evidence")),n.a.createElement("button",{className:"removeEvidenceButton",onClick:this.cancelEvidenceAction},n.a.createElement("div",null,"Cancel"))))}},{key:"getEvidenceViewOnly",value:function(){var e=this;return n.a.createElement($t.a,{button:!0,onClick:function(){e.clickEvidenceNotInDraft()},style:{width:"100%",minHeight:"70px",borderTop:"1px solid darkgrey"}},n.a.createElement(Zt.a,{style:{overflow:"hidden"},primary:this.props.evidence.evidenceLink,secondary:this.props.evidence.supportingDetails}))}},{key:"render",value:function(){return n.a.createElement("div",null,this.state.isClicked?n.a.createElement("div",null,this.state.isImageUploading?n.a.createElement("div",{style:{margin:"auto",width:"50px"}},n.a.createElement(Da.a,{type:"TailSpin",color:"#00BFFF",height:"50",width:"50"})):this.getEvidenceDraft()):this.getEvidenceViewOnly())}}]),a}(n.a.Component)),pi=(a(1514),function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).state={isClicked:JSON.parse(JSON.stringify(i.props.isClicked)),newNumber:JSON.parse(JSON.stringify(i.props.number))},i.renderViewOnlyNumber=i.renderViewOnlyNumber.bind(Object(v.a)(i)),i.getNumberDraft=i.getNumberDraft.bind(Object(v.a)(i)),i.handleChange=i.handleChange.bind(Object(v.a)(i)),i.clickNumberNotInDraft=i.clickNumberNotInDraft.bind(Object(v.a)(i)),i.cancelNumber=i.cancelNumber.bind(Object(v.a)(i)),i.removeNumber=i.removeNumber.bind(Object(v.a)(i)),i.updateNumber=i.updateNumber.bind(Object(v.a)(i)),i}return Object(o.a)(a,[{key:"renderViewOnlyNumber",value:function(){return n.a.createElement("div",{className:"draftBlockNumberViewDiv"},n.a.createElement("span",{className:"draftBlockNumberViewContainer",onClick:this.clickNumberNotInDraft},n.a.createElement("span",{className:"draftBlockNumberViewKey"},this.props.number.key,":   "),n.a.createElement("b",{className:"draftBlockNumberViewValue"},this.props.number.value)))}},{key:"handleChange",value:function(e,t){var a=!0,i=e.target.value;if(Oe(i,["\n","\t"])||(a=!1),a&&"number"==t&&!function(e){return 1==e.length&&"-"==e[0]||!isNaN(e)}(i)&&(a=!1),a){var n=this.state.newNumber;"key"==t?(n.key=e.target.value,this.setState({newNumber:n})):"number"==t&&(n.value=e.target.value,this.setState({newNumber:n}))}}},{key:"clickNumberNotInDraft",value:function(){this.setState({isClicked:!0,newNumber:JSON.parse(JSON.stringify(this.props.number))})}},{key:"cancelNumber",value:function(){Object(L.isNullOrUndefined)(this.props.number)||null!=this.props.number.key?this.setState({isClicked:!1}):this.removeNumber()}},{key:"removeNumber",value:function(){var e=Object(k.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.props.updateNumber(this.props.number,null,!1,!0,this.props.index),this.setState({isClicked:!1});case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateNumber",value:function(){var e=Object(k.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(t=this.state.newNumber).value=parseFloat(t.value),isNaN(t.value)&&(t.value=0),t.key=we(t.key),0==t.key.length&&(t.key="Unknown key"),this.props.updateNumber(this.props.number,this.state.newNumber,!0,!1,this.props.index),this.setState({isClicked:!1,newNumber:t});case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getNumberDraft",value:function(){var e=this;return n.a.createElement("div",null,n.a.createElement("div",{class:"draft-number-edit-container"},n.a.createElement("form",{className:"draft-number-key-edit"},n.a.createElement("label",null,n.a.createElement(oi.a,{type:"text",placeholder:"Key",value:this.state.newNumber.key,onChange:function(t){e.handleChange(t,"key")},minRows:"1",style:{background:"white",borderWidth:"2px",borderStyle:"solid",borderColor:"darkgrey",paddingTop:"6px",paddingBottom:"6px",width:"100%"}}))),n.a.createElement("form",{className:"draft-number-value-edit"},n.a.createElement("label",null,n.a.createElement(oi.a,{type:"text",placeholder:"Number",value:this.state.newNumber.value,onChange:function(t){e.handleChange(t,"number")},minRows:"1",style:{background:"white",borderWidth:"2px",borderStyle:"solid",borderColor:"darkgrey",paddingTop:"6px",paddingBottom:"6px",width:"100%"}})))),n.a.createElement("div",{className:"draft-number-button-container"},n.a.createElement("button",{className:"updateNumberButton",onClick:this.updateNumber},n.a.createElement("div",null,"Confirm")),n.a.createElement("button",{className:"removeNumberButton",onClick:this.removeNumber},n.a.createElement("div",null,"Remove")),n.a.createElement("button",{className:"removeNumberButton",onClick:this.cancelNumber},n.a.createElement("div",null,"Cancel"))))}},{key:"render",value:function(){return n.a.createElement("div",null,this.state.isClicked?n.a.createElement("div",null,this.getNumberDraft()):n.a.createElement("div",null,this.renderViewOnlyNumber()))}}]),a}(n.a.Component)),mi=function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){return Object(r.a)(this,a),t.call(this,e)}return Object(o.a)(a,[{key:"render",value:function(){var e=this;return n.a.createElement("label",{style:{fontSize:"15px",marginRight:"25px"}},n.a.createElement("input",{type:"checkbox",checked:this.props.isChecked,onChange:function(){e.props.toggleChange(e.props.value)}}),this.props.label)}}]),a}(n.a.Component),bi=a(453),fi=a.n(bi),gi=(a(1515),function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).selectedOptionsStyles={color:"white",backgroundColor:"rgb(117, 106, 214)",borderRadius:"20px",fontSize:"0.6em",padding:"5px",maxWidth:"92%",wordWrap:"break-word"},i.optionsListStyles={backgroundColor:"darkcyan",color:"white"},i.state={monthList:[],newDate:JSON.parse(JSON.stringify(e.date))},i.monthClicked=i.monthClicked.bind(Object(v.a)(i)),i.selectedMonthBadgeClicked=i.selectedMonthBadgeClicked.bind(Object(v.a)(i)),i.validateMonth=i.validateMonth.bind(Object(v.a)(i)),i.generateMonthList=i.generateMonthList.bind(Object(v.a)(i)),i.handleChange=i.handleChange.bind(Object(v.a)(i)),i}return Object(o.a)(a,[{key:"validateMonth",value:function(e){for(var t=-1,a=1;a<e.length;a++)if(1==e[a].value){t=e[a].id;break}var i=this.state.newDate;if(-1==t){i.month;t=null,e[0].value=!0}i.month=t,this.setState({monthList:e,newDate:i}),this.props.onChange(this.state.newDate)}},{key:"handleChange",value:function(e,t){var a=!0,i=e.target.value[e.target.value.length-1];if("\n"!=i&&"\t"!=i||(a=!1),(!function(e){for(var t=0;e&&t<e.length;t++){var a=e[t];if(!(a>="1"&&a<="9"||"0"==a))return!1}return!0}(e.target.value)||e.target.value.length>8)&&"year"==t&&(a=!1),a&&"year"==t){var n=this.state.newDate;n.year=Number(e.target.value),this.setState({newDate:n}),this.props.onChange(this.state.newDate)}}},{key:"generateMonthList",value:function(){var e=["Jan","Feb","March","April","May","June","July","Aug","Sep","Oct","Nov","Dec"],t=[];t.push({id:-1,value:!1,label:"None"});for(var a=0;a<12;a++){var i=!1;this.props.date.month==a&&(i=!0),t.push({id:a,value:i,label:e[a]})}Object(L.isNullOrUndefined)(this.props.date.month)&&(t[0].value=!0),this.setState({monthList:t})}},{key:"monthClicked",value:function(e){this.validateMonth(e)}},{key:"selectedMonthBadgeClicked",value:function(e){this.validateMonth(e)}},{key:"componentDidMount",value:function(){this.generateMonthList()}},{key:"render",value:function(){var e=this;return n.a.createElement("div",{style:{display:"flex",flexWrap:"wrap"}},n.a.createElement("div",{style:{marginRight:"20px",width:"150px"}},n.a.createElement("div",{className:"monthPickerHeader"},"Month"),n.a.createElement("div",{style:{width:"80%"}},n.a.createElement(A.a,{options:this.state.monthList,optionClicked:this.monthClicked.bind(this),selectedBadgeClicked:this.selectedMonthBadgeClicked.bind(this),selectedOptionsStyles:this.selectedOptionsStyles,optionsListStyles:this.optionsListStyles,isTextWrap:!1,isSingleSelect:!0}))),n.a.createElement("div",null,n.a.createElement("div",{className:"monthPickerHeader"},"Year"),n.a.createElement("div",null,n.a.createElement("form",null,n.a.createElement("label",null,n.a.createElement(Ra.a,{type:"number",multiline:!0,value:String(this.state.newDate.year),onChange:function(t){e.handleChange(t,"year")},rowsMax:"12",rows:"1",style:{background:"transparent",textColor:"black",width:"200px"}}))))))}}]),a}(n.a.Component)),ki=a(877),vi=a.n(ki),yi=(a(1577),a(1578),n.a.forwardRef((function(e,t){return n.a.createElement(It.a,Object.assign({direction:"up",ref:t},e))}))),Ei=function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).selectedOptionsStyles={color:"white",backgroundColor:"rgb(117, 106, 214)",borderRadius:"20px",fontSize:"0.6em",padding:"5px",maxWidth:"92%",wordWrap:"break-word"},i.optionsListStyles={backgroundColor:"darkcyan",color:"white"},i.DAY=864e5,i.state={newBlock:{},canSubmit:!1,newEntity:"",multiSelectEntityList:[],addDate:!1,addTime:!1,deleteDraftBlockDialog:!1,commitDraftBlockDialog:!1,dialogType:null,dialogText:{delete:{title:"Delete block",desc:"You are about to delete this block. This action cannot be reversed.\nDo you confirm?"},commit:{title:"Add block to story",desc:"You are about to add this block to the story.\nDo you confirm?"},selected:{title:null,desc:null}},date:new Date,time:void 0,selectedDateStyle:"date",showTooltip:{draftBlockTour:JSON.parse(JSON.stringify(e.draftBlockTooltip))},tooltipText:{draftBlockTour:[{title:"Edit your block!",target:".addDateTimeButton",content:"You can now edit each aspect of your block here. Click on the blue info icons to learn more about the various aspects of your block such as date-time, entities and evidences.",disableBeacon:!0,placement:"center"},{title:"Add block to your story after editing!",target:".commitBlockTooltip",content:"After editing, click this button to add to story!",disableBeacon:!0,placementBeacon:"left",event:"hover"}]},adhocTooltip:{datetime:{flag:!1,text:[{title:"Add date and time",target:".tooltipDatetime",content:"If the content of your block describes some event (someones birth, the creation of a company, a terrorist attack, etc.) that is associated with some date and time, then add that to the block. This enables your block to appear in the Timeline visualisation that shows the chronological view of your story.",disableBeacon:!0}]},entities:{flag:!1,text:[{title:"Tag entities/characters!",target:".tooltipEntities",content:"Your block will be associated with some characters of the entire story. You can tag those characters (or entities) here. Typically, some entities are autodetected in the text and tagged when you create the block. The entities from these tags appear in the Graph visualisation of your story that show how your story's characters are connected with one-another. Your block will also show up in the Graph visualisation if the viewer clicks on the entities that are tagged.",disableBeacon:!0}]},evidences:{flag:!1,text:[{title:"Add evidences!",target:".tooltipEvidences",content:"You may want to add authenticity to your block's content by adding evidences that is visible to any viewer. You have to provide a link to the actual evidence that viewers of the story can click and navigate to. If your evidence is a picture (a chart), then add the link of the picture here so that the viewers of the story can see it when they click on your block.",disableBeacon:!0}]},numbers:{flag:!1,text:[{title:"Add relevant numbers!",target:".tooltipNumbers",content:"You may have some numbers, like money, headcount, etc., that you want to associate with this block.",disableBeacon:!0}]}}},i.handleChange=i.handleChange.bind(Object(v.a)(i)),i.changeDateStatus=i.changeDateStatus.bind(Object(v.a)(i)),i.changeTimeStatus=i.changeTimeStatus.bind(Object(v.a)(i)),i.renderDate=i.renderDate.bind(Object(v.a)(i)),i.renderTime=i.renderTime.bind(Object(v.a)(i)),i.renderTimeOption=i.renderTimeOption.bind(Object(v.a)(i)),i.generateMultiSelectEntityList=i.generateMultiSelectEntityList.bind(Object(v.a)(i)),i.makeEntityUppercase=i.makeEntityUppercase.bind(Object(v.a)(i)),i.addEntityToList=i.addEntityToList.bind(Object(v.a)(i)),i.handleKeyDown=i.handleKeyDown.bind(Object(v.a)(i)),i.updateEvidence=i.updateEvidence.bind(Object(v.a)(i)),i.updateNumber=i.updateNumber.bind(Object(v.a)(i)),i.addEvidence=i.addEvidence.bind(Object(v.a)(i)),i.addNumber=i.addNumber.bind(Object(v.a)(i)),i.singleBlockEvidence=i.singleBlockEvidence.bind(Object(v.a)(i)),i.singleBlockNumber=i.singleBlockNumber.bind(Object(v.a)(i)),i.commitDraftBlock=i.commitDraftBlock.bind(Object(v.a)(i)),i.saveDraftBlock=i.saveDraftBlock.bind(Object(v.a)(i)),i.submitDraftBlock=i.submitDraftBlock.bind(Object(v.a)(i)),i.cancelDraftBlock=i.cancelDraftBlock.bind(Object(v.a)(i)),i.removeDraftBlock=i.removeDraftBlock.bind(Object(v.a)(i)),i.populateEntitiesAndEvidencesToBlock=i.populateEntitiesAndEvidencesToBlock.bind(Object(v.a)(i)),i.showLocalTooltip=i.showLocalTooltip.bind(Object(v.a)(i)),i.handleAdhocTooltipJoyrideCallback=i.handleAdhocTooltipJoyrideCallback.bind(Object(v.a)(i)),i.isDateChecked=i.isDateChecked.bind(Object(v.a)(i)),i.toggleDateStyle=i.toggleDateStyle.bind(Object(v.a)(i)),i.toggleDeleteBlockDialog=i.toggleDeleteBlockDialog.bind(Object(v.a)(i)),i.performAction=i.performAction.bind(Object(v.a)(i)),i}return Object(o.a)(a,[{key:"changeDateStatus",value:function(){var e=this.state.addDate,t=this.state.newBlock,a=new Date;e?delete t.blockDate:t.blockDate={date:a.getDate(),month:a.getMonth(),year:a.getFullYear()},this.setState({addDate:!e,newBlock:t,date:a})}},{key:"changeTimeStatus",value:function(){var e=this.state.addTime,t=this.state.newBlock,a=new Date,i={hour:a.getHours(),minute:a.getMinutes()};e?delete t.blockTime:t.blockTime={hours:i.hour,minutes:i.minute,time:i},this.setState({addTime:!e,newBlock:t,time:i})}},{key:"entityClicked",value:function(e){this.setState({multiSelectEntityList:e})}},{key:"selectedBadgeClicked",value:function(e){this.setState({multiSelectEntityList:e})}},{key:"generateMultiSelectEntityList",value:function(){for(var e=1,t=this.state.multiSelectEntityList,a=this.props.draftBlock.entities,i={},n={},s=0;s<a.length;s++)t.push({value:!0,label:a[s].title,id:e}),e++,n[a[s].title]="",i[a[s].title]="";Object.keys(this.props.investigationGraph).forEach((function(a){a in i||(t.push({value:!1,label:a,id:e}),e++,n[a]="")}));var l=this.props.entityPane;for(s=0;s<l.length;s++){var r=!1,o=l[s].label;o in i&&(r=!0),o in n||(t.push({value:r,label:o,id:e}),e++)}t.sort((function(e,t){return e.label.toLocaleLowerCase()<t.label.toLocaleLowerCase()?-1:1})),this.setState({multiSelectEntityList:t})}},{key:"handleKeyDown",value:function(e){if("Enter"===e.key){for(var t=e.target.value.split(","),a=0;a<t.length;a++){var i=t[a].trim();i.length>0&&this.addEntityToList(i)}i="",this.setState({newEntity:i})}}},{key:"makeEntityUppercase",value:function(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}},{key:"addEntityToList",value:function(e){e=this.makeEntityUppercase(e);for(var t=!1,a=this.state.multiSelectEntityList,i=this.state.newBlock,n=-1,s=0;s<a.length;s++){if(a[s].label==e){t=!0,n=s;break}}if(t||"all"==e.toLowerCase()||"none"==e.toLowerCase())t&&"all"!=e.toLowerCase()&&"none"!=e.toLowerCase()&&(a[n].value=!0,Object(L.isNullOrUndefined)(i.entities)&&(i.entities=[]),i.entities.push({title:a[n].label}),this.setState({multiSelectEntityList:a,newBlock:i,newEntity:""}));else{var l=a.length;l+=1,a.push({value:!0,label:e,id:l}),Object(L.isNullOrUndefined)(i.entities)&&(i.entities=[]),i.entities.push({title:e}),this.setState({multiSelectEntityList:a,newBlock:i,newEntity:""})}}},{key:"handleChange",value:function(e,t){var a=!0;if("date"!=t&&"time"!=t){var i=e.target.value;Oe(i,"\n\t")||(a=!1)}if(a){var n=this.state.newBlock;"title"==t?(n.title=e.target.value,this.setState({newBlock:n})):"summary"==t?(n.summary=e.target.value,this.setState({newBlock:n})):"new-entity"==t?this.setState({newEntity:e.target.value}):"date"==t?("date"==this.state.selectedDateStyle?n.blockDate={date:e.getDate(),month:e.getMonth(),year:e.getFullYear()}:n.blockDate={date:null,month:e.month,year:e.year},this.setState({date:e,newBlock:n})):"time"==t&&(n.blockTime={minutes:e.minute,hours:e.hour24},this.setState({time:e,newBlock:n}))}}},{key:"updateEvidence",value:function(e,t,a,i,n){var s=this.state.newBlock;if(Object(L.isNullOrUndefined)(s.evidences)&&(s.evidences=[]),i){for(var l=[],r=0;r<s.evidences.length;r++)r!=n&&l.push(s.evidences[r]);s.evidences=l}else a&&(s.evidences[n]=t);this.setState({newBlock:s})}},{key:"updateNumber",value:function(e,t,a,i,n){var s=this.state.newBlock;if(Object(L.isNullOrUndefined)(s.numbers)&&(s.numbers=[]),i){for(var l=[],r=0;r<s.numbers.length;r++)r!=n&&l.push(s.numbers[r]);s.numbers=l}else a&&(s.numbers[n]=t);s.numbers=Be(s.numbers),this.setState({newBlock:s})}},{key:"addEvidence",value:function(){var e=this.state.newBlock;Object(L.isNullOrUndefined)(e.evidences)&&(e.evidences=[]),e.evidences.push({evidenceLink:"",evidenceType:"",supportingDetails:""}),this.setState({newBlock:e})}},{key:"addNumber",value:function(){var e=this.state.newBlock;Object(L.isNullOrUndefined)(e.numbers)&&(e.numbers=[]),e.numbers.push({key:null,value:0}),this.setState({newBlock:e})}},{key:"singleBlockEvidence",value:function(e,t){var a=""==e.supportingDetails&&""==e.evidenceLink;return n.a.createElement(hi,{isClicked:a,evidence:e,updateEvidence:this.updateEvidence,index:t,bId:this.props.bId,uIdHash:this.props.uIdHash})}},{key:"singleBlockNumber",value:function(e,t){var a=Object(L.isNullOrUndefined)(e.key);return n.a.createElement(pi,{isClicked:a,index:t,number:e,updateNumber:this.updateNumber})}},{key:"populateEntitiesAndEvidencesToBlock",value:function(){var e=this.state.newBlock;e.entities=[];for(var t=this.state.multiSelectEntityList,a=0;a<t.length;a++)t[a].value&&e.entities.push({title:t[a].label,type:"None"});Object(L.isNullOrUndefined)(e.evidences)&&(e.evidences=[]),this.setState({newBlock:e})}},{key:"saveDraftBlock",value:function(){this.populateEntitiesAndEvidencesToBlock(),this.props.updateBlock(this.state.newBlock,this.props.draftBlock,"SAVE")}},{key:"commitDraftBlock",value:function(){this.populateEntitiesAndEvidencesToBlock(),this.props.updateBlock(this.state.newBlock,this.props.draftBlock,"COMMIT")}},{key:"submitDraftBlock",value:function(){this.populateEntitiesAndEvidencesToBlock(),this.props.updateBlock(this.state.newBlock,this.props.draftBlock,"SUBMIT")}},{key:"cancelDraftBlock",value:function(){this.props.updateBlock(this.state.newBlock,this.props.draftBlock,"CANCEL")}},{key:"removeDraftBlock",value:function(){this.props.updateBlock(this.state.newBlock,this.props.draftBlock,"DELETE")}},{key:"isDateChecked",value:function(e){return e==this.state.selectedDateStyle}},{key:"toggleDateStyle",value:function(e){var t=this.state.newBlock,a=this.state.date,i=this.state.addTime;"month"==e&&"month"!=this.state.selectedDateStyle?t.blockDate&&(t.blockDate.date=null,a.setFullYear(t.blockDate.year),a.setMonth(t.blockDate.month),a.setDate(0),a.setHours(0),a.setMinutes(0),delete t.blockTime,i=!1):"date"==e&&"date"!=this.state.selectedDateStyle&&t.blockDate&&(a=new Date,t.blockDate.date=1,Object(L.isNullOrUndefined)(t.blockDate.month)&&(t.blockDate.month=0),a.setFullYear(t.blockDate.year),a.setMonth(t.blockDate.month),a.setDate(1)),this.setState({selectedDateStyle:e,date:a,newBlock:t,addTime:i})}},{key:"renderDate",value:function(){var e=this;return n.a.createElement("div",{style:{marginBottom:"15px"}},this.state.addDate?n.a.createElement("div",null,n.a.createElement("div",null,n.a.createElement(mi,{value:"date",isChecked:this.isDateChecked("date"),label:"Complete date",toggleChange:this.toggleDateStyle}),n.a.createElement(mi,{value:"month",isChecked:this.isDateChecked("month"),label:"Only month/year",toggleChange:this.toggleDateStyle})),"date"==this.state.selectedDateStyle?n.a.createElement("div",{style:{marginTop:"5px"}},n.a.createElement(fi.a,{selected:this.state.date,onChange:function(t){e.handleChange(t,"date")}})):null,"month"==this.state.selectedDateStyle?n.a.createElement("div",{style:{marginTop:"5px"}},n.a.createElement(gi,{date:this.state.newBlock.blockDate,onChange:function(t){e.handleChange(t,"date")}})):null):null)}},{key:"renderTime",value:function(){var e=this;return n.a.createElement("div",null,this.state.addTime?n.a.createElement("div",null,n.a.createElement(vi.a,{time:this.state.time,onChange:function(t){return e.handleChange(t,"time")}})):null)}},{key:"renderTimeOption",value:function(){return n.a.createElement("div",{style:{marginTop:"5px",marginBottom:"5px"}},n.a.createElement("span",{style:{fontSize:"0.8em",fontWeight:"bold",marginRight:"1em"}}," Time: "),n.a.createElement(rt.a,{variant:"contained",className:"addDateTimeButton",onClick:this.changeTimeStatus},this.state.addTime?n.a.createElement("div",null,"Remove time"):n.a.createElement("div",null,"Add time")),this.renderTime())}},{key:"showLocalTooltip",value:function(e){var t=this.state.adhocTooltip;"datetime"==e?t.datetime.flag=!0:"entities"==e?t.entities.flag=!0:"evidences"==e?t.evidences.flag=!0:"numbers"==e&&(t.numbers.flag=!0),this.setState({adhocTooltip:t})}},{key:"handleAdhocTooltipJoyrideCallback",value:function(e,t){e.action,e.index;var a=e.status;e.type;if([O.a.FINISHED,O.a.SKIPPED].includes(a)){var i=this.state.adhocTooltip;"datetime"==t?i.datetime.flag=!1:"entities"==t?i.entities.flag=!1:"evidences"==t?i.evidences.flag=!1:"numbers"==t&&(i.numbers.flag=!1),this.setState({adhocTooltip:i})}}},{key:"EditSingleBlock",value:function(e,t){var a=this,i="";Object(L.isNullOrUndefined)(this.state.newBlock.evidences)||(i=this.state.newBlock.evidences.map((function(e,t){return a.singleBlockEvidence(e,t)})));var s="";Object(L.isNullOrUndefined)(this.state.newBlock.numbers)||(s=this.state.newBlock.numbers.map((function(e,t){return a.singleBlockNumber(e,t)})));var l="";return this.state.newBlock.actionType&&(l=this.state.newBlock.actionType),n.a.createElement("div",{className:"draft-block-container "+("MODIFY"==l?"draft-block-color-MODIFY":"")+("ADD"==l?"draft-block-color-ADD":"")},"MODIFY"==this.state.newBlock.actionType?n.a.createElement("div",{className:"draftBlocksPaneTitle"},"Modify block"):n.a.createElement("div",{className:"draftBlocksPaneTitle"},"Edit block"),0==this.props.bpDetails.criterion?n.a.createElement("div",null,n.a.createElement("p",{className:"openTooltipTextContainer"},"Click on ",n.a.createElement("a",{className:"tooltip-selection",onClick:function(){return a.toggleDeleteBlockDialog(!0,"commit")}},"Add to story")," to add your block to the story. ",n.a.createElement("br",null),n.a.createElement("br",null))):null,n.a.createElement("div",{className:"draft-options-container",style:{marginTop:"0.1em"}},0==this.props.bpDetails.criterion?n.a.createElement("div",null,n.a.createElement(rt.a,{variant:"contained",className:"commitBlockButton commitBlockTooltip",onClick:function(){return a.toggleDeleteBlockDialog(!0,"commit")}},n.a.createElement("div",{className:"buttonDraftGeneral"},"Add to story"))):null,n.a.createElement("div",null,n.a.createElement(rt.a,{variant:"contained",className:"saveBlockButton",onClick:this.saveDraftBlock},n.a.createElement("div",{className:"buttonDraftGeneral"},"Save as Draft"))),this.state.canSubmit?n.a.createElement("div",null,n.a.createElement(rt.a,{variant:"contained",className:"submitBlockButton",onClick:this.submitDraftBlock},n.a.createElement("div",{className:"buttonDraftGeneral"},"Submit"))):null,n.a.createElement("div",null,n.a.createElement(rt.a,{variant:"contained",className:"cancelBlockBackButton",onClick:this.cancelDraftBlock},n.a.createElement("div",{className:"buttonDraftGeneral"},"Cancel"))),n.a.createElement("div",null,n.a.createElement(rt.a,{variant:"contained",className:"deleteBlockButton",onClick:function(){return a.toggleDeleteBlockDialog(!0,"delete")}},n.a.createElement("div",{className:"buttonDraftGeneral"},"Delete")))),n.a.createElement("form",null,n.a.createElement("label",null,n.a.createElement(Ra.a,{type:"text",variant:"outlined",multiline:!0,placeholder:"Title of your contribution.",value:this.state.newBlock.title,onChange:function(e){a.handleChange(e,"title")},rowsMax:"2",rowsMin:"1",style:{background:"white",marginTop:"6px",marginBottom:"6px",width:"95%"}}),n.a.createElement(Ra.a,{type:"text",variant:"outlined",multiline:!0,placeholder:"Content of your contribution.",value:this.state.newBlock.summary,onChange:function(e){a.handleChange(e,"summary")},rowsMax:"13",rows:"3",style:{background:"white",marginTop:"6px",marginBottom:"6px",width:"95%"}}))),n.a.createElement("div",{className:"draft-box-datetime-container"},n.a.createElement("h6",{style:{marginBottom:"3px",fontSize:"19px"}},"Add relevant date/time",n.a.createElement("a",{className:"tooltipDatetime tooltips-draft",onClick:function(e){a.showLocalTooltip("datetime")}},n.a.createElement(T.a,{style:{fontSize:"19px"}})),n.a.createElement(O.b,{styles:{options:{arrowColor:"#e3ffeb",beaconSize:"4em",primaryColor:"#05878B",backgroundColor:"#e3ffeb",overlayColor:"rgba(10,10,10, 0.4)",width:900,zIndex:1e3}},steps:this.state.adhocTooltip.datetime.text,run:this.state.adhocTooltip.datetime.flag,callback:function(e){a.handleAdhocTooltipJoyrideCallback(e,"datetime")}})),n.a.createElement("div",{style:{marginTop:"5px",marginBottom:"5px"}},n.a.createElement("span",{style:{fontSize:"0.8em",fontWeight:"bold",marginRight:"1em"}}," Date: "),n.a.createElement(rt.a,{variant:"contained",className:"addDateTimeButton",onClick:this.changeDateStatus},this.state.addDate?n.a.createElement("div",null,"Remove date"):n.a.createElement("div",null,"Add Date")),this.renderDate()),this.state.addDate&&"date"==this.state.selectedDateStyle?this.renderTimeOption():null),n.a.createElement("div",{className:"draft-box-entity-dropdown-container"},n.a.createElement("h6",{style:{marginBottom:"3px",fontSize:"19px"}},"Tag entities/characters",n.a.createElement("a",{className:"tooltipEntities tooltips-draft",onClick:function(e){a.showLocalTooltip("entities")}},n.a.createElement(T.a,{style:{fontSize:"19px"}})),n.a.createElement(O.b,{styles:{options:{arrowColor:"#e3ffeb",beaconSize:"4em",primaryColor:"#05878B",backgroundColor:"#e3ffeb",overlayColor:"rgba(10,10,10, 0.4)",width:900,zIndex:1e3}},steps:this.state.adhocTooltip.entities.text,run:this.state.adhocTooltip.entities.flag,callback:function(e){a.handleAdhocTooltipJoyrideCallback(e,"entities")}})),n.a.createElement(A.a,{options:this.state.multiSelectEntityList,optionClicked:this.entityClicked.bind(this),selectedBadgeClicked:this.selectedBadgeClicked.bind(this),selectedOptionsStyles:this.selectedOptionsStyles,optionsListStyles:this.optionsListStyles,isTextWrap:!1}),n.a.createElement("div",{className:"draft-add-new-entity-container"},n.a.createElement(Ra.a,{type:"text",variant:"outlined",multiline:!0,value:this.state.newEntity,onChange:function(e){a.handleChange(e,"new-entity")},onKeyDown:function(e){a.handleKeyDown(e)},placeholder:"Type entity tags seperated by commas and press 'Enter'",rowsMax:"2",rows:"1",style:{background:"white",marginTop:"6px",marginBottom:"6px",minWidth:"60%",maxWidth:"90%"}})),n.a.createElement("div",null,n.a.createElement("p",{style:{fontSize:"12px"}},"Type entity tags seperated by commas (eg: Black Widow,Thor,Ironman) and press 'Enter'"))),n.a.createElement("div",{className:"draft-box-evidence-container"},n.a.createElement("h6",{style:{marginBottom:"3px",marginTop:"3px",fontSize:"19px"}},"Add evidences",n.a.createElement("a",{className:"tooltipEvidences tooltips-draft",onClick:function(e){a.showLocalTooltip("evidences")}},n.a.createElement(T.a,{style:{fontSize:"19px"}})),n.a.createElement(O.b,{styles:{options:{arrowColor:"#e3ffeb",beaconSize:"4em",primaryColor:"#05878B",backgroundColor:"#e3ffeb",overlayColor:"rgba(10,10,10, 0.4)",width:900,zIndex:1e3}},steps:this.state.adhocTooltip.evidences.text,run:this.state.adhocTooltip.evidences.flag,callback:function(e){a.handleAdhocTooltipJoyrideCallback(e,"evidences")}})),n.a.createElement(rt.a,{variant:"contained",className:"addEvidenceButton",onClick:this.addEvidence},n.a.createElement("div",null,"Add new evidence")),n.a.createElement("div",null,i)),n.a.createElement("div",{className:"draft-box-number-container"},n.a.createElement("h6",{style:{marginBottom:"3px",marginTop:"3px",fontSize:"19px"}},"Add relevant numbers",n.a.createElement("a",{className:"tooltipNumbers tooltips-draft",onClick:function(e){a.showLocalTooltip("numbers")}},n.a.createElement(T.a,{style:{fontSize:"19px"}})),n.a.createElement(O.b,{styles:{options:{arrowColor:"#e3ffeb",beaconSize:"4em",primaryColor:"#05878B",backgroundColor:"#e3ffeb",overlayColor:"rgba(10,10,10, 0.4)",width:900,zIndex:1e3}},steps:this.state.adhocTooltip.numbers.text,run:this.state.adhocTooltip.numbers.flag,callback:function(e){a.handleAdhocTooltipJoyrideCallback(e,"numbers")}})),n.a.createElement(rt.a,{variant:"contained",className:"addNumberButton",onClick:this.addNumber},n.a.createElement("div",null,"Add new number")),n.a.createElement("div",null,s)),n.a.createElement("div",{className:"draft-options-container",style:{marginTop:"0.1em"}},0==this.props.bpDetails.criterion?n.a.createElement(rt.a,{variant:"contained",className:"commitBlockButton",onClick:function(){return a.toggleDeleteBlockDialog(!0,"commit")}},n.a.createElement("div",{className:"buttonDraftGeneral"},"Add to story")):null,n.a.createElement(rt.a,{variant:"contained",className:"saveBlockButton",onClick:this.saveDraftBlock},n.a.createElement("div",{className:"buttonDraftGeneral"},"Save as Draft")),this.state.canSubmit?n.a.createElement(rt.a,{variant:"contained",className:"submitBlockButton",onClick:this.submitDraftBlock},n.a.createElement("div",{className:"buttonDraftGeneral"},"Submit")):null,n.a.createElement(rt.a,{variant:"contained",className:"cancelBlockBackButton",onClick:this.cancelDraftBlock},n.a.createElement("div",{className:"buttonDraftGeneral"},"Cancel")),n.a.createElement(rt.a,{variant:"contained",className:"deleteBlockButton",onClick:function(){return a.toggleDeleteBlockDialog(!0,"delete")}},n.a.createElement("div",{className:"buttonDraftGeneral"},"Delete"))),0==this.props.bpDetails.criterion?n.a.createElement("div",null,n.a.createElement("p",{className:"openTooltipTextContainer"},"Click on ",n.a.createElement("a",{className:"tooltip-selection",onClick:function(){return a.toggleDeleteBlockDialog(!0,"commit")}},"Add to story")," to add your block to the story. ",n.a.createElement("br",null),n.a.createElement("br",null))):null)}},{key:"componentDidMount",value:function(){this.generateMultiSelectEntityList();var e=JSON.stringify(this.props.draftBlock),t=JSON.parse(e),a=new Date,i=void 0,n=!1,s=!1,l="date";"blockDate"in t&&null!=t.blockDate&&(a.setFullYear(t.blockDate.year),a.setMonth(t.blockDate.month),Object(L.isNullOrUndefined)(t.blockDate.date)?(a.setDate(0),l="month"):a.setDate(t.blockDate.date),a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0),n=!0,"blockTime"in t&&null!=t.blockTime&&(i={hour:t.blockTime.hours,minute:t.blockTime.minutes},s=!0)),this.setState({newBlock:JSON.parse(e),date:a,addDate:n,addTime:s,time:i,selectedDateStyle:l})}},{key:"toggleDeleteBlockDialog",value:function(e,t){var a=this.state.dialogText;"delete"==t?(a.selected.title=a.delete.title,a.selected.desc=a.delete.desc):"commit"==t&&(a.selected.title=a.commit.title,a.selected.desc=a.commit.desc),this.setState({deleteDraftBlockDialog:e,dialogType:t})}},{key:"performAction",value:function(e){"delete"==e?this.removeDraftBlock():"commit"==e&&this.commitDraftBlock()}},{key:"render",value:function(){var e=this;return n.a.createElement("div",null,n.a.createElement(O.b,{styles:{options:{arrowColor:"#e3ffeb",beaconSize:"3em",primaryColor:"#05878B",backgroundColor:"#e3ffeb",overlayColor:"rgba(10,10,10, 0.4)",width:900,zIndex:1e3}},steps:this.state.tooltipText.draftBlockTour,run:this.state.showTooltip.draftBlockTour}),n.a.createElement(Xa.a,{open:this.state.deleteDraftBlockDialog,TransitionComponent:yi,keepMounted:!0,onClose:function(){return e.toggleDeleteBlockDialog(!1,"delete")},"aria-labelledby":"alert-dialog-slide-title","aria-describedby":"alert-dialog-slide-description"},n.a.createElement(ei.a,{id:"alert-dialog-slide-title"},this.state.dialogText.selected.title),n.a.createElement($a.a,null,n.a.createElement(Za.a,{id:"alert-dialog-slide-description"},this.state.dialogText.selected.desc)),n.a.createElement(Qa.a,null,n.a.createElement(rt.a,{onClick:function(){return e.toggleDeleteBlockDialog(!1,e.state.dialogType)},color:"primary"},"No"),n.a.createElement(rt.a,{onClick:function(){return e.performAction(e.state.dialogType)},color:"primary"},"Yes"))),this.EditSingleBlock())}}]),a}(n.a.Component),Si=function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).state={isBlockClicked:!1},i.BlockEntity=i.BlockEntity.bind(Object(v.a)(i)),i.clickBlockInDraft=i.clickBlockInDraft.bind(Object(v.a)(i)),i.revertBlockInDraft=i.revertBlockInDraft.bind(Object(v.a)(i)),i.clickBlockNotInDraft=i.clickBlockNotInDraft.bind(Object(v.a)(i)),i.updateDraftBlock=i.updateDraftBlock.bind(Object(v.a)(i)),i}return Object(o.a)(a,[{key:"BlockEntity",value:function(e){return n.a.createElement("span",{className:"user-block-entity"},e.title)}},{key:"clickBlockNotInDraft",value:function(e){this.props.isMultiSelect||this.props.selectBlock(e)}},{key:"renderViewOnlyBlock",value:function(){var e=this;return null!=this.props.block.entities&&this.props.block.entities.length>0&&this.props.block.entities.map((function(t){return e.BlockEntity(t)})),n.a.createElement($t.a,{button:!0,onClick:function(){e.clickBlockNotInDraft(e.props.block)},style:{width:"100%"}},n.a.createElement(Zt.a,{primary:this.props.block.title,secondary:this.props.block.summary}))}},{key:"clickBlockInDraft",value:function(){if(this.props.isMultiSelect){var e=this.props.block.key;this.props.multiSelectBlocks(e)}else this.state.isBlockClicked||this.setState({isBlockClicked:!0}),this.props.block.key!=this.props.selectedDraftBlockId&&this.props.changeSelectedBlock(this.props.block.key)}},{key:"revertBlockInDraft",value:function(){this.state.isBlockClicked&&this.setState({isBlockClicked:!1})}},{key:"renderDraftBlock",value:function(){var e=this,t="";return this.props.block&&(t=this.props.block.actionType),n.a.createElement("div",null,this.props.selectedDraftBlockId==this.props.block.key?n.a.createElement("div",null,n.a.createElement(Ei,{draftBlock:this.props.block,investigationGraph:this.props.investigationGraph,updateBlock:this.updateDraftBlock,entityPane:this.props.entityPane,draftBlockTooltip:this.props.draftBlockTooltip,finishTooltip:this.props.finishTooltip,bpDetails:this.props.bpDetails,bId:this.props.bId,uIdHash:this.props.uIdHash})):n.a.createElement("div",{className:("MODIFY"!=t||this.props.isMultiSelect?"":"user-block-color-MODIFY")+("ADD"!=t||this.props.isMultiSelect?"":"user-block-color-ADD")+(this.props.isMultiSelect&&!this.props.isBlockSelectedInMultiselect?"user-block-color-multiselect-UNSELECTED":"")+(this.props.isMultiSelect&&this.props.isBlockSelectedInMultiselect?"user-block-color-multiselect-SELECTED":"")},n.a.createElement($t.a,{button:!0,onClick:function(){e.clickBlockInDraft()},style:{width:"100%"}},n.a.createElement(Zt.a,{primary:this.props.block.title,secondary:this.props.block.summary}))))}},{key:"updateDraftBlock",value:function(e,t,a){"SAVE"==a?(this.props.isNewBlock?this.props.addDraftBlock(e):this.props.updateDraftBlock(e.key,e),this.setState({isBlockClicked:!1}),this.props.changeSelectedBlock(null)):"COMMIT"==a?this.props.commitBlockToBlockprobe(e):"SUBMIT"==a?(delete e.children,this.props.submitDraftBlock(e),this.setState({isBlockClicked:!1}),this.props.changeSelectedBlock(null)):"CANCEL"==a?this.props.isNewBlock?this.props.deleteNewBlock():(this.setState({isBlockClicked:!1}),this.props.changeSelectedBlock(null)):"DELETE"==a&&(this.props.isNewBlock?this.props.deleteNewBlock():(this.props.deleteDraftBlock(e.key),this.setState({isBlockClicked:!1}),this.props.changeSelectedBlock(null)))}},{key:"render",value:function(){return n.a.createElement("div",null,"DRAFT"==this.props.block.blockState?this.renderDraftBlock():this.renderViewOnlyBlock())}}]),a}(n.a.Component),Oi=(a(1619),a(1620),function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).state={text:"none",loadingText:!1,fileName:null,pictures:[],showPreview:!0},i.functions=y.functions(),i.onDrop=i.onDrop.bind(Object(v.a)(i)),i.uploadOcrFileToDb=i.uploadOcrFileToDb.bind(Object(v.a)(i)),i.getText=i.getText.bind(Object(v.a)(i)),i.canSubmit=i.canSubmit.bind(Object(v.a)(i)),i.clickSubmit=i.clickSubmit.bind(Object(v.a)(i)),i.togglePreviewImages=i.togglePreviewImages.bind(Object(v.a)(i)),i}return Object(o.a)(a,[{key:"uploadOcrFileToDb",value:function(){var e=Object(k.a)(f.a.mark((function e(t,a){var i,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this,i=this.props.bId+"/users/"+this.props.uId+"/ocr_"+String(a),n=y.storage().ref(i),e.prev=3,e.next=6,n.put(t);case 6:e.next=10;break;case 8:e.prev=8,e.t0=e.catch(3);case 10:case"end":return e.stop()}}),e,this,[[3,8]])})));return function(t,a){return e.apply(this,arguments)}}()},{key:"getText",value:function(){var e=Object(k.a)(f.a.mark((function e(t,a,i){var n,s,l,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(ui.a)(t,a);case 2:return n=e.sent,URL.createObjectURL(n),s="",e.prev=5,e.next=8,this.uploadOcrFileToDb(n,i);case 8:return l=this.functions.httpsCallable("ocrTextExtraction"),e.next=11,l({bpId:this.props.bId,userId:this.props.uId,index:i});case 11:r=e.sent,s=r.data,s=ye(s),s+="\n\n",e.next=20;break;case 17:e.prev=17,e.t0=e.catch(5),s="";case 20:return e.abrupt("return",s);case 21:case"end":return e.stop()}}),e,this,[[5,17]])})));return function(t,a,i){return e.apply(this,arguments)}}()},{key:"onDrop",value:function(e){this.setState({pictures:e})}},{key:"clickSubmit",value:function(){var e=Object(k.a)(f.a.mark((function e(){var t,a,i,n,s,l,r,o,c;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=this.state.pictures,a={maxSizeMB:1,useWebWorker:!0},this.setState({loadingText:!0}),i="",n=[],s=0;s<t.length;s++)try{l=t[s],s!=t.length-1||Object(L.isNullOrUndefined)(l.name)||(i=l.name),r=this.getText(l,a,s),n.push(r)}catch(d){console.log(d)}return e.next=8,Promise.all(n);case 8:for(o=e.sent,c=0;c<o.length;c++)!Object(L.isNullOrUndefined)(o[c])&&o[c].length>0&&this.props.addText(o[c]);this.setState({loadingText:!1,fileName:i});case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"canSubmit",value:function(){return this.state.pictures.length>0}},{key:"togglePreviewImages",value:function(){this.setState({showPreview:!this.state.showPreview})}},{key:"render",value:function(){return n.a.createElement("div",null,this.state.loadingText?n.a.createElement("div",null,n.a.createElement("div",{style:{margin:"auto",width:"50px"}},n.a.createElement(Da.a,{type:"TailSpin",color:"#00BFFF",height:"50",width:"50"})),n.a.createElement("div",{style:{padding:"3px",textAlign:"center"}},n.a.createElement("p",{className:"processingOcrText"},"Your image is being processed. This may take 15 seconds or more to complete."))):n.a.createElement("div",null,n.a.createElement("div",{style:{textAlign:"center"}},this.canSubmit()?n.a.createElement("button",{className:"converOcrButton",onClick:this.clickSubmit},"Save"):null),n.a.createElement("div",{style:{marginLeft:"1em"}},n.a.createElement(mi,{value:"showPreview",isChecked:this.state.showPreview,label:"Preview images",toggleChange:this.togglePreviewImages})),n.a.createElement(di.a,{withIcon:!0,buttonText:"Choose image",onChange:this.onDrop,singleImage:!0,imgExtension:[".jpg",".gif",".png",".gif"],maxFileSize:5242880,withPreview:this.state.showPreview}),Object(L.isNullOrUndefined)(this.state.fileName)?null:n.a.createElement("div",{style:{textAlign:"center"}},n.a.createElement("p",{className:"processingOcrText"},"Your last image upload was ",n.a.createElement("span",{style:{color:"blue"}},this.state.fileName),"."))))}}]),a}(n.a.Component)),Bi=(a(1621),function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).state={url:"",loadingText:!1},i.functions=y.functions(),i.handleChange=i.handleChange.bind(Object(v.a)(i)),i.isValidLink=i.isValidLink.bind(Object(v.a)(i)),i.getArticleText=i.getArticleText.bind(Object(v.a)(i)),i}return Object(o.a)(a,[{key:"getArticleText",value:function(){var e=Object(k.a)(f.a.mark((function e(){var t,a,i,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loadingText:!0}),e.prev=1,t=this.state.url,a=this.functions.httpsCallable("articleTextExtraction"),i="",e.prev=5,e.next=8,a({url:t});case 8:n=e.sent,i=n.data.content+"\n\n",e.next=15;break;case 12:e.prev=12,e.t0=e.catch(5),i="";case 15:return e.prev=15,e.finish(15);case 17:this.props.addText(i),this.setState({loadingText:!1}),e.next=24;break;case 21:e.prev=21,e.t1=e.catch(1),this.setState({loadingText:!1});case 24:return e.prev=24,e.finish(24);case 26:case"end":return e.stop()}}),e,this,[[1,21,24,26],[5,12,15,17]])})));return function(){return e.apply(this,arguments)}}()},{key:"handleChange",value:function(e,t){var a=!0,i=e.target.value[e.target.value.length-1];if("\n"!=i&&"\t"!=i||(a=!1),a){var n=this.state.url;"url"==t&&(n=e.target.value,this.setState({url:n}))}}},{key:"isValidLink",value:function(){return""!=this.state.url.trim()}},{key:"render",value:function(){var e=this;return n.a.createElement("div",null,this.state.loadingText?n.a.createElement("div",null,n.a.createElement("div",{style:{margin:"auto",width:"50px"}},n.a.createElement(Da.a,{type:"TailSpin",color:"#00BFFF",height:"50",width:"50"})),n.a.createElement("div",{style:{padding:"3px",textAlign:"center"}},n.a.createElement("p",{className:"processingArticleLinkText"},"Your link is being processed. Kindly wait for a few moments."))):n.a.createElement("div",null,n.a.createElement("form",{className:"articleLinkForm"},n.a.createElement("label",null,n.a.createElement(oi.a,{type:"text",placeholder:"Paste link to article here.",value:this.state.url,onChange:function(t){e.handleChange(t,"url")},maxRows:"1",minRows:"1",style:{background:"white",borderWidth:"2px",borderStyle:"solid",borderColor:"darkgrey",paddingTop:"6px",paddingBottom:"6px",width:"96%"}}))),this.isValidLink()?n.a.createElement("button",{className:"submitArticleLinkButton",onClick:this.getArticleText},n.a.createElement("div",null,"Get Text")):null))}}]),a}(n.a.Component)),Ti=(a(1622),function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).state={delimiters:"()",loadingText:!1,oldText:[],canUndo:!1,showPreview:!1},i.handleChange=i.handleChange.bind(Object(v.a)(i)),i.filterText=i.filterText.bind(Object(v.a)(i)),i.isValidDelimter=i.isValidDelimter.bind(Object(v.a)(i)),i.undoOperation=i.undoOperation.bind(Object(v.a)(i)),i.toggleDelimiterPreview=i.toggleDelimiterPreview.bind(Object(v.a)(i)),i}return Object(o.a)(a,[{key:"handleChange",value:function(e,t){if(function(e){if(!Object(L.isNullOrUndefined)(e)){if(e.length>2)return!1;for(var t=0;t<2;t++)if("\n"==e[t]||"\t"==e[t]||" "==e[t])return!1;if(2==e.length&&e[0]==e[1])return!1}return!0}(e.target.value)){var a=this.state.delimiters;"delimiters"==t&&(a=e.target.value,this.setState({delimiters:a}),this.props.setDelims(a))}}},{key:"toggleDelimiterPreview",value:function(){var e=!this.state.showPreview;this.props.setDelims(this.state.delimiters),this.props.togglePreview("delims",e),this.setState({showPreview:e})}},{key:"filterText",value:function(){var e=this.props.text,t=this.state.delimiters,a=this.state.oldText;a.push(e),this.setState({oldText:a,canUndo:!0}),e=function(e,t,a,i){var n=" ",s=" ";if(!Object(L.isNullOrUndefined)(e)){for(var l=0,r="",o="",c=0;c<e.length;c++){var d=!1;"\n"!=n&&"\n"==s&&"\n"==e[c]&&(d=!0);var u=!0;e[c]==t?(0==l&&(u=!1,o+="\n"),l++):e[c]==a&&(1==l&&(u=!1,r+="\n"),l>0&&l--),0==l&&u?(o+=e[c],d&&(r+="\n\n")):u&&(r+=e[c],d&&(o+="\n\n")),n=s,s=e[c]}return i?r:o}return e}(e,t[0],t[1],!0),this.props.addText(e)}},{key:"undoOperation",value:function(){var e=this.state.oldText,t=e.pop(),a=!0;0==e.length&&(a=!1),this.setState({canUndo:a,oldText:e}),this.props.addText(t)}},{key:"isValidDelimter",value:function(){var e=this.state.delimiters;return!Object(L.isNullOrUndefined)(e)&&!(e.length<2)}},{key:"render",value:function(){var e=this;return n.a.createElement("div",{className:"filterTextComponent"},n.a.createElement("div",null,n.a.createElement("p",null,"Delimiter"),n.a.createElement("form",null,n.a.createElement("label",null,n.a.createElement(oi.a,{type:"text",value:this.state.delimiters,onChange:function(t){e.handleChange(t,"delimiters")},maxRows:"1",minRows:"1",style:{background:"white",borderWidth:"2px",borderStyle:"solid",borderColor:"darkgrey",paddingTop:"6px",paddingBottom:"6px",width:"80px"}}))),this.isValidDelimter()?n.a.createElement("div",{style:{marginTop:"10px",marginBottom:"10px"}},n.a.createElement(mi,{value:"showPreview",isChecked:this.state.showPreview,label:"Preview text with filter",toggleChange:this.toggleDelimiterPreview})):null,n.a.createElement("div",{className:"filterTextOptionsContainer"},!!this.isValidDelimter()&&n.a.createElement("button",{className:"filterTextDelimiterButton",onClick:this.filterText},n.a.createElement("div",null,"Filter")),!!this.state.canUndo&&n.a.createElement("button",{className:"undoFilterTextDelimiterButton",onClick:this.undoOperation},n.a.createElement("div",null,"Undo"))),this.state.canUndo?n.a.createElement("p",{className:"filterTextUndoOperation"},"You have filter text based on the delimiters  ",n.a.createElement("span",{className:"filterTextDelimText"},this.state.delimiters),". To undo this action, please click ",n.a.createElement("a",{className:"filterTextUndoAction",onClick:function(){return e.undoOperation()}},"Undo"),"."):null))}}]),a}(n.a.Component)),wi=(a(1623),function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).state={firstLangSelectList:[],selectedLang:String(i.props.lang),currentLangLabel:null,oldTexts:[]},i.functions=y.functions(),i.generateLangLists=i.generateLangLists.bind(Object(v.a)(i)),i.canSubmit=i.canSubmit.bind(Object(v.a)(i)),i.canPreview=i.canPreview.bind(Object(v.a)(i)),i.canUndo=i.canUndo.bind(Object(v.a)(i)),i.translateText=i.translateText.bind(Object(v.a)(i)),i.previewText=i.previewText.bind(Object(v.a)(i)),i.submitText=i.submitText.bind(Object(v.a)(i)),i.undoAction=i.undoAction.bind(Object(v.a)(i)),i}return Object(o.a)(a,[{key:"firstLangClicked",value:function(e){for(var t=null,a=0;a<e.length;a++)e[a].value&&(t=e[a].id);this.setState({firstLangSelectList:e,selectedLang:t})}},{key:"firstSelectedBadgeClicked",value:function(e){for(var t=null,a=0;a<e.length;a++)e[a].value&&(t=e[a].id);this.setState({firstLangSelectList:e,selectedLang:t})}},{key:"generateLangLists",value:function(){for(var e=this.state.firstLangSelectList,t=this.state.selectedLangLabel,a=0;a<ct.length;a++){var i=!1;this.state.selectedLang==ct[a].id&&(i=!0,t=ct[a].label),e.push({value:i,label:ct[a].label,id:ct[a].id})}this.setState({firstLangSelectList:e,currentLangLabel:t})}},{key:"componentDidMount",value:function(){this.generateLangLists()}},{key:"canPreview",value:function(){return!Object(L.isNullOrUndefined)(this.state.selectedLang)}},{key:"canSubmit",value:function(){return!Object(L.isNullOrUndefined)(this.props.translatedText)&&this.props.translatedText.length>0}},{key:"canUndo",value:function(){return this.state.oldTexts.length>0}},{key:"previewText",value:function(){var e=Object(k.a)(f.a.mark((function e(){var t,a,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.state.selectedLang,a=this.props.text,e.next=4,this.translateText(a,t);case 4:return i=e.sent,e.next=7,this.props.setTranslatedText(i);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"submitText",value:function(){var e=Object(k.a)(f.a.mark((function e(){var t,a,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.previewText();case 2:t=this.props.translatedText,a=JSON.parse(JSON.stringify(this.props.text)),(i=this.state.oldTexts).push(a),this.setState({oldTexts:i}),this.props.updateText(t);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"undoAction",value:function(){var e=this.state.oldTexts,t=e.pop();this.setState({oldTexts:e}),this.props.updateText(t)}},{key:"translateText",value:function(){var e=Object(k.a)(f.a.mark((function e(t,a){var i,n,s,l;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.functions.httpsCallable("translateText"),n={},e.prev=2,e.next=5,i({text:t,target:a});case 5:n=e.sent,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),n={data:[]};case 11:return e.prev=11,e.finish(11);case 13:for(s="",l=0;l<n.data.length;l++)s+=n.data[l]+" ";return e.abrupt("return",s);case 16:case"end":return e.stop()}}),e,this,[[2,8,11,13]])})));return function(t,a){return e.apply(this,arguments)}}()},{key:"render",value:function(){return n.a.createElement("div",{className:"translateTextContainer"},n.a.createElement("div",{className:"translatepane-filter-container"},n.a.createElement("div",{className:"translatepane-dropdown-container"},n.a.createElement(A.a,{options:this.state.firstLangSelectList,optionClicked:this.firstLangClicked.bind(this),selectedBadgeClicked:this.firstSelectedBadgeClicked.bind(this),selectedOptionsStyles:{color:"white",backgroundColor:"rgb(117, 106, 214)",borderRadius:"20px",fontSize:"0.6em",padding:"10px",maxWidth:"92%",wordWrap:"break-word"},optionsListStyles:{backgroundColor:"darkcyan",color:"white"},isSingleSelect:!0,isTextWrap:!1})),this.canPreview()?n.a.createElement("button",{className:"translatePaneButton",onClick:this.previewText},"Preview"):null,this.canSubmit()?n.a.createElement("button",{className:"submitPaneButton",onClick:this.submitText},"Submit"):null,this.canUndo()?n.a.createElement("button",{className:"undoPaneButton",onClick:this.undoAction},"Undo"):null))}}]),a}(n.a.Component)),Ni=a(880),xi=a.n(Ni),ji=(a(1625),function(e){Object(c.a)(i,e);var t=Object(d.a)(i);function i(e){var n;return Object(r.a)(this,i),(n=t.call(this,e)).state={html:"",delims:["(",")"]},n.htmlToText=a(1626),n.handleChange=n.handleChange.bind(Object(v.a)(n)),n.unmakeHtml=n.unmakeHtml.bind(Object(v.a)(n)),n.formatHtml=n.formatHtml.bind(Object(v.a)(n)),n.removeExtraEffects=n.removeExtraEffects.bind(Object(v.a)(n)),n.getDelimiters=n.getDelimiters.bind(Object(v.a)(n)),n}return Object(o.a)(i,[{key:"handleChange",value:function(e){var t=String(e.target.value);console.log(e.target),console.log(t),console.log(this.unmakeHtml(t));var a=t;this.unmakeHtml(this.state.html)!=this.unmakeHtml(t)&&(a=this.formatHtml(t)),this.setState({html:a})}},{key:"unmakeHtml",value:function(e){var t=e;return t=t.replace(/<div/g,"<br><div"),t=this.htmlToText.fromString(t)}},{key:"removeExtraEffects",value:function(e){var t=e;return t=(t=(t=(t=(t=t.replace(new RegExp('<span style="color: green">',"g"),"")).replace(new RegExp('<span style="font-weight:bold">',"g"),"")).replace(new RegExp('<b style="color: green">',"g"),"")).replace(new RegExp("</b>","g"),"")).replace(new RegExp("</span>","g"),"")}},{key:"getDelimiters",value:function(e){var t=this.props.delims,a=e;return Object(L.isNullOrUndefined)(t)||2!=t.length||(a=function(e,t,a,i){if(!Object(L.isNullOrUndefined)(e)){for(var n=0,s="",l=0;l<e.length;l++){if(e[l]==t){if(0==n){s+=e[l],s+='<b class="filterTextStyle">',n++;continue}n++}else e[l]==a&&(1==n&&(s+="</b>"),n>0&&n--);s+=e[l]}return s}return e}(e,t[0],t[1])),a}},{key:"formatHtml",value:function(e){var t=e;return this.props.type.delims&&(t=this.getDelimiters(e)),t}},{key:"render",value:function(){var e=this.props.value;return e='<div class="nonEditablePreviewText">'+e+"</div>",e=this.formatHtml(e),n.a.createElement("div",{style:{width:"100%"}},n.a.createElement(xi.a,{className:"editableBulkDivMain",html:e,disabled:!0}))}}]),i}(n.a.Component)),Ci=(a(470),n.a.forwardRef((function(e,t){return n.a.createElement(It.a,Object.assign({direction:"up",ref:t},e))}))),Ii=function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).handleKeyPress=function(e){e.key},i.state={value:"",oldValue:"",translatedValue:"",isSavingBlocks:!1,isLoadingText:!1,isSavingText:!1,openOcr:!1,openArticleLink:!1,openFilterText:!1,openTranslateText:!1,openConfirmDialog:!1,placeholderOld:"Paste text here in the following format:\n\nTitle of block1\nContent of block1\n\nTitle of block2\nContent of block2\n\n(Note:\nAdding #2 at the start of the title will give the block a rank of 2, which is useful in sorting the block.\nAdding #2s at the start of the title will put the block in summary view and give it the rank 2.)",placeholder:"Input your story (broken into paragraphs) here",tooltipText:{addBlocks:[{title:"Write your story as short paragraphs and save!",target:".addBlocksPaneInput",content:"",disableBeacon:!0}]},showTooltip:{addBlocks:JSON.parse(JSON.stringify(e.addBlocksTooltip))},adhocTooltip:{para:{flag:!1,text:[{title:"Importance of paragraphs in input!",target:".tooltipPara",content:"Your input must be in the forms of paras with every two paras seperated by atleast one empty line. Each para becomes one block. To add titles to your blocks, you can add a title to each para but please note that the title and the content must NOT have empty lines between them. In the example shown in red text, '#1s Avengers' is the title while 'Thor, Rogers,...' is the content. In the same example, another block is inputed without a title but with content 'Thor is from Asgard.' ",disableBeacon:!0}]},hashtag:{flag:!1,text:[{title:"Importance of hashtags in the title of each block!",target:".tooltipHashtag",content:"Each block has a title. If you want to order your blocks to provide structure to your content (in the same way paragraphs follow a certain order in a story), you can start the title using a hashtag. For example, the block with '#1' as title will show up before the block with '#2'. The text in red inputs a block with a title that starts with #1.",disableBeacon:!0}]},summary:{flag:!1,text:[{title:"Importance of hashtags in the summary view!",target:".tooltipSummary",content:"Your story dashboard contains a summary visualisation that provides a summary of your story to any viewer. As a contributor to the story, you may want your block to surface in the summary. To do so, you need to append the letter 's' to the hashtag in the title. Note that the 's' must come after the number in the hashtag. For example, in the red text, the first block as a title that begins with '#1s', so it will surface in the summary view. The ordering of blocks in the summary view is the same as described in the previous tooltip.",disableBeacon:!0}]}},previewEditorType:{},delims:""},i.functions=y.functions(),i.textarea=null,i.handleChange=i.handleChange.bind(Object(v.a)(i)),i.sendMessage=i.sendMessage.bind(Object(v.a)(i)),i.getParas=i.getParas.bind(Object(v.a)(i)),i.formatParas=i.formatParas.bind(Object(v.a)(i)),i.isValidNlpEntity=i.isValidNlpEntity.bind(Object(v.a)(i)),i.isDate=i.isDate.bind(Object(v.a)(i)),i.isLocation=i.isLocation.bind(Object(v.a)(i)),i.isRepeatedNlpEntity=i.isRepeatedNlpEntity.bind(Object(v.a)(i)),i.saveDraftInBulk=i.saveDraftInBulk.bind(Object(v.a)(i)),i.showLocalTooltip=i.showLocalTooltip.bind(Object(v.a)(i)),i.handleAdhocTooltipJoyrideCallback=i.handleAdhocTooltipJoyrideCallback.bind(Object(v.a)(i)),i.makeEntityUppercase=i.makeEntityUppercase.bind(Object(v.a)(i)),i.closeAdvancedTabs=i.closeAdvancedTabs.bind(Object(v.a)(i)),i.toggleAdvancedTab=i.toggleAdvancedTab.bind(Object(v.a)(i)),i.isAnyAdvancedTabOpened=i.isAnyAdvancedTabOpened.bind(Object(v.a)(i)),i.addText=i.addText.bind(Object(v.a)(i)),i.reformText=i.reformText.bind(Object(v.a)(i)),i.deleteExistingBulkText=i.deleteExistingBulkText.bind(Object(v.a)(i)),i.closeBulkDraft=i.closeBulkDraft.bind(Object(v.a)(i)),i.saveBulkDraft=i.saveBulkDraft.bind(Object(v.a)(i)),i.toggleSaveDialog=i.toggleSaveDialog.bind(Object(v.a)(i)),i.togglePreview=i.togglePreview.bind(Object(v.a)(i)),i.setDelims=i.setDelims.bind(Object(v.a)(i)),i.getBulkPreviewText=i.getBulkPreviewText.bind(Object(v.a)(i)),i.setTranslatedText=i.setTranslatedText.bind(Object(v.a)(i)),i}return Object(o.a)(a,[{key:"togglePreview",value:function(e,t){var a=this.state.previewEditorType;t?a[e]=!0:delete a[e],this.setState({previewEditorType:a})}},{key:"setDelims",value:function(e){this.setState({delims:e})}},{key:"formatParas",value:function(e,t){var a={};if(e){a.title="",a.body="",a.entities=[];for(var i={},n=0,s=0;s<e.length&&pe(e[s]);s++)s>0&&(e[s]=ge(e[s])),a.title+=e[s]+" ",n++;for(var l="",r=n;r<e.length;r++)if(me(e[r])){var o=be(e[r]);for(var c in o)o[c]=this.makeEntityUppercase(o[c]),o[c]in i||(i[c]={title:o[c],type:"None"})}else{e[r];l+=e[r]}for(var d in a.body=l,i)a.entities.push(i[d])}t.push(a)}},{key:"getParas",value:function(e){var t="",a="0",i="0",n=[],s=[],l=0;for(e=e.trim();l<e.length&&("\n"==e[l]||"\t"==e[l]);)l++;e=e.substring(l);for(var r=0;r<e.length;r++)"\n"==e[r]?"\n"!=a?(t+=" ",n.push(t),t=""):"\n"!=i&&(t="",n.length>0&&(this.formatParas(n,s),n=[])):(t+=e[r],e[r]),i=a,a=e[r];return""!=t&&n.push(t),n.length>0&&(this.formatParas(n,s),n=[]),s}},{key:"isAnyAdvancedTabOpened",value:function(){return this.state.openArticleLink||this.state.openOcr}},{key:"closeAdvancedTabs",value:function(){this.togglePreview("delims",!1),this.togglePreview("translate",!1),this.setState({openOcr:!1,openArticleLink:!1,openFilterText:!1,openTranslateText:!1})}},{key:"toggleAdvancedTab",value:function(e){this.closeAdvancedTabs(),"ocr"==e?this.setState({openOcr:!this.state.openOcr}):"article"==e?this.setState({openArticleLink:!this.state.openArticleLink}):"filterText"==e?this.setState({openFilterText:!this.state.openFilterText}):"translateText"==e&&(this.togglePreview("translate",!this.state.openTranslateText),this.setState({openTranslateText:!this.state.openTranslateText}))}},{key:"toggleSaveDialog",value:function(e){this.setState({openConfirmDialog:e})}},{key:"handleChange",value:function(e){this.setState({value:e.target.value})}},{key:"reformText",value:function(e){this.setState({value:e})}},{key:"addText",value:function(e){var t=this.state.value;t+=e,this.setState({value:t})}},{key:"sendMessage",value:function(e){e.key}},{key:"isLocation",value:function(e){return"LOCATION"==e.type}},{key:"isValidNlpEntity",value:function(e,t){if(Object(L.isNullOrUndefined)(e))return!1;var a=e.mentions;if(!Object(L.isNullOrUndefined)(e.name)&&("all"==e.name.toLowerCase()||"none"==e.name.toLowerCase()))return!1;for(var i=0;i<a.length;i++)if(a[i].type==t)return!0;return!1}},{key:"isDate",value:function(e){if("DATE"!=e.type)return!1;if(e.metadata&&!("year"in e.metadata))return!1;return!0}},{key:"isRepeatedNlpEntity",value:function(e){for(var t=this.props.entityPane,a=e.name,i=0;i<t.length;i++){var n=t[i].label;if(n.toLowerCase().indexOf(a.toLowerCase())>=0||a.toLowerCase().indexOf(n.toLowerCase())>=0)return!0}return!1}},{key:"makeEntityUppercase",value:function(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}},{key:"saveDraftInBulk",value:function(){var e=Object(k.a)(f.a.mark((function e(){var t,a,i,n,s,l,r,o,c,d,u,h,p,m,b,g,k;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({isSavingBlocks:!0}),t=[],t=this.getParas(this.state.value),a=[],i="",n=[],s=[],l=[],r=[],o=0;case 10:if(!(o<t.length)){e.next=32;break}if(i+=t[o].body,i+=".",o%10!=9&&o!=t.length-1){e.next=29;break}return c=this.functions.httpsCallable("entityExtraction"),d={},e.prev=16,e.next=19,c({text:i});case 19:d=e.sent,e.next=25;break;case 22:e.prev=22,e.t0=e.catch(16),d={data:[]};case 25:return e.prev=25,e.finish(25);case 27:if(d.data)for(u=0;u<d.data.length;u++)d.data[u].name=this.makeEntityUppercase(d.data[u].name),!this.isValidNlpEntity(d.data[u],"PROPER")||this.isLocation(d.data[u])||this.isRepeatedNlpEntity(d.data[u])||n.push(d.data[u]),this.isValidNlpEntity(d.data[u],"COMMON")&&!this.isRepeatedNlpEntity(d.data[u])&&s.push(d.data[u]),this.isDate(d.data[u])&&l.push(d.data[u]),this.isLocation&&r.push(d.data[u]);i="";case 29:o++,e.next=10;break;case 32:n.sort((function(e,t){return t.salience-e.salience})),s.sort((function(e,t){return t.salience-e.salience})),l.sort((function(e,t){var a=e.metadata,i=t.metadata;return a.year!=i.year?Number(a.year)-Number(i.year):Object(L.isNullOrUndefined)(a.month)&&Object(L.isNullOrUndefined)(i.month)||a.month==i.month?Object(L.isNullOrUndefined)(a.day)&&Object(L.isNullOrUndefined)(i.day)?a.day:Object(L.isNullOrUndefined)(a.day)?1:Object(L.isNullOrUndefined)(i.day)?-1:Number(a.day)-Number(i.day):Object(L.isNullOrUndefined)(a.month)?1:Object(L.isNullOrUndefined)(i.month)?-1:Number(i.month)-Number(a.month)})),o=0;case 36:if(!(o<t.length)){e.next=59;break}for(h={entities:[],evidences:[],summary:t[o].body,title:t[o].title},p=this.props.entityPane,u=0;!Object(L.isNullOrUndefined)(t[o])&&!Object(L.isNullOrUndefined)(t[o].entities)&&u<t[o].entities.length;u++)h.entities.push(t[o].entities[u]);for(u=0;u<p.length;u++)m=p[u].label,Ae(h.summary.toLowerCase(),m.toString().toLowerCase())&&h.entities.push({title:m,type:"None"});for(u=0;u<n.length&&h.entities.length<=3;u++)m=n[u].name,h.summary.toLowerCase().indexOf(m.toString().toLowerCase())>=0&&h.entities.push({title:m,type:"None"});for(u=0;u<s.length&&h.entities.length<2;u++)m=s[u].name,h.summary.toLowerCase().indexOf(m.toString().toLowerCase())>=0&&h.entities.push({title:m,type:"None"});h.entities&&(d=h.entities.reduce((function(e,t){return e.some((function(e){return e.title===t.title}))||e.push(t),e}),[]),h.entities=d),b=0;case 45:if(!(b<l.length)){e.next=55;break}if(g=l[b].name,!(h.summary.toLowerCase().indexOf(g.toString().toLowerCase())>=0)){e.next=52;break}return k={date:null,month:Number(l[b].metadata.month)-1,year:Number(l[b].metadata.year)},Object(L.isNullOrUndefined)(l[b].metadata.day)||(k.date=Number(l[b].metadata.day)),h.blockDate=k,e.abrupt("break",55);case 52:b++,e.next=45;break;case 55:a.push(h);case 56:o++,e.next=36;break;case 59:return e.prev=59,e.next=62,this.deleteExistingBulkText();case 62:e.next=66;break;case 64:e.prev=64,e.t1=e.catch(59);case 66:this.setState({isSavingBlocks:!1}),this.props.addDraftBlocksInBulk(a);case 68:case"end":return e.stop()}}),e,this,[[16,22,25,27],[59,64]])})));return function(){return e.apply(this,arguments)}}()},{key:"showLocalTooltip",value:function(e){var t=this.state.adhocTooltip;"para"==e?t.para.flag=!0:"hashtag"==e?t.hashtag.flag=!0:"summary"==e&&(t.summary.flag=!0),this.setState({adhocTooltip:t})}},{key:"handleAdhocTooltipJoyrideCallback",value:function(e,t){e.action,e.index;var a=e.status;e.type;if([O.a.FINISHED,O.a.SKIPPED].includes(a)){var i=this.state.adhocTooltip;"para"==t?i.para.flag=!1:"hashtag"==t?i.hashtag.flag=!1:"summary"==t&&(i.summary.flag=!1),this.setState({adhocTooltip:i})}}},{key:"deleteExistingBulkText",value:function(){var e=Object(k.a)(f.a.mark((function e(){var t,a,i,n=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=y.firestore().collection("Blockprobes").doc(this.props.bId).collection("users").doc(this.props.uIdHash).collection("bulkText"),e.next=3,t.get();case 3:if(!(a=e.sent)){e.next=9;break}return i=[],a.forEach((function(e){var t=y.firestore().collection("Blockprobes").doc(n.props.bId).collection("users").doc(n.props.uIdHash).collection("bulkText").doc(e.id).delete();i.push(t)})),e.next=9,Promise.all(i);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"saveBulkDraft",value:function(){var e=Object(k.a)(f.a.mark((function e(){var t,a,i,n,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.setState({isSavingText:!0,previewEditorType:{}}),t=de(this.state.value),e.prev=2,this.state.value==this.state.oldValue){e.next=10;break}return e.next=6,this.deleteExistingBulkText();case 6:for(a=[],i=0;i<t.length;i++)n={id:i,text:t[i]},s=y.firestore().collection("Blockprobes").doc(this.props.bId).collection("users").doc(this.props.uIdHash).collection("bulkText").doc(String(i)).set(n),a.push(s);return e.next=10,Promise.all(a);case 10:e.next=14;break;case 12:e.prev=12,e.t0=e.catch(2);case 14:return e.prev=14,this.setState({isSavingText:!1}),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[2,12,14,17]])})));return function(){return e.apply(this,arguments)}}()},{key:"closeBulkDraft",value:function(){var e=Object(k.a)(f.a.mark((function e(){var t,a,i,n,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.setState({isSavingText:!0}),t=de(this.state.value),e.prev=2,this.state.value==this.state.oldValue){e.next=10;break}return e.next=6,this.deleteExistingBulkText();case 6:for(a=[],i=0;i<t.length;i++)n={id:i,text:t[i]},s=y.firestore().collection("Blockprobes").doc(this.props.bId).collection("users").doc(this.props.uIdHash).collection("bulkText").doc(String(i)).set(n),a.push(s);return e.next=10,Promise.all(a);case 10:e.next=14;break;case 12:e.prev=12,e.t0=e.catch(2);case 14:return e.prev=14,this.setState({isSavingText:!1}),this.props.cancelBulkDraftBlock(),e.finish(14);case 18:case"end":return e.stop()}}),e,this,[[2,12,14,18]])})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){var e=Object(k.a)(f.a.mark((function e(){var t,a,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({isLoadingText:!0}),e.prev=1,t=y.firestore().collection("Blockprobes").doc(this.props.bId).collection("users").doc(this.props.uIdHash).collection("bulkText"),e.next=5,t.orderBy("id").get();case 5:a=e.sent,i=this.state.value,a&&a.forEach((function(e){i+=e.data().text})),this.setState({value:i,oldValue:i}),e.next=14;break;case 12:e.prev=12,e.t0=e.catch(1);case 14:return e.prev=14,this.setState({isLoadingText:!1}),Object(L.isNullOrUndefined)(this.textarea)||this.textarea.focus(),e.finish(14);case 18:case"end":return e.stop()}}),e,this,[[1,12,14,18]])})));return function(){return e.apply(this,arguments)}}()},{key:"oldTooltips",value:function(){var e=this;return n.a.createElement("div",{style:{marginLeft:"1em"},className:"addBlocksPane"},n.a.createElement("p",{className:"tooltips-list-bulkdraft"},"**The following key points are important while contributing to any story. Click on the info icons to learn more",n.a.createElement("br",null)),n.a.createElement("ol",{className:"tooltips-list-bulkdraft bulkdraft-list"},n.a.createElement("li",null,"How paragraphs get converted into blocks.",n.a.createElement("a",{className:"tooltipPara tooltips-bulkdraft",onClick:function(t){e.showLocalTooltip("para")}},n.a.createElement(T.a,{style:{fontSize:"19px"}})),n.a.createElement(O.b,{styles:{options:{arrowColor:"#e3ffeb",beaconSize:"4em",primaryColor:"#05878B",backgroundColor:"#e3ffeb",overlayColor:"rgba(10,10,10, 0.4)",width:900,zIndex:1e3}},steps:this.state.adhocTooltip.para.text,run:this.state.adhocTooltip.para.flag,callback:function(t){e.handleAdhocTooltipJoyrideCallback(t,"para")}})),n.a.createElement("li",null,"Role of the title hashtag in ordering of content",n.a.createElement("a",{className:"tooltipHashtag tooltips-bulkdraft",onClick:function(t){e.showLocalTooltip("hashtag")}},n.a.createElement(T.a,{style:{fontSize:"19px"}})),n.a.createElement(O.b,{styles:{options:{arrowColor:"#e3ffeb",beaconSize:"4em",primaryColor:"#05878B",backgroundColor:"#e3ffeb",overlayColor:"rgba(10,10,10, 0.4)",width:900,zIndex:1e3}},steps:this.state.adhocTooltip.hashtag.text,run:this.state.adhocTooltip.hashtag.flag,callback:function(t){e.handleAdhocTooltipJoyrideCallback(t,"hashtag")}})),n.a.createElement("li",null,"Role of the title hashtag in the creation of the story summary",n.a.createElement("a",{className:"tooltipSummary tooltips-bulkdraft",onClick:function(t){e.showLocalTooltip("summary")}},n.a.createElement(T.a,{style:{fontSize:"19px"}})),n.a.createElement(O.b,{styles:{options:{arrowColor:"#e3ffeb",beaconSize:"4em",primaryColor:"#05878B",backgroundColor:"#e3ffeb",overlayColor:"rgba(10,10,10, 0.4)",width:900,zIndex:1e3}},steps:this.state.adhocTooltip.summary.text,run:this.state.adhocTooltip.summary.flag,callback:function(t){e.handleAdhocTooltipJoyrideCallback(t,"summary")}}))))}},{key:"getBulkPreviewText",value:function(){return this.state.previewEditorType.delims?this.state.value:this.state.previewEditorType.translate?this.state.translatedValue:void 0}},{key:"setTranslatedText",value:function(e){this.setState({translatedValue:e})}},{key:"render",value:function(){var e=this;return n.a.createElement("div",{className:"bulkDraftBlocksPaneContainer"},this.state.isSavingBlocks||this.state.isLoadingText||this.state.isSavingText?n.a.createElement("div",null,n.a.createElement("div",{style:{padding:"3px",textAlign:"center"}},this.state.isSavingBlocks?n.a.createElement("p",{className:"processingDraftBlockText"},"We are processing your contribution. Kindly wait for a few moments."):null,this.state.isSavingText?n.a.createElement("p",{className:"processingDraftBlockText"},"We are saving your contribution. Kindly wait for a few moments."):null),n.a.createElement("div",{style:{margin:"auto",width:"50px"}},n.a.createElement(Da.a,{type:"TailSpin",color:"#00BFFF",height:"50",width:"50"}))):n.a.createElement("div",null,n.a.createElement("div",{style:{marginLeft:"1em"},className:"addBlocksPane"},n.a.createElement("p",{style:{fontSize:"13px",color:"grey",fontStyle:"italic"}},"Copy paste your content. Your content must be divided into paragraphs. Add subtitles for each para if needed. ",n.a.createElement("br",null),"For example, copy paste the entire text in red as input.",n.a.createElement("a",{href:"https://youtu.be/SCDA-rUVdMA?t=192",target:"blank"},"Learn More")),n.a.createElement("p",{className:"copyBlockBulkText",style:{fontSize:"13px",color:"red",fontStyle:"italic",background:"rgba(255,0,0,0.3)"}},"# Avengers",n.a.createElement("br",null),"Thor, Rogers and Ironman are the Avengers.",n.a.createElement("br",null),n.a.createElement("br",null),"Thor is from Asgard")),n.a.createElement("div",{className:"bulkDraftBlocksPaneTitle",style:{marginBottom:"0"}},"Advanced options"),n.a.createElement("div",{className:"bulk-draft-options-container",style:{marginTop:"0"}},n.a.createElement(rt.a,{variant:"contained",className:"advancedImageOption "+(this.state.openOcr?"advancedImageOptionSelected":"advancedImageOptionUnselected"),onClick:function(){e.toggleAdvancedTab("ocr")}},n.a.createElement("div",{style:{fontWeight:"bold"}},"Retrieve text from image")),n.a.createElement(rt.a,{variant:"contained",className:"advancedImageOption "+(this.state.openArticleLink?"advancedImageOptionSelected":"advancedImageOptionUnselected"),onClick:function(){e.toggleAdvancedTab("article")}},n.a.createElement("div",{style:{fontWeight:"bold"}},"Retrieve text from article")),n.a.createElement(rt.a,{variant:"contained",className:"advancedImageOption "+(this.state.openFilterText?"advancedImageOptionSelected":"advancedImageOptionUnselected"),onClick:function(){e.toggleAdvancedTab("filterText")}},n.a.createElement("div",{style:{fontWeight:"bold"}},"Quickfilter")),n.a.createElement(rt.a,{variant:"contained",className:"advancedImageOption "+(this.state.openTranslateText?"advancedImageOptionSelected":"advancedImageOptionUnselected"),onClick:function(){e.toggleAdvancedTab("translateText")}},n.a.createElement("div",{style:{fontWeight:"bold"}},"Translate"))),this.state.openOcr?n.a.createElement(Oi,{addText:this.addText,closeComponent:this.closeAdvancedTabs,uIdHash:this.props.uIdHash,bId:this.props.bId,uId:this.props.uId}):null,this.state.openArticleLink?n.a.createElement(Bi,{addText:this.addText,closeComponent:this.closeAdvancedTabs}):null,this.state.openFilterText?n.a.createElement(Ti,{addText:this.reformText,text:this.state.value,togglePreview:this.togglePreview,setDelims:this.setDelims}):null,this.state.openTranslateText?n.a.createElement(wi,{updateText:this.reformText,text:this.state.value,lang:this.props.lang,translatedText:this.state.translatedValue,setTranslatedText:this.setTranslatedText}):null,n.a.createElement("div",{className:"bulkDraftBlocksPaneTitle"},"Input your text here"),n.a.createElement(O.b,{styles:{options:{arrowColor:"#e3ffeb",beaconSize:"4em",primaryColor:"#05878B",backgroundColor:"#e3ffeb",overlayColor:"rgba(10,10,10, 0.4)",width:900,zIndex:1e3}},steps:this.state.tooltipText.addBlocks,run:this.state.showTooltip.addBlocks}),n.a.createElement("div",{style:{display:"flex",flexWrap:"wrap"}},n.a.createElement("div",{className:0==Object.keys(this.state.previewEditorType).length?"bulkEdit-nonPreview":"bulkEdit-preview"},n.a.createElement("form",{className:"addBlocksPaneInput"},n.a.createElement("label",null,n.a.createElement(oi.a,{inputRef:function(t){return e.textarea=t},type:"text",value:this.state.value,onKeyPress:this.handleKeyPress,placeholder:this.state.placeholder,onChange:function(t){e.handleChange(t)},minRows:"10",onKeyUp:this.sendMessage,style:{background:"white",borderRadius:"5px",borderWidth:"2px",borderStyle:"solid",borderColor:"black",marginLeft:"1%",marginRight:"1%",paddingTop:"6px",paddingBottom:"6px",width:"95%",color:"blue",fontWeight:"500",fontSize:"16px",fontStyle:"normal",maxHeight:"1150px",overflowY:"auto"}})))),n.a.createElement("div",{className:0==Object.keys(this.state.previewEditorType).length?"bulkPreview-nonPreview":"bulkEdit-preview",style:{maxHeight:"1165px",overflowY:"auto"}},n.a.createElement(ji,{style:{width:"100%"},value:this.getBulkPreviewText(),type:this.state.previewEditorType,delims:this.state.delims}))),n.a.createElement("div",{className:"bulk-draft-options-container",style:{marginTop:"0"}},n.a.createElement(rt.a,{variant:"contained",className:"convertToBlocksButton saveBlocksInBulk",onClick:function(){return e.toggleSaveDialog(!0)}},n.a.createElement("div",null,"Confirm")),n.a.createElement(Xa.a,{open:this.state.openConfirmDialog,TransitionComponent:Ci,keepMounted:!0,onClose:function(){return e.toggleSaveDialog(!1)},"aria-labelledby":"alert-dialog-slide-title","aria-describedby":"alert-dialog-slide-description"},n.a.createElement(ei.a,{id:"alert-dialog-slide-title"},"Save content as blocks"),n.a.createElement($a.a,null,n.a.createElement(Za.a,{id:"alert-dialog-slide-description"},"This action will convert your text to blocks that can be added to your story, and remove all existing text from here. Do you confirm?")),n.a.createElement(Qa.a,null,n.a.createElement(rt.a,{onClick:function(){return e.toggleSaveDialog(!1)},color:"primary"},"No"),n.a.createElement(rt.a,{onClick:this.saveDraftInBulk,color:"primary"},"Yes"))),n.a.createElement(rt.a,{variant:"contained",className:"saveDraftBulkBlockprobeButton",onClick:this.saveBulkDraft},n.a.createElement("div",null,"Save draft")),n.a.createElement(rt.a,{variant:"contained",className:"cancelBlockBackButton",onClick:this.closeBulkDraft},n.a.createElement("div",null,"Close")))))}}]),a}(n.a.Component),Li=(a(1677),a(1678),function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).state={entities:[],haveEntitiesLoaded:!1,newEntity:"",entityPresent:{},tooltipText:{entityPane:[{title:"Let us add characters (entities) to your story",target:".createNewEntitiesPane",content:"Copy paste the text in red and press enter",disableBeacon:!0}],cancelButton:[{title:"Well done! Your entities have been defined!",target:".cancelEntityPaneButton",content:"Click on close. We are done here!",disableBeacon:!1,placementBeacon:"left",event:"hover"}]},showTooltip:{cancel:!1}},i.addEntityToList=i.addEntityToList.bind(Object(v.a)(i)),i.makeEntityUppercase=i.makeEntityUppercase.bind(Object(v.a)(i)),i.initEntities=i.initEntities.bind(Object(v.a)(i)),i.getEntities=i.getEntities.bind(Object(v.a)(i)),i.removeEntity=i.removeEntity.bind(Object(v.a)(i)),i.handleKeyDown=i.handleKeyDown.bind(Object(v.a)(i)),i.clickOkayButton=i.clickOkayButton.bind(Object(v.a)(i)),i.addEntitiesInBulk=i.addEntitiesInBulk.bind(Object(v.a)(i)),i.closeEntityPane=i.closeEntityPane.bind(Object(v.a)(i)),i}return Object(o.a)(a,[{key:"componentDidUpdate",value:function(){}},{key:"initEntities",value:function(e,t){for(var a=e.data().entities,i=t.state.entityPresent,n=0;n<a.length;n++)i[a[n].label]=a[n].canRemove;t.props.updateEntityPaneList(a),t.setState({entityPresent:i,entities:a,haveEntitiesLoaded:!0})}},{key:"componentDidMount",value:function(){var e=this;y.firestore().collection("Blockprobes").doc(this.props.bId).collection("users").doc(this.props.uIdHash).collection("session").doc("entityPane").get().then((function(t){t.exists&&e.initEntities(t,e)}))}},{key:"addEntitiesInBulk",value:function(e){for(var t=e.split(","),a=0;a<t.length;a++){var i=t[a].trim();i.length>0&&this.addEntityToList(i)}i="";var n=this.state.showTooltip;""!=e.trim()&&this.props.entityPaneTooltip&&(n.cancel=!0),this.setState({newEntity:i,showTooltip:n})}},{key:"clickOkayButton",value:function(){var e=this.state.newEntity;this.addEntitiesInBulk(e)}},{key:"handleKeyDown",value:function(e){if("Enter"===e.key){var t=e.target.value;this.addEntitiesInBulk(t)}}},{key:"handleChange",value:function(e,t){"date"!=t&&"time"!=t&&(e.target.value=e.target.value.replace(/(\r\n|\n|\r)/gm,""),e.target.value=e.target.value.replace("\t",""),e.target.value.trim()),"new-entity"==t&&this.setState({newEntity:e.target.value})}},{key:"makeEntityUppercase",value:function(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}},{key:"addEntityToList",value:function(e){var t=this.state.entities,a=this.state.entityPresent;(e=this.makeEntityUppercase(e))in a||"all"==e.toLowerCase()||"none"==e.toLowerCase()||(t.push({canRemove:!0,label:e}),a[e]=!0,y.firestore().collection("Blockprobes").doc(this.props.bId).collection("users").doc(this.props.uIdHash).collection("session").doc("entityPane").set({entities:t}),this.props.updateEntityPaneList(this.getEntities()),this.setState({entities:t,newEntity:"",entityPresent:a}))}},{key:"removeEntity",value:function(e){var t=this.state.entities.filter((function(t){return t.label!=e.label})),a=this.state.entityPresent;delete a[e.label],y.firestore().collection("Blockprobes").doc(this.props.bId).collection("users").doc(this.props.uIdHash).collection("session").doc("entityPane").set({entities:t}),this.setState({entities:t,entityPresent:a})}},{key:"BlockEntity",value:function(e){var t=this;return n.a.createElement("span",{className:"block-entity"},e.label,e.canRemove?n.a.createElement("a",{style:{marginLeft:"5px",color:"black",cursor:"pointer"},onClick:function(){t.removeEntity(e)}},"X"):null)}},{key:"getEntities",value:function(){for(var e=this.state.entities,t={},a=0;a<e.length;a++)t[e[a].label]=e[a].canRemove;null!=this.props.investigationGraph&&Object.keys(this.props.investigationGraph).forEach((function(a){a in t||e.push({canRemove:!1,label:a}),t[a]=!1}));for(a=0;a<e.length;a++)e[a].canRemove=t[e[a].label];return e}},{key:"closeEntityPane",value:function(){var e=!1;this.state.showTooltip.cancel&&(e=!0),this.props.closeEntityPane(e)}},{key:"render",value:function(){var e=this,t="",a=this.getEntities();return null!=a&&a.length>0&&(t=a.map((function(t){return e.BlockEntity(t)}))),n.a.createElement("div",{className:"entityPaneContainer"},n.a.createElement("div",{className:"entityPaneTitle"},"Entities of your story"),n.a.createElement("div",null,t),n.a.createElement(O.b,{styles:{options:{arrowColor:"#e3ffeb",beaconSize:"3em",primaryColor:"#05878B",backgroundColor:"#e3ffeb",overlayColor:"rgba(10,10,10, 0.4)",width:900,zIndex:1e3}},steps:this.state.tooltipText.entityPane,run:this.props.entityPaneTooltip}),n.a.createElement(Ra.a,{type:"text",variant:"outlined",multiline:!0,className:"createNewEntitiesPane",value:this.state.newEntity,onChange:function(t){e.handleChange(t,"new-entity")},onKeyDown:function(t){e.handleKeyDown(t)},placeholder:"Input your entity names seperated by ',' and press 'Enter key' or 'Ok button'",rowsMax:"2",rows:"1",style:{background:"white",marginTop:"6px",marginBottom:"6px",minWidth:"60%",maxWidth:"80%",marginLeft:"1em",color:"darkBlue",fontWeight:"600"}}),n.a.createElement("div",{style:{marginLeft:"1em"}},n.a.createElement("span",{style:{fontSize:"14px",color:"grey",fontStyle:"italic"}},"**Input your entity names seperated by comma and press 'Enter key' or 'Ok button'. For example, copy-paste the text below shown in red as input. ",n.a.createElement("a",{href:"https://youtu.be/SCDA-rUVdMA?t=122",target:"blank"},"Learn More"),n.a.createElement("br",null)),n.a.createElement("span",{style:{fontSize:"14px",fontWeight:"bold",color:"red",background:"rgba(255,0,0,0.3)",fontStyle:"italic"}},"Ironman, Thor, Rogers, Asgard, Thanos")),n.a.createElement(O.b,{styles:{options:{arrowColor:"#e3ffeb",beaconSize:"4em",primaryColor:"#05878B",backgroundColor:"#e3ffeb",overlayColor:"rgba(10,10,10, 0.4)",width:900,zIndex:1e3}},steps:this.state.tooltipText.cancelButton,run:this.state.showTooltip.cancel}),n.a.createElement("div",{className:"draft-add-new-entity-container"},n.a.createElement(rt.a,{color:"primary",variant:"contained",className:"cancelBlockButton cancelEntityPaneButton",onClick:this.closeEntityPane},n.a.createElement("div",null,"Close")),""!=this.state.newEntity?n.a.createElement(rt.a,{color:"primary",variant:"contained",className:"addEntityButton",onClick:this.clickOkayButton},n.a.createElement("div",null,"Ok")):null))}}]),a}(n.a.Component)),Di=(a(1679),function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).state={firstEntitySelectList:[],selectedEntityUrl:"",selectedEntity:"",changedEntities:{},uploadedImages:{},entityTabIndex:{},selectedTabIndex:0,isImageUploading:!1,hasUpdated:!1},i.generateEntityLists=i.generateEntityLists.bind(Object(v.a)(i)),i.handleChange=i.handleChange.bind(Object(v.a)(i)),i.submitEntityImage=i.submitEntityImage.bind(Object(v.a)(i)),i.canSubmit=i.canSubmit.bind(Object(v.a)(i)),i.onDrop=i.onDrop.bind(Object(v.a)(i)),i.getImageOptions=i.getImageOptions.bind(Object(v.a)(i)),i.getImageUrlFromFile=i.getImageUrlFromFile.bind(Object(v.a)(i)),i.onChangeImageTab=i.onChangeImageTab.bind(Object(v.a)(i)),i.removeImageFromDb=i.removeImageFromDb.bind(Object(v.a)(i)),i.closeImagePane=i.closeImagePane.bind(Object(v.a)(i)),i.isImagePresent=i.isImagePresent.bind(Object(v.a)(i)),i}return Object(o.a)(a,[{key:"submitEntityImage",value:function(){var e=Object(k.a)(f.a.mark((function e(){var t,a,i,n,s,l;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.state.selectedEntity.length>0)){e.next=6;break}for(a in t=[],this.state.changedEntities)i=this.state.changedEntities[a],n=0,a in this.state.entityTabIndex&&1==this.state.entityTabIndex[a]&&(i=this.state.uploadedImages[a],n=1),s={entity:a,url:i,timestamp:Date.now(),imageUploadtype:n},l=y.firestore().collection("Blockprobes").doc(this.props.bId).collection("images").doc(s.entity).set(s),t.push(l);return e.next=5,Promise.all(t);case 5:this.props.refreshBlockprobe();case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"generateEntityLists",value:function(){var e=1,t=this.state.firstEntitySelectList;Object.keys(this.props.investigationGraph).forEach((function(a){t.push({value:!1,label:a,id:e}),e++})),t.sort((function(e,t){return"none"==e.label.toLocaleLowerCase()?-1:"none"==t.label.toLocaleLowerCase()?1:e.label.toLocaleLowerCase()<t.label.toLocaleLowerCase()?-1:1}));var a="",i="";t.length>0&&((a=t[0].label)in this.props.imageMapping&&(i=this.props.imageMapping[a]),t[0].value=!0),this.setState({firstEntitySelectList:t,selectedEntity:a,selectedEntityUrl:i})}},{key:"firstEntityClicked",value:function(e){for(var t="",a="",i=0;i<e.length;i++)e[i].value&&((t=e[i].label)in this.state.changedEntities?a=this.state.changedEntities[t]:t in this.props.imageMapping&&(a=this.props.imageMapping[t]));this.setState({firstEntitySelectList:e,selectedEntity:t,selectedEntityUrl:a})}},{key:"firstSelectedBadgeClicked",value:function(e){for(var t="",a="",i=0;i<e.length;i++)e[i].value&&((t=e[i].label)in this.state.changedEntities?a=this.state.changedEntities[t]:t in this.props.imageMapping&&(a=this.props.imageMapping[t]));var n=0;t in this.state.entityTabIndex&&(n=this.state.entityTabIndex[t]),this.setState({firstEntitySelectList:e,selectedEntity:t,selectedEntityUrl:a,selectedTabIndex:n})}},{key:"componentDidMount",value:function(){this.generateEntityLists()}},{key:"handleChange",value:function(e,t){var a=!0;if("date"!=t&&"time"!=t){var i=e.target.value[e.target.value.length-1];"\n"!=i&&"\t"!=i||(a=!1)}if(a&&"entity"==t){var n=e.target.value,s=this.state.changedEntities,l=this.state.selectedEntity;this.state.selectedEntity&&(s[l]=n),this.setState({selectedEntityUrl:n,changedEntities:s})}}},{key:"canSubmit",value:function(){return!1}},{key:"uploadFileToDb",value:function(){var e=Object(k.a)(f.a.mark((function e(t){var a,i,n,s,l,r,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.state.uploadedImages,i=this.state.selectedEntity,n=this,s=this.props.bId+"/"+i,l=y.storage().ref(s),this.setState({isImageUploading:!0}),e.prev=6,e.next=9,l.put(t);case 9:return e.next=11,l.getDownloadURL();case 11:return r=e.sent,a[i]=r,o={entity:i,url:r,timestamp:Date.now(),imageUploadtype:1},e.next=16,y.firestore().collection("Blockprobes").doc(n.props.bId).collection("images").doc(o.entity).set(o);case 16:n.setState({uploadedImages:a,isImageUploading:!1,hasUpdated:!0}),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(6),n.setState({isImageUploading:!1});case 22:case"end":return e.stop()}}),e,this,[[6,19]])})));return function(t){return e.apply(this,arguments)}}()},{key:"removeImageFromDb",value:function(){var e=Object(k.a)(f.a.mark((function e(){var t,a,i,n,s,l;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.state.uploadedImages,a=this.state.selectedEntity,i=this,n=this.props.bId+"/"+a,s=y.storage().ref(n),this.setState({isImageUploading:!0}),e.prev=6,t[a]=null,l={entity:a,url:"",timestamp:Date.now(),imageUploadtype:1},e.next=11,s.delete();case 11:return e.next=13,y.firestore().collection("Blockprobes").doc(i.props.bId).collection("images").doc(l.entity).set(l);case 13:i.setState({uploadedImages:t,isImageUploading:!1,hasUpdated:!0}),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(6),i.setState({isImageUploading:!1});case 19:case"end":return e.stop()}}),e,this,[[6,16]])})));return function(){return e.apply(this,arguments)}}()},{key:"onDrop",value:function(){var e=Object(k.a)(f.a.mark((function e(t){var a,i,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.length>0)){e.next=12;break}return a=t[t.length-1],i={maxSizeMB:.015,maxWidthOrHeight:1920,useWebWorker:!0},e.prev=3,e.next=6,Object(ui.a)(a,i);case 6:n=e.sent,this.uploadFileToDb(n),e.next=12;break;case 10:e.prev=10,e.t0=e.catch(3);case 12:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getImageUrlFromFile",value:function(e){var t=this.state.uploadedImages,a=null;return e in t?a=t[e]:e in this.props.imageMapping&&(a=this.props.imageMapping[e]),a}},{key:"isImagePresent",value:function(e){var t=this.state.uploadedImages,a=null;return e in this.props.imageMapping&&(a=this.props.imageMapping[e]),e in t&&(a=t[e]),null!=a&&""!=a}},{key:"onChangeImageTab",value:function(e,t,a){var i=this.state.entityTabIndex;i[this.state.selectedEntity]=e,this.state.changedEntities[this.state.selectedEntity]="",this.setState({selectedTabIndex:e,entityTabIndex:i})}},{key:"getImageOptions",value:function(){return n.a.createElement("div",{style:{marginBottom:"40px"}},n.a.createElement(S.d,{selectedIndex:this.state.selectedTabIndex,onSelect:this.onChangeImageTab},n.a.createElement(S.b,null,n.a.createElement(S.a,null,"Upload Image")),n.a.createElement(S.c,null,n.a.createElement("div",null,n.a.createElement(di.a,{withIcon:!0,label:"Max-size: 5MB, Accepted formats: jpg|png|jpeg|gif|svg",buttonText:"Choose image",onChange:this.onDrop,singleImage:!0,imgExtension:[".jpg",".gif",".png",".svg",".jpeg"],maxFileSize:5242880}),n.a.createElement("div",null,this.state.isImageUploading?n.a.createElement("div",{style:{margin:"auto",width:"50px"}},n.a.createElement(Da.a,{type:"TailSpin",color:"#00BFFF",height:"50",width:"50"})):n.a.createElement("div",null,this.isImagePresent(this.state.selectedEntity)?n.a.createElement("div",{style:{textAlign:"center",marginBottom:"35px"}},n.a.createElement("span",{className:"removeImageButton",onClick:this.removeImageFromDb},"Remove image")):null,n.a.createElement("div",{style:{textAlign:"center"}},n.a.createElement(F.a,{src:[this.getImageUrlFromFile(this.state.selectedEntity)],style:{width:"200px",maxHeight:"200px",marginLeft:"1.1em"}}))))))))}},{key:"closeImagePane",value:function(){this.state.hasUpdated&&this.props.refreshBlockprobe(),this.props.closeImagePane()}},{key:"render",value:function(){return n.a.createElement("div",null,n.a.createElement("div",{className:"imagepane-filter-container"},n.a.createElement("div",{className:"imagepane-dropdown-container"},n.a.createElement(A.a,{options:this.state.firstEntitySelectList,optionClicked:this.firstEntityClicked.bind(this),selectedBadgeClicked:this.firstSelectedBadgeClicked.bind(this),selectedOptionsStyles:{color:"white",backgroundColor:"rgb(117, 106, 214)",borderRadius:"20px",fontSize:"0.6em",padding:"10px",maxWidth:"92%",wordWrap:"break-word"},optionsListStyles:{backgroundColor:"darkcyan",color:"white"},isSingleSelect:!0,isTextWrap:!1})),this.canSubmit()?n.a.createElement(rt.a,{color:"primary",variant:"contained",className:"imagePaneButton",onClick:this.submitEntityImage},"Save"):null,n.a.createElement(rt.a,{color:"primary",variant:"contained",className:"imagePaneButton",onClick:this.closeImagePane},"Close")),""==this.state.selectedEntity?null:this.getImageOptions())}}]),a}(n.a.Component)),Ui=(a(1680),n.a.forwardRef((function(e,t){return n.a.createElement(It.a,Object.assign({direction:"up",ref:t},e))}))),Ai=function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).state={entityName:null,label:null,dialogType:null,dialogText:{delete:{title:"Delete entity",desc:"You are about to delete this entity. This action cannot be reversed.\nDo you confirm?"},rename:{title:"Rename entity",desc:"You are about to rename this entity. This action cannot be reversed.\nDo you confirm?"},selected:{title:null,desc:null}},dialog:!1},Object(L.isNullOrUndefined)(e.entity)||Object(L.isNullOrUndefined)(e.entity.label)||(i.state.entityName=JSON.parse(JSON.stringify(e.entity.label)),i.state.label=JSON.parse(JSON.stringify(e.entity.label))),i.handleChange=i.handleChange.bind(Object(v.a)(i)),i.isEntityNameChanged=i.isEntityNameChanged.bind(Object(v.a)(i)),i.renameEntity=i.renameEntity.bind(Object(v.a)(i)),i.deleteEntity=i.deleteEntity.bind(Object(v.a)(i)),i.createBlockForEntityChange=i.createBlockForEntityChange.bind(Object(v.a)(i)),i.toggleDialog=i.toggleDialog.bind(Object(v.a)(i)),i.performAction=i.performAction.bind(Object(v.a)(i)),i}return Object(o.a)(a,[{key:"toggleDialog",value:function(e,t){var a=this.state.dialogText;"delete"==t?(a.selected.title=a.delete.title,a.selected.desc=a.delete.desc):"rename"==t&&(a.selected.title=a.rename.title,a.selected.desc=a.rename.desc),this.setState({dialog:e,dialogType:t})}},{key:"performAction",value:function(e){"delete"==e?this.deleteEntity():"rename"==e&&this.renameEntity(),this.setState({dialog:!1,dialogType:null})}},{key:"handleChange",value:function(e,t){var a=e.target.value;Oe(a,["\n","\t"])&&"entity-name"==t&&this.setState({entityName:e.target.value})}},{key:"isEntityNameChanged",value:function(){var e=this.state.entityName;return!Object(L.isNullOrUndefined)(e)&&!Object(L.isNullOrUndefined)(this.props.entity.label)&&e.length>0&&e!=this.props.entity.label}},{key:"componentWillReceiveProps",value:function(e){if(e.entity!=this.props.entity){var t=JSON.parse(JSON.stringify(e.entity.label)),a=JSON.parse(JSON.stringify(e.entity.label));this.setState({entityName:t,label:a})}}},{key:"createBlockForEntityChange",value:function(e,t){var a={curr:e,new:t},i={title:"",summary:"",entities:[],evidences:[],referenceBlock:null,timestamp:Date.now(),actionType:"entityChange",entityMap:a};this.props.commitBlockToBlockprobe(i)}},{key:"renameEntity",value:function(){var e=this.state.entityName,t=JSON.parse(JSON.stringify(this.props.entity.label));this.createBlockForEntityChange(t,e)}},{key:"deleteEntity",value:function(){var e=JSON.parse(JSON.stringify(this.props.entity.label));this.createBlockForEntityChange(e,null)}},{key:"render",value:function(){var e=this;return n.a.createElement("div",null,n.a.createElement("h4",{className:"manageSingleEntityTitle"}," Manage entity ",this.state.label),n.a.createElement(Xa.a,{open:this.state.dialog,TransitionComponent:Ui,keepMounted:!0,onClose:function(){return e.toggleDialog(!1,"delete")},"aria-labelledby":"alert-dialog-slide-title","aria-describedby":"alert-dialog-slide-description"},n.a.createElement(ei.a,{id:"alert-dialog-slide-title"},this.state.dialogText.selected.title),n.a.createElement($a.a,null,n.a.createElement(Za.a,{id:"alert-dialog-slide-description"},this.state.dialogText.selected.desc)),n.a.createElement(Qa.a,null,n.a.createElement(rt.a,{onClick:function(){return e.toggleDialog(!1,e.state.dialogType)},color:"primary"},"No"),n.a.createElement(rt.a,{onClick:function(){return e.performAction(e.state.dialogType)},color:"primary"},"Yes"))),n.a.createElement("div",{className:"entityEditLabelContainer"},n.a.createElement("div",{style:{marginBottom:"6px"}},"Edit Name"),n.a.createElement(Ra.a,{type:"text",variant:"outlined",value:this.state.entityName,onChange:function(t){e.handleChange(t,"entity-name")},placeholder:"Entity name",multiline:!0,rowsMax:"3",rows:"1",style:{background:"white",marginTop:"6px",marginBottom:"6px",minWidth:"40%",maxWidth:"50%",color:"darkBlue",fontWeight:"600"}})),n.a.createElement("div",{className:"entityOptionsContainer"},this.isEntityNameChanged()?n.a.createElement(rt.a,{variant:"contained",className:"renameEntityButton",onClick:function(){e.toggleDialog(!0,"rename")}},n.a.createElement("div",null,"Rename")):null,n.a.createElement(rt.a,{variant:"contained",className:"deleteEntityButton",onClick:function(){e.toggleDialog(!0,"delete")}},n.a.createElement("div",null,"Delete"))))}}]),a}(n.a.Component),Gi=a(1796),Pi=(a(583),a(1797)),Mi=a(1788),Fi=(Object(Pi.a)(),n.a.forwardRef((function(e,t){return n.a.createElement(It.a,Object.assign({direction:"up",ref:t},e))})),function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).state={summary:"",selectedEntities:[]},i.confirmEdge=i.confirmEdge.bind(Object(v.a)(i)),i.handleChange=i.handleChange.bind(Object(v.a)(i)),i.getEntities=i.getEntities.bind(Object(v.a)(i)),i}return Object(o.a)(a,[{key:"handleChange",value:function(e,t){var a=e.target.value;Oe(a,["\n","\t"])&&("connection-description"==t?this.setState({summary:e.target.value}):"entityA"==t&&this.setState({entityA:e.target.value}))}},{key:"getEntities",value:function(e,t){var a=[],i={};if(Object(L.isNullOrUndefined)(e)||Object.keys(e).forEach((function(e){e in i||a.push({label:e}),i[e]=!1})),!Object(L.isNullOrUndefined)(t))for(var n=0;n<t.length;n++)t[n].label in i||a.push({label:t[n].label});return a}},{key:"getLatestIndex",value:function(){var e=0;return this.props.lastIndexDraftBlocks.length>0&&(e=Math.max(e,this.props.lastIndexDraftBlocks[this.props.lastIndexDraftBlocks.length-1])),this.props.lastIndex&&(e=Math.max(e,this.props.lastIndex)),e}},{key:"commitBlockToBlockprobe",value:function(){for(var e=[],t=0;t<this.state.selectedEntities.length;t++)e.push({title:we(this.state.selectedEntities[t]),type:"None"});var a=this.getLatestIndex(),i={title:"#".concat(a+=.1," "),summary:this.state.summary,entities:e,evidences:[],referenceBlock:null,timestamp:Date.now(),actionType:"ADD"};this.props.commitBlockToBlockprobe(i)}},{key:"confirmEdge",value:function(){this.commitBlockToBlockprobe()}},{key:"render",value:function(){var e=this,t=this.getEntities(this.props.investigationGraph,this.props.entityPane);return n.a.createElement("div",null,n.a.createElement("h4",{className:"addEdgeTitle"}," Add connection"),n.a.createElement("div",{className:"addEdgeBlockTextContainer"},n.a.createElement(Ra.a,{type:"text",variant:"outlined",value:this.state.summary,onChange:function(t){e.handleChange(t,"connection-description")},label:"Add connection description",multiline:!0,rowsMax:"3",rows:"2",style:{background:"white",marginTop:"6px",marginBottom:"6px",width:"100%",color:"darkBlue",fontWeight:"600"}})),n.a.createElement("div",{className:"addEdgeEntityContainer"},n.a.createElement(Mi.a,{multiple:!0,id:"tags-filled",options:t.map((function(e){return e.label})),freeSolo:!0,renderTags:function(e,t){return e.map((function(e,a){return n.a.createElement(Gi.a,Object.assign({variant:"outlined",label:e},t({index:a})))}))},value:this.state.selectedEntities,onChange:function(t,a){e.setState({selectedEntities:a})},renderInput:function(e){return n.a.createElement(Ra.a,Object.assign({},e,{variant:"outlined",label:"Add topics"}))}})),2==this.state.selectedEntities.length?n.a.createElement(rt.a,{variant:"contained",onClick:function(){return e.confirmEdge()},className:"confirmEdgeButton"},"Confirm"):n.a.createElement("p",{className:"edgeEntityMessage"},"*Input exactly two topics that you want to create a connection between!"))}}]),a}(n.a.Component)),Vi=(Object(Pi.a)(),n.a.forwardRef((function(e,t){return n.a.createElement(It.a,Object.assign({direction:"up",ref:t},e))})),function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).state={summary:"",selectedEntities:[],baseEntity:[]},i.confirmEdge=i.confirmEdge.bind(Object(v.a)(i)),i.handleChange=i.handleChange.bind(Object(v.a)(i)),i.getEntities=i.getEntities.bind(Object(v.a)(i)),i}return Object(o.a)(a,[{key:"handleChange",value:function(e,t){var a=e.target.value;Oe(a,["\n","\t"])&&("connection-description"==t?this.setState({summary:e.target.value}):"entityA"==t&&this.setState({entityA:e.target.value}))}},{key:"getEntities",value:function(e,t){var a=[],i={};if(Object(L.isNullOrUndefined)(e)||Object.keys(e).forEach((function(e){e in i||a.push({label:e}),i[e]=!1})),!Object(L.isNullOrUndefined)(t))for(var n=0;n<t.length;n++)t[n].label in i||a.push({label:t[n].label});return a}},{key:"getLatestIndex",value:function(){var e=0;return this.props.lastIndexDraftBlocks.length>0&&(e=Math.max(e,this.props.lastIndexDraftBlocks[this.props.lastIndexDraftBlocks.length-1])),this.props.lastIndex&&(e=Math.max(e,this.props.lastIndex)),e}},{key:"commitBlocksToBlockprobe",value:function(){var e=this.getLatestIndex(),t=[],a=Date.now();e+=.1;for(var i=0;i<this.state.selectedEntities.length;i++)if(we(this.state.baseEntity[0])!=we(this.state.selectedEntities[i])){a+=10;var n=[];n.push({title:we(this.state.baseEntity[0]),type:"None"}),n.push({title:we(this.state.selectedEntities[i]),type:"None"});var s={title:"#".concat(e," "),summary:this.state.summary,entities:n,evidences:[],referenceBlock:null,timestamp:a,actionType:"ADD"};t.push(s)}this.props.commitMultipleBlocksToBlockprobe(t)}},{key:"confirmEdge",value:function(){this.commitBlocksToBlockprobe()}},{key:"render",value:function(){var e=this,t=this.getEntities(this.props.investigationGraph,this.props.entityPane);return n.a.createElement("div",null,n.a.createElement("h4",{className:"addEdgeTitle"}," Add connections"),n.a.createElement("div",{className:"addEdgeBlockTextContainer"},n.a.createElement(Ra.a,{type:"text",variant:"outlined",value:this.state.summary,onChange:function(t){e.handleChange(t,"connection-description")},label:"Add connection description",multiline:!0,rowsMax:"3",rows:"2",style:{background:"white",marginTop:"6px",marginBottom:"6px",width:"100%",color:"darkBlue",fontWeight:"600"}})),n.a.createElement("div",{className:"addEdgeEntityContainer primaryEntityContainer"},n.a.createElement(Mi.a,{multiple:!0,id:"tags-filled",options:t.map((function(e){return e.label})),freeSolo:!0,renderTags:function(e,t){return e.map((function(e,a){return n.a.createElement(Gi.a,Object.assign({variant:"outlined",label:e},t({index:a})))}))},value:this.state.baseEntity,onChange:function(t,a){e.setState({baseEntity:a})},renderInput:function(e){return n.a.createElement(Ra.a,Object.assign({},e,{variant:"outlined",label:"Primary topic"}))}})),n.a.createElement("div",{className:"addEdgeEntityContainer"},n.a.createElement(Mi.a,{multiple:!0,id:"tags-filled",options:t.map((function(e){return e.label})),freeSolo:!0,renderTags:function(e,t){return e.map((function(e,a){return n.a.createElement(Gi.a,Object.assign({variant:"outlined",label:e},t({index:a})))}))},value:this.state.selectedEntities,onChange:function(t,a){e.setState({selectedEntities:a})},renderInput:function(e){return n.a.createElement(Ra.a,Object.assign({},e,{variant:"outlined",label:"Secondary topics"}))}})),this.state.selectedEntities.length>=1&&1==this.state.baseEntity.length?n.a.createElement(rt.a,{variant:"contained",onClick:function(){return e.confirmEdge()},className:"confirmEdgeButton"},"Confirm"):n.a.createElement("p",{className:"edgeEntityMessage"},"*Input one primary topic and atleast one secondary topic!"))}}]),a}(n.a.Component)),Ri=(Object(Pi.a)(),n.a.forwardRef((function(e,t){return n.a.createElement(It.a,Object.assign({direction:"up",ref:t},e))})),function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).state={summary:"",selectedEntities:[]},i.confirmEdge=i.confirmEdge.bind(Object(v.a)(i)),i.handleChange=i.handleChange.bind(Object(v.a)(i)),i.getEntities=i.getEntities.bind(Object(v.a)(i)),i}return Object(o.a)(a,[{key:"handleChange",value:function(e,t){var a=e.target.value;Oe(a,["\n","\t"])&&("connection-description"==t?this.setState({summary:e.target.value}):"entityA"==t&&this.setState({entityA:e.target.value}))}},{key:"getEntities",value:function(e,t){var a=[],i={};if(Object(L.isNullOrUndefined)(e)||Object.keys(e).forEach((function(e){e in i||a.push({label:e}),i[e]=!1})),!Object(L.isNullOrUndefined)(t))for(var n=0;n<t.length;n++)t[n].label in i||a.push({label:t[n].label});return a}},{key:"getLatestIndex",value:function(){var e=0;return this.props.lastIndexDraftBlocks.length>0&&(e=Math.max(e,this.props.lastIndexDraftBlocks[this.props.lastIndexDraftBlocks.length-1])),this.props.lastIndex&&(e=Math.max(e,this.props.lastIndex)),e}},{key:"commitBlockToBlockprobe",value:function(){for(var e=[],t=0;t<this.state.selectedEntities.length;t++)e.push({title:we(this.state.selectedEntities[t]),type:"None"});var a=this.getLatestIndex(),i={title:"#".concat(a+=.1," "),summary:this.state.summary,entities:e,evidences:[],referenceBlock:null,timestamp:Date.now(),actionType:"ADD"};this.props.commitBlockToBlockprobe(i)}},{key:"confirmEdge",value:function(){this.commitBlockToBlockprobe()}},{key:"render",value:function(){var e=this,t=this.getEntities(this.props.investigationGraph,this.props.entityPane);return n.a.createElement("div",null,n.a.createElement("h4",{className:"addEdgeTitle"},"Add topic"),n.a.createElement("div",{className:"addEdgeBlockTextContainer"},n.a.createElement(Ra.a,{type:"text",variant:"outlined",value:this.state.summary,onChange:function(t){e.handleChange(t,"connection-description")},label:"Describe topic",multiline:!0,rowsMax:"3",rows:"2",style:{background:"white",marginTop:"6px",marginBottom:"6px",width:"100%",color:"darkBlue",fontWeight:"600"}})),n.a.createElement("div",{className:"addEdgeEntityContainer"},n.a.createElement(Mi.a,{multiple:!0,id:"tags-filled",options:t.map((function(e){return e.label})),freeSolo:!0,renderTags:function(e,t){return e.map((function(e,a){return n.a.createElement(Gi.a,Object.assign({variant:"outlined",label:e},t({index:a})))}))},value:this.state.selectedEntities,onChange:function(t,a){e.setState({selectedEntities:a})},renderInput:function(e){return n.a.createElement(Ra.a,Object.assign({},e,{variant:"outlined",label:"Add topics"}))}})),1==this.state.selectedEntities.length&&!Object(L.isNullOrUndefined)(this.state.summary)&&this.state.summary.length>0?n.a.createElement(rt.a,{variant:"contained",onClick:function(){return e.confirmEdge()},className:"confirmEdgeButton"},"Confirm"):n.a.createElement("p",{className:"edgeEntityMessage"},"*Input exactly one topic and describe it!"))}}]),a}(n.a.Component)),Wi=(a(1681),a(1702),function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).state={date:new Date,selectedDateStyle:"date",newBlock:{title:"",summary:"",blockDate:{}}},i.state.newBlock.blockDate={date:i.state.date.getDate(),month:i.state.date.getMonth(),year:i.state.date.getFullYear()},i.handleChange=i.handleChange.bind(Object(v.a)(i)),i.isDateChecked=i.isDateChecked.bind(Object(v.a)(i)),i.toggleDateStyle=i.toggleDateStyle.bind(Object(v.a)(i)),i.getLatestIndex=i.getLatestIndex.bind(Object(v.a)(i)),i.commitBlockToBlockprobe=i.commitBlockToBlockprobe.bind(Object(v.a)(i)),i.confirmTime=i.confirmTime.bind(Object(v.a)(i)),i}return Object(o.a)(a,[{key:"getLatestIndex",value:function(){var e=0;return this.props.lastIndexDraftBlocks.length>0&&(e=Math.max(e,this.props.lastIndexDraftBlocks[this.props.lastIndexDraftBlocks.length-1])),this.props.lastIndex&&(e=Math.max(e,this.props.lastIndex)),e}},{key:"commitBlockToBlockprobe",value:function(){var e=this.getLatestIndex(),t={title:"#".concat(e+=.1," ").concat(this.state.newBlock.title.trim()),summary:this.state.newBlock.summary.trim(),entities:[],evidences:[],blockDate:this.state.newBlock.blockDate,referenceBlock:null,timestamp:Date.now(),actionType:"ADD"};this.props.commitBlockToBlockprobe(t)}},{key:"confirmTime",value:function(){this.commitBlockToBlockprobe()}},{key:"toggleDateStyle",value:function(e){var t=this.state.newBlock,a=this.state.date;"month"==e&&"month"!=this.state.selectedDateStyle?t.blockDate&&(t.blockDate.date=null,a.setFullYear(t.blockDate.year),a.setMonth(t.blockDate.month),a.setDate(0),a.setHours(0),a.setMinutes(0),delete t.blockTime):"date"==e&&"date"!=this.state.selectedDateStyle&&t.blockDate&&(a=new Date,t.blockDate.date=1,Object(L.isNullOrUndefined)(t.blockDate.month)&&(t.blockDate.month=0),a.setFullYear(t.blockDate.year),a.setMonth(t.blockDate.month),a.setDate(1)),this.setState({selectedDateStyle:e,date:a,newBlock:t})}},{key:"isDateChecked",value:function(e){return e==this.state.selectedDateStyle}},{key:"handleChange",value:function(e,t){var a=!0;if("date"!=t&&"time"!=t){var i=e.target.value;Oe(i,"\n\t")||(a=!1)}if(a){var n=this.state.newBlock;"title"==t?(n.title=e.target.value,this.setState({newBlock:n})):"summary"==t?(n.summary=e.target.value,this.setState({newBlock:n})):"new-entity"==t?this.setState({newEntity:e.target.value}):"date"==t?("date"==this.state.selectedDateStyle?n.blockDate={date:e.getDate(),month:e.getMonth(),year:e.getFullYear()}:n.blockDate={date:null,month:e.month,year:e.year},this.setState({date:e,newBlock:n})):"time"==t&&(n.blockTime={minutes:e.minute,hours:e.hour24},this.setState({time:e,newBlock:n}))}}},{key:"render",value:function(){var e=this;return n.a.createElement("div",null,n.a.createElement("h4",{className:"addTimeTitle"}," Add timeline event"),n.a.createElement("div",{style:{marginBottom:"15px"}},n.a.createElement("div",null,n.a.createElement("div",{className:"addTimelineBlockTextContainer"},n.a.createElement("form",null,n.a.createElement("label",null,n.a.createElement(Ra.a,{type:"text",variant:"outlined",multiline:!0,label:"Add title",value:this.state.newBlock.title,onChange:function(t){e.handleChange(t,"title")},rowsMax:"2",rowsMin:"1",style:{background:"white",marginTop:"6px",marginBottom:"6px",width:"100%"}}),n.a.createElement(Ra.a,{type:"text",variant:"outlined",multiline:!0,label:"Add description",value:this.state.newBlock.summary,onChange:function(t){e.handleChange(t,"summary")},rowsMax:"13",rows:"3",style:{background:"white",marginTop:"6px",marginBottom:"6px",width:"100%"}})))),n.a.createElement("div",null,n.a.createElement(mi,{value:"date",isChecked:this.isDateChecked("date"),label:"Complete date",toggleChange:this.toggleDateStyle}),n.a.createElement(mi,{value:"month",isChecked:this.isDateChecked("month"),label:"Only month/year",toggleChange:this.toggleDateStyle})),"date"==this.state.selectedDateStyle?n.a.createElement("div",{style:{marginTop:"5px"}},n.a.createElement(fi.a,{selected:this.state.date,onChange:function(t){e.handleChange(t,"date")}})):null,"month"==this.state.selectedDateStyle?n.a.createElement("div",{style:{marginTop:"5px"}},n.a.createElement(gi,{date:this.state.newBlock.blockDate,onChange:function(t){e.handleChange(t,"date")}})):null),Object(L.isNullOrUndefined)(this.state.newBlock.blockDate)?n.a.createElement("p",{className:"timeEntityMessage"},"*Select a date for the timeline event!"):n.a.createElement(rt.a,{variant:"contained",onClick:function(){return e.confirmTime()},className:"confirmTimeButton"},"Confirm")))}}]),a}(n.a.Component)),Ji=n.a.forwardRef((function(e,t){return n.a.createElement(It.a,Object.assign({direction:"up",ref:t},e))})),Hi=function(e){Object(c.a)(i,e);var t=Object(d.a)(i);function i(e){var n;Object(r.a)(this,i),(n=t.call(this,e)).state={uIdHash:"",shajs:null,selectedDraftBlockId:null,displaySingleEntity:!0,entityPaneList:[],draftBlocks:{},successBlocks:{},toReviewBlocks:{},inReviewBlocks:{},blockStateMap:{},lastIndexDraftBlocks:[0],newBlock:{title:"",summary:"",blockState:"DRAFT",entities:[]},graphViewAddType:"single_connection",multiSelectedBlocks:{},dialogType:null,dialogText:{delete:{title:"Delete blocks",desc:"You are about to delete these blocks. This action cannot be reversed.\nDo you confirm?"},commit:{title:"Add blocks to story",desc:"You are about to add these blocks to the story.\nDo you confirm?"},selected:{title:null,desc:null}},dialog:!1,imageUploading:!1,blocksUploading:!1,viewPublishLink:!1,multiSelectDraftBlockStatus:!1,isCreateBlockClicked:!1,isCreateBulkBlockClicked:!1,isEntityPaneOpen:!1,isImagePaneOpen:!1,urlPrefix:"https://blprobe.com/view/",gameUrlPrefix:"https://blprobe.com/game/",tooltipText:{entityPane:[{title:"Your story is empty!",target:".entityPaneButtonTooltip",content:"First you have to define the entities or characters of your story. Click on this button to start defining the entities",disableBeacon:!0}],addBlocks:[{title:"Click on 'Contribute' to start adding content to your story!",target:".addBulkBlockButton",content:"",disableBeacon:!0}],draftBlock:[{title:"Click on any block (para) that you just added from the Draft list!",target:".draftBlocksList",content:"",disableBeacon:!0}],commitBlock:[{title:"Add your block to the story!",target:".inReviewBlockList",content:"Your block is in review. You can see it in this list. Since you are the creator of the story, you also get to review the block. But for now, you can skip the review and directly add it to the story. Click on your block in review.",disableBeacon:!0}]},showTooltip:{entityPane:!1,addBlocks:JSON.parse(JSON.stringify(e.buildStory)),draftBlock:!1,commitBlock:!1},selectedGraphNode:null};var s=a(149);return n.state.uIdHash=s("sha256").update(n.props.uId).digest("hex"),n.state.shajs=s,E.a.initialize("UA-143383035-1"),E.a.pageview("/userBlocks"),n.modifyBlockList=n.modifyBlockList.bind(Object(v.a)(n)),n.modifyBlockListWrapper=n.modifyBlockListWrapper.bind(Object(v.a)(n)),n.selectBlock=n.selectBlock.bind(Object(v.a)(n)),n.renderSingleBlock=n.renderSingleBlock.bind(Object(v.a)(n)),n.renderSingleDraftBlock=n.renderSingleDraftBlock.bind(Object(v.a)(n)),n.renderBlockOptions=n.renderBlockOptions.bind(Object(v.a)(n)),n.createBlock=n.createBlock.bind(Object(v.a)(n)),n.createBulkBlock=n.createBulkBlock.bind(Object(v.a)(n)),n.cancelBulkBlock=n.cancelBulkBlock.bind(Object(v.a)(n)),n.changeSelectedBlock=n.changeSelectedBlock.bind(Object(v.a)(n)),n.openEntityPane=n.openEntityPane.bind(Object(v.a)(n)),n.closeEntityPane=n.closeEntityPane.bind(Object(v.a)(n)),n.openImagePane=n.openImagePane.bind(Object(v.a)(n)),n.closeImagePane=n.closeImagePane.bind(Object(v.a)(n)),n.deleteNewBlock=n.deleteNewBlock.bind(Object(v.a)(n)),n.deleteMultipleDraftBlocks=n.deleteMultipleDraftBlocks.bind(Object(v.a)(n)),n.commitMultipleDraftBlocks=n.commitMultipleDraftBlocks.bind(Object(v.a)(n)),n.deleteDraftBlock=n.deleteDraftBlock.bind(Object(v.a)(n)),n.addDraftBlock=n.addDraftBlock.bind(Object(v.a)(n)),n.addDraftBlocksInBulk=n.addDraftBlocksInBulk.bind(Object(v.a)(n)),n.updateStoryEntities=n.updateStoryEntities.bind(Object(v.a)(n)),n.updateDraftBlock=n.updateDraftBlock.bind(Object(v.a)(n)),n.getRandomReviewer=n.getRandomReviewer.bind(Object(v.a)(n)),n.giveBlockToFirstReviewer=n.giveBlockToFirstReviewer.bind(Object(v.a)(n)),n.submitDraftBlock=n.submitDraftBlock.bind(Object(v.a)(n)),n.updateEntityPaneList=n.updateEntityPaneList.bind(Object(v.a)(n)),n.initEntityPane=n.initEntityPane.bind(Object(v.a)(n)),n.finishTooltip=n.finishTooltip.bind(Object(v.a)(n)),n.commitBlockToBlockprobe=n.commitBlockToBlockprobe.bind(Object(v.a)(n)),n.setDashboardVisualisation=n.setDashboardVisualisation.bind(Object(v.a)(n)),n.setShareVisualization=n.setShareVisualization.bind(Object(v.a)(n)),n.convertBlockMapToList=n.convertBlockMapToList.bind(Object(v.a)(n)),n.sortBlocks=n.sortBlocks.bind(Object(v.a)(n)),n.isSummaryBlocksAvailable=n.isSummaryBlocksAvailable.bind(Object(v.a)(n)),n.isGraphAvailable=n.isGraphAvailable.bind(Object(v.a)(n)),n.isTimelineAvailable=n.isTimelineAvailable.bind(Object(v.a)(n)),n.onSelectTab=n.onSelectTab.bind(Object(v.a)(n)),n.toggleMultiSelect=n.toggleMultiSelect.bind(Object(v.a)(n)),n.multiSelectBlocks=n.multiSelectBlocks.bind(Object(v.a)(n)),n.toggleDialog=n.toggleDialog.bind(Object(v.a)(n)),n.performAction=n.performAction.bind(Object(v.a)(n)),n.toggleGraphOptionStyle=n.toggleGraphOptionStyle.bind(Object(v.a)(n)),n.selectGraphNode=n.selectGraphNode.bind(Object(v.a)(n)),n.publishStory=n.publishStory.bind(Object(v.a)(n)),n}return Object(o.a)(i,[{key:"toggleDialog",value:function(e,t){var a=this.state.dialogText;"delete"==t?(a.selected.title=a.delete.title,a.selected.desc=a.delete.desc):"commit"==t&&(a.selected.title=a.commit.title,a.selected.desc=a.commit.desc),this.setState({dialog:e,dialogType:t})}},{key:"updateEntityPaneList",value:function(e){this.setState({entityPaneList:e})}},{key:"getRandomReviewer",value:function(e,t){if(!Object(L.isNullOrUndefined)(e))for(var a=Date.now()%e.length,i=0;i<e.length;i++){var n=(a+i)%e.length;if(!(e[n].id in t))return e[n]}return null}},{key:"giveBlockToFirstReviewer",value:function(e){var t={},a=JSON.stringify(this.props.bpDetails.reviewers),i=JSON.parse(a),n=this.getRandomReviewer(i,t);null!=n&&(e.blockState="TO REVIEW",t[n.id]="-",y.firestore().collection("Blockprobes").doc(e.bpID).collection("users").doc(n.id).collection("userBlocks").doc(e.key+"_r").set(e));var s={actionType:e.actionType,blockAuthor:this.state.uIdHash,entities:Object(L.isNullOrUndefined)(e.entities)?null:e.entities,evidences:Object(L.isNullOrUndefined)(e.evidences)?null:e.evidences,reviewers:t,summary:e.summary,timestamp:e.timestamp,title:e.title};y.database().ref("Blockprobes/"+e.bpID+"/reviewBlocks/"+e.key).set(s)}},{key:"modifyBlockList",value:function(e,t){if("SUCCESSFUL"==e.blockState&&"entityChange"!=e.actionType){var a=this.state.successBlocks;t&&this.props.blockStatus[e.key]?a[e.key]=e:delete a[e.key],this.setState({successBlocks:a})}else if("UNDER REVIEW"==e.blockState){a=this.state.inReviewBlocks;t?a[e.key]=e:delete a[e.key],this.setState({inReviewBlocks:a})}else if("TO REVIEW"==e.blockState){a=this.state.toReviewBlocks;t?a[e.key]=e:delete a[e.key],this.setState({toReviewBlocks:a})}else if("DRAFT"==e.blockState){var i=this.state.lastIndexDraftBlocks;a=this.state.draftBlocks;if(t){a[e.key]=e;var n=ue(e);Object(L.isNullOrUndefined)(n)||(i.push(n),i.sort())}else{var s=ue(a[e.key]);if(delete a[e.key],!Object(L.isNullOrUndefined)(s)){for(var l=[],r=!1,o=0;o<i.length;o++)r||i[o]!=s?l.push(i[o]):r=!0;i=l}}this.setState({draftBlocks:a,lastIndexDraftBlocks:i})}}},{key:"modifyBlockListWrapper",value:function(e,t){var a=e.data(),i=e.id,n=this.state.blockStateMap;if(i in n){var s=n[i],l={key:a.key,blockState:s};this.modifyBlockList(l,!1),t&&(this.modifyBlockList(a,!0),n[i]=a.blockState)}else t&&(n[i]=a.blockState,this.modifyBlockList(a,!0))}},{key:"deleteMultipleDraftBlocks",value:function(){var e=this.state.multiSelectedBlocks,t=this;Object.keys(e).map((function(e){t.deleteDraftBlock(e)})),e={},this.setState({multiSelectedBlocks:e})}},{key:"commitMultipleDraftBlocks",value:function(){var e=this,t=this.state.multiSelectedBlocks,a=[];Object.keys(t).map((function(t){t in e.state.draftBlocks&&a.push(e.state.draftBlocks[t])})),this.props.commitMultipleBlocksToBlockprobe(a),t={},this.setState({multiSelectedBlocks:t})}},{key:"deleteDraftBlock",value:function(e){y.firestore().collection("Blockprobes").doc(this.props.bId).collection("users").doc(this.state.uIdHash).collection("userBlocks").doc(e).delete()}},{key:"updateDraftBlock",value:function(e,t){y.firestore().collection("Blockprobes").doc(this.props.bId).collection("users").doc(this.state.uIdHash).collection("userBlocks").doc(e).set(t),this.updateStoryEntities(t)}},{key:"addDraftBlocksInBulk",value:function(e){var t=0;this.state.lastIndexDraftBlocks.length>0&&(t=Math.max(t,this.state.lastIndexDraftBlocks[this.state.lastIndexDraftBlocks.length-1])),this.props.lastIndex&&(t=Math.max(t,this.props.lastIndex));for(var a={},i=[],n=0;n<e.length;n++){if(e[n].entities)for(var s=0;s<e[n].entities.length;s++){var l=e[n].entities[s];l.title in a||(a[l.title]="",i.push(l))}"title"in e[n]||(e[n].title="");var r=ue(e[n]),o=fe(e[n].title);null==r?(e[n].title=ge(e[n].title),t+=.1,e[n].title="#"+String(t.toFixed(1))+(o?"s":"")+" "+e[n].title):r>t&&(t=r)}var c={entities:i};this.updateStoryEntities(c);var d=Date.now();for(n=0;n<e.length;n++)e[n].timestamp=d+1e3*n,this.addDraftBlock(e[n],!0);this.setState({isCreateBulkBlockClicked:!1});var u={blockprobe:this.props.bId,count:e.length};e.length>0&&this.finishTooltip("addBlocks"),E.a.event({category:"blocks",action:"Add blocks in bulk",label:JSON.stringify(u)})}},{key:"publishStory",value:function(){var e=this;this.setState({blocksUploading:!0,imageUploading:!0});var t=this.props.blockTree,a=oe(t);a.length>0?y.firestore().collection("public").doc(this.props.bId).collection("aggBlocks").get().then((function(t){t.forEach((function(t){y.firestore().collection("public").doc(e.props.bId).collection("aggBlocks").doc(t.id).delete()}));for(var i=0;i<a.length;i++)y.firestore().collection("public").doc(e.props.bId).collection("aggBlocks").doc(String(i)).set(a[i])})).then(this.setState({blocksUploading:!1})):this.setState({blocksUploading:!1});var i=this.props.imageMapping,n=ce(i);n.length>0?y.firestore().collection("public").doc(this.props.bId).collection("images").get().then((function(t){t.forEach((function(t){y.firestore().collection("public").doc(e.props.bId).collection("images").doc(t.id).delete()}));for(var a=0;a<n.length;a++)y.firestore().collection("public").doc(e.props.bId).collection("images").doc(String(a)).set(n[a])})).then(this.setState({imageUploading:!1})):this.setState({imageUploading:!1}),this.setState({viewPublishLink:!0})}},{key:"updateStoryEntities",value:function(e){var t=y.firestore().collection("Blockprobes").doc(this.props.bId).collection("users").doc(this.state.uIdHash).collection("session").doc("entityPane"),a=e.entities,i=this;if(a)y.firestore().runTransaction((function(e){return e.get(t).then((function(n){for(var s={},l=0;l<a.length;l++)s[a[l].title]="";var r=[];if(n.exists){r=n.data().entities;for(l=0;l<r.length;l++)r[l].label in s&&(r[l].canRemove=!1,delete s[r[l].label])}Object.keys(s).forEach((function(e){r.push({label:e,canRemove:!1})})),n.exists?e.update(t,{entities:r}):t.set({entities:r}),i.initEntityPane()}))}))}},{key:"addDraftBlock",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(L.isNullOrUndefined)(e.timestamp)&&(e.timestamp=Date.now());var a=this.state.shajs("sha256").update(this.state.uIdHash+String(e.timestamp)).digest("hex");Object(L.isNullOrUndefined)(e.blockState)&&(e.blockState="DRAFT"),e.key=a,e.actionType="ADD",e.bpID=this.props.bId,y.firestore().collection("Blockprobes").doc(this.props.bId).collection("users").doc(this.state.uIdHash).collection("userBlocks").doc(e.key).set(e),this.setState({isCreateBlockClicked:!1}),t||this.updateStoryEntities(e)}},{key:"submitDraftBlock",value:function(e){if(Object(L.isNullOrUndefined)(e.key)){e.timestamp=Date.now();var t=this.state.shajs("sha256").update(this.state.uIdHash+String(e.timestamp)).digest("hex");e.key=t,e.actionType="ADD"}e.bpID=this.props.bId,e.blockState="UNDER REVIEW",y.firestore().collection("Blockprobes").doc(this.props.bId).collection("users").doc(this.state.uIdHash).collection("userBlocks").doc(e.key).set(e),this.giveBlockToFirstReviewer(e),this.setState({isCreateBlockClicked:!1}),this.finishTooltip("draftBlock")}},{key:"componentDidMount",value:function(){var e=this;y.firestore().collection("Blockprobes").doc(this.props.bId).collection("users").doc(this.state.uIdHash).collection("userBlocks").onSnapshot((function(t){t.docChanges().forEach((function(t){"added"===t.type&&e.modifyBlockListWrapper(t.doc,!0),"modified"===t.type&&e.modifyBlockListWrapper(t.doc,!0),"removed"===t.type&&e.modifyBlockListWrapper(t.doc,!1)}))})),this.initEntityPane()}},{key:"changeSelectedBlock",value:function(e){this.setState({selectedDraftBlockId:e})}},{key:"renderSingleDraftBlock",value:function(e,t,a){return Object(L.isNullOrUndefined)(e)||Object(L.isNullOrUndefined)(e.blockState)||"DRAFT"!=e.blockState||Object(L.isNullOrUndefined)(e.key)||Object(L.isNullOrUndefined)(this.state.selectedDraftBlockId)||this.state.selectedDraftBlockId!=e.key?null:n.a.createElement(Si,{block:e,bId:this.props.bId,uIdHash:this.state.uIdHash,selectBlock:this.selectBlock,investigationGraph:this.props.investigationGraph,isNewBlock:a,deleteNewBlock:this.deleteNewBlock,deleteDraftBlock:this.deleteDraftBlock,addDraftBlock:this.addDraftBlock,updateDraftBlock:this.updateDraftBlock,submitDraftBlock:this.submitDraftBlock,commitBlockToBlockprobe:this.commitBlockToBlockprobe,entityPane:this.state.entityPaneList,draftBlockTooltip:this.state.showTooltip.draftBlock,finishTooltip:this.finishTooltip,selectedDraftBlockId:this.state.selectedDraftBlockId,changeSelectedBlock:this.changeSelectedBlock,bpDetails:this.props.bpDetails,isMultiSelect:!1,multiSelectBlocks:this.multiSelectBlocks,isBlockSelectedInMultiselect:!1})}},{key:"renderSingleBlock",value:function(e,t,a){if(Object(L.isNullOrUndefined)(e))return null;var i=!1;return this.state.multiSelectedBlocks[e.key]&&(i=!0),n.a.createElement(Si,{block:e,bId:this.props.bId,uIdHash:this.state.uIdHash,selectBlock:this.selectBlock,investigationGraph:this.props.investigationGraph,isNewBlock:a,deleteNewBlock:this.deleteNewBlock,deleteDraftBlock:this.deleteDraftBlock,addDraftBlock:this.addDraftBlock,updateDraftBlock:this.updateDraftBlock,submitDraftBlock:this.submitDraftBlock,commitBlockToBlockprobe:this.commitBlockToBlockprobe,entityPane:this.state.entityPaneList,draftBlockTooltip:this.state.showTooltip.draftBlock,finishTooltip:this.finishTooltip,selectedDraftBlockId:null,changeSelectedBlock:this.changeSelectedBlock,bpDetails:this.props.bpDetails,isMultiSelect:this.state.multiSelectDraftBlockStatus,multiSelectBlocks:this.multiSelectBlocks,isBlockSelectedInMultiselect:i})}},{key:"selectBlock",value:function(e){this.props.selectBlock(e)}},{key:"multiSelectBlocks",value:function(e){var t=this.state.multiSelectedBlocks;e in t?delete t[e]:t[e]=!0,this.setState({multiSelectedBlocks:t})}},{key:"createBlock",value:function(){this.setState({isCreateBlockClicked:!0})}},{key:"openEntityPane",value:function(){E.a.event({category:"entity pane",action:"entity pane opened",label:"entity pane opened"}),this.setState({isEntityPaneOpen:!0})}},{key:"closeEntityPane",value:function(e){e&&this.finishTooltip("entity"),this.setState({isEntityPaneOpen:!1})}},{key:"openImagePane",value:function(){this.setState({isImagePaneOpen:!0})}},{key:"closeImagePane",value:function(){this.setState({isImagePaneOpen:!1})}},{key:"createBulkBlock",value:function(){E.a.event({category:"bulk block pane",action:"bulk block pane opened",label:"bulk block pane opened"}),this.setState({isCreateBulkBlockClicked:!0})}},{key:"cancelBulkBlock",value:function(){this.setState({isCreateBulkBlockClicked:!1})}},{key:"deleteNewBlock",value:function(){this.setState({isCreateBlockClicked:!1})}},{key:"initEntityPane",value:function(){var e=this;y.firestore().collection("Blockprobes").doc(this.props.bId).collection("users").doc(this.state.uIdHash).collection("session").doc("entityPane").get().then((function(t){if(t.exists){var a=t.data().entities;e.setState({entityPaneList:a})}}))}},{key:"commitBlockToBlockprobe",value:function(){var e=Object(k.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.commitBlockToBlockprobe(t);case 2:return e.next=4,this.updateStoryEntities(t);case 4:this.finishTooltip("commitBlock"),E.a.event({category:"commit_blocks",action:"Committed blocks",label:this.props.bId});case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"finishTooltip",value:function(e){var t=this.state.showTooltip;"entity"==e?t.entityPane&&(t.entityPane=!1,t.addBlocks=!0):"addBlocks"==e?t.addBlocks&&(t.entityPane=!1,t.addBlocks=!1,t.draftBlock=!0):"draftBlock"==e?t.draftBlock&&(t.entityPane=!1,t.addBlocks=!1,t.draftBlock=!1,t.commitBlock=!0,this.props.finishBuildingStoryTooltip()):"commitBlock"==e&&t.draftBlock&&(t.entityPane=!1,t.addBlocks=!1,t.draftBlock=!1,t.commitBlock=!1,this.props.finishAddingBlockToStoryTooltip()),this.setState({showTooltip:t})}},{key:"renderBlockOptions",value:function(){return this.state.isCreateBlockClicked?n.a.createElement("div",null,this.renderSingleBlock(this.state.newBlock,this,!0)):this.state.isCreateBulkBlockClicked?n.a.createElement("div",null,n.a.createElement(Ii,{cancelBulkDraftBlock:this.cancelBulkBlock,addDraftBlocksInBulk:this.addDraftBlocksInBulk,investigationGraph:this.props.investigationGraph,entityPane:this.state.entityPaneList,addBlocksTooltip:this.state.showTooltip.addBlocks,finishTooltip:this.finishTooltip,uIdHash:this.state.uIdHash,uId:this.props.uId,bId:this.props.bId,lang:this.props.lang})):this.state.isEntityPaneOpen?n.a.createElement(Li,{closeEntityPane:this.closeEntityPane,investigationGraph:this.props.investigationGraph,bId:this.props.bId,uIdHash:this.state.uIdHash,updateEntityPaneList:this.updateEntityPaneList,entityPaneTooltip:this.state.showTooltip.entityPane,finishTooltip:this.finishTooltip}):this.state.isImagePaneOpen?n.a.createElement(Di,{closeImagePane:this.closeImagePane,investigationGraph:this.props.investigationGraph,bId:this.props.bId,uIdHash:this.state.uIdHash,imageMapping:this.props.imageMapping,permit:this.props.permit,refreshBlockprobe:this.props.refreshBlockprobe}):n.a.createElement("div",{className:"userblocks-header-container"},n.a.createElement("div",{className:"userblocks-options-container"},n.a.createElement(O.b,{styles:{options:{arrowColor:"#e3ffeb",beaconSize:"3em",primaryColor:"#05878B",backgroundColor:"#e3ffeb",overlayColor:"rgba(10,10,10, 0.4)",width:900,zIndex:1e3}},steps:this.state.tooltipText.entityPane,run:this.state.showTooltip.entityPane}),n.a.createElement(O.b,{styles:{options:{arrowColor:"#e3ffeb",beaconSize:"3em",primaryColor:"#05878B",backgroundColor:"#e3ffeb",overlayColor:"rgba(10,10,10, 0.4)",width:900,zIndex:1e3}},steps:this.state.tooltipText.addBlocks,run:this.state.showTooltip.addBlocks}),n.a.createElement("div",null,n.a.createElement(rt.a,{color:"primary",variant:"contained",className:"addBulkBlockButton",onClick:this.createBulkBlock},n.a.createElement("div",null,"Contribute"))),n.a.createElement("div",null,n.a.createElement(rt.a,{color:"primary",variant:"contained",className:"editEntitiesButton entityPaneButtonTooltip",onClick:this.openEntityPane},n.a.createElement("div",null,"Manage story entities"))),n.a.createElement("div",null,Object.keys(this.props.investigationGraph).length>0?n.a.createElement(rt.a,{color:"primary",variant:"contained",className:"editEntitiesButton",onClick:this.openImagePane},n.a.createElement("div",null,"Manage story images")):null),this.props.blockTree&&Object.keys(this.props.blockTree).length>0?n.a.createElement("div",null,n.a.createElement(rt.a,{color:"primary",variant:"contained",className:"editEntitiesButton",onClick:this.publishStory},n.a.createElement("div",null,"Publish"))):null),this.state.viewPublishLink?n.a.createElement("div",{className:"userBlocks-renderShare"},this.renderShareScreen()):null,n.a.createElement("div",{className:"contributeOpenTooltipTextContainer"},Object.keys(this.state.successBlocks).length>0?n.a.createElement("p",{className:"contributeOpenTooltipText"},"Click on the menu (top-left) and choose ",n.a.createElement("a",{className:"tooltip-selection",onClick:this.setDashboardVisualisation},"Dashboard")," to visualise your contributions. ",n.a.createElement("br",null),n.a.createElement("br",null),"Click on the menu (top-left) and choose ",n.a.createElement("a",{className:"tooltip-selection",onClick:this.setShareVisualization},"Share")," to share.",n.a.createElement("br",null),n.a.createElement("br",null)):n.a.createElement("div",null,Object.keys(this.state.draftBlocks).length>0?n.a.createElement("p",{className:"contributeOpenTooltipText"},"Click on any block (para) that you just added from the Draft list."):n.a.createElement("p",{className:"contributeOpenTooltipText"},"Click on ",n.a.createElement("a",{className:"tooltip-selection",onClick:this.createBulkBlock},"Contribute")," to add content to your story."))))}},{key:"setDashboardVisualisation",value:function(){this.props.setNewVisualisation("dashboard")}},{key:"setShareVisualization",value:function(){this.props.setNewVisualisation("publish_blockprobe")}},{key:"sortBlocks",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;e=e.trim(),t=t.trim();var n=0,s=0,l=!1,r=!1;if(e.length>0&&"#"===e.charAt(0)){for(var o="",c=1;c<e.length;c++)isNaN(parseInt(e.charAt(c),10))&&"."!==e[c]?o.length>0&&(n=parseFloat(o),l=!0):o+=e.charAt(c);o.length>0&&(n=parseFloat(o),l=!0)}if(t.length>0&&"#"===t.charAt(0)){for(o="",c=1;c<t.length;c++)isNaN(parseInt(t.charAt(c),10))&&"."!==t[c]?o.length>0&&(s=parseFloat(o),r=!0):o+=t.charAt(c);o.length>0&&(s=parseFloat(o),r=!0)}return!l&&r?1:l&&!r?-1:l&&r?n>s?1:-1:a>i?1:i>a?-1:e>t?1:-1}},{key:"convertBlockMapToList",value:function(e){var t=[];for(var a in e)a in e&&t.push(e[a]);var i=this;return t.sort((function(e,t){return i.sortBlocks(e.title,t.title,e.timestamp,t.timestamp)})),t}},{key:"isSummaryBlocksAvailable",value:function(){return!Object(L.isNullOrUndefined)(this.props.summaryBlocks)&&0!=this.props.summaryBlocks.length}},{key:"isGraphAvailable",value:function(){return!Object(L.isNullOrUndefined)(this.props.investigationGraph)&&0!=Object.keys(this.props.investigationGraph).length}},{key:"isTimelineAvailable",value:function(){return!!(this.props.timeline&&this.props.timeline.length>0)}},{key:"onSelectTab",value:function(e,t,a){1==e&&this.setState({multiSelectDraftBlockStatus:!1})}},{key:"toggleMultiSelect",value:function(){this.state.multiSelectDraftBlockStatus?this.setState({multiSelectDraftBlockStatus:!1}):this.setState({multiSelectDraftBlockStatus:!0,selectedDraftBlockId:""})}},{key:"performAction",value:function(e){"delete"==e?this.deleteMultipleDraftBlocks():"commit"==e&&this.commitMultipleDraftBlocks(),this.setState({dialog:!1,dialogType:null})}},{key:"selectGraphNode",value:function(e){var t={label:e};this.setState({selectedGraphNode:t})}},{key:"toggleGraphOptionStyle",value:function(e){this.setState({graphViewAddType:e})}},{key:"renderShareScreen",value:function(){var e=this,t=this.state.urlPrefix+this.props.bId,a=this.state.gameUrlPrefix+this.props.bId;return n.a.createElement(Mt.a,{elevation:6},n.a.createElement("div",{className:"userblocks-share-container"},n.a.createElement("div",{className:"userblocks-share-section-heading"},"Public link to visualize"),n.a.createElement("div",{className:"userblocks-share-url-div"},n.a.createElement("a",{href:t,target:"_blank",className:"userblocks-share-url"},t)),n.a.createElement("div",{className:"userblocks-share-section-heading"},"Public link to play game"),n.a.createElement("div",{className:"userblocks-share-url-div"},n.a.createElement("a",{href:a,target:"_blank",className:"userblocks-share-url"},a)),n.a.createElement(rt.a,{color:"primary",variant:"contained",className:"userblocks-share-close",onClick:function(){e.setState({viewPublishLink:!1})}},n.a.createElement("div",null,"Close"))))}},{key:"render",value:function(){var e=this,t=this,a=this.convertBlockMapToList(this.state.successBlocks),i=a.map((function(e){return t.renderSingleBlock(e,t,!1)}));0==a.length&&(i="No succesful contributions.");var s=this.convertBlockMapToList(this.state.toReviewBlocks).map((function(e){return t.renderSingleBlock(e,t,!1)})),l=this.convertBlockMapToList(this.state.draftBlocks),r=l.map((function(e){return t.renderSingleBlock(e,t,!1)})),o=l.map((function(e){return t.renderSingleDraftBlock(e,t,!1)}));0==l.length&&(r="No contributions in draft.");var c=this.convertBlockMapToList(this.state.inReviewBlocks).map((function(e){return t.renderSingleBlock(e,t,!1)}));return n.a.createElement("div",{className:"userBlocksDivContainer"},this.renderBlockOptions(),n.a.createElement("div",null,n.a.createElement(Xa.a,{open:this.state.dialog,TransitionComponent:Ji,keepMounted:!0,onClose:function(){return e.toggleDialog(!1,"delete")},"aria-labelledby":"alert-dialog-slide-title","aria-describedby":"alert-dialog-slide-description"},n.a.createElement(ei.a,{id:"alert-dialog-slide-title"},this.state.dialogText.selected.title),n.a.createElement($a.a,null,n.a.createElement(Za.a,{id:"alert-dialog-slide-description"},this.state.dialogText.selected.desc)),n.a.createElement(Qa.a,null,n.a.createElement(rt.a,{onClick:function(){return e.toggleDialog(!1,e.state.dialogType)},color:"primary"},"No"),n.a.createElement(rt.a,{onClick:function(){return e.performAction(e.state.dialogType)},color:"primary"},"Yes"))),n.a.createElement("div",{className:"visualization-tabs-title"},"My contributions"),n.a.createElement(S.d,{className:"blocksTab",onSelect:this.onSelectTab},n.a.createElement(S.b,null,n.a.createElement(S.a,null,"DRAFT"),n.a.createElement(S.a,null,"SUCCESSFUL"),Object.keys(this.state.inReviewBlocks).length>0?n.a.createElement(S.a,null,"IN REVIEW"):null,Object.keys(this.state.toReviewBlocks).length>0?n.a.createElement(S.a,null,"TO REVIEW"):null),n.a.createElement(S.c,null,Object.keys(this.state.draftBlocks).length>0?n.a.createElement("div",null,n.a.createElement(O.b,{styles:{options:{arrowColor:"#e3ffeb",beaconSize:"3em",primaryColor:"#05878B",backgroundColor:"#e3ffeb",overlayColor:"rgba(10,10,10, 0.4)",width:900,zIndex:1e3}},steps:this.state.tooltipText.draftBlock,run:this.state.showTooltip.draftBlock}),n.a.createElement("div",{className:"multiselect-button-container"},this.state.multiSelectDraftBlockStatus?n.a.createElement(rt.a,{variant:"contained",className:"multiSelectBlockButton",onClick:this.toggleMultiSelect},n.a.createElement("div",null,"Close multiselect")):n.a.createElement(rt.a,{variant:"contained",className:"multiSelectBlockButton",onClick:this.toggleMultiSelect},n.a.createElement("div",null,"Multiselect")),Object.keys(this.state.multiSelectedBlocks).length>0&&this.state.multiSelectDraftBlockStatus?n.a.createElement(rt.a,{variant:"contained",className:"multiSelectDeleteBlockButton",onClick:function(){e.toggleDialog(!0,"delete")}},n.a.createElement("div",null,"Delete")):null,Object.keys(this.state.multiSelectedBlocks).length>0&&this.state.multiSelectDraftBlockStatus?n.a.createElement(rt.a,{variant:"contained",className:"multiSelectCommitBlockButton",onClick:function(){e.toggleDialog(!0,"commit")}},n.a.createElement("div",null,"Add to story")):null),n.a.createElement(Mt.a,{className:"block-list-content draftBlocksList",elevation:3},n.a.createElement(Qt.a,null,r)),n.a.createElement("div",null,o)):n.a.createElement("div",{className:"blocklist-message"},r)),n.a.createElement(S.c,null,Object.keys(this.state.successBlocks).length>0?n.a.createElement("div",null,n.a.createElement(Mt.a,{className:"block-list-content",elevation:3},n.a.createElement(Qt.a,null,i))):n.a.createElement("div",{className:"blocklist-message"},i)),Object.keys(this.state.inReviewBlocks).length>0?n.a.createElement(S.c,null,n.a.createElement("div",null,n.a.createElement(O.b,{styles:{options:{arrowColor:"#e3ffeb",beaconSize:"3em",primaryColor:"#05878B",backgroundColor:"#e3ffeb",overlayColor:"rgba(10,10,10, 0.4)",width:900,zIndex:1e3}},steps:this.state.tooltipText.commitBlock,run:this.state.showTooltip.commitBlock}),n.a.createElement(Mt.a,{className:"block-list-content inReviewBlockList",elevation:3},n.a.createElement(Qt.a,null,c)))):null,Object.keys(this.state.toReviewBlocks).length>0?n.a.createElement(S.c,null,n.a.createElement("div",null,n.a.createElement(Mt.a,{className:"block-list-content",elevation:3},n.a.createElement(Qt.a,null,s)))):null)),n.a.createElement("div",{className:"contributionVisualizationContainer"},n.a.createElement("div",{className:"visualization-tabs-title"},"Visualizations"),n.a.createElement(S.d,{style:{marginTop:"10px"}},n.a.createElement(S.b,null,n.a.createElement(S.a,null,"Graph"),n.a.createElement(S.a,null,"Timeline"),n.a.createElement(S.a,null,"Summary")),n.a.createElement(S.c,null,n.a.createElement("div",{className:"graphVisualizationSingleEntity"},n.a.createElement("div",{style:{flexWrap:"wrap",display:"flex"}},n.a.createElement("div",null,n.a.createElement(mi,{value:"single_connection",isChecked:"single_connection"==this.state.graphViewAddType,label:"Single connection",toggleChange:this.toggleGraphOptionStyle})),n.a.createElement("div",null,n.a.createElement(mi,{value:"star_connections",isChecked:"star_connections"==this.state.graphViewAddType,label:"Multiple connections",toggleChange:this.toggleGraphOptionStyle})),n.a.createElement("div",null,n.a.createElement(mi,{value:"single_topic",isChecked:"single_topic"==this.state.graphViewAddType,label:"Single topic",toggleChange:this.toggleGraphOptionStyle}))),"single_connection"==this.state.graphViewAddType?n.a.createElement(Fi,{entityPane:this.state.entityPaneList,commitBlockToBlockprobe:this.props.commitBlockToBlockprobe,investigationGraph:this.props.investigationGraph,lastIndexDraftBlocks:this.state.lastIndexDraftBlocks,lastIndex:this.props.lastIndex}):null,"star_connections"==this.state.graphViewAddType?n.a.createElement(Vi,{entityPane:this.state.entityPaneList,commitBlockToBlockprobe:this.props.commitBlockToBlockprobe,investigationGraph:this.props.investigationGraph,lastIndexDraftBlocks:this.state.lastIndexDraftBlocks,lastIndex:this.props.lastIndex,commitMultipleBlocksToBlockprobe:this.props.commitMultipleBlocksToBlockprobe}):null,"single_topic"==this.state.graphViewAddType?n.a.createElement(Ri,{entityPane:this.state.entityPaneList,commitBlockToBlockprobe:this.props.commitBlockToBlockprobe,investigationGraph:this.props.investigationGraph,lastIndexDraftBlocks:this.state.lastIndexDraftBlocks,lastIndex:this.props.lastIndex}):null),this.isGraphAvailable()?n.a.createElement("div",null,!Object(L.isNullOrUndefined)(this.state.selectedGraphNode)&&this.state.displaySingleEntity?n.a.createElement("div",{className:"graphVisualizationSingleEntity"},n.a.createElement(Ai,{entity:this.state.selectedGraphNode,commitBlockToBlockprobe:this.props.commitBlockToBlockprobe})):null,n.a.createElement(Ke,{blockTree:this.props.blockTree,investigationGraph:this.props.investigationGraph,selectBlock:this.props.selectBlock,imageMapping:this.props.imageMapping,multiSelectEntityList:this.props.multiSelectEntityList,lang:this.props.lang,selectNode:this.selectGraphNode})):n.a.createElement("div",{className:"blocklist-message"},"No content available for graph.")),n.a.createElement(S.c,null,n.a.createElement("div",{className:"graphVisualizationSingleEntity"},n.a.createElement(Wi,{commitBlockToBlockprobe:this.props.commitBlockToBlockprobe,lastIndexDraftBlocks:this.state.lastIndexDraftBlocks,lastIndex:this.props.lastIndex})),this.isTimelineAvailable()?n.a.createElement("div",{class:"contributions-timeline-container"},n.a.createElement(Ze,{timeline:this.props.timeline,selectBlock:this.props.selectBlock})):n.a.createElement("div",{className:"blocklist-message"},"No content available for timeline.")),n.a.createElement(S.c,null,this.isSummaryBlocksAvailable()?n.a.createElement("div",null,n.a.createElement(D,{summaryBlocks:this.props.summaryBlocks,selectBlock:this.props.selectBlock})):n.a.createElement("div",{className:"blocklist-message"},"No content available for summary.")))))}}]),i}(n.a.Component),zi=(a(10),a(1682),function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;if(Object(r.a)(this,a),(i=t.call(this,e)).state={newValue:"",prevPropsValue:null,clickedOnEdit:!1,limits:{title:{char:160}}},!Object(L.isNullOrUndefined)(e.value)){var n=JSON.parse(JSON.stringify(e.value));i.setState({newValue:n,prevPropsValue:n})}return i.isValid=i.isValid.bind(Object(v.a)(i)),i.clickOnButton=i.clickOnButton.bind(Object(v.a)(i)),i.handleChange=i.handleChange.bind(Object(v.a)(i)),i}return Object(o.a)(a,[{key:"clickOnButton",value:function(e){if("edit"==e)this.setState({clickedOnEdit:!0});else if("close"==e)this.setState({newValue:JSON.parse(JSON.stringify(this.state.prevPropsValue)),clickedOnEdit:!1});else if("save"==e){this.setState({clickedOnEdit:!1});var t={actionType:"BpDetails",timestamp:Date.now()};"title"==this.props.type&&(t.title=this.state.newValue),this.props.commitBlockToBlockprobe(t)}}},{key:"handleChange",value:function(e,t){var a=!0,i=e.target.value[e.target.value.length-1];if("\n"!=i&&"\t"!=i||(a=!1),a){var n=this.state.newValue;"title"==t?(n=(n=e.target.value).substring(0,this.state.limits.title.char-1),this.setState({newValue:n})):"summary"==t&&(n=e.target.value,this.setState({newValue:n}))}}},{key:"isValid",value:function(){return""!=this.state.newValue.trim()}},{key:"componentDidUpdate",value:function(){if(!this.state.clickedOnEdit&&this.state.prevPropsValue!=this.props.value&&!Object(L.isNullOrUndefined)(this.props.value)){var e=JSON.parse(JSON.stringify(this.props.value));this.setState({newValue:e,prevPropsValue:e})}}},{key:"render",value:function(){var e=this;return n.a.createElement("div",null,this.state.clickedOnEdit?n.a.createElement("div",null,n.a.createElement("form",{className:"newBlockprobeForm"},n.a.createElement("label",null,n.a.createElement(Ra.a,{type:"text",variant:"outlined",multiline:!0,placeholder:"Enter "+this.props.type,value:this.state.newValue,onChange:function(t){e.handleChange(t,"title")},rowsMax:"2",rows:"1",style:{background:"white",marginTop:"6px",marginBottom:"6px",textColor:"black",fontWeight:"600",marginLeft:"1em",width:"95%"}}))),this.isValid()?n.a.createElement(rt.a,{color:"primary",variant:"contained",className:"submit-bpDetail-button",onClick:function(){e.clickOnButton("save")}},n.a.createElement("div",null,"Confirm")):null,n.a.createElement(rt.a,{color:"primary",variant:"contained",className:"close-bpDetail-button",onClick:function(){e.clickOnButton("close")}},n.a.createElement("div",null,"Close"))):n.a.createElement("div",null,"title"==this.props.type?n.a.createElement("h2",null,this.props.value,Object(L.isNullOrUndefined)(this.props.value)||"CREATOR"!=this.props.permit?null:n.a.createElement(rt.a,{color:"primary",variant:"contained",className:"edit-bpDetail-button",onClick:function(){e.clickOnButton("edit")}},"Edit ",this.props.type)):null))}}]),a}(n.a.Component)),_i=function(e){Object(c.a)(i,e);var t=Object(d.a)(i);function i(e){var n;Object(r.a)(this,i),(n=t.call(this,e)).changeSelectedBlock=function(e){"SUCCESSFUL"==e.blockState&&n.state.modifyRef[e.key]&&((e=n.state.blockTree[n.state.modifyRef[n.state.modifyRef[e.key]]]).blockState="SUCCESSFUL",e.bpID=n.props.bId),n.setState({selectedBlock:e}),n.onSetSelectedBlockSidebarOpen(!0)},n.state={uIdHash:"",shajs:null,genesisBlockId:"",blockprobeTitle:null,bpDetailsLastTs:0,blockprobeSummary:"",bpDetails:{},lang:"en",langLoading:!0,modifyRef:{},blockStatus:{},selectedBlock:"",blockTree:{},investigationGraph:{},imageMapping:{},entityChanges:{},timeline:[],summaryList:[],latestBlock:null,selectedBlockSidebarOpen:!1,menuBarOpen:!1,selectedVisualisation:"contributions",lastTitleIndex:0,coUsers:{},multiSelectEntityList:[{value:!0,label:"All",id:0},{value:!1,label:"None",id:-1}],testList:[],isloading:{bpDetails:!0,blockprobe:!0,images:!0},tooltipText:{menuClickFirst:[{title:"Let's see your story!",target:".menu-button",content:"Click on the menu icon.",disableBeacon:!0}],preShareStory:[{title:"Let's share your story with friends!",target:".menu-button",content:"Click on the menu icon.",disableBeacon:!1,placementBeacon:"left",event:"hover"}]},showTooltip:{buildStory:JSON.parse(JSON.stringify(e.buildStorytooltip)),preCommitToStory:!1,commitToStory:!1,menuClickFirst:!1,viewDashboardView:!1,preShareStory:!1,shareStory:!1}};var s=a(149);return n.state.uIdHash=s("sha256").update(n.props.uId).digest("hex"),n.state.shajs=s,Object(L.isNullOrUndefined)(e.permit)||"VIEWER"!=e.permit||(n.state.selectedVisualisation="dashboard"),n.bpDetailsDoc=null,n.bpUsersRef=null,n.bpLangRef=null,E.a.initialize("UA-143383035-1"),E.a.pageview("/userBlockprobePrivate"),n.changeSelectedBlock=n.changeSelectedBlock.bind(Object(v.a)(n)),n.onSetSelectedBlockSidebarOpen=n.onSetSelectedBlockSidebarOpen.bind(Object(v.a)(n)),n.onSetMenuBlockSidebarOpen=n.onSetMenuBlockSidebarOpen.bind(Object(v.a)(n)),n.renderVisualisation=n.renderVisualisation.bind(Object(v.a)(n)),n.setNewVisualisation=n.setNewVisualisation.bind(Object(v.a)(n)),n.addEdge=n.addEdge.bind(Object(v.a)(n)),n.createInvestigationGraph=n.createInvestigationGraph.bind(Object(v.a)(n)),n.closeSelectedBlockSidebar=n.closeSelectedBlockSidebar.bind(Object(v.a)(n)),n.getImages=n.getImages.bind(Object(v.a)(n)),n.refreshBlockprobe=n.refreshBlockprobe.bind(Object(v.a)(n)),n.sortBlocks=n.sortBlocks.bind(Object(v.a)(n)),n.isSummaryBlock=n.isSummaryBlock.bind(Object(v.a)(n)),n.createSummaryList=n.createSummaryList.bind(Object(v.a)(n)),n.generateMultiSelectEntityList=n.generateMultiSelectEntityList.bind(Object(v.a)(n)),n.finishBuildingStoryTooltip=n.finishBuildingStoryTooltip.bind(Object(v.a)(n)),n.startAddBlockToStoryTooltip=n.startAddBlockToStoryTooltip.bind(Object(v.a)(n)),n.finishAddingBlockToStoryTooltip=n.finishAddingBlockToStoryTooltip.bind(Object(v.a)(n)),n.finishOpenMenuForDashboard=n.finishOpenMenuForDashboard.bind(Object(v.a)(n)),n.finishDashboardView=n.finishDashboardView.bind(Object(v.a)(n)),n.startShowingShareStoryTooltip=n.startShowingShareStoryTooltip.bind(Object(v.a)(n)),n.finishShareStoryTooltip=n.finishShareStoryTooltip.bind(Object(v.a)(n)),n.writeShortBlocktree=n.writeShortBlocktree.bind(Object(v.a)(n)),n.getBlockTree=n.getBlockTree.bind(Object(v.a)(n)),n.getLatestTimestamp=n.getLatestTimestamp.bind(Object(v.a)(n)),n.getLatestBlocks=n.getLatestBlocks.bind(Object(v.a)(n)),n.buildBlocktree=n.buildBlocktree.bind(Object(v.a)(n)),n.commitBlockToBlockprobe=n.commitBlockToBlockprobe.bind(Object(v.a)(n)),n.commitMultipleBlocksToBlockprobe=n.commitMultipleBlocksToBlockprobe.bind(Object(v.a)(n)),n.commitSingleBlockToBlockprobe=n.commitSingleBlockToBlockprobe.bind(Object(v.a)(n)),n}return Object(o.a)(i,[{key:"finishBuildingStoryTooltip",value:function(){var e=this.state.showTooltip;e.buildStory=!1,e.preCommitToStory=!0,e.commitToStory=!1,e.menuClickFirst=!1,e.viewDashboardView=!1,this.setState({showTooltip:e})}},{key:"startAddBlockToStoryTooltip",value:function(){var e=this.state.showTooltip;e.buildStory=!1,e.preCommitToStory=!1,e.commitToStory=!0,e.menuClickFirst=!1,e.viewDashboardView=!1,this.setState({showTooltip:e})}},{key:"finishAddingBlockToStoryTooltip",value:function(){var e=this.state.showTooltip;e.buildStory=!1,e.preCommitToStory=!1,e.commitToStory=!1,e.menuClickFirst=!0,e.viewDashboardView=!1,this.setState({showTooltip:e}),E.a.event({category:"open_menu_tooltip",action:"Open menu tooltip",label:this.props.bId})}},{key:"finishOpenMenuForDashboard",value:function(){var e=this.state.showTooltip;e.buildStory=!1,e.preCommitToStory=!1,e.commitToStory=!1,e.menuClickFirst=!1,e.viewDashboardView=!0,this.setState({showTooltip:e})}},{key:"finishDashboardView",value:function(){var e=this.state.showTooltip;e.buildStory=!1,e.commitToStory=!1,e.menuClickFirst=!1,e.viewDashboardView=!1,e.preShareStory=!0,e.shareStory=!1,this.setState({showTooltip:e})}},{key:"startShowingShareStoryTooltip",value:function(){var e=this.state.showTooltip;e.buildStory=!1,e.commitToStory=!1,e.menuClickFirst=!1,e.viewDashboardView=!1,e.preShareStory=!1,e.shareStory=!0,this.setState({showTooltip:e})}},{key:"finishShareStoryTooltip",value:function(){var e=this.state.showTooltip;e.buildStory=!1,e.commitToStory=!1,e.menuClickFirst=!1,e.viewDashboardView=!1,e.shareStory=!1,this.setState({showTooltip:e})}},{key:"setNewVisualisation",value:function(e){this.state.visualisation!=e&&("publish_blockprobe"==e?this.state.showTooltip.shareStory&&this.finishShareStoryTooltip():this.state.showTooltip.shareStory&&this.finishDashboardView(),"dashboard"==e?this.state.showTooltip.viewDashboardView&&this.finishDashboardView():this.state.showTooltip.viewDashboardView&&this.finishAddingBlockToStoryTooltip(),this.setState({selectedVisualisation:e,menuBarOpen:!1}))}},{key:"onSetSelectedBlockSidebarOpen",value:function(e){e?this.state.showTooltip.preCommitToStory&&this.startAddBlockToStoryTooltip():this.state.showTooltip.commitToStory&&this.finishBuildingStoryTooltip(),this.setState({selectedBlockSidebarOpen:e})}},{key:"onSetMenuBlockSidebarOpen",value:function(e){e?(this.state.showTooltip.menuClickFirst?this.finishOpenMenuForDashboard():this.state.showTooltip.preShareStory&&this.startShowingShareStoryTooltip(),E.a.event({category:"open_menu",action:"Opened menu",label:this.props.bId})):("dashboard"!=this.state.selectedVisualisation&&this.state.showTooltip.viewDashboardView&&this.finishAddingBlockToStoryTooltip(),"publish_blockprobe"!=this.state.selectedVisualisation&&this.state.showTooltip.shareStory&&this.finishDashboardView()),this.setState({menuBarOpen:e})}},{key:"addBlocksToProbe",value:function(e){var t=this.state.blockTree;e.key in t&&(Object(L.isNullOrUndefined)(t[e.key].children)||(e.children=Object(Ja.a)(t[e.key].children))),t[e.key]=e;var a=e.previousKey;a in t?Object(L.isNullOrUndefined)(t[a].children)&&(t[a].children=[]):t[a]={children:[]},t[a].children.push(e.key);var i=this.state.latestBlock;(Object(L.isNullOrUndefined)(i)||i.timestamp<e.timestamp)&&(i=e);var n=ue(e),s=this.state.lastTitleIndex;s=Math.max(n,s),this.setState({blockTree:t,latestBlock:i,lastTitleIndex:s}),"genesis"==e.actionType&&(document.title=e.title,this.setState({genesisBlockId:e.key,blockprobeTitle:e.title,bpDetailsLastTs:0,blockprobeSummary:e.summary}))}},{key:"traverseBlockTree",value:function(e,t,a,i,n,s,l){var r=this,o=this.state.blockTree[e];if(!Object(L.isNullOrUndefined)(o)){try{if("entityChange"==o.actionType&&!Object(L.isNullOrUndefined)(o.entityMap)){var c=o.entityMap.curr,d=o.entityMap.new,u=o.timestamp;c in l||(l[c]=[]),l[c].push({ts:u,change:d})}if("BpDetails"==o.actionType){var h=o.timestamp,p=this.state.bpDetailsLastTs;!Object(L.isNullOrUndefined)(h)&&h>p&&this.setState({blockprobeTitle:o.title,blockprobeSummary:o.summary,bpDetailsLastTs:h})}if("REMOVE"!=o.actionType?(i.push(o.key),n[o.key]=!0):(n[o.referenceBlock]=!1,null!=s[o.referenceBlock]&&void 0!=s[o.referenceBlock]&&(n[s[o.referenceBlock]]=!1)),null==o.blockDate&&null==o.blockTime||("REMOVE"!=o.actionType?(t.push(o.key),a[o.key]=!0):a[o.referenceBlock]=!1),"MODIFY"==o.actionType){var m=s[o.referenceBlock],b=o.key,f=this.state.blockTree[s[o.referenceBlock]].timestamp,g=o.timestamp;n[m]?g>f?(n[m]=!1,a[m]=!1,s[m]=o.referenceBlock,s[o.referenceBlock]=b,s[b]=b):(n[b]=!1,a[b]=!1,s[b]=o.referenceBlock,s[o.referenceBlock]=m):(n[o.key]=!1,a[o.key]=!1,s[b]=o.referenceBlock)}else s[o.key]=o.key;this.setState({timeline:t})}catch(v){}var k={};Object(L.isNullOrUndefined)(o.children)||o.children.forEach((function(o){if(r.state.blockTree[o].previousKey==e&&!(o in k))try{r.traverseBlockTree(o,t,a,i,n,s,l)}catch(c){}k[o]=!0}))}}},{key:"addEdge",value:function(e,t,a,i){i in e[a].edges||(e[a].edges[i]=[]),e[a].edges[i].push(t.key)}},{key:"sortBlocks",value:function(e,t){e=e.trim(),t=t.trim();var a=0,i=0,n=!1,s=!1;if(e.length>0&&"#"===e.charAt(0))for(var l="",r=1;r<e.length;r++)isNaN(parseInt(e.charAt(r),10))&&"."!==e[r]?l.length>0&&(a=parseFloat(l),n=!0):l+=e.charAt(r);if(t.length>0&&"#"===t.charAt(0))for(l="",r=1;r<t.length;r++)isNaN(parseInt(t.charAt(r),10))&&"."!==t[r]?l.length>0&&(i=parseFloat(l),s=!0):l+=t.charAt(r);return!n&&s?1:n&&!s?-1:n&&s?a>i?1:-1:e>t?1:-1}},{key:"isSummaryBlock",value:function(e){var t=e.title;if((t=t.trim()).length>0&&"#"===t.charAt(0))for(var a=1;a<t.length;a++){if(" "==t.charAt(a))return!1;if("s"==t.charAt(a)||"S"==t.charAt(a))return!0}return!1}},{key:"createSummaryList",value:function(e){var t=this,a=[];e.forEach((function(e){var i=t.state.blockTree[e];t.isSummaryBlock(i)&&a.push(i)})),a.sort((function(e,a){return t.sortBlocks(e.title,a.title)})),this.setState({summaryList:a})}},{key:"createInvestigationGraph",value:function(e){var t=this,a={};e.forEach((function(e){var i=t.state.blockTree[e];if(null!=i.entities){for(var n=0;n<i.entities.length;n++){(s=i.entities[n].title)in a||(a[s]={char:[],edges:{}})}if(1==i.entities.length){var s=i.entities[0].title;a[s].char.push(i.key)}else if(i.entities.length>1)for(n=0;n<i.entities.length;n++)for(var l=n+1;l<i.entities.length;l++)t.addEdge(a,i,i.entities[n].title,i.entities[l].title),t.addEdge(a,i,i.entities[l].title,i.entities[n].title)}})),this.setState({investigationGraph:a}),this.generateMultiSelectEntityList()}},{key:"generateMultiSelectEntityList",value:function(){for(var e=1,t=this.state.multiSelectEntityList,a={},i=2;i<t.length;i++)a[t[i].label]=!0,t[i].id>=e&&(e=t[i].id+1);Object.keys(this.state.investigationGraph).forEach((function(i){i in a||(t.push({value:!1,label:i,id:e}),e++)})),t.sort((function(e,t){return"all"==e.label.toLocaleLowerCase()?-1:"all"==t.label.toLocaleLowerCase()?1:"none"==e.label.toLocaleLowerCase()?-1:"none"==t.label.toLocaleLowerCase()?1:e.label.toLocaleLowerCase()<t.label.toLocaleLowerCase()?-1:1})),this.setState({multiSelectEntityList:t})}},{key:"getImages",value:function(e){var t=this,a=this.state.imageMapping;e.forEach((function(e){a[e.data().entity]=e.data().url})),this.setState({imageMapping:a});var i=ce(a);i.length>0&&y.firestore().collection("Blockprobes").doc(this.props.bId).collection("users").doc(this.state.uIdHash).collection("shortImages").get().then((function(e){e.forEach((function(e){y.firestore().collection("Blockprobes").doc(t.props.bId).collection("users").doc(t.state.uIdHash).collection("shortImages").doc(e.id).delete()}));for(var a=0;a<i.length;a++)y.firestore().collection("Blockprobes").doc(t.props.bId).collection("users").doc(t.state.uIdHash).collection("shortImages").doc(String(a)).set(i[a])}))}},{key:"createBlockprobe",value:function(e){var t=this;e.forEach((function(e){return t.addBlocksToProbe(e)}));var a=[],i={},n=[],s={},l={},r={};try{for(var o in this.traverseBlockTree(this.state.genesisBlockId,a,i,n,s,l,r),r)r[o].sort((function(e,t){return e.ts-t.ts}));je(n,this.state.blockTree,r);if(this.props.prevTitle!=this.state.blockprobeTitle){var c=JSON.parse(JSON.stringify(this.props.currBlockprobe));c.title=this.state.blockprobeTitle,c.timestamp=this.state.bpDetailsLastTs,this.props.modifyBlockprobe("update",c);for(var d=this.props.posts,u=-1,h=0;h<d.length;h++)if(d[h].bp==this.props.bId){u=h;break}u>-1&&(d[u].title=this.state.blockprobeTitle,this.props.updatePosts(d,this.props.bId))}}catch(b){}var p=[];a.forEach((function(e){i[e]&&s[e]&&p.push(t.state.blockTree[e])})),ve(p),this.setState({timeline:[].concat(p),modifyRef:l,blockStatus:s,entityChanges:r});var m=[];n.forEach((function(e){s[e]&&m.push(e)})),this.createInvestigationGraph(m),this.createSummaryList(m)}},{key:"writeShortBlocktree",value:function(){var e=this,t=oe(this.state.blockTree);t&&t.length>0&&y.firestore().collection("Blockprobes").doc(this.props.bId).collection("users").doc(this.state.uIdHash).collection("shortBlockprobe").get().then((function(a){a.forEach((function(t){y.firestore().collection("Blockprobes").doc(e.props.bId).collection("users").doc(e.state.uIdHash).collection("shortBlockprobe").doc(t.id).delete()}));for(var i=0;i<t.length;i++)y.firestore().collection("Blockprobes").doc(e.props.bId).collection("users").doc(e.state.uIdHash).collection("shortBlockprobe").doc(String(i)).set(t[i])}))}},{key:"refreshBlockprobe",value:function(){var e=this,t=this.state.isloading;t.blockprobe=!0,t.images=!0,this.setState({blockTree:{},investigationGraph:{},timeline:[],isloading:t}),this.getBlockTree(),y.firestore().collection("Blockprobes").doc(this.props.bId).collection("images").get().then((function(t){e.getImages(t);var a=e.state.isloading;a.images=!1,e.setState({isloading:a})}))}},{key:"getLatestTimestamp",value:function(e){var t=0;return e.forEach((function(e){for(var a=e.data().blocks,i=0;a&&i<a.length;i++)a[i].timestamp&&(t=Math.max(t,a[i].timestamp))})),t}},{key:"getLatestBlocks",value:function(){var e=Object(k.a)(f.a.mark((function e(t,a){var i,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=Date.now(),e.next=3,y.firestore().collection("Blockprobes").doc(this.props.bId).collection("fullBlocks").where("timestamp",">",t).where("timestamp","<",i).orderBy("timestamp").get();case 3:(n=e.sent)&&n.forEach((function(e){var t=e.data();a.push(t)}));case 5:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"buildBlocktree",value:function(){var e=Object(k.a)(f.a.mark((function e(t){var a,i,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.getLatestTimestamp(t),i=[],t.forEach((function(e){for(var t=e.data(),a=0;t&&t.blocks&&a<t.blocks.length;a++)i.push(t.blocks[a])})),e.next=5,this.getLatestBlocks(a,i);case 5:this.createBlockprobe(i),this.writeShortBlocktree(),(n=this.state.isloading).blockprobe=!1,this.setState({isloading:n});case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getBlockTree",value:function(){var e=this;y.firestore().collection("Blockprobes").doc(this.props.bId).collection("users").doc(this.state.uIdHash).collection("shortBlockprobe").get().then((function(t){e.buildBlocktree(t)}))}},{key:"componentDidMount",value:function(){var e=Object(k.a)(f.a.mark((function e(){var t,a=this;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.bpDetailsDoc=y.firestore().collection("Blockprobes").doc(this.props.bId),this.bpDetailsDoc.onSnapshot((function(e){a.setState({bpDetails:e.data()});var t=a.state.isloading;t.bpDetails=!1,a.setState({isloading:t})})),this.getBlockTree(),y.firestore().collection("Blockprobes").doc(this.props.bId).collection("images").get().then((function(e){a.getImages(e);var t=a.state.isloading;t.images=!1,a.setState({isloading:t})})),t=this,this.bpUsersRef=y.database().ref("Blockprobes/"+this.props.bId+"/users"),this.bpUsersRef.on("child_added",(function(e){var a=e.val(),i=t.state.coUsers;i[a.id]=a,t.setState({coUsers:i})})),this.bpUsersRef.on("child_changed",(function(e){var a=e.val(),i=t.state.coUsers;i[a.id]=a,t.setState({coUsers:i})})),this.bpUsersRef.on("child_removed",(function(e){var a=e.val(),i=t.state.coUsers;delete i[a.id],t.setState({coUsers:i})})),this.bpLangRef=y.firestore().collection("blprobeLang").doc(this.props.bId),this.bpLangRef.onSnapshot((function(e){var a="en";e.exists&&(Object(L.isNullOrUndefined)(e.data())||Object(L.isNullOrUndefined)(e.data().lang)||(a=e.data().lang)),t.setState({lang:a,langLoading:!1})}),(function(e){t.setState({langLoading:!1})}));case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){(this.bpDetailsDoc.onSnapshot((function(){}))(),Object(L.isNullOrUndefined)(this.bpUsersRef)||this.bpUsersRef.off(),Object(L.isNullOrUndefined)(this.bpLangRef))||this.bpLangRef.onSnapshot((function(){}))()}},{key:"renderVisualisation",value:function(){return"timeline"==this.state.selectedVisualisation?n.a.createElement("div",{className:"blockprobe-body"},n.a.createElement(Ze,{timeline:this.state.timeline,selectBlock:this.changeSelectedBlock})):"dashboard"==this.state.selectedVisualisation?n.a.createElement("div",{style:{marginBottom:"40px"}},n.a.createElement(et,{summaryBlocks:this.state.summaryList,blockTree:this.state.blockTree,investigationGraph:this.state.investigationGraph,imageMapping:this.state.imageMapping,selectBlock:this.changeSelectedBlock,multiSelectEntityList:this.state.multiSelectEntityList,lang:this.state.lang,timeline:this.state.timeline,setNewVisualisation:this.setNewVisualisation})):"graph"==this.state.selectedVisualisation?n.a.createElement("div",null,n.a.createElement(Ke,{blockTree:this.state.blockTree,investigationGraph:this.state.investigationGraph,selectBlock:this.changeSelectedBlock,imageMapping:this.state.imageMapping,lang:this.state.lang,multiSelectEntityList:this.state.multiSelectEntityList})):"find_connections"==this.state.selectedVisualisation?n.a.createElement("div",null,n.a.createElement(qe,{blockTree:this.state.blockTree,investigationGraph:this.state.investigationGraph,selectBlock:this.changeSelectedBlock,imageMapping:this.state.imageMapping})):"contributions"==this.state.selectedVisualisation?n.a.createElement("div",null,n.a.createElement(Hi,{uId:this.props.uId,bId:this.props.bId,permit:this.props.permit,bpDetails:this.state.bpDetails,selectBlock:this.changeSelectedBlock,imageMapping:this.state.imageMapping,investigationGraph:this.state.investigationGraph,buildStory:this.state.showTooltip.buildStory,finishBuildingStoryTooltip:this.finishBuildingStoryTooltip,commitBlockToBlockprobe:this.commitBlockToBlockprobe,commitMultipleBlocksToBlockprobe:this.commitMultipleBlocksToBlockprobe,finishAddingBlockToStoryTooltip:this.finishAddingBlockToStoryTooltip,setNewVisualisation:this.setNewVisualisation,refreshBlockprobe:this.refreshBlockprobe,blockStatus:this.state.blockStatus,blockTree:this.state.blockTree,multiSelectEntityList:this.state.multiSelectEntityList,timeline:this.state.timeline,summaryBlocks:this.state.summaryList,lastIndex:this.state.lastTitleIndex,lang:this.state.lang})):"manage_blockprobe"==this.state.selectedVisualisation?n.a.createElement("div",null,n.a.createElement(ii,{uId:this.props.uId,bpId:this.props.bId,details:this.state.bpDetails,permit:this.props.permit,coUsers:this.state.coUsers,lang:this.state.lang})):"publish_blockprobe"==this.state.selectedVisualisation?n.a.createElement("div",null,n.a.createElement(Ka,{uId:this.props.uId,bpId:this.props.bId,details:this.state.bpDetails,permit:this.props.permit,blockTree:this.state.blockTree,imageMapping:this.state.imageMapping,posts:this.props.posts,title:this.state.blockprobeTitle,updatePosts:this.props.updatePosts,setNewVisualisation:this.setNewVisualisation})):n.a.createElement("div",{style:{textAlign:"center"}},"FEATURE TO BE IMPLEMENTED")}},{key:"closeSelectedBlockSidebar",value:function(){this.onSetSelectedBlockSidebarOpen(!1)}},{key:"componentWillReceiveProps",value:function(e){if(e.buildStorytooltip){var t=this.state.showTooltip;t.buildStory=JSON.parse(JSON.stringify(e.buildStorytooltip)),this.setState({showTooltip:t})}}},{key:"commitMultipleBlocksToBlockprobe",value:function(){var e=Object(k.a)(f.a.mark((function e(t){var a,i,n,s,l,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=Date.now(),(i=this.state.isloading).blockprobe=!0,this.setState({isloading:i}),n=[],s=0;!Object(L.isNullOrUndefined)(t)&&s<t.length;s++)l=t[s],r=this.commitSingleBlockToBlockprobe(l,a),n.push(r),a+=10;return e.next=8,Promise.all(n);case 8:this.refreshBlockprobe();case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"commitSingleBlockToBlockprobe",value:function(){var e=Object(k.a)(f.a.mark((function e(t,a){var i,n,s,l,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.key,n=JSON.stringify(t),s=JSON.parse(n),l=this.state.shajs("sha256").update(this.state.uIdHash+String(s.timestamp)).digest("hex"),s.timestamp=a,s.verificationHash=l,s.previousKey=this.state.latestBlock.key,"bpID"in s||(s.bpID=this.props.bId),"entities"in s||(s.entities=[]),"evidences"in s||(s.evidences=[]),"ADD"!=s.actionType&&"BpDetails"!=s.actionType||(s.referenceBlock=null),"BpDetails"==s.actionType&&("title"in s||(s.title=this.state.blockprobeTitle),"summary"in s||(s.summary=this.state.blockprobeSummary)),s.key=this.state.shajs("sha256").update(l+s.previousKey).digest("hex"),Object(L.isNullOrUndefined)(s.blockDate)&&(s.blockDate=null),Object(L.isNullOrUndefined)(s.blockTime)&&(s.blockTime=null),s.blockState="SUCCESSFUL",delete(r=JSON.parse(JSON.stringify(s))).blockState,delete r.bpID,delete r.children,!i){e.next=25;break}return e.next=23,y.database().ref("Blockprobes/"+s.bpID+"/reviewBlocks/"+i).remove();case 23:return e.next=25,y.firestore().collection("Blockprobes").doc(s.bpID).collection("users").doc(this.state.uIdHash).collection("userBlocks").doc(i).delete();case 25:if("BpDetails"==s.actionType){e.next=28;break}return e.next=28,y.firestore().collection("Blockprobes").doc(s.bpID).collection("users").doc(this.state.uIdHash).collection("userBlocks").doc(s.key).set(s);case 28:return e.next=30,y.firestore().collection("Blockprobes").doc(s.bpID).collection("fullBlocks").doc(r.key).set(r);case 30:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"commitBlockToBlockprobe",value:function(){var e=Object(k.a)(f.a.mark((function e(t){var a,i,n,s,l,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((a=this.state.isloading).blockprobe=!0,this.setState({isloading:a}),i=t.key,n=JSON.stringify(t),s=JSON.parse(n),l=this.state.shajs("sha256").update(this.state.uIdHash+String(s.timestamp)).digest("hex"),s.timestamp=Date.now(),s.verificationHash=l,s.previousKey=this.state.latestBlock.key,"bpID"in s||(s.bpID=this.props.bId),"entities"in s||(s.entities=[]),"evidences"in s||(s.evidences=[]),"ADD"!=s.actionType&&"BpDetails"!=s.actionType||(s.referenceBlock=null),"BpDetails"==s.actionType&&("title"in s||(s.title=this.state.blockprobeTitle),"summary"in s||(s.summary=this.state.blockprobeSummary)),s.key=this.state.shajs("sha256").update(l+s.previousKey).digest("hex"),Object(L.isNullOrUndefined)(s.blockDate)&&(s.blockDate=null),Object(L.isNullOrUndefined)(s.blockTime)&&(s.blockTime=null),s.blockState="SUCCESSFUL",delete(r=JSON.parse(JSON.stringify(s))).blockState,delete r.bpID,delete r.children,!i){e.next=28;break}return e.next=26,y.database().ref("Blockprobes/"+s.bpID+"/reviewBlocks/"+i).remove();case 26:return e.next=28,y.firestore().collection("Blockprobes").doc(s.bpID).collection("users").doc(this.state.uIdHash).collection("userBlocks").doc(i).delete();case 28:if("BpDetails"==s.actionType){e.next=31;break}return e.next=31,y.firestore().collection("Blockprobes").doc(s.bpID).collection("users").doc(this.state.uIdHash).collection("userBlocks").doc(s.key).set(s);case 31:return e.next=33,y.firestore().collection("Blockprobes").doc(s.bpID).collection("fullBlocks").doc(r.key).set(r);case 33:this.refreshBlockprobe();case 34:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return n.a.createElement("div",null,n.a.createElement(va.a,{sidebar:n.a.createElement("div",{className:"right-sidebar"},n.a.createElement(ka,{selectedBlock:this.state.selectedBlock,uId:this.props.uId,bpId:this.props.bId,closeSideBar:this.closeSelectedBlockSidebar,bpDetails:this.state.bpDetails,latestBlock:this.state.latestBlock,refreshBlockprobe:this.refreshBlockprobe,commitToStoryTooltip:this.state.showTooltip.commitToStory,finishAddingBlockToStoryTooltip:this.finishAddingBlockToStoryTooltip})),open:this.state.selectedBlockSidebarOpen,onSetOpen:this.onSetSelectedBlockSidebarOpen,pullRight:!0,defaultSidebarWidth:"200px",styles:{sidebar:{background:"#fefefe",position:"fixed"}}}),n.a.createElement(va.a,{sidebar:n.a.createElement("div",{className:"left-sidebar"},n.a.createElement(Ia,{selectVisualisation:this.setNewVisualisation,selectedVisualisation:this.state.selectedVisualisation,permit:this.props.permit,isViewOnly:!1,dashboardTooltip:this.state.showTooltip.viewDashboardView,shareStoryTooltip:this.state.showTooltip.shareStory})),open:this.state.menuBarOpen,onSetOpen:this.onSetMenuBlockSidebarOpen,pullRight:!1,defaultSidebarWidth:"200px",styles:{sidebar:{background:"white",position:"fixed"}}},n.a.createElement("div",{style:{height:"100%",overflowY:"scroll"}},n.a.createElement("div",{className:"blockprobe-options-container"},n.a.createElement(O.b,{styles:{options:{arrowColor:"#e3ffeb",beaconSize:"3em",primaryColor:"#05878B",backgroundColor:"#e3ffeb",overlayColor:"rgba(10,10,10, 0.4)",width:900,zIndex:1e3}},steps:this.state.tooltipText.menuClickFirst,run:this.state.showTooltip.menuClickFirst}),n.a.createElement(O.b,{styles:{options:{arrowColor:"#e3ffeb",beaconSize:"3em",primaryColor:"#05878B",backgroundColor:"#e3ffeb",overlayColor:"rgba(10,10,10, 0.4)",width:900,zIndex:1e3}},steps:this.state.tooltipText.preShareStory,run:this.state.showTooltip.preShareStory}),n.a.createElement("button",{onClick:function(){e.onSetMenuBlockSidebarOpen(!0)},className:"menu-button"},n.a.createElement(si.a,null)),n.a.createElement("button",{onClick:function(){e.refreshBlockprobe()},className:"sync-button"},n.a.createElement(ri.a,null))),n.a.createElement("div",{className:"blockprobe-header"},Object(L.isNullOrUndefined)(this.state.blockprobeTitle)?null:n.a.createElement(zi,{type:"title",value:this.state.blockprobeTitle,lastTs:this.state.bpDetailsLastTs,permit:this.props.permit,posts:this.props.posts,commitBlockToBlockprobe:this.commitBlockToBlockprobe}),n.a.createElement("h4",null,this.state.blockprobeSummary)),this.state.isloading.blockprobe||this.state.isloading.bpDetails||this.state.langLoading?n.a.createElement("div",{style:{width:"50px",margin:"auto"}},n.a.createElement(Da.a,{type:"TailSpin",color:"#00BFFF",height:"50",width:"50"})):this.renderVisualisation())))}}]),i}(n.a.Component),Yi=a(608),Ki=a.n(Yi),qi=a(609),Xi=a.n(qi),Qi=a(610),$i=a.n(Qi),Zi=a(882),en=a.n(Zi),tn=(a(1683),a(798),function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).state={visualizedBps:{},isEditSummary:{},newSummary:{}},i.renderSinglePost=i.renderSinglePost.bind(Object(v.a)(i)),i.clickOnVisualizeButton=i.clickOnVisualizeButton.bind(Object(v.a)(i)),i.clickOnEdit=i.clickOnEdit.bind(Object(v.a)(i)),i.isValid=i.isValid.bind(Object(v.a)(i)),i}return Object(o.a)(a,[{key:"clickOnVisualizeButton",value:function(e,t){var a=this.state.visualizedBps;a[e]=t,this.setState({visualizedBps:a})}},{key:"clickOnEdit",value:function(e,t,a){if("summary"==e){var i=this.state.isEditSummary;(i={})[a.bp]=t;var n=this.state.newSummary;n[a.bp]="",Object(L.isNullOrUndefined)(a.summary)||(n[a.bp]=a.summary),this.setState({isEditSummary:i,newSummary:n})}}},{key:"isValid",value:function(e){return!Object(L.isNullOrUndefined)(e)&&""!=e.trim()}},{key:"clickOnSave",value:function(e,t){if("summary"==e){for(var a=this.state.newSummary[t.bp],i=this.props.posts,n=0;n<i.length;n++)if(i[n].bp==t.bp){i[n].summary=a;break}this.props.updatePosts(i),this.clickOnEdit("summary",!1,t)}}},{key:"handleChange",value:function(e,t,a){var i=!0,n=e.target.value[e.target.value.length-1];if("\n"!=n&&"\t"!=n||(i=!1),i&&"summary"==t&&e.target.value.length<=288){var s=e.target.value,l=this.state.newSummary;l[a.bp]=s,this.setState({newSummary:l})}}},{key:"renderSinglePost",value:function(e,t){var a=this,i="";return e&&e.bp&&(i="https://blprobe.com/tabs/"+e.bp),n.a.createElement("div",{className:"wallPostContainer"},n.a.createElement("h5",{className:"wallPostTitle"},e.title),this.state.isEditSummary[e.bp]&&this.props.isPrivate?n.a.createElement("div",null,n.a.createElement("form",{className:"newBlockprobeForm"},n.a.createElement("label",null,n.a.createElement(Ra.a,{type:"text",variant:"outlined",multiline:!0,placeholder:"Enter details about this story",value:this.state.newSummary[e.bp],onChange:function(t){a.handleChange(t,"summary",e)},rowsMax:"4",rows:"2",style:{background:"white",marginTop:"6px",marginBottom:"6px",textColor:"black",fontWeight:"600",marginLeft:"1em",width:"95%"}}))),n.a.createElement("div",{style:{display:"flex"}},this.isValid(this.state.newSummary[e.bp])?n.a.createElement(rt.a,{variant:"contained",className:"summarySaveWallbutton",onClick:function(){a.clickOnSave("summary",e)}},n.a.createElement("div",null,"Confirm")):null,n.a.createElement(rt.a,{className:"summaryCancelWallbutton",variant:"contained",onClick:function(t){return a.clickOnEdit("summary",!1,e)}},"Cancel"))):null,!this.state.isEditSummary[e.bp]&&this.props.isPrivate?n.a.createElement("div",null,e.summary&&e.summary.length>0?n.a.createElement("p",{className:"wallPostSummary"},e.summary):n.a.createElement("p",{className:"wallPostSummaryPrompt"},"Add a summary!"),n.a.createElement(rt.a,{className:"summaryChangeWallbutton",onClick:function(t){return a.clickOnEdit("summary",!0,e)},variant:"contained"},"Edit summary")):null,!this.props.isPrivate&&e.summary&&e.summary.length>0?n.a.createElement("p",{className:"wallPostSummary"},e.summary):null,n.a.createElement("div",{className:"wallPostBody"},this.state.visualizedBps[e.bp]?n.a.createElement("div",{className:"wallShowViso"},n.a.createElement("div",null,n.a.createElement(rt.a,{className:"visualizeWallBpButton",onClick:function(t){return a.clickOnVisualizeButton(e.bp,!1)},variant:"contained"},"Close"))):n.a.createElement("div",{className:"wallHideViso"},n.a.createElement(rt.a,{className:"visualizeWallBpButton",onClick:function(t){return a.clickOnVisualizeButton(e.bp,!0)},variant:"contained"},"Visualize")),n.a.createElement(q.a,{open:this.state.visualizedBps[e.bp],duration:400,transitions:["height","opacity","background"]},n.a.createElement("div",{className:"wallPostVisoContainer"},this.state.visualizedBps[e.bp]?n.a.createElement("iframe",{src:i,className:"wallPostViso"}):null))))}},{key:"render",value:function(){var e=this,t=this.props.posts.map((function(t){return e.renderSinglePost(t,e)}));return n.a.createElement("div",null,t)}}]),a}(n.a.Component)),an=(a(1684),n.a.forwardRef((function(e,t){return n.a.createElement(It.a,Object.assign({direction:"up",ref:t},e))}))),nn=function(e){Object(c.a)(i,e);var t=Object(d.a)(i);function i(e){var n;Object(r.a)(this,i),(n=t.call(this,e)).state={dialogType:null,dialog:!1,dialogText:{selected:{title:null,desc:null}},selectedNotificationId:null,uIdHash:null,shajs:null};var s=a(149);return n.state.uIdHash=s("sha256").update(n.props.userId).digest("hex"),n.state.shajs=s,n.renderSingleNotification=n.renderSingleNotification.bind(Object(v.a)(n)),n.renderStoryInviteNotifications=n.renderStoryInviteNotifications.bind(Object(v.a)(n)),n.clickOnNotification=n.clickOnNotification.bind(Object(v.a)(n)),n.toggleDialog=n.toggleDialog.bind(Object(v.a)(n)),n.performAction=n.performAction.bind(Object(v.a)(n)),n}return Object(o.a)(i,[{key:"toggleDialog",value:function(e,t,a){var i=this.state.dialogText;"storyInvite"==t&&(i.selected.title='Contribute to story \n"'.concat(a.title,'"'),i.selected.desc="You have been invited to contribute to this story. Do you accept?"),this.setState({dialog:e,dialogType:t,dialogText:i})}},{key:"renderStoryInviteNotifications",value:function(e){var t=this,a=null;return Object(L.isNullOrUndefined)(e)||(a=Object.keys(e).map((function(a){var i=e[a],n=i.title;return t.renderSingleNotification(n,"You have been invited to contribute to this story as admin.","storyInvite",i)}))),n.a.createElement("div",null,a)}},{key:"clickOnNotification",value:function(){var e=Object(k.a)(f.a.mark((function e(t,a){var i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=a.id,e.next=3,this.setState({selectedNotificationId:i});case 3:this.toggleDialog(!0,"storyInvite",a);case 4:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"renderSingleNotification",value:function(e,t,a,i){var s=this,l={title:e,id:i.id};return n.a.createElement($t.a,{button:!0,onClick:function(){s.clickOnNotification(a,l)},style:{width:"100%"}},n.a.createElement(Zt.a,{primary:e,secondary:t}))}},{key:"performAction",value:function(){var e=Object(k.a)(f.a.mark((function e(t){var a,i,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("storyInvite"!=this.state.dialogType||Object(L.isNullOrUndefined)(this.state.selectedNotificationId)){e.next=16;break}if(a=this.props.notifications[this.state.selectedNotificationId],i=this.props.userId,!t){e.next=12;break}return n=Pa(a,i,this.state.uIdHash),e.next=8,Promise.all(n);case 8:return e.next=10,Aa(a,i);case 10:e.next=16;break;case 12:return e.next=14,Ga(a,i,this.state.uIdHash);case 14:return e.next=16,Aa(a,i);case 16:this.toggleDialog(!1,"all",null);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return n.a.createElement("div",null,n.a.createElement("h2",{style:{textAlign:"center"}},"Notifications"),n.a.createElement(S.d,{className:"notificationsTab"},n.a.createElement(S.b,null,n.a.createElement(S.a,null,"Story invites")),n.a.createElement(S.c,null,n.a.createElement(Qt.a,null,this.renderStoryInviteNotifications(this.props.notifications)))),n.a.createElement(Xa.a,{open:this.state.dialog,TransitionComponent:an,keepMounted:!0,onClose:function(){return e.toggleDialog(!1,"all",null)},"aria-labelledby":"alert-dialog-slide-title","aria-describedby":"alert-dialog-slide-description"},n.a.createElement(ei.a,{id:"alert-dialog-slide-title"},this.state.dialogText.selected.title),n.a.createElement($a.a,null,n.a.createElement(Za.a,{id:"alert-dialog-slide-description"},this.state.dialogText.selected.desc)),n.a.createElement(Qa.a,null,n.a.createElement(rt.a,{onClick:function(){return e.performAction(!0)},color:"primary"},"Yes"),n.a.createElement(rt.a,{onClick:function(){return e.performAction(!1)},color:"primary"},"No"),n.a.createElement(rt.a,{onClick:function(){return e.toggleDialog(!1,"all",null)},color:"primary"},"Cancel"))))}}]),i}(n.a.Component),sn=a(1780),ln=a(1781),rn=a(1782),on=a(1785),cn=a(1783),dn=a(887),un=a.n(dn),hn=a(889),pn=a.n(hn),mn=a(888),bn=a.n(mn),fn=a(884),gn=a.n(fn),kn=a(883),vn=a.n(kn),yn=a(885),En=a.n(yn),Sn=a(886),On=a.n(Sn),Bn=(a(1685),a(1779)),Tn=(a(1686),function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).state={playGame:!1},i.playGame=i.playGame.bind(Object(v.a)(i)),i.viewResults=i.viewResults.bind(Object(v.a)(i)),i}return Object(o.a)(a,[{key:"playGame",value:function(e){var t="https://blprobe.com"+"/game/".concat(this.props.id);window.open(t,"_blank")}},{key:"viewResults",value:function(){var e="https://blprobe.com"+"/gameResults/".concat(this.props.id);window.open(e,"_blank")}},{key:"render",value:function(){var e=this;return n.a.createElement(Lt.a,{item:!0,xs:12,spacing:4},n.a.createElement(Dt.a,{elevation:6},n.a.createElement(Ut.a,null,n.a.createElement(Pt.a,{variant:"h6"},this.props.title),Object(L.isNullOrUndefined)(this.props.summary)?null:n.a.createElement(Pt.a,{variant:"body2",component:"p",gutterBottom:!0},this.props.summary)),n.a.createElement(Bn.a,null,n.a.createElement(rt.a,{size:"small",onClick:function(){e.playGame(!0)}},"Play"),n.a.createElement(rt.a,{size:"small",onClick:function(){e.viewResults()}},"View results"),this.props.isPrivate&&this.props.removeGame?n.a.createElement(rt.a,{size:"small",onClick:function(){e.props.removeGame(e.props.id)}},"Remove"):null)))}}]),a}(n.a.Component)),wn=(a(1687),function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).state={list:[],title:null,isLoading:!0,currGameList:{},addGameList:!1,newGame:{title:"",id:""}},i.removeGame=i.removeGame.bind(Object(v.a)(i)),i.addGame=i.addGame.bind(Object(v.a)(i)),i.writeToDb=i.writeToDb.bind(Object(v.a)(i)),i.singleGameListItem=i.singleGameListItem.bind(Object(v.a)(i)),i.renderGameListFull=i.renderGameListFull.bind(Object(v.a)(i)),i.confirmGame=i.confirmGame.bind(Object(v.a)(i)),i.handleChange=i.handleChange.bind(Object(v.a)(i)),i.isValidGame=i.isValidGame.bind(Object(v.a)(i)),i}return Object(o.a)(a,[{key:"removeGame",value:function(e){for(var t=this.state.list,a=[],i=0;i<t.length;i++)t[i].id!=e&&a.push(t[i]);this.writeToDb(a,this.state.title)}},{key:"addGame",value:function(e){var t=this.state.list;t.length<20&&(t.push(e),this.writeToDb(t,this.state.title))}},{key:"writeToDb",value:function(){var e=Object(k.a)(f.a.mark((function e(t,a){var i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(i=this.state.currGameList).games=t,delete i.list,i.title=a,e.next=6,y.firestore().collection("publicGameList").doc(this.props.gameListId).set(i);case 6:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"singleGameListItem",value:function(e){return n.a.createElement("div",{className:"singleGameListItemContainer"},n.a.createElement(Tn,{title:e.title,id:e.id,isPrivate:!0,removeGame:this.removeGame}))}},{key:"handleChange",value:function(e,t){var a=!0;if("date"!=t&&"time"!=t){var i=e.target.value;Oe(i,"\n\t")||(a=!1)}if(a){var n=this.state.newGame;"title"==t?(n.title=e.target.value,this.setState({newGame:n})):"id"==t&&(n.id=e.target.value,this.setState({newGame:n}))}}},{key:"componentDidMount",value:function(){if(!Object(L.isNullOrUndefined)(this.props.gameListId)){var e=this;y.firestore().collection("publicGameList").doc(this.props.gameListId).onSnapshot((function(t){if(t.exists){var a=t.data().title,i=t.data().games,n=t.data();e.setState({list:i,title:a,currGameList:n})}e.setState({isLoading:!1})}),(function(t){e.setState({isLoading:!1})}))}}},{key:"confirmGame",value:function(){var e=this.state.newGame;this.addGame(e),this.setState({addGameList:!1,newGame:{title:"",id:""}})}},{key:"isValidGame",value:function(){return!Object(L.isNullOrUndefined)(this.state.newGame.id)&&""!=this.state.newGame.id.trim()&&(!Object(L.isNullOrUndefined)(this.state.newGame.title)&&""!=this.state.newGame.title.trim())}},{key:"returnNewGame",value:function(){var e=this;return n.a.createElement("div",null,n.a.createElement(Lt.a,{xs:12},n.a.createElement("div",{className:"newGameFormContainer"},n.a.createElement("form",null,n.a.createElement("label",null,n.a.createElement(Ra.a,{type:"text",variant:"outlined",multiline:!0,label:"Game title",value:this.state.newGame.title,onChange:function(t){e.handleChange(t,"title")},rowsMax:"2",rowsMin:"1",style:{background:"white",marginTop:"6px",marginBottom:"6px",width:"95%"}}),n.a.createElement(Ra.a,{type:"text",variant:"outlined",multiline:!0,label:"Game ID",value:this.state.newGame.id,onChange:function(t){e.handleChange(t,"id")},rowsMax:"2",rows:"1",style:{background:"white",marginTop:"6px",marginBottom:"6px",width:"95%"}}))),n.a.createElement("div",{className:"newGamePrivateOptionsContainer"},this.isValidGame()?n.a.createElement(rt.a,{className:"addGameButton",color:"primary",variant:"contained",onClick:function(){e.confirmGame()}},"Add"):null,n.a.createElement(rt.a,{className:"addGameButton",color:"primary",variant:"contained",onClick:function(){e.setState({addGameList:!1,newGame:{title:"",id:""}})}},"Close")))))}},{key:"renderGameListFull",value:function(){var e=this,t=this.state.list.map((function(t){return e.singleGameListItem(t)})),a="https://blprobe.com/gameList/"+this.props.gameListId;return n.a.createElement("div",null,n.a.createElement("h2",{className:"gameListTitle"},this.state.title),n.a.createElement("div",{className:"gameListPrivateOptionsContainer"},n.a.createElement(rt.a,{className:"addGameButton",color:"primary",variant:"contained",onClick:function(){e.props.return()}},"Back to gameLists"),this.state.addGameList?null:n.a.createElement(rt.a,{className:"addGameButton",color:"primary",variant:"contained",onClick:function(){e.setState({addGameList:!0})}},"Add new game")),this.state.addGameList?this.returnNewGame():null,n.a.createElement("div",{className:"shareUrlContainer"},n.a.createElement("p",null,"Public link to view game list: ",n.a.createElement("br",null)),n.a.createElement("div",{className:"shareUrlDiv"},n.a.createElement("a",{href:a,target:"_blank"},a))),this.state.list.length>0?n.a.createElement("div",{style:{marginBottom:"40px"}},t):null)}},{key:"render",value:function(){return n.a.createElement("div",null,this.state.isLoading?n.a.createElement("div",{style:{width:"50px",margin:"auto"}},n.a.createElement(Da.a,{type:"TailSpin",color:"#00BFFF",height:"50",width:"50"})):this.renderGameListFull())}}]),a}(n.a.Component)),Nn=function(e){Object(c.a)(i,e);var t=Object(d.a)(i);function i(e){var n;Object(r.a)(this,i),(n=t.call(this,e)).state={shajs:null,areGameListsLoading:!0,userGameLists:{},createGameList:!1,draftGameList:{title:""}};var s=a(149);return n.state.shajs=s,n.selectGame=n.selectGame.bind(Object(v.a)(n)),n.addGameList=n.addGameList.bind(Object(v.a)(n)),n.removeGameList=n.removeGameList.bind(Object(v.a)(n)),n.getList=n.getList.bind(Object(v.a)(n)),n.toggleCreateGameList=n.toggleCreateGameList.bind(Object(v.a)(n)),n.createGameList=n.createGameList.bind(Object(v.a)(n)),n.renderGameLists=n.renderGameLists.bind(Object(v.a)(n)),n.renderNewGameForm=n.renderNewGameForm.bind(Object(v.a)(n)),n.isValidGameList=n.isValidGameList.bind(Object(v.a)(n)),n.handleChange=n.handleChange.bind(Object(v.a)(n)),n.returnToGameLists=n.returnToGameLists.bind(Object(v.a)(n)),n.getLatestTimestamp=n.getLatestTimestamp.bind(Object(v.a)(n)),n.getGameLists=n.getGameLists.bind(Object(v.a)(n)),n.getGameListsShort=n.getGameListsShort.bind(Object(v.a)(n)),n.updateShortenedGameListsToDb=n.updateShortenedGameListsToDb.bind(Object(v.a)(n)),n.getNewGameListsTillThisSession=n.getNewGameListsTillThisSession.bind(Object(v.a)(n)),n.listenToGameListsDuringSession=n.listenToGameListsDuringSession.bind(Object(v.a)(n)),n}return Object(o.a)(i,[{key:"getLatestTimestamp",value:function(e){var t=0;return e.forEach((function(e){for(var a=e.data().gameLists,i=0;a&&i<a.length;i++)a[i].timestamp&&(t=Math.max(t,a[i].timestamp))})),t}},{key:"getGameListsShort",value:function(){var e=this;y.firestore().collection("Users").doc(this.props.userId).collection("shortGameLists").get().then((function(t){var a=e.getLatestTimestamp(t),i=[];t.forEach((function(t){var a=t.data();if(a.gameLists)for(var n=0;n<a.gameLists.length;n++)i.push(a.gameLists[n]),e.addGameList(a.gameLists[n])})),e.getNewGameListsTillThisSession(a)}))}},{key:"updateShortenedGameListsToDb",value:function(){var e=this,t=function(e){var t=[],a=[],i=0;if(null!=e&&Object.keys(e).map((function(n,s){if(i&&i%100==0){var l={gameLists:a};t.push(l),a=[]}var r=e[n];null!=r&&(a.push(r),i++)})),a.length>0){var n={gameLists:a};t.push(n),a=[]}return t}(this.state.userGameLists);t&&t.length>0&&y.firestore().collection("Users").doc(this.props.userId).collection("shortGameLists").get().then((function(a){a.forEach((function(t){y.firestore().collection("Users").doc(e.props.userId).collection("shortGameLists").doc(t.id).delete()}));for(var i=0;i<t.length;i++)y.firestore().collection("Users").doc(e.props.userId).collection("shortGameLists").doc(String(i)).set(t[i])}))}},{key:"getNewGameListsTillThisSession",value:function(e){var t=this,a=Date.now();y.firestore().collection("Users").doc(this.props.userId).collection("gameLists").where("timestamp",">",e).where("timestamp","<=",a).orderBy("timestamp").get().then((function(e){e.forEach((function(e){var a=e.data();a&&t.addGameList(a)})),t.updateShortenedGameListsToDb(),t.setState({areGameListsLoading:!1}),t.listenToGameListsDuringSession(a)}))}},{key:"listenToGameListsDuringSession",value:function(e){var t=this;y.firestore().collection("Users").doc(this.props.userId).collection("gameLists").where("timestamp",">",e).orderBy("timestamp").onSnapshot((function(e){e.docChanges().forEach((function(e){if("added"===e.type){var a=e.doc.data();a&&t.addGameList(a,!0)}else if("removed"==e.type){var i=e.doc.data();i&&t.removeGameList(i,!1)}}))}))}},{key:"handleChange",value:function(e,t){var a=!0,i=e.target.value;if(Oe(i,"\n\t")||(a=!1),a){var n=this.state.draftGameList;"title"==t&&(n.title=e.target.value,n.title=n.title.substring(0,99),this.setState({draftGameList:n}))}}},{key:"createGameList",value:function(){var e=Object(k.a)(f.a.mark((function e(){var t,a,i,n,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Date.now(),a=this.state.draftGameList.title,i=this.state.shajs("sha256").update(this.props.userId+"_"+String(t)).digest("hex"),n={title:a,timestamp:t,id:i},s={title:a,games:[],timestamp:t,id:i},e.next=7,y.firestore().collection("Users").doc(this.props.userId).collection("gameLists").doc(i).set(n);case 7:return e.next=9,y.firestore().collection("publicGameList").doc(i).set(s);case 9:this.setState({draftGameList:{title:""},createGameList:!1});case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isValidGameList",value:function(){return""!=this.state.draftGameList.title.trim()}},{key:"renderNewGameForm",value:function(){var e=this;return n.a.createElement("div",null,n.a.createElement("form",{className:"newGameListForm"},n.a.createElement("label",null,n.a.createElement(Ra.a,{type:"text",label:"Title",variant:"outlined",value:this.state.draftGameList.title,onChange:function(t){e.handleChange(t,"title")},multiline:!0,rowsMax:"2",rows:"1",style:{background:"white",marginTop:"6px",marginBottom:"6px",textColor:"black",fontWeight:"600",marginLeft:"1em",width:"95%"}}))),n.a.createElement("div",{className:"createValidGameOptions"},this.isValidGameList()?n.a.createElement(rt.a,{className:"submitGameListButton",color:"primary",variant:"contained",onClick:this.createGameList},"Confirm"):null,n.a.createElement(rt.a,{className:"createGameListButton",color:"primary",variant:"contained",onClick:this.toggleCreateGameList},"Close")))}},{key:"selectGame",value:function(e){this.props.selectGameList(e)}},{key:"renderSingleUserGame",value:function(e){var t=this;return n.a.createElement($t.a,{button:!0,selected:t.props.selectedUserGame==e.id,onClick:function(){t.selectGame(e.id)},style:{width:"100%"}},n.a.createElement(Zt.a,{primary:e.title,secondary:""}))}},{key:"addGameList",value:function(e){if(!Object(L.isNullOrUndefined)(e)){var t=this.state.userGameLists;t[e.id]=e,this.setState({userGameLists:t})}}},{key:"removeGameList",value:function(e){if(!Object(L.isNullOrUndefined)(e)){var t=this.state.userGameLists;delete t[e.id],this.setState({userGameLists:t})}}},{key:"getGameLists",value:function(){this.setState({areGameListsLoading:!1}),this.getGameListsShort()}},{key:"componentDidMount",value:function(){this.getGameLists()}},{key:"getList",value:function(e){var t=[];for(var a in e)t.push(e[a]);return t}},{key:"toggleCreateGameList",value:function(){this.setState({createGameList:!this.state.createGameList})}},{key:"renderGameLists",value:function(){var e=this,t=this.getList(this.state.userGameLists);t.sort((function(e,t){return e.title.toLowerCase()>t.title.toLowerCase()?1:-1}));var a=t.map((function(t){return e.renderSingleUserGame(t)}));return n.a.createElement("div",{className:"gameListsViewContainer"},n.a.createElement("h2",{style:{textAlign:"center"}},"My game lists"),n.a.createElement("div",{className:"createGameListOptions"},this.state.createGameList?null:n.a.createElement(rt.a,{className:"createGameListButton",color:"primary",variant:"contained",onClick:this.toggleCreateGameList},n.a.createElement("div",null,"Create gamelist"))),this.state.createGameList?n.a.createElement("div",null,this.renderNewGameForm()):null,n.a.createElement("div",null,n.a.createElement(Qt.a,null,a)))}},{key:"returnToGameLists",value:function(){this.props.selectGameList(null)}},{key:"render",value:function(){return n.a.createElement("div",null,Object(L.isNullOrUndefined)(this.props.selectedUserGame)||""==this.props.selectedUserGame?n.a.createElement("div",null,this.state.areGameListsLoading?n.a.createElement("div",{style:{margin:"auto",width:"50px"}},n.a.createElement(Da.a,{type:"TailSpin",color:"#00BFFF",height:"50",width:"50"})):n.a.createElement("div",null,this.renderGameLists())):n.a.createElement("div",null,n.a.createElement(wn,{gameListId:this.props.selectedUserGame,return:this.returnToGameList})))}}]),i}(n.a.Component),xn=function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).state={isUserSignedIn:i.getItemWrapper("isUserSignedIn",!1),showLogin:!0,isWallOpened:!1,isGameListOpened:!1,isNotificationsOpened:!1,selectedBlockprobeId:"",selectedGameListId:null,userId:i.getItemWrapper("userId",""),providerId:i.getItemWrapper("providerId",""),blockprobes:{},posts:[],notifications:{},areBlockprobesLoading:!1,tooltip:{buildStory:!1},landingPage:{journalist:{logo:"",text:"As a journalist, you can build your story using blockprobe, visualise your story and better engage your audience with your story.",background:Ki.a},police:{logo:"",text:"As a law enforcement agent, detective or police officer, you can build your investigation using blockprobe, visualise your investigation and better engage the general public with your investigation."},politician:{logo:"",text:"As a lawmaker, you can visualise your proposals and laws using blockprobe, and better engage your constituents with your proposals.",background:$i.a},teacher:{logo:"",text:"As a teacher, you can visualise your chapters in history, science and english using blockprobe, and better engage your students with these subjects.",background:Xi.a}},currBackgroundIndex:0,allBackgrounds:["teacher","journalist","politician"],tabValue:0},""==i.state.userId&&(i.state.isUserSignedIn=!1),i.getUiConfig=i.getUiConfig.bind(Object(v.a)(i)),i.getItemWrapper=i.getItemWrapper.bind(Object(v.a)(i)),i.getAndSetUser=i.getAndSetUser.bind(Object(v.a)(i)),i.loggedInView=i.loggedInView.bind(Object(v.a)(i)),i.loggedInContent=i.loggedInContent.bind(Object(v.a)(i)),i.loggedOutView=i.loggedOutView.bind(Object(v.a)(i)),i.clickLoginOption=i.clickLoginOption.bind(Object(v.a)(i)),i.getBlockprobes=i.getBlockprobes.bind(Object(v.a)(i)),i.getBlockprobesShort=i.getBlockprobesShort.bind(Object(v.a)(i)),i.getNewBlockprobesTillThisSession=i.getNewBlockprobesTillThisSession.bind(Object(v.a)(i)),i.listenToBlockprobesDuringSession=i.listenToBlockprobesDuringSession.bind(Object(v.a)(i)),i.updateShortenedBlockprobesListToDb=i.updateShortenedBlockprobesListToDb.bind(Object(v.a)(i)),i.selectBlockprobe=i.selectBlockprobe.bind(Object(v.a)(i)),i.createBlockprobeList=i.createBlockprobeList.bind(Object(v.a)(i)),i.addBlockprobeToList=i.addBlockprobeToList.bind(Object(v.a)(i)),i.addNotificationToList=i.addNotificationToList.bind(Object(v.a)(i)),i.removeBlockprobeFromList=i.removeBlockprobeFromList.bind(Object(v.a)(i)),i.cueCardViewV2=i.cueCardViewV2.bind(Object(v.a)(i)),i.getLatestTimestamp=i.getLatestTimestamp.bind(Object(v.a)(i)),i.returnToViewBlockprobes=i.returnToViewBlockprobes.bind(Object(v.a)(i)),i.modifyBlockprobe=i.modifyBlockprobe.bind(Object(v.a)(i)),i.getUserWall=i.getUserWall.bind(Object(v.a)(i)),i.getUserNotifications=i.getUserNotifications.bind(Object(v.a)(i)),i.buildUserWall=i.buildUserWall.bind(Object(v.a)(i)),i.viewWall=i.viewWall.bind(Object(v.a)(i)),i.viewNotifications=i.viewNotifications.bind(Object(v.a)(i)),i.viewGameList=i.viewGameList.bind(Object(v.a)(i)),i.updatePosts=i.updatePosts.bind(Object(v.a)(i)),i.renderGeneralLoggedInView=i.renderGeneralLoggedInView.bind(Object(v.a)(i)),i.handleTabChange=i.handleTabChange.bind(Object(v.a)(i)),i.changeOpacity=i.changeOpacity.bind(Object(v.a)(i)),i.selectGameList=i.selectGameList.bind(Object(v.a)(i)),i.onBackButtonPressed=i.onBackButtonPressed.bind(Object(v.a)(i)),i}return Object(o.a)(a,[{key:"onBackButtonPressed",value:function(){(""!=this.state.selectedBlockprobeId||this.state.isNotificationsOpened)&&this.returnToViewBlockprobes(),this.state.isGameListOpened&&(null==this.state.selectedGameListId?this.returnToViewBlockprobes():this.setState({selectedGameListId:null}))}},{key:"selectGameList",value:function(e){this.setState({selectedGameListId:e})}},{key:"getItemWrapper",value:function(e,t){return Object(L.isNullOrUndefined)(localStorage.getItem(e))?t:localStorage.getItem(e)}},{key:"getUiConfig",value:function(){var e={signInFlow:"popup",signInOptions:[{provider:y.auth.PhoneAuthProvider.PROVIDER_ID,defaultCountry:"IN"}],callbacks:{signInSuccess:function(){return!1},signInSuccessWithAuthResult:function(e,t){}}};return window.innerWidth>768&&(e.signInOptions.push(y.auth.GoogleAuthProvider.PROVIDER_ID),e.signInOptions.push(y.auth.EmailAuthProvider.PROVIDER_ID)),e}},{key:"clickLoginOption",value:function(){this.setState({showLogin:!0})}},{key:"returnToViewBlockprobes",value:function(){this.setState({selectedBlockprobeId:"",isWallOpened:!1,isNotificationsOpened:!1,isGameListOpened:!1})}},{key:"viewWall",value:function(){this.setState({isWallOpened:!0,isNotificationsOpened:!1,selectedBlockprobeId:"",isGameListOpened:!1})}},{key:"viewNotifications",value:function(){this.setState({isWallOpened:!1,isNotificationsOpened:!0,selectedBlockprobeId:"",isGameListOpened:!1})}},{key:"viewGameList",value:function(){this.setState({isWallOpened:!1,isNotificationsOpened:!1,selectedBlockprobeId:"",isGameListOpened:!0})}},{key:"addBlockprobeToList",value:function(e){var t=this.state.blockprobes,a={id:e.id,title:e.title,summary:e.summary,timestamp:e.timestamp,isActive:e.isActive,active:e.active,permit:e.permit};"EXIT"==a.permit?delete t[e.id]:t[e.id]=a,this.setState({blockprobes:t})}},{key:"removeBlockprobeFromList",value:function(e){var t=this.state.blockprobes;e.id in t&&delete t[e.id],this.setState({blockprobes:t})}},{key:"createBlockprobeList",value:function(e){var t=this;e.forEach((function(e){return t.addBlockprobeToList(e)}))}},{key:"getBlockprobes",value:function(){this.state.isUserSignedIn&&""==this.state.selectedBlockprobeId&&(this.setState({areBlockprobesLoading:!0}),this.getBlockprobesShort())}},{key:"getLatestTimestamp",value:function(e){var t=0;return e.forEach((function(e){for(var a=e.data().blockprobe,i=0;a&&i<a.length;i++)a[i].timestamp&&(t=Math.max(t,a[i].timestamp))})),t}},{key:"addNotificationToList",value:function(e,t){var a=this.state.notifications,i=e.id;Object(L.isNullOrUndefined)(i)||(t?a[i]=e:i in a&&delete a[i],this.setState({notifications:a}))}},{key:"getUserNotifications",value:function(){var e=this;y.firestore().collection("Users").doc(this.state.userId).collection("notifications").onSnapshot((function(t){t.docChanges().forEach((function(t){if("added"===t.type){var a=t.doc.data();a&&e.addNotificationToList(a,!0)}else if("removed"==t.type){var i=t.doc.data();i&&e.addNotificationToList(i,!1)}}))}))}},{key:"getUserWall",value:function(){var e=this;y.firestore().collection("publicWall").doc(this.state.userId).collection("userPosts").get().then((function(t){e.buildUserWall(t)}))}},{key:"buildUserWall",value:function(e){var t=[];e.forEach((function(e){for(var a=e.data(),i=0;a&&a.posts&&i<a.posts.length;i++)t.push(a.posts[i])})),this.setState({posts:t})}},{key:"updateShortenedBlockprobesListToDb",value:function(){var e=this,t=function(e){var t=[],a=[],i=0;if(null!=e&&Object.keys(e).map((function(n,s){if(i&&i%100==0){var l={blockprobe:a};t.push(l),a=[]}var r=e[n];null!=r&&(Object.keys(r).map((function(e){void 0==r[e]&&delete r[e]})),a.push(r),i++)})),a.length>0){var n={blockprobe:a};t.push(n),a=[]}return t}(this.state.blockprobes);t&&t.length>0&&y.firestore().collection("Users").doc(this.state.userId).collection("shortBlockprobes").get().then((function(a){a.forEach((function(t){y.firestore().collection("Users").doc(e.state.userId).collection("shortBlockprobes").doc(t.id).delete()}));for(var i=0;i<t.length;i++)y.firestore().collection("Users").doc(e.state.userId).collection("shortBlockprobes").doc(String(i)).set(t[i])}))}},{key:"listenToBlockprobesDuringSession",value:function(e){var t=this;y.firestore().collection("Users").doc(this.state.userId).collection("blockprobes").where("timestamp",">",e).orderBy("timestamp").onSnapshot((function(e){e.docChanges().forEach((function(e){if("added"===e.type){var a=e.doc.data();a&&t.addBlockprobeToList(a)}else if("modified"==e.type){var i=e.doc.data();i&&t.addBlockprobeToList(i)}}))}))}},{key:"getNewBlockprobesTillThisSession",value:function(e){var t=this,a=Date.now();y.firestore().collection("Users").doc(this.state.userId).collection("blockprobes").where("timestamp",">",e).where("timestamp","<=",a).orderBy("timestamp").get().then((function(e){e.forEach((function(e){var a=e.data();a&&t.addBlockprobeToList(a)})),t.updateShortenedBlockprobesListToDb(),t.setState({areBlockprobesLoading:!1}),t.listenToBlockprobesDuringSession(a)}))}},{key:"getBlockprobesShort",value:function(){var e=this;y.firestore().collection("Users").doc(this.state.userId).collection("shortBlockprobes").get().then((function(t){var a=e.getLatestTimestamp(t),i=[];t.forEach((function(t){var a=t.data();if(a.blockprobe)for(var n=0;n<a.blockprobe.length;n++)i.push(a.blockprobe[n]),e.addBlockprobeToList(a.blockprobe[n])})),e.getNewBlockprobesTillThisSession(a)}))}},{key:"selectBlockprobe",value:function(e,t){var a=this.state.tooltip;a.buildStory=t,this.setState({selectedBlockprobeId:e,isWallOpened:!1,isNotificationsOpened:!1,isGameListOpened:!1,tooltip:a})}},{key:"getAndSetUser",value:function(){if(this.state.isUserSignedIn){var e=this.state.userId,t=this;y.firestore().collection("Users").doc(this.state.userId).get().then((function(a){if(!a.exists){var i={ID:e};y.firestore().collection("Users").doc(e).set(i);var n=t.state.tooltip;n.buildStory=!1,t.setState({tooltip:n})}}))}}},{key:"logout",value:function(){var e=Object(k.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.auth().signOut();case 2:return e.next=4,localStorage.setItem("isUserSignedIn",!1);case 4:return e.next=6,localStorage.removeItem("userId");case 6:return e.next=8,localStorage.removeItem("providerId");case 8:return e.next=10,this.setState({isUserSignedIn:!1,isWallOpened:!1,isNotificationsOpened:!1,isGameListOpened:!1});case 10:window.location.href="/";case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){var e=this;this.state.isUserSignedIn&&(this.getAndSetUser(),this.getBlockprobes(),this.getUserWall(),this.getUserNotifications()),y.auth().onAuthStateChanged((function(t){var a=e.state.isUserSignedIn;e.setState({isUserSignedIn:!!t}),localStorage.setItem("isUserSignedIn",!!t);var i="",n="";!Object(L.isNullOrUndefined)(y.auth().currentUser)&&!Object(L.isNullOrUndefined)(y.auth().currentUser.providerData)&&y.auth().currentUser.providerData.length>0&&(i=y.auth().currentUser.providerData[0].providerId),"phone"==i?n=y.auth().currentUser.phoneNumber:("google.com"==i||"password"==i)&&(n=y.auth().currentUser.email),e.setState({providerId:i,userId:n}),localStorage.setItem("providerId",i),localStorage.setItem("userId",n),!t||Object(L.isNullOrUndefined)(y.auth().currentUser)||a||(e.getAndSetUser(),e.getBlockprobes(),e.getUserWall(),e.getUserNotifications())}))}},{key:"updatePosts",value:function(e){Ua(e,this.state.userId),this.setState({posts:e})}},{key:"modifyBlockprobe",value:function(){var e=Object(k.a)(f.a.mark((function e(t,a){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("update"!=t){e.next=3;break}return e.next=3,y.firestore().collection("Users").doc(this.state.userId).collection("blockprobes").doc(a.id).set(a);case 3:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"renderGeneralLoggedInView",value:function(){return this.state.isWallOpened?n.a.createElement(tn,{posts:this.state.posts,isPrivate:!0,updatePosts:this.updatePosts}):this.state.isNotificationsOpened?n.a.createElement(nn,{notifications:this.state.notifications,userId:this.state.userId}):this.state.isGameListOpened?n.a.createElement(Nn,{userId:this.state.userId,selectedUserGame:this.state.selectedGameListId,selectGameList:this.selectGameList}):n.a.createElement(Wa,{blockprobes:this.state.blockprobes,selectedBlockprobe:this.state.selectedBlockprobeId,selectBlockprobe:this.selectBlockprobe,uId:this.state.userId,buildStorytooltip:this.state.tooltip.buildStory})}},{key:"loggedInContent",value:function(){return""!=this.state.userId?n.a.createElement("div",{className:"blockprobe-list-container"},this.state.blockprobes?n.a.createElement("div",null,this.state.areBlockprobesLoading?n.a.createElement("div",{style:{margin:"auto",width:"50px"}},n.a.createElement(Da.a,{type:"TailSpin",color:"#00BFFF",height:"50",width:"50"})):n.a.createElement("div",null,this.renderGeneralLoggedInView())):null):null}},{key:"loggedInView",value:function(){var e=this,t=null;return Object.keys(this.state.notifications).length>0&&(t=Object.keys(this.state.notifications).length),n.a.createElement("div",null,n.a.createElement("div",{style:{display:"block"}},n.a.createElement("header",{className:"toolbar"},n.a.createElement(sn.a,{position:"static"},n.a.createElement(ln.a,null,""!=this.state.selectedBlockprobeId||this.state.isGameListOpened||this.state.isNotificationsOpened?n.a.createElement(at.a,{color:"inherit",onClick:function(){return e.onBackButtonPressed()}},n.a.createElement(vn.a,null)):null,n.a.createElement(Pt.a,{className:"toolbar__logo"},"Blockprobe"),n.a.createElement("div",{style:{flexGrow:"1"}}),n.a.createElement(at.a,{color:"inherit",onClick:function(){return e.returnToViewBlockprobes()}},n.a.createElement(gn.a,null)),n.a.createElement(at.a,{color:"inherit",onClick:function(){return e.viewGameList()}},n.a.createElement(En.a,null)),n.a.createElement(at.a,{color:"inherit",onClick:function(){return e.viewNotifications()}},n.a.createElement(rn.a,{badgeContent:t,color:"secondary"},n.a.createElement(On.a,null))),n.a.createElement(Pt.a,{className:"userName"},this.state.userId),n.a.createElement(rt.a,{color:"inherit",onClick:function(){return e.logout()}},"Logout"))))),n.a.createElement("div",null,n.a.createElement("div",{className:"logged-in-content"},""!=this.state.selectedBlockprobeId&&this.state.selectedBlockprobeId in this.state.blockprobes?n.a.createElement("div",{className:"blockprobe-list-container"},n.a.createElement(_i,{bId:this.state.selectedBlockprobeId,uId:this.state.userId,permit:this.state.blockprobes[this.state.selectedBlockprobeId].permit,buildStorytooltip:this.state.tooltip.buildStory,prevTitle:this.state.blockprobes[this.state.selectedBlockprobeId].title,currBlockprobe:this.state.blockprobes[this.state.selectedBlockprobeId],modifyBlockprobe:this.modifyBlockprobe,posts:this.state.posts,updatePosts:this.updatePosts})):this.loggedInContent())))}},{key:"cueCardViewV2",value:function(e,t){return n.a.createElement("div",{className:"cue-card-container-v2",style:{width:"100%",display:"flex"}},n.a.createElement("div",{style:{padding:"10px 10px 10px 10px"}},n.a.createElement("div",{className:"cue-card-text",style:{fontFamily:"Lora, bold-italic",textAlign:"justify"}},t)))}},{key:"handleTabChange",value:function(e,t){this.setState({tabValue:t,currBackgroundIndex:t})}},{key:"changeOpacity",value:function(e){try{document.querySelector(".teacherImage").style.opacity=0,document.querySelector(".journalistImage").style.opacity=0,document.querySelector(".politicianImage").style.opacity=0;var t="."+this.state.allBackgrounds[e]+"Image";document.querySelector(t).style.opacity=1}catch(a){}}},{key:"loggedOutView",value:function(){var e=[en.a],t=(this.state.landingPage[this.state.allBackgrounds[this.state.currBackgroundIndex]].background,this.state.landingPage[this.state.allBackgrounds[this.state.currBackgroundIndex]]);return this.changeOpacity(this.state.currBackgroundIndex),n.a.createElement("div",null,n.a.createElement("main",{style:{height:"100vh",overflow:"hidden"}},n.a.createElement("div",{style:{height:"100vh",overflow:"auto"}},n.a.createElement("img",{class:"background-image teacherImage",src:Xi.a}),n.a.createElement("img",{class:"background-image journalistImage",src:Ki.a}),n.a.createElement("img",{class:"background-image politicianImage",src:$i.a}),n.a.createElement(Ea.a,{fonts:[{font:"Roboto",weights:[400,"400i"]},{font:"Roboto Mono",weights:[400,700]},{font:"Bungee Inline",weights:[400]},{font:"Lora",weights:[400]}],subsets:["cyrillic-ext","greek"]}),n.a.createElement("div",{className:"landing-view-container"},n.a.createElement("div",{style:{paddingTop:"10px",textAlign:"center"}},n.a.createElement(F.a,{src:e,style:{width:"50%"}})),n.a.createElement("div",{style:{fontFamily:"Lora, bold-italic",textAlign:"center",fontSize:"26px",fontWeight:"bold"}},n.a.createElement("span",null,"Visually engage your audience and yourself with your work.")),n.a.createElement("div",{className:"lpTabContainer"},n.a.createElement(Mt.a,{square:!0,className:"lpTabPaper"},n.a.createElement(on.a,{value:this.state.tabValue,onChange:this.handleTabChange,variant:"fullWidth",indicatorColor:"primary",textColor:"primary","aria-label":"icon tabs example"},n.a.createElement(cn.a,{icon:n.a.createElement(un.a,null),value:0,"aria-label":"phone",label:"TEACHERS"}),n.a.createElement(cn.a,{icon:n.a.createElement(bn.a,null),value:1,"aria-label":"person",label:"JOURNALISTS"}),n.a.createElement(cn.a,{icon:n.a.createElement(pn.a,null),value:2,"aria-label":"favorite",label:"LAWMAKERS"})))),n.a.createElement("div",{style:{marginTop:"16px"}},this.cueCardViewV2(t.logo,t.text)),this.state.showLogin?n.a.createElement("div",{className:"user-session-login-container-v2"},n.a.createElement("div",{className:"user-session-shadow-view-v2"},n.a.createElement("div",null,n.a.createElement("span",{className:"userSessionLoginHeader"},"Login")),n.a.createElement(bt.a,{uiConfig:this.getUiConfig(),firebaseAuth:y.auth()}))):null,n.a.createElement("div",{style:{marginTop:"3%"}},n.a.createElement("a",{style:{fontFamily:"Roboto, sans-serif",margin:"3%"},href:"https://sites.google.com/view/blockprobe/quickstart",target:"blank"},"Quickstart"),n.a.createElement("a",{style:{fontFamily:"Roboto, sans-serif",margin:"3%"},href:"https://sites.google.com/view/blockprobe/home",target:"blank"},"About"),n.a.createElement("a",{style:{fontFamily:"Roboto, sans-serif",margin:"3%"},href:"https://sites.google.com/view/blockprobe/privacy-policy",target:"blank"},"Privacy Policy"),n.a.createElement("a",{style:{fontFamily:"Roboto, sans-serif",margin:"3%"},href:"https://sites.google.com/view/blockprobe/terms-of-service",target:"blank"},"Terms of Service"))),n.a.createElement("div",null))))}},{key:"render",value:function(){return n.a.createElement("div",null,this.state.isUserSignedIn?this.loggedInView():this.loggedOutView())}}]),a}(n.a.Component),jn=(a(850),function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).state={topPerformance:[],latestPerformances:[],topTimelinePerformance:[],title:null,isLoading:!0},i.formatEntityStats=i.formatEntityStats.bind(Object(v.a)(i)),i.renderSinglePerformance=i.renderSinglePerformance.bind(Object(v.a)(i)),i.getData=i.getData.bind(Object(v.a)(i)),i}return Object(o.a)(a,[{key:"getData",value:function(e){if(!Object(L.isNullOrUndefined)(e)){var t=this.props.gameId,a=y.firestore().collection("Users").doc(e).collection("gameScores"),i=a.where("bpId","==",t).orderBy("score","desc").limit(1).get(),n=a.where("bpId","==",String(t+"_ts")).orderBy("score","desc").limit(1).get(),s=[i,a.where("bpId","==",t).orderBy("ts","desc").limit(5).get(),n],l=this;Promise.all(s).then((function(e){var t=Object(g.a)(e,3),a=t[0],i=t[1],n=t[2],s=[];a.forEach((function(e){var t=e.data();s.push(t)}));var r=[];n.forEach((function(e){var t=e.data();r.push(t)}));var o=[];if(i.forEach((function(e){var t=e.data();o.push(t)})),o.length>0){var c=o[0].bpTitle;l.setState({title:c})}l.setState({topPerformance:s,topTimelinePerformance:r,latestPerformances:o,isLoading:!1})}),(function(e){l.setState({topPerformance:[],latestPerformances:[],isLoading:!1})}))}}},{key:"componentDidMount",value:function(){Object(L.isNullOrUndefined)(this.props.userId)||this.getData(this.props.userId)}},{key:"componentWillReceiveProps",value:function(e){this.props.userId!=e.userId&&(this.setState({isLoading:!0}),this.getData(e.userId))}},{key:"formatEntityStats",value:function(e){var t={};if(Object(L.isNullOrUndefined)(e))return{};for(var a in e)e[a]&&(t[a]=e[a].mistakes);return t}},{key:"isEntityStatsNewType",value:function(e){if(Object(L.isNullOrUndefined)(e))return!1;for(var t in e)if(Object(L.isNullOrUndefined)(e[t].mistakes))return!1;return!0}},{key:"renderSinglePerformance",value:function(e,t,a){return this.isEntityStatsNewType(e.entityStats)&&(e.entityStats=this.formatEntityStats(e.entityStats)),n.a.createElement("div",null,n.a.createElement(vt,{stats:e,bpId:this.props.gameId,title:this.state.title,id:String(e.ts)+"_"+t+"_"+a,ts:e.ts,canSave:!1,type:a}))}},{key:"render",value:function(){var e=this,t=(this.state.latestPerformances.map((function(t){return e.renderSinglePerformance(t,"latest","graphGame")})),this.state.topPerformance.map((function(t){return e.renderSinglePerformance(t,"top","graphGame")}))),a=this.state.topTimelinePerformance.map((function(t){return e.renderSinglePerformance(t,"top","timeline")}));return n.a.createElement("div",null,this.state.isLoading?n.a.createElement("div",{style:{width:"50px",margin:"auto"}},n.a.createElement(Da.a,{type:"TailSpin",color:"#00BFFF",height:"50",width:"50"})):n.a.createElement("div",{style:{paddingTop:"20px"}},0==this.state.topPerformance.length?n.a.createElement("h4",{className:"gamePerformanceHeader"},"User has not played game yet"):n.a.createElement("div",null,this.state.topPerformance.length>0?n.a.createElement("div",null,n.a.createElement("h4",{className:"gamePerformanceHeader"},"Match the topics"),n.a.createElement("div",{className:"gamePerformanceContent"},t)):null,this.state.topTimelinePerformance.length>0?n.a.createElement("div",null,n.a.createElement("h4",{className:"gamePerformanceHeader"},"Fill the dates"),n.a.createElement("div",{className:"gamePerformanceContent"},a)):null)))}}]),a}(n.a.Component)),Cn=function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).state={userId:"",displayedUserId:""},i.isValidUserId=i.isValidUserId.bind(Object(v.a)(i)),i.handleChange=i.handleChange.bind(Object(v.a)(i)),i.displayUserScore=i.displayUserScore.bind(Object(v.a)(i)),i}return Object(o.a)(a,[{key:"isValidUserId",value:function(e){return!Object(L.isNullOrUndefined)(e)&&e.length>0}},{key:"handleChange",value:function(e,t){var a=!1,i=e.target.value;if("userId"==t&&Oe(i,["\n","\t"])&&(a=!0),a&&"userId"==t){var n=e.target.value;this.setState({userId:n})}}},{key:"displayUserScore",value:function(){this.setState({displayedUserId:this.state.userId.trim()})}},{key:"render",value:function(){var e=this;return n.a.createElement("div",null,n.a.createElement("div",{className:"input-userId-getScore-container"},n.a.createElement("h3",null,"Input userId"),n.a.createElement("form",null,n.a.createElement("label",null,n.a.createElement(Ra.a,{type:"text",variant:"outlined",multiline:!0,placeholder:"Enter userId",value:this.state.userId,onChange:function(t){e.handleChange(t,"userId")},rowsMax:"1",rows:"1",style:{background:"white",marginTop:"6px",marginBottom:"6px",width:"30%"}}))),n.a.createElement("div",{className:"viewGameResultsOptionsContainer"},this.isValidUserId(this.state.userId)?n.a.createElement(rt.a,{variant:"contained",className:"displayUserGameScoreButton",style:{marginTop:"1em"},onClick:function(t){return e.displayUserScore("creator",!0)}},n.a.createElement("div",null,"Confirm")):null)),!Object(L.isNullOrUndefined)(this.props.match.params.gameId)&&this.isValidUserId(this.state.displayedUserId)?n.a.createElement(jn,{gameId:this.props.match.params.gameId,userId:this.state.displayedUserId}):null)}}]),a}(n.a.Component),In=(a(1688),function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).state={userId:"",posts:[],doesNotExist:!1,isLoading:!0},Object(L.isNullOrUndefined)(e.match.params.userId)||(i.state.userId=JSON.parse(JSON.stringify(e.match.params.userId))),i.getUserWall=i.getUserWall.bind(Object(v.a)(i)),i.buildUserWall=i.buildUserWall.bind(Object(v.a)(i)),i}return Object(o.a)(a,[{key:"getUserWall",value:function(){var e=this;y.firestore().collection("publicWall").doc(this.state.userId).collection("userPosts").get().then((function(t){e.buildUserWall(t)}),(function(t){e.setState({posts:[],doesNotExist:!0,isLoading:!1})}))}},{key:"buildUserWall",value:function(e){var t=[];e.forEach((function(e){for(var a=e.data(),i=0;a&&a.posts&&i<a.posts.length;i++)t.push(a.posts[i])}));var a=this.state.doesNotExist;0==t.length&&(a=!0),this.setState({posts:t,doesNotExist:a,isLoading:!1})}},{key:"componentDidMount",value:function(){this.getUserWall()}},{key:"render",value:function(){return n.a.createElement("div",null,n.a.createElement(Ea.a,{fonts:[{font:"Lora",weights:[400]}],subsets:["cyrillic-ext","greek"]}),n.a.createElement("h2",{style:{fontFamily:"Lora, bold-italic",textAlign:"center",fontSize:"26px"}},this.state.userId),this.state.isLoading?n.a.createElement("div",{style:{width:"50px",margin:"auto"}},n.a.createElement(Da.a,{type:"TailSpin",color:"#00BFFF",height:"50",width:"50"})):n.a.createElement("div",null,this.state.doesNotExist?n.a.createElement("div",{className:"noWallInfoMessage"},n.a.createElement("p",null,"This user either does not exist or does not have any posts on their wall!")):n.a.createElement(tn,{posts:this.state.posts,isPrivate:!1})))}}]),a}(n.a.Component)),Ln=a(611),Dn=(a(1700),{height:"390",width:"100%",playerVars:{autoplay:0}}),Un=function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).state={gameListId:i.props.match.params.gameListId,list:[],title:null,isLoading:!0},i.singleGameListItem=i.singleGameListItem.bind(Object(v.a)(i)),i.renderGameListFull=i.renderGameListFull.bind(Object(v.a)(i)),i}return Object(o.a)(a,[{key:"componentDidMount",value:function(){var e=Object(k.a)(f.a.mark((function e(){var t,a,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(L.isNullOrUndefined)(this.state.gameListId)){e.next=5;break}return e.next=3,y.firestore().collection("publicGameList").doc(this.state.gameListId).get();case 3:(t=e.sent).exists?(a=t.data().title,i=t.data().games,this.setState({list:i,title:a,isLoading:!1})):this.setState({isLoading:!1});case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"singleGameListItem",value:function(e){return n.a.createElement("div",{className:"singleGameListItemContainer"},n.a.createElement(Tn,{title:e.title,id:e.id}))}},{key:"renderGameListFull",value:function(){var e=this,t=this.state.list.map((function(t){return e.singleGameListItem(t)}));return n.a.createElement("div",null,n.a.createElement("h2",{className:"gameListTitle"},this.state.title),this.state.list.length>0?n.a.createElement("div",{style:{marginBottom:"40px"}},t):null,n.a.createElement("div",{className:"gameVideoLink"},n.a.createElement("h3",null,"Create your own game"),n.a.createElement("p",null,"Follow the steps in this video tutorial to create your own visualized game using ",n.a.createElement("a",{href:"https://blprobe.com",target:"_blank"},"Blockprobe"),"."),n.a.createElement("div",{className:"gameVideoContainer"},n.a.createElement(Lt.a,{item:!0,xs:12,md:6,className:"videoPadding"},n.a.createElement(Mt.a,{elevation:3},n.a.createElement(Ln.a,{videoId:"esZCwWauxV4",opts:Dn,onReady:this._onReady}))),n.a.createElement(Lt.a,{item:!0,xs:12,md:6,className:"videoPadding"},n.a.createElement(Mt.a,{elevation:3},n.a.createElement(Ln.a,{videoId:"AY74YJ697Ec",opts:Dn,onReady:this._onReady}))))))}},{key:"render",value:function(){return n.a.createElement("div",null,this.state.isLoading?n.a.createElement("div",{style:{width:"50px",margin:"auto"}},n.a.createElement(Da.a,{type:"TailSpin",color:"#00BFFF",height:"50",width:"50"})):this.renderGameListFull())}}]),a}(n.a.Component),An=function(e){Object(c.a)(a,e);var t=Object(d.a)(a);function a(){return Object(r.a)(this,a),t.apply(this,arguments)}return Object(o.a)(a,[{key:"render",value:function(){return n.a.createElement("div",{className:"App"},n.a.createElement(u.a,null,n.a.createElement(h.a,null,n.a.createElement(p.a,{path:"/wall/:userId",component:In}),n.a.createElement(p.a,{path:"/gameList/:gameListId",component:Un}),n.a.createElement(p.a,{path:"/gameResults/:gameId",component:Cn}),n.a.createElement(p.a,{path:"/:viewType/:bId",component:Va}),n.a.createElement(p.a,{exact:!0,path:"/",component:xn}),n.a.createElement(m.a,{from:"*",to:"/"}))))}}]),a}(i.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));y.initializeApp({apiKey:"AIzaSyBW_45Sz2fY7v5_obQr_WqXGLsLlfcjOGQ",authDomain:"blockprobe-32644.firebaseapp.com",databaseURL:"https://blockprobe-32644.firebaseio.com",projectId:"blockprobe-32644",storageBucket:"blockprobe-32644.appspot.com",messagingSenderId:"217518052082"}),l.a.render(n.a.createElement(An,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},441:function(e,t,a){e.exports=a.p+"static/media/well_done.ee86f2ec.mp3"},442:function(e,t,a){e.exports=a.p+"static/media/try_again.c4b2f20c.mp3"},515:function(e,t,a){},539:function(e,t,a){},583:function(e,t,a){},608:function(e,t,a){e.exports=a.p+"static/media/Journalist.fa9d5e95.jpg"},609:function(e,t,a){e.exports=a.p+"static/media/Teacher.08d8cb9c.jpg"},610:function(e,t,a){e.exports=a.p+"static/media/lawmaker.66d4da4e.jpg"},802:function(e,t,a){},815:function(e,t,a){},850:function(e,t,a){},882:function(e,t,a){e.exports=a.p+"static/media/logo.409a67ba.png"},939:function(e,t,a){e.exports=a(1701)}},[[939,1,3]]]);
//# sourceMappingURL=main.348bcdfd.chunk.js.map